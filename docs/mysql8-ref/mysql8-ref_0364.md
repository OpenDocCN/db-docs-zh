# 8.2.4 指定账户名

> 原文：[`dev.mysql.com/doc/refman/8.0/en/account-names.html`](https://dev.mysql.com/doc/refman/8.0/en/account-names.html)

MySQL 账户名由用户名和主机名组成，这使得可以为从不同主机连接的具有相同用户名的用户创建不同的账户。本节描述了账户名的语法，包括特殊值和通配符规则。

在大多数方面，账户名与 MySQL 角色名类似，但有一些差异，详见第 8.2.5 节“指定角色名”。

账户名出现在 SQL 语句中，如`CREATE USER`、`GRANT`和`SET PASSWORD`，并遵循以下规则：

+   账户名语法为`'*`user_name`*'@'*`host_name`*'`。

+   `@'*`host_name`*'`部分是可选的。仅由用户名组成的账户名等同于`'*`user_name`*'@'%'`。例如，`'me'`等同于`'me'@'%'`。

+   如果用户名和主机名作为未引用的标识符是合法的，则不需要加引号。如果*`user_name`*字符串包含特殊字符（如空格或`-`），或者*`host_name`*字符串包含特殊字符或通配符字符（如`.`或`%`），则必须使用引号。例如，在账户名`'test-user'@'%.com'`中，用户名称和主机名部分都需要引号。

+   将用户名称和主机名引用为标识符或字符串，可以使用反引号进行引用。

+   如果用户名和主机名部分被引用，则必须分别引用。也就是说，写成`'me'@'localhost'`，而不是`'me@localhost'`。（后者实际上等同于`'me@localhost'@'%'`，尽管这种行为现在已被弃用。）

+   对`CURRENT_USER`或`CURRENT_USER()`函数的引用等同于直接指定当前客户端的用户名和主机名。

MySQL 使用独立列在`mysql`系统数据库的授权表中存储账户名的用户名称和主机名部分：

+   `user`表为每个账户包含一行。`User`和`Host`列存储用户名和主机名。该表还指示了账户具有哪些全局权限。

+   其他授权表显示了账户对数据库和数据库内对象的权限。这些表有`User`和`Host`列用于存储账户名。这些表中的每一行都与`user`表中具有相同`User`和`Host`值的账户相关联。

+   对于访问检查目的，User 值的比较区分大小写。Host 值的比较不区分大小写。

有关存储在授权表中的用户名称和主机名属性的详细信息，例如最大长度，请参阅 Grant Table Scope Column Properties。

用户名和主机名具有特定的特殊值或通配符约定，如下所述。

帐户名的用户名部分要么是一个非空值，字面上匹配传入连接尝试的用户名，要么是一个空值（空字符串），匹配任何用户名。具有空用户名的帐户是匿名用户。要在 SQL 语句中指定匿名用户，请使用带引号的空用户名部分，例如`''@'localhost'`。

帐户名的主机名部分可以采用多种形式，并且允许使用通配符：

+   主机值可以是主机名或 IP 地址（IPv4 或 IPv6）。名称`'localhost'`表示本地主机。IP 地址`'127.0.0.1'`表示 IPv4 环回接口。IP 地址`'::1'`表示 IPv6 环回接口。

+   在主机名或 IP 地址值中允许使用`%`和`_`通配符字符，但自 MySQL 8.0.35 起已不推荐使用，并且可能在将来的 MySQL 版本中删除。这些字符的含义与使用`LIKE`运算符执行的模式匹配操作相同。例如，主机值`'%'`匹配任何主机名，而值`'%.mysql.com'`匹配`mysql.com`域中的任何主机。`'198.51.100.%'`匹配 198.51.100 类 C 网络中的任何主机。

    因为主机值中允许使用 IP 通配符值（例如，`'198.51.100.%'`匹配子网上的每个主机），因此某人可能尝试利用此功能，将主机命名为`198.51.100.somewhere.com`。为了阻止这种尝试，MySQL 不会对以数字和点开头的主机名进行匹配。例如，如果主机名为`1.2.example.com`，其名称永远不会与帐户名的主机部分匹配。IP 通配符值只能匹配 IP 地址，而不能匹配主机名。

    如果`partial_revokes`为`ON`，MySQL 将`%`和`_`视为文字字符，而不是通配符。从 MySQL 8.0.35 开始，不推荐使用这些通配符（无论此变量的值如何），您应该期望这种功能在将来的 MySQL 版本中被移除。

+   对于指定为 IPv4 地址的主机值，可以提供一个子网掩码来指示用于网络号的地址位数。子网掩码表示法不能用于 IPv6 地址。

    语法是`*`host_ip`*/*`netmask`*`。例如：

    ```sql
    CREATE USER 'david'@'198.51.100.0/255.255.255.0';
    ```

    这使得`david`可以从具有 IP 地址*`client_ip`*的任何客户端主机连接，条件如下：

    ```sql
    *client_ip* & *netmask* = *host_ip*
    ```

    对于刚刚显示的`CREATE USER`语句：

    ```sql
    *client_ip* & 255.255.255.0 = 198.51.100.0
    ```

    满足此条件的 IP 地址范围从 `198.51.100.0` 到 `198.51.100.255`。

    掩码通常以设置为 1 的位开始，然后是设置为 0 的位。示例：

    +   `198.0.0.0/255.0.0.0`: 198 类 A 网络上的任何主机

    +   `198.51.0.0/255.255.0.0`: 198.51 类 B 网络上的任何主机

    +   `198.51.100.0/255.255.255.0`: 198.51.100 类 C 网络上的任何主机

    +   `198.51.100.1`: 仅具有此特定 IP 地址的主机

+   自 MySQL 8.0.23 起，指定为 IPv4 地址的主机值可以使用 CIDR 表示法，例如 `198.51.100.44/24`。

服务器通过系统 DNS 解析器返回的客户端主机名或 IP 地址的值来匹配帐户名称中的主机值。除非使用网络掩码表示帐户主机值，服务器将执行此比较作为字符串匹配，即使帐户主机值以 IP 地址形式给出。这意味着您应该以 DNS 使用的相同格式指定帐户主机值。以下是需要注意的问题示例：

+   假设本地网络上的主机具有完全限定名称 `host1.example.com`。如果 DNS 返回此主机的名称查找为 `host1.example.com`，请在帐户主机值中使用该名称。如果 DNS 只返回 `host1`，请改用 `host1`。

+   如果 DNS 返回给定主机的 IP 地址为 `198.51.100.2`，则匹配帐户主机值为 `198.51.100.2`，但不匹配 `198.051.100.2`。同样，它匹配帐户主机模式如 `198.51.100.%`，但不匹配 `198.051.100.%`。

为避免此类问题，建议检查 DNS 返回主机名和地址的格式。在 MySQL 帐户名称中使用相同格式的值。

# 9.1 备份和恢复类型

> 原文：[`dev.mysql.com/doc/refman/8.0/en/backup-types.html`](https://dev.mysql.com/doc/refman/8.0/en/backup-types.html)

本节描述了不同类型备份的特点。

### 物理（原始）与逻辑备份

物理备份由存储数据库内容的目录和文件的原始副本组成。这种备份适用于需要在出现问题时快速恢复的大型重要数据库。

逻辑备份保存的信息表示为逻辑数据库结构（`CREATE DATABASE`，`CREATE TABLE`语句）和内容（`INSERT`语句或分隔文本文件）。这种类型的备份适用于数据量较小的情况，您可能需要编辑数据值或表结构，或者在不同的机器架构上重新创建数据。

物理备份方法具有以下特点：

+   备份由数据库目录和文件的精确副本组成。通常这是 MySQL 数据目录的全部或部分副本。

+   物理备份方法比逻辑备份更快，因为它们只涉及文件复制而不涉及转换。

+   输出比逻辑备份更紧凑。

+   由于备份速度和紧凑性对于繁忙、重要的数据库至关重要，MySQL Enterprise Backup 产品执行物理备份。有关 MySQL Enterprise Backup 产品的概述，请参见第 32.1 节，“MySQL Enterprise Backup 概述”。

+   备份和恢复的粒度范围从整个数据目录的级别到单个文件的级别。这可能或可能不提供表级粒度，这取决于存储引擎。例如，`InnoDB`表可以分别存储在单独的文件中，或与其他`InnoDB`表共享文件存储；每个`MyISAM`表对应于一组文件。

+   除了数据库，备份还可以包括任何相关文件，如日志或配置文件。

+   通过这种方式备份`MEMORY`表的数据有些棘手，因为它们的内容不存储在磁盘上。（MySQL Enterprise Backup 产品具有一个功能，可以在备份过程中检索`MEMORY`表的数据。）

+   备份只能在具有相同或类似硬件特征的其他机器之间进行移植。

+   可以在 MySQL 服务器未运行时执行备份。如果服务器正在运行，则需要执行适当的锁定，以确保服务器在备份过程中不更改数据库内容。对于需要的表，MySQL Enterprise Backup 会���动执行此锁定。

+   物理备份工具包括 MySQL Enterprise Backup 的**mysqlbackup**用于`InnoDB`或任何其他表，或文件系统级别的命令（如**cp**，**scp**，**tar**，**rsync**）用于`MyISAM`表。

+   恢复时：

    +   MySQL Enterprise Backup 可以恢复备份的`InnoDB`和其他表。

    +   **ndb_restore** 用于恢复`NDB`表。

    +   在文件系统级别复制的文件可以使用文件系统命令复制回其原始位置。

逻辑备份方法具有以下特点：

+   备份是通过查询 MySQL 服务器获取数据库结构和内容信息完成的。

+   备份比物理方法慢，因为服务器必须访问数据库信息并将其转换为逻辑格式。如果输出写在客户端端，服务器还必须将其发送给备份程序。

+   输出比物理备份大，特别是以文本格式保存时。

+   备份和恢复的粒度可在服务器级别（所有数据库）、数据库级别（特定数据库中的所有表）或表级别进行。这对于存储引擎都是适用的。

+   备份不包括日志或配置文件，或其他不属于数据库的数据库相关文件。

+   存储在逻辑格式中的备份是与机器无关且高度可移植的。

+   逻辑备份是在 MySQL 服务器运行时执行的。服务器不会被停机。

+   逻辑备份工具包括**mysqldump**程序和`SELECT ... INTO OUTFILE`语句。这些适用于任何存储引擎，甚至`MEMORY`。

+   要恢复逻辑备份，可以使用**mysql**客户端处理 SQL 格式的转储文件。要加载分隔文本文件，请使用`LOAD DATA`语句或**mysqlimport**客户端。

### 在线与离线备份

在线备份是在 MySQL 服务器运行时进行的，以便从服务器获取数据库信息。离线备份是在服务器停止时进行的。这种区别也可以描述为“热”与“冷”备份；“温暖”备份是指服务器保持运行但被锁定以防止修改数据，同时您可以在外部访问数据库文件。

在线备份方法具有以下特点：

+   备份对其他客户端的干扰较小，这些客户端可以在备份期间连接到 MySQL 服务器，并根据需要执行的操作访问数据。

+   必须谨慎地施加适当的锁定，以防止发生会损害备份完整性的数据修改。MySQL Enterprise Backup 产品会自动执行此类锁定。

离线备份方法具有以下特点：

+   客户端可能受到不利影响，因为服务器在备份期间不可用。因此，这种备份通常是从可以脱机而不影响可用性的副本中进行的。

+   备份过程更简单，因为不会受到客户端活动的干扰。

在恢复操作中也存在在线和离线的区别，并且具有类似的特征。然而，客户端更有可能受到在线恢复的影响，而不是在线备份，因为恢复需要更强的锁定。在备份期间，客户端可能能够读取数据，而在恢复数据时，客户端必须被阻止访问数据，因为恢复会修改数据而不仅仅是读取数据。

### 本地与远程备份

本地备份是在运行 MySQL 服务器的同一主机上执行的，而远程备份是从不同主机执行的。对于某些类型的备份，即使输出是在服务器本地写入的，备份也可以从远程主机启动。

+   **mysqldump**可以连接到本地或远程服务器。对于 SQL 输出（`CREATE`和`INSERT`语句），可以进行本地或远程转储，并在客户端生成输出。对于分隔文本输出（使用`--tab`选项），数据文件将在服务器主机上创建。

+   `SELECT ... INTO OUTFILE`可以从本地或远程客户端主机启动，但输出文件将在服务器主机上创建。

+   物理备份方法通常在 MySQL 服务器主机上本地启动，以便服务器可以脱机，尽管复制文件的目的地可能是远程的。

### 快照备份

一些文件系统实现允许进行“快照”操作。这些提供了文件系统在特定时间点的逻辑副本，而无需对整个文件系统进行物理复制。（例如，实现可能使用写时复制技术，因此只需要复制快照时间后修改的文件系统的部分。）MySQL 本身不提供进行文件系统快照的功能。可以通过第三方解决方案（如 Veritas、LVM 或 ZFS）来实现。

### 完全与增量备份

完全备份包括在特定时间点上由 MySQL 服务器管理的所有数据。增量备份包括在给定时间段内对数据所做的更改（从一个时间点到另一个时间点）。MySQL 有不同的方法来执行完全备份，比如在本节中早些时候描述的那些。通过启用服务器的二进制日志，可以实现增量备份，服务器使用该日志记录数据更改。

### 完全备份与时间点（增量）恢复

完全恢复会从完全备份中恢复所有数据。这将使服务器实例恢复到备份时的状态。如果该状态不够及时，可以在完全恢复后恢复自完全备份以来制作的增量备份，将服务器带到更加及时的状态。

增量恢复是在给定时间段内恢复所做更改。这也被称为按时间点恢复，因为它使服务器的状态保持到给定时间。按时间点恢复基于二进制日志，通常在从备份文件进行完全恢复后进行，将服务器恢复到备份时的状态。然后，二进制日志文件中写入的数据更改将作为增量恢复应用，重新执行数据修改，将服务器带到所需的时间点。

### 表维护

如果表损坏，数据完整性可能会受到损害。对于`InnoDB`表，这不是一个典型问题。要检查`MyISAM`表并在发现问题时修复它们的程序，请参阅第 9.6 节，“MyISAM 表维护和崩溃恢复”。

### 备份调度、压缩和加密

备份调度对于自动化备份程序非常有价值。备份输出的压缩可以减少空间需求，输出的加密可以提供更好的安全性，防止未经授权访问备份数据。MySQL 本身不提供这些功能。MySQL 企业备份产品可以压缩`InnoDB`备份，使用文件系统工具可以实现备份输出的压缩或加密。也可以使用其他第三方解决方案。

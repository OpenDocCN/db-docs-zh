> 译文：[`dev.mysql.com/doc/refman/8.0/en/innodb-file-per-table-tablespaces.html`](https://dev.mysql.com/doc/refman/8.0/en/innodb-file-per-table-tablespaces.html)

#### 17.6.3.2 每表一个表空间

每表一个表空间包含单个`InnoDB`表的数据和索引，并存储在单个数据文件中的文件系统中。

每表一个表空间的特性在本节中的以下主题下描述：

+   每表一个表空间配置

+   每表一个表空间数据文件

+   每表一个表空间优势

+   每表一个表空间的缺点

##### 每表一个表空间配置

`InnoDB`默认在每表一个表空间中创建表。此行为由`innodb_file_per_table`变量控制。禁用`innodb_file_per_table`会导致`InnoDB`在系统表空间中创建表。

可以在选项文件中指定`innodb_file_per_table`设置，也可以使用`SET GLOBAL`语句在运行时进行配置。在运行时更改设置需要足够权限来设置全局系统变量。请参见第 7.1.9.1 节，“系统变量权限”。

选项文件：

```sql
[mysqld]
innodb_file_per_table=ON
```

在运行时使用`SET GLOBAL`：

```sql
mysql> SET GLOBAL innodb_file_per_table=ON;
```

##### 每表一个表空间数据文件

每表一个表空间在 MySQL 数据目录下的模式目录中创建一个`.ibd`数据文件。`.ibd`文件以表名（`*`table_name`*.ibd`）命名。例如，表`test.t1`的数据文件将在 MySQL 数据目录下的`test`目录中创建：

```sql
mysql> USE test;

mysql> CREATE TABLE t1 (
   id INT PRIMARY KEY AUTO_INCREMENT,
   name VARCHAR(100)
 ) ENGINE = InnoDB;

$> cd /*path*/*to*/*mysql*/data/test
$> ls
t1.ibd
```

您可以使用`CREATE TABLE`语句的`DATA DIRECTORY`子句隐式地在数据目录之外创建一个每表一个表空间数据文件。有关更多信息，请参见第 17.6.1.2 节，“外部创建表”。

##### 每表一个表空间优势

每表一个表空间相对于共享表空间（如系统表空间或通用表空间）具有以下优势。

+   在每表表空间中创建的表被截断或删除后，磁盘空间将返回给操作系统。在共享表空间中截断或删除表会在共享表空间数据文件中创建可用于`InnoDB`数据的空闲空间。换句话说，共享表空间数据文件在截断或删除表后不会缩小。

+   在共享表空间中的表上执行表复制的`ALTER TABLE`操作可能会增加表空间所占用的磁盘空间。这些操作可能需要额外的空间，与表中的数据加索引相同。这些空间不会像每表表空间那样释放回操作系统。

+   在每表表空间文件中的表上执行`TRUNCATE TABLE`性能更好。

+   可以在单独的存储设备上为 I/O 优化、空间管理或备份目的创建每表表空间数据文件。请参见第 17.6.1.2 节，“外部创建表”。

+   您可以从另一个 MySQL 实例导入位于每表表空间中的表。请参见第 17.6.1.3 节，“导入 InnoDB 表”。

+   在每表表空间文件中创建的表支持与系统表空间不支持的`DYNAMIC`和`COMPRESSED`行格式相关的功能。请参见第 17.10 节，“InnoDB 行格式”。

+   存储在单独表空间数据文件中的表在数据损坏发生、备份或二进制日志不可用或 MySQL 服务器实例无法重新启动时，可以节省时间并提高成功恢复的机会。

+   在每表表空间文件中创建的表可以使用 MySQL 企业备份快速备份或恢复，而不会中断其他`InnoDB`表的使用。这对备份计划不同或需要较少备份的表非常有益。详细信息请参见进行部分备份。

+   每表表空间允许通过监视表空间数据文件的大小来监视文件系统上的表大小。

+   常见的 Linux 文件系统不允许在将`innodb_flush_method`设置为`O_DIRECT`时对单个文件进行并发写入。因此，在使用此设置时，使用每表表空间文件的方式可能会带来性能改进。

+   共享表空间中的表受到 64TB 表空间大小限制的限制。相比之下，每个每表表空间都有一个 64TB 的大小限制，为表增长提供了充足的空间。

##### 以文件为单位的表空间的缺点

与系统表空间或通用表空间等共享表空间相比，以文件为单位的表空间具有以下缺点。

+   使用以文件为单位的表空间，每个表可能会有未使用的空间，只能由同一表的行利用，如果管理不当可能会导致空间浪费。

+   `fsync` 操作是在多个以文件为单位的数据文件上执行的，而不是在单个共享表空间数据文件上执行。由于 `fsync` 操作是针对每个文件的，多个表的写操作不能合并，这可能导致更多的 `fsync` 操作。

+   **mysqld** 必须为每个以文件为单位的表空间保持一个打开的文件句柄，如果在以文件为单位的表空间中有大量表，可能会影响性能。

+   每个表都有自己的数据文件时，需要更多的文件描述符。

+   存在更多的碎片化可能会妨碍 `DROP TABLE` 和表扫描性能。然而，如果管理碎片化，以文件为单位的表空间可以改善这些操作的性能。

+   当删除位于以文件为单位的表空间中的表时，需要扫描缓冲池，对于大型缓冲池可能需要几秒钟。扫描是使用广泛的内部锁执行的，这可能会延迟其他操作。

+   `innodb_autoextend_increment` 变量定义了在自动扩展的共享表空间文件满时扩展大小的增量大小，但不适用于自动扩展的以文件为单位的表空间文件，这些文件无论 `innodb_autoextend_increment` 设置如何都会自动扩展。初始以文件为单位的表空间扩展量很小，之后以 4MB 的增量进行扩展。

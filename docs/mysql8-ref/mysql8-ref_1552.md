# 20.8.1 在组中组合不同的成员版本

> 原文：[`dev.mysql.com/doc/refman/8.0/en/group-replication-online-upgrade-combining-versions.html`](https://dev.mysql.com/doc/refman/8.0/en/group-replication-online-upgrade-combining-versions.html)

20.8.1.1 升级期间的成员版本

20.8.1.2 组复制通信协议版本

组复制的版本与捆绑有 Group Replication 插件的 MySQL 服务器版本相对应。例如，如果一个成员运行 MySQL 5.7.26，则 Group Replication 插件的版本就是这个版本。要检查组成员上的 MySQL 服务器版本，请发出：

```sql
SELECT MEMBER_HOST,MEMBER_PORT,MEMBER_VERSION FROM performance_schema.replication_group_members;
+-------------+-------------+----------------+
| member_host | member_port | member_version |
+-------------+-------------+----------------+
| example.com |	   3306     |   8.0.13	     |
+-------------+-------------+----------------+
```

有关理解 MySQL 服务器版本和选择版本的指导，请参见 Section 2.1.2，“选择要安装的 MySQL 版本和发行版”。

为了获得最佳兼容性和性能，组中的所有成员应该运行相同版本的 MySQL 服务器，因此也应该运行相同版本的组复制。然而，在在线升级组的过程中，为了最大化可用性，您可能需要同时运行具有不同 MySQL 服务器版本的成员。根据 MySQL 版本之间的更改，您可能会在这种情况下遇到不兼容性。例如，如果在主要版本之间已弃用某个功能，则将版本组合到组中可能导致依赖于已弃用功能的成员失败。相反，如果在组中有运行较新 MySQL 版本的读写成员时向运行较旧 MySQL 版本的成员写入数据，可能会导致缺少较新版本引入的功能的成员出现问题。

为了防止这些问题，组复制包括兼容性策略，使您能够安全地将运行不同 MySQL 版本的成员组合到同一组中。成员应用这些策略来决定是否正常加入组，或以只读模式加入，或不加入组，具体取决于哪种选择能够确保加入成员和现有组成员的安全运行。在升级场景中，每个服务器必须离开组，进行升级，然后使用新的服务器版本重新加入组。此时，成员将应用其新服务器版本的策略，这可能已经与其最初加入组时应用的策略不同。

作为管理员，你可以通过配置服务器并发出 `START GROUP_REPLICATION` 语句，指示任何服务器尝试加入任何组。加入组或不加入组，或以只读模式加入组的决定由加入成员自己在尝试将其添加到组后进行，并由其自行实施。加入成员接收当前组成员的 MySQL 服务器版本信息，评估自己与这些成员的兼容性，并应用其自己 MySQL 服务器版本中使用的策略（*而不是*现有成员使用的策略）来决定是否兼容。

加入组时，加入成员应用的兼容性策略如下：

+   如果成员运行的 MySQL 服务器版本低于现有组成员运行的最低版本，则该成员不加入组。

+   如果成员运行的 MySQL 服务器版本与现有组成员运行的最低版本相同，则该成员正常加入组。

+   如果成员运行的 MySQL 服务器版本高于现有组成员运行的最低版本，则该成员加入组但保持只读模式。这种行为仅在组以多主模式运行时才有区别，因为在以单主模式运行的组中，新添加的成员默认始终为只读模式。

运行 MySQL 8.0.17 或更高版本的成员在检查兼容性时考虑发布的补丁版本。运行 MySQL 8.0.16 或更低版本，或 MySQL 5.7 的成员只考虑主要版本。例如，如果你有一个所有成员都运行 MySQL 版本 8.0.13 的组：

+   运行 MySQL 版本 5.7 的成员无法加入。

+   运行 MySQL 8.0.16 的成员正常加入（因为它考虑主要版本）。

+   运行 MySQL 8.0.17 的成员加入但保持只读模式（因为它考虑了补丁版本）。

请注意，运行 MySQL 5.7.27 之前版本的加入成员会检查所有组成员，以确定自己的 MySQL 服务器主要版本是否较低。因此，对于任何成员运行 MySQL 8.0 版本的组，它们将无法通过此检查，即使该组已经有其他运行 MySQL 5.7 的成员。从 MySQL 5.7.27 开始，加入成员只会检查运行最低主要版本的组成员，因此它们可以加入一个混合版本组，其中存在其他 MySQL 5.7 服务器。

在一个多主模式组中，成员使用不同的 MySQL Server 版本，Group Replication 会自动管理运行 MySQL 8.0.17 或更高版本的成员的读写和只读状态。如果一个成员离开组，那些运行当前最低版本的成员会自动设置为读写模式。当你将原本以单主模式运行的组改为多主模式时，使用`group_replication_switch_to_multi_primary_mode()`函数，Group Replication 会自动将成员设置为正确的模式。如果某些成员运行的 MySQL 服务器版本高于组中最低版本，那么它们会自动被设置为只读模式，而运行最低版本的成员会被设置为读写模式。

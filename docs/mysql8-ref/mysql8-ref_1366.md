# 19.1.6 复制和二进制日志选项和变量

> 原文：[`dev.mysql.com/doc/refman/8.0/en/replication-options.html`](https://dev.mysql.com/doc/refman/8.0/en/replication-options.html)

19.1.6.1 复制和二进制日志选项和变量参考

19.1.6.2 复制源选项和变量

19.1.6.3 副本服务器选项和变量

19.1.6.4 二进制日志选项和变量

19.1.6.5 全局事务 ID 系统变量

以下各节包含有关用于复制和控制二进制日志的**mysqld**选项和服务器变量的信息。用于源和副本的选项和变量分别进行了介绍，与二进制日志记录和全局事务标识符（GTID）相关的选项和变量也是如此。还包括一组快速参考表，提供有关这些选项和变量的基本信息。

特别重要的是`server_id` 系统变量。

| 命令行格式 | `--server-id=#` |
| --- | --- |
| 系统变量 | `server_id` |
| 范围 | 全局 |
| 动态 | 是 |
| `SET_VAR` 提示适用 | 否 |
| 类型 | 整数 |
| 默认值 | `1` |
| 最小值 | `0` |
| 最大值 | `4294967295` |

此变量指定服务器 ID。`server_id` 默认设置为 1。服务器可以使用此默认 ID 启动，但是当启用二进制日志记录时，如果您没有显式设置`server_id` 来指定服务器 ID，则会发出信息消息。

对于用于复制拓扑的服务器，您必须为每个复制服务器指定一个唯一的服务器 ID，范围从 1 到 2³² − 1。“唯一”意味着每个 ID 必须与复制拓扑中任何其他源或副本正在使用的任何其他 ID 不同。有关更多信息，请参见第 19.1.6.2 节，“复制源选项和变量”，以及第 19.1.6.3 节，“副本服务器选项和变量”。

如果服务器 ID 设置为 0，则会进行二进制日志记录，但具有服务器 ID 0 的源会拒绝来自副本的任何连接，具有服务器 ID 0 的副本会拒绝连接到源。请注意，尽管您可以将服务器 ID 动态更改为非零值，但这样做并不会立即启用复制。您必须更改服务器 ID，然后重新启动服务器以初始化副本。

有关更多信息，请参见第 19.1.2.2 节，“设置复制配置”。

`server_uuid`

MySQL 服务器生成一个真正的 UUID，除了默认或用户提供的`server_id`系统变量设置之外。这作为全局只读变量`server_uuid`可用。

注意

`server_uuid`系统变量的存在不会改变为每个 MySQL 服务器设置唯一`server_id`值的要求，如本节前面描述的。

| 系统变量 | `server_uuid` |
| --- | --- |
| 范围 | 全局 |
| 动态 | 否 |
| `SET_VAR`提示适用 | 否 |
| 类型 | 字符串 |

启动时，MySQL 服务器会自动获取 UUID，如���所示：

1.  尝试读取并使用写入文件`*`data_dir`*/auto.cnf`中的 UUID（其中*`data_dir`*是服务器的数据目录）。

1.  如果未找到`*`data_dir`*/auto.cnf`，则生成一个新的 UUID 并将其保存到此文件中，必要时创建该文件。

`auto.cnf`文件的格式类似于`my.cnf`或`my.ini`文件的格式。`auto.cnf`只有一个包含单个`server_uuid`设置和值的`[auto]`部分；文件的内容类似于这里显示的内容：

```sql
[auto]
server_uuid=8a94f357-aab4-11df-86ab-c80aa9429562
```

重要

`auto.cnf`文件是自动生成的；不要尝试编写或修改此文件。

在使用 MySQL 复制时，源和副本知道彼此的 UUID。副本的 UUID 值可以在`SHOW REPLICAS`的输出中看到（或在 MySQL 8.0.22 之前，在`SHOW SLAVE HOSTS`中）。一旦执行了`START REPLICA`，源的 UUID 值就可以在副本的`SHOW REPLICA STATUS`的输出中找到（在 MySQL 8.0.22 中，`SLAVE`关键字被`REPLICA`替换）。

注意

发出`STOP REPLICA`或`RESET REPLICA`语句不会重置在副本上使用的源 UUID。

服务器的`server_uuid`也用于 GTID 中在该服务器上发起的事务。有关更多信息，请参见第 19.1.3 节，“使用全局事务标识符进行复制”。

在启动时，如果复制 I/O（接收器）线程的源 UUID 等于自身 UUID，则会生成错误并中止，除非已设置`--replicate-same-server-id`选项。此外，如果以下任一情况为真，则复制接收器线程会生成警告：

+   没有符合预期`server_uuid`的源存在。

+   源的`server_uuid`已更改，尽管从未执行过`CHANGE REPLICATION SOURCE TO` | `CHANGE MASTER TO`语句。

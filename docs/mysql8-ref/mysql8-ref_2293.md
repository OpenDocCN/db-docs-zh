# B.1 错误消息来源和元素

> 原文：[`dev.mysql.com/doc/refman/8.0/en/error-message-elements.html`](https://dev.mysql.com/doc/refman/8.0/en/error-message-elements.html)

本节讨论了 MySQL 内部错误消息的产生方式以及它们包含的元素。

+   错误消息来源

+   错误消息元素

+   错误代码范围

### 错误消息来源

错误消息可以源自服务器端或客户端端：

+   在服务器端，错误消息可能发生在启动和关闭过程中，在 SQL 语句执行过程中等。

    +   MySQL 服务器将一些错误消息写入其错误日志。这些指示对数据库管理员感兴趣的问题或需要 DBA 操作。

    +   服务器向客户端程序发送其他错误消息。这些指示仅涉及特定客户端的问题。MySQL 客户端库接收来自服务器的错误并使其可供主机客户端程序使用。

+   客户端错误消息是由 MySQL 客户端库内部生成的，通常涉及与服务器通信的问题。

例如，写入错误日志的服务器端错误消息示例：

+   在启动过程中产生的此消息提供了状态或进度指示：

    ```sql
    2018-10-28T13:01:32.735983Z 0 [Note] [MY-010303] [Server] Skipping
    generation of SSL certificates as options related to SSL are specified.
    ```

+   此消息指示需要 DBA 操作的问题：

    ```sql
    2018-10-02T03:20:39.410387Z 768 [ERROR] [MY-010045] [Server] Event Scheduler:
    [evtuser@localhost][myschema.e_daily] Unknown database 'mydb'
    ```

例如，发送给客户端程序的服务器端错误消息示例，由**mysql**客户端显示：

```sql
mysql> SELECT * FROM no_such_table;
ERROR 1146 (42S02): Table 'test.no_such_table' doesn't exist
```

例如，源自客户端库内部的客户端端错误消息示例，由**mysql**客户端显示：

```sql
$> mysql -h no-such-host
ERROR 2005 (HY000): Unknown MySQL server host 'no-such-host' (-2)
```

无论错误是源自客户端库内部还是从服务器接收的，MySQL 客户端程序可能以不同方式响应。正如刚刚展示的，客户端可以显示错误消息，以便用户采取纠正措施。客户端也可以内部尝试解决或重试失败的操作，或采取其他操作。

### 错误消息元素

当发生错误时，错误信息包括几个元素：错误代码、SQLSTATE 值和消息字符串。这些元素具有以下特征：

+   错误代码：此值为数字。它是 MySQL 特有的，不可移植到其他数据库系统。

    每个错误编号都有相应的符号值。例如：

    +   服务器错误编号`1146`的符号是`ER_NO_SUCH_TABLE`。

    +   客户端错误编号`2005`的符号是`CR_UNKNOWN_HOST`。

    用于错误消息的错误代码集合被划分为不同的范围；参见 错误代码范围。

    错误代码在给定 MySQL 系列的正式发布（GA）版本中保持稳定。在系列达到 GA 状态之前，新代码仍可能在开发中，并可能会更改。

+   SQLSTATE 值：此值是一个五字符字符串（例如，`'42S02'`）。SQLSTATE 值取自 ANSI SQL 和 ODBC，比数值错误代码更加标准化。SQLSTATE 值的前两个字符表示错误类别：

    +   类别 = `'00'` 表示成功。

    +   类别 = `'01'` 表示警告。

    +   类别 = `'02'` 表示“未找到”。这在游标的上下文中是相关的，并用于控制游标到达数据集末尾时发生的情况。此条件还适用于检索不返回任何行的 `SELECT ... INTO *`var_list`*` 语句。

    +   类别 > `'02'` 表示异常。

    对于服务器端错误，不是所有 MySQL 错误编号都有相应的 SQLSTATE 值。在这些情况下，使用 `'HY000'`（一般错误）。

    对于客户端错误，SQLSTATE 值始终为 `'HY000'`（一般错误），因此对于区分一个客户端错误和另一个客户端错误并不具有意义。

+   消息字符串：此字符串提供了错误的文本描述。

### 错误代码范围

用于错误消息的错误代码集合被划分为不同的范围，每个范围都有其自己的目的：

+   1 到 999：全局错误代码。此错误代码范围称为“全局”，因为它是服务器和客户端共享的范围。

    当此范围内的错误源自服务器端时，服务器将其写入错误日志，将错误代码填充为六位数字并添加前缀 `MY-`。

    当此范围内的错误源自客户端时，客户端库将其提供给客户程序，不带零填充或前缀。

+   1,000 到 1,999：服务器错误代码保留供发送给客户端的消息使用。

+   2,000 到 2,999：客户端错误代码保留供客户端库使用。

+   3,000 到 4,999：服务器错误代码保留供发送给客户端的消息使用。

+   5,000 到 5,999：错误代码保留供 X 插件发送给客户端的消息使用。

+   10,000 到 49,999：服务器错误代码保留供写入错误日志的消息使用（不发送给客户端）。

    当此范围内的错误发生时，服务器将其写入错误日志，将错误代码填充为六位数字并添加前缀 `MY-`。

+   50,000 到 51,999：错误代码保留供第三方使用。

服务器处理写入错误日志的错误消息与发送给客户端的错误消息方式不同：

+   当服务器将消息写入错误日志时，它会在错误代码前面填充零直到六位数，并添加前缀`MY-`（例如：`MY-000022`，`MY-010048`）。

+   当服务器向客户端程序发送消息时，不会在错误代码前面添加零填充或前缀（例如：`1036`，`3013`）。

# 17.5.3 自适应哈希索引

> 原文：[`dev.mysql.com/doc/refman/8.0/en/innodb-adaptive-hash.html`](https://dev.mysql.com/doc/refman/8.0/en/innodb-adaptive-hash.html)

自适应哈希索引使`InnoDB`能够在具有适当的工作负载组合和足够内存用于缓冲池的系统上更像是内存数据库，而不会牺牲事务特性或可靠性。自适应哈希索引由`innodb_adaptive_hash_index`变量启用，或者在服务器启动时通过`--skip-innodb-adaptive-hash-index`关闭。

根据搜索的观察模式，使用索引键的前缀构建哈希索引。前缀可以是任意长度，可能只有 B 树中的某些值出现在哈希索引中。哈希索引是按需为经常访问的索引页面构建的。

如果表几乎完全适合主内存，哈希索引通过启用任何元素的直接查找来加快查询速度，将索引值转换为一种指针。`InnoDB`具有监视索引搜索的机制。如果`InnoDB`注意到查询可以从构建哈希索引中受益，它会自动执行。

对于某些工作负载，哈希索引查找的加速远远超过监视索引查找和维护哈希索引结构的额外工作。在重型工作负载下，例如多个并发连接时，对自适应哈希索引的访问有时可能成为争用的来源。带有`LIKE`运算符和`%`通配符的查询也往往不会受益。对于不受自适应哈希索引益处的工作负载，关闭它可以减少不必要的性能开销。由于很难预测自适应哈希索引是否适合特定系统和工作负载，考虑在启用和禁用时运行基准测试。

自适应哈希索引功能是分区的。每个索引绑定到特定分区，并且每个分区由单独的锁保护。分区由`innodb_adaptive_hash_index_parts`变量控制。`innodb_adaptive_hash_index_parts`变量默认设置为 8。最大设置为 512。

您可以在`SHOW ENGINE INNODB STATUS`输出的`SEMAPHORES`部分监视自适应哈希索引的使用和争用。如果有大量线程在`btr0sea.c`中创建的 rw-latches 上等待，请考虑增加自适应哈希索引分区的数量或禁用自适应哈希索引。

有关哈希索引性能特征的信息，请参见第 10.3.9 节，“B-Tree 和哈希索引的比较”。

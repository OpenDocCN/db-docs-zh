# 10.5.9 优化 InnoDB 配置变量

> 原文：[`dev.mysql.com/doc/refman/8.0/en/optimizing-innodb-configuration-variables.html`](https://dev.mysql.com/doc/refman/8.0/en/optimizing-innodb-configuration-variables.html)

不同的设置对于负载轻、可预测的服务器和一直运行在满负荷或经历高活动峰值的服务器效果最佳。

因为`InnoDB`存储引擎自动执行许多优化，许多性能调整任务涉及监视以确保数据库性能良好，并在性能下降时更改配置选项。有关详细的`InnoDB`性能监控信息，请参见第 17.16 节，“InnoDB 与 MySQL 性能模式的集成”。

您可以执行的主要配置步骤包括：

+   控制`InnoDB`缓冲更改数据的数据更改操作类型，以避免频繁的小磁盘写入。请参见配置更改缓冲。因为默认情况下是缓冲所有类型的数据更改操作，只有在需要减少缓冲量时才更改此设置。

+   使用`innodb_adaptive_hash_index`选项打开或关闭自适应哈希索引功能。有关更多信息，请参见第 17.5.3 节，“自适应哈希索引”。您可能会在异常活动期间更改此设置，然后将其恢复为原始设置。

+   如果上下文切换是瓶颈，设置`InnoDB`处理的并发线程数量上限。请参见第 17.8.4 节，“配置 InnoDB 的线程并发性”。

+   控制`InnoDB`在读取操作中进行预取的数量。当系统有未使用的 I/O 容量时，增加预取可以提高查询性能。过多的预取可能会导致在负载较重的系统上定期性能下降。参见第 17.8.3.4 节，“配置 InnoDB 缓冲池预取（预读）”。

+   如果您有一个高端 I/O 子系统，默认值未完全利用，则增加后台线程的数量以进行读取或写入操作。参见第 17.8.5 节，“配置后台 InnoDB I/O 线程的数量”。

+   控制`InnoDB`在后台执行的 I/O 量。参见 Section 17.8.7, “配置 InnoDB I/O 容量”。如果观察到性能周期性下降，您可能需要缩减此设置。

+   控制确定`InnoDB`何时执行某些类型后台写入的算法。参见 Section 17.8.3.5, “配置缓冲池刷新”。该算法适用于某些工作负载，但不适用于其他工作负载，因此如果观察到性能周期性下降，您可能需要禁用此功能。

+   充分利用多核处理器及其缓存内存配置，以最小化上下文切换的延迟。参见 Section 17.8.8, “配置自旋锁轮询”。

+   防止一次性操作（如表扫描）干扰存储在`InnoDB`缓冲池中的频繁访问数据。参见 Section 17.8.3.3, “使缓冲池扫描抗干扰”。

+   调整日志文件的大小，以确保可靠性和崩溃恢复。`InnoDB`日志文件通常保持较小，以避免崩溃后长时间的启动时间。MySQL 5.5 中引入的优化加快了崩溃恢复过程的某些步骤。特别是，由于改进的内存管理算法，扫描重做日志和应用重做日志的速度更快。如果您人为地保持日志文件较小以避免长时间的启动时间，现在可以考虑增加日志文件大小，以减少由重做日志记录回收引起的 I/O。

+   配置`InnoDB`缓冲池的大小和实例数量，对于具有多个千兆字节缓冲池的系统尤为重要。参见 Section 17.8.3.2, “配置多个缓冲池实例”。

+   增加最大并发事务数，极大地提高了最繁忙数据库的可伸缩性。参见 Section 17.6.6, “撤销日志”。

+   将清除操作（一种垃圾收集类型）移入后台线程。参见 Section 17.8.9, “清除配置”。为了有效地衡量此设置的结果，首先调整其他与 I/O 和线程相关的配置设置。

+   减少`InnoDB`在并发线程之间的切换次数，以使繁忙服务器上的 SQL 操作不会排队形成“交通堵塞”。为`innodb_thread_concurrency`选项设置一个值，对于高性能现代系统，可以设置为大约 32。增加`innodb_concurrency_tickets`选项的值，通常设置为 5000 左右。这些选项的组合设置了`InnoDB`在任一时间处理的线程数上限，并允许每个线程在被交换出之前完成大量工作，从而保持等待线程数较低，使操作可以在没有过多上下文切换的情况下完成。

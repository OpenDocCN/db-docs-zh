# 9.2 数据库备份方法

> 原文：[`dev.mysql.com/doc/refman/8.0/en/backup-methods.html`](https://dev.mysql.com/doc/refman/8.0/en/backup-methods.html)

这一部分总结了一些制作备份的一般方法。

### 使用 MySQL 企业备份进行热备份

MySQL 企业版的客户可以使用 MySQL 企业备份产品对整个实例或选定的数据库、表或两者进行物理备份。该产品包括增量备份和压缩备份的功能。备份物理数据库文件比逻辑技术（如`mysqldump`命令）快得多。`InnoDB`表使用热备份机制进行复制。（理想情况下，`InnoDB`表应该占据大部分数据。）其他存储引擎的表使用温备份机制进行复制。有关 MySQL 企业备份产品的概述，请参见第 32.1 节，“MySQL 企业备份概述”。

### 使用 mysqldump 进行备份

**mysqldump**程序可以进行备份。它可以备份所有类型的表。（参见第 9.4 节，“使用 mysqldump 进行备份”。）

对于`InnoDB`表，可以使用`--single-transaction`选项在不锁定表的情况下执行在线备份，使用**mysqldump**。参见第 9.3.1 节，“建立备份策略”。

### 通过复制表文件进行备份

可以通过复制表文件（`*.MYD`、`*.MYI`文件和相关的`*.sdi`文件）备份 MyISAM 表。为了获得一致的备份，停止服务器或锁定并刷新相关表：

```sql
FLUSH TABLES *tbl_list* WITH READ LOCK;
```

您只需要一个读锁；这使得其他客户端可以继续查询表，同时您可以复制数据库目录中的文件。刷新是必要的，以确保在开始备份之前将所有活动索引页写入磁盘。参见第 15.3.6 节，“LOCK TABLES 和 UNLOCK TABLES 语句”和第 15.7.8.3 节，“FLUSH 语句”。

您还可以通过简单地复制表文件来创建二进制备份，只要服务器没有更新任何内容。（但请注意，如果您的数据库包含`InnoDB`表，则表文件复制方法不起作用。此外，即使服务器没有活动更新数据，`InnoDB`可能仍然在内存中缓存修改的数据，而未刷新到磁盘。）

有关此备份方法的示例，请参考 Section 15.2.6, “IMPORT TABLE Statement”中的导出和导入示例。

### 创建分隔文本文件备份

要创建包含表数据的文本文件，可以使用`SELECT * INTO OUTFILE '*`file_name`*' FROM *`tbl_name`*`。该文件在 MySQL 服务器主机上创建，而不是客户端主机。对于此语句，输出文件不能已经存在，因为允许文件被覆盖构成安全风险。请参阅 Section 15.2.13, “SELECT Statement”。此方法适用于任何类型的数据文件，但仅保存表数据，而不保存表结构。

另一种创建文本数据文件（以及包含用于备份表的`CREATE TABLE`语句的文件）的方法是使用**mysqldump**与`--tab`选项。请参阅 Section 9.4.3, “Dumping Data in Delimited-Text Format with mysqldump”。

要重新加载分隔文本数据文件，请使用`LOAD DATA`或**mysqlimport**。

### 通过启用二进制日志进行增量备份

MySQL 支持使用二进制日志进行增量备份。二进制日志文件提供了您需要的信息，以便复制在您执行备份之后对数据库所做的更改。因此，为了允许服务器恢复到某个时间点，必须在其上启用二进制日志记录，这是 MySQL 8.0 的默认设置；请参阅 Section 7.4.4, “The Binary Log”。

当你想要进行增量备份（包含自上次完整或增量备份以来发生的所有更改）时，你应该通过使用`FLUSH LOGS`来旋转二进制日志。完成这一步后，你需要将从上次完整或增量备份时刻到倒数第二个时刻的所有二进制日志复制到备份位置。这些二进制日志就是增量备份；在恢复时，你需要按照第 9.5 节，“时间点（增量）恢复” Recovery")中的说明应用它们。下次进行完整备份时，你也应该使用`FLUSH LOGS`或**mysqldump --flush-logs**来旋转二进制日志。参见第 6.5.4 节，“mysqldump — 数据库备份程序”。

### 使用副本进行备份

如果在备份时服务器出现性能问题，一个有助于解决问题的策略是设置复制并在副本上执行备份，而不是在源服务器上执行。参见第 19.4.1 节，“使用复制进行备份”。

如果你正在备份一个副本，你应该在备份副本数据库时备份其连接元数据存储库和应用程序元数据存储库（参见第 19.2.4 节，“中继日志和复制元数据存储库”），无论你选择哪种备份方法，这些信息总是需要的，以便在恢复副本数据后恢复复制。如果你的副本正在复制`LOAD DATA`语句，你还应该备份副本用于此目的的任何`SQL_LOAD-*`文件。副本需要这些文件来恢复任何中断的`LOAD DATA`操作的复制。此目录的位置是系统变量`replica_load_tmpdir`（从 MySQL 8.0.26 开始）或`slave_load_tmpdir`（MySQL 8.0.26 之前）的值。如果服务器未使用该变量启动，则目录位置是系统变量`tmpdir`的值。

### 恢复损坏的表

如果必须恢复已损坏的 `MyISAM` 表，请尝试首先使用 `REPAIR TABLE` 或 **myisamchk -r** 进行恢复。在 99.9% 的情况下，这应该有效。如果 **myisamchk** 失败，请参阅 第 9.6 节，“MyISAM 表维护和崩溃恢复”。

### 使用文件系统快照进行备份。

如果你使用的是 Veritas 文件系统，可以这样进行备份：

1.  从客户端程序执行 `FLUSH TABLES WITH READ LOCK`。

1.  从另一个 shell 中执行 `mount vxfs snapshot`。

1.  从第一个客户端执行 `UNLOCK TABLES`。

1.  从快照中复制文件。

1.  卸载快照。

其他文件系统（如 LVM 或 ZFS）可能具有类似的快照功能。

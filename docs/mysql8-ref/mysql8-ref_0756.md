# 13.3.5 ENUM 类型

> 原文：[`dev.mysql.com/doc/refman/8.0/en/enum.html`](https://dev.mysql.com/doc/refman/8.0/en/enum.html)

`ENUM`是一个字符串对象，其值是在表创建时在列规范中明确枚举的允许值列表中选择的。

请参见第 13.3.1 节，“字符串数据类型语法”以获取`ENUM`类型的语法和长度限制。

`ENUM`类型具有以下优点：

+   在列具有有限可能值集的情况下紧凑的数据存储。您指定的输入值字符串会自动编码为数字。有关`ENUM`类型的存储要求，请参见第 13.7 节，“数据类型存储要求”。

+   可读的查询和输出。数字在查询结果中被翻译回相应的字符串。

以及需要考虑的潜在问题：

+   如果您创建看起来像数字的枚举值，很容易混淆文字值与其内部索引号，如枚举限制中所解释的那样。

+   在`ORDER BY`子句中使用`ENUM`列需要额外小心，如枚举排序中所解释的那样。

+   创建和使用 ENUM 列

+   枚举文字的索引值

+   枚举文字的处理

+   空或 NULL 的枚举值

+   枚举排序

+   枚举限制

#### 创建和使用 ENUM 列

枚举值必须是带引号的字符串文字。例如，您可以像这样创建具有`ENUM`列的表：

```sql
CREATE TABLE shirts (
    name VARCHAR(40),
    size ENUM('x-small', 'small', 'medium', 'large', 'x-large')
);
INSERT INTO shirts (name, size) VALUES ('dress shirt','large'), ('t-shirt','medium'),
  ('polo shirt','small');
SELECT name, size FROM shirts WHERE size = 'medium';
+---------+--------+
| name    | size   |
+---------+--------+
| t-shirt | medium |
+---------+--------+
UPDATE shirts SET size = 'small' WHERE size = 'large';
COMMIT;
```

将值为`'medium'`的 1 百万行插入到此表中将需要 1 百万字节的存储空间，而如果您将实际字符串`'medium'`存储在`VARCHAR`列中，则需要 6 百万字节。

#### 枚举文字的索引值

每个枚举值都有一个索引：

+   在列规范中列出的元素被分配索引号，从 1 开始。

+   空字符串错误值的索引值为 0。这意味着您可以使用以下`SELECT`语句查找分配了无效`ENUM`值的行：

    ```sql
    mysql> SELECT * FROM *tbl_name* WHERE *enum_col*=0;
    ```

+   `NULL`值的索引为`NULL`。

+   这里的“索引”术语指的是枚举值列表中的位置。它与表索引无关。

例如，指定为`ENUM('Mercury', 'Venus', 'Earth')`的列可以具有此处显示的任何值。每个值的索引也显示在这里。

| 值 | 索引 |
| --- | --- |
| `NULL` | `NULL` |
| `''` | 0 |
| `'水星'` | 1 |
| `'金星'` | 2 |
| `'地球'` | 3 |

一个`ENUM`列最多可以有 65,535 个不同的元素。

如果在数值上下文中检索`ENUM`值，则返回列值的索引。例如，可以像这样从`ENUM`列中检索数值：

```sql
mysql> SELECT *enum_col*+0 FROM *tbl_name*;
```

诸如`SUM()`或`AVG()`之类的期望数值参数的函数在必要时将参数转换为数字。对于`ENUM`值，索引号用于计算。

#### 处理枚举文字

在创建表时，表定义中的`ENUM`成员值的尾随空格会被自动删除。

检索时，存储到`ENUM`列中的值将使用在列定义中使用的大小写形式显示。请注意，`ENUM`列可以分配字符集和排序规则。对于二进制或区分大小写的排序规则，在为列分配值时会考虑大小写形式。

如果将一个数字存储到一个`ENUM`列中，该数字将被视为可能值的索引，存储的值是具有该索引的枚举成员。（但是，这在`LOAD DATA`中*不*起作用，因为它将所有输入视为字符串。）如果将数字值引用起来，如果在枚举值列表中没有匹配的字符串，它仍然被解释为索引。因此，不建议定义一个具有看起来像数字的枚举值的`ENUM`列，因为这很容易变得令人困惑。例如，以下列具有字符串值为`'0'`，`'1'`和`'2'`的枚举成员，但索引值为`1`，`2`和`3`：

```sql
numbers ENUM('0','1','2')
```

如果存储`2`，它被解释为索引值，并变为`'1'`（具有索引 2 的值）。如果存储`'2'`，它匹配一个枚举值，因此存储为`'2'`。如果存储`'3'`，它不匹配任何枚举值，因此被视为索引并变为`'2'`（具有索引 3 的值）。

```sql
mysql> INSERT INTO t (numbers) VALUES(2),('2'),('3');
mysql> SELECT * FROM t;
+---------+
| numbers |
+---------+
| 1       |
| 2       |
| 2       |
+---------+
```

要确定`ENUM`列的所有可能值，请使用`SHOW COLUMNS FROM *`tbl_name`* LIKE '*`enum_col`*'`并解析输出的`Type`列中的`ENUM`定义。

在 C API 中，`ENUM`值以字符串形式返回。有关使用结果集元数据将其与其他字符串区分开的信息，请参阅 C API 基本数据结构。

#### 空或 NULL 枚举值

在某些情况下，枚举值也可以是空字符串（`''`）或`NULL`：

+   如果向`ENUM`中插入无效值（即不在允许值列表中的字符串），则插入空字符串作为特殊错误值。此字符串可以通过该字符串的数值为 0 来与“正常”空字符串区分。有关枚举值的数值索引的详细信息，请参阅枚举文字的索引值。

    如果启用了严格的 SQL 模式，则尝试插入无效的`ENUM`值会导致错误。

+   如果声明`ENUM`列允许`NULL`，则`NULL`值是列的有效值，且默认值为`NULL`。如果声明`ENUM`列为`NOT NULL`，其默认值为允许值列表的第一个元素。

#### 枚举排序

`ENUM`值根据它们的索引号排序，这取决于在列规范中列出枚举成员的顺序。例如，对于`ENUM('b', 'a')`，`'b'`在`'a'`之前排序。空字符串在非空字符串之前排序，`NULL`值在所有其他枚举值之前排序。

为了在对`ENUM`列使用`ORDER BY`子句时避免意外结果，请使用以下技术之一：

+   按字母顺序指定`ENUM`列表。

+   确保通过编码`ORDER BY CAST(*`col`* AS CHAR)`或`ORDER BY CONCAT(*`col`*)`对列进行字典排序而不是按索引号排序。

#### 枚举限制

枚举值不能是表达式，即使是评估为字符串值的表达式也不行。

例如，此`CREATE TABLE`语句不起作用，因为`CONCAT`函数不能用于构造枚举值：

```sql
CREATE TABLE sizes (
    size ENUM('small', CONCAT('med','ium'), 'large')
);
```

您也不能将用户变量用作枚举值。这对语句不起作用：

```sql
SET @mysize = 'medium';

CREATE TABLE sizes (
    size ENUM('small', @mysize, 'large')
);
```

我们强烈建议*不要*将数字用作枚举值，因为它不会节省适当`TINYINT`或`SMALLINT`类型的存储空间，并且如果错误引用`ENUM`值，很容易混淆字符串和底层数值（可能不同）。如果将数字用作枚举值，请始终将其括在引号中。如果省略引号，则该数字被视为索引。请参阅枚举文字的处理以查看即使引用的数字也可能被错误地用作数值索引值的情况。

定义中的重复值会导致警告，如果启用了严格的 SQL 模式，则会导致错误。

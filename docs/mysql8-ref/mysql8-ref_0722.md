# 12.14 向字符集添加排序

> 原文：[`dev.mysql.com/doc/refman/8.0/en/adding-collation.html`](https://dev.mysql.com/doc/refman/8.0/en/adding-collation.html)

12.14.1 排序实现类型

12.14.2 选择排序 ID

12.14.3 向 8 位字符集添加简单排序

12.14.4 向 Unicode 字符集添加 UCA 排序

警告

用户定义的排序已被弃用；您应该期望在将来的 MySQL 版本中删除对它们的支持。从 MySQL 8.0.33 开始，服务器对任何 SQL 语句中使用 `COLLATE *`user_defined_collation`*` 都会发出警告；当服务器以 `--collation-server` 设置为用户定义排序的名称启动时，也会发出警告。

排序是一组定义如何比较和排序字符串的规则。MySQL 中的每个排序都属于单个字符集。每个字符集至少有一个排序，大多数有两个或更多排序。

字符串排序是基于权重的。字符集中的每个字符都映射到一个权重。具有相同权重的字符比较相等，具有不同权重的字符根据其权重的相对大小进行比较。

`WEIGHT_STRING()` 函数可用于查看字符串中字符的权重。它返回的表示权重的值是一个二进制字符串，因此方便使用 `HEX(WEIGHT_STRING(*`str`*))` 以可打印形式显示权重。以下示例显示，如果是非二进制不区分大小写字符串，则对于 `'AaBb'` 中的字母，权重不会有区别，但如果是二进制字符串，则会有区别：

```sql
mysql> SELECT HEX(WEIGHT_STRING('AaBb' COLLATE latin1_swedish_ci));
+------------------------------------------------------+
| HEX(WEIGHT_STRING('AaBb' COLLATE latin1_swedish_ci)) |
+------------------------------------------------------+
| 41414242                                             |
+------------------------------------------------------+
mysql> SELECT HEX(WEIGHT_STRING(BINARY 'AaBb'));
+-----------------------------------+
| HEX(WEIGHT_STRING(BINARY 'AaBb')) |
+-----------------------------------+
| 41614262                          |
+-----------------------------------+
```

MySQL 支持多种排序实现，如 第 12.14.1 节“排序实现类型” 中讨论的。其中一些可以在不重新编译 MySQL 的情况下添加：

+   8 位字符集的简单排序。

+   基于 UCA 的 Unicode 字符集排序。

+   二进制 (`*`xxx`*_bin`) 排序。

以下部分描述如何向现有字符集添加前两种类型的用户定义排序。所有现有字符集已经有一个二进制排序，因此这里不需要描述如何添加一个。

警告

不支持重新定义内置排序，并可能导致意外的服务器行为。

添加新用户定义排序的步骤摘要：

1.  选择一个排序 ID。

1.  添加配置信息，命名排序规则并描述字符排序规则。

1.  重新启动服务器。

1.  确保服务器识别排序。

此处的说明仅涵盖可以在不重新编译 MySQL 的情况下添加的用户定义排序规则。要添加需要重新编译的排序规则（通过在 C 源文件中使用函数实现），请使用第 12.13 节的说明，“添加字符集”。但是，不要添加完整字符集所需的所有信息，只需修改现有字符集的适当文件。也就是说，根据当前字符集的排序规则已有的内容，为新的排序规则添加数据结构、函数和配置信息。

注意

如果您修改现有的用户定义排序规则，可能会影响使用该排序规则的列索引的行排序。在这种情况下，重新构建任何此类索引以避免问题，如查询结果不正确。请参见第 3.14 节，“重建或修复表或索引”。

### 附加资源

+   示例显示如何为全文搜索添加排序规则：第 14.9.7 节，“为全文索引添加用户定义排序规则”

+   Unicode 排序算法（UCA）规范：[`www.unicode.org/reports/tr10/`](http://www.unicode.org/reports/tr10/)

+   本地化数据标记语言（LDML）规范：[`www.unicode.org/reports/tr35/`](http://www.unicode.org/reports/tr35/)

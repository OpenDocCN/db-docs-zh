> [`dev.mysql.com/doc/refman/8.0/en/group-replication-distributed-recovery-fault.html`](https://dev.mysql.com/doc/refman/8.0/en/group-replication-distributed-recovery-fault.html)

#### 20.5.4.4 分布式恢复的容错性

Group Replication 的分布式恢复过程具有多项内置措施，以确保在过程中出现任何问题时的容错性。

从当前视图中的适当在线组成员列表中随机选择分布式恢复的捐赠者。选择随机捐赠者意味着当多个成员进入组时，同一服务器不会被多次选择的机会很大。从 MySQL 8.0.17 开始，对于从二进制日志进行状态转移，加入者只选择运行低于或等于自身的 MySQL Server 补丁版本的捐赠者。对于早期版本，所有在线成员都可以成为捐赠者。对于远程克隆操作，加入者只选择与自身运行相同补丁版本的捐赠者。请注意，当加入成员在操作结束时重新启动时，它会与新的捐赠者建立连接，以从二进制日志进行状态转移，这可能是与用于远程克隆操作的原始捐赠者不同的成员。

在以下情况下，Group Replication 检测到分布式恢复中的错误，自动切换到新的捐赠者，并重试状态转移：

+   *连接错误* - 存在身份验证问题或与候选捐赠者建立连接的其他问题。

+   *复制错误* - 用于从二进制日志进行状态转移的复制线程之一（接收器或应用程序线程）失败。由于此状态转移方法使用现有的 MySQL 复制框架，因此可能会出现一些瞬态错误导致接收器或应用程序线程出错。

+   *远程克隆操作错误* - 远程克隆操作失败或在完成之前停止。

+   *捐赠者离开组* - 捐赠者离开组，或者在状态转移正在进行时，在捐赠者上停止 Group Replication。

Performance Schema 表`replication_applier_status_by_worker`显示导致最后一次重试失败的错误。在这些情况下，错误后的新连接将尝试与新的候选捐赠者建立连接。在错误事件中选择不同的捐赠者意味着新的候选捐赠者可能不会有相同的错误。如果安装了克隆插件，Group Replication 首先尝试与每个适当的在线支持克隆的捐赠者进行远程克隆操作。如果所有这些尝试失败，Group Replication 将尝试依次从所有适当的捐赠者进行二进制日志状态转移，如果可能的话。

警告

对于远程克隆操作，接收方（加入成员）上的用户创建的表空间和数据在远程克隆操作开始传输数据之前被删除。如果远程克隆操作开始但未完成，加入成员可能会留下部分原始数据文件集，或者没有用户数据。如果在数据完全克隆之前停止克隆操作，捐赠者传输的数据将从接收方中删除。Group Replication 会自动重试克隆操作，以修复这种情况。

在以下情况下，分布式恢复过程无法完成，加入成员将离开组：

+   *清除的事务* - 加入成员需要的事务不在任何在线组成员的二进制日志文件中，并且数据无法通过远程克隆操作获取（因为未安装克隆插件，或者尝试了所有可能的捐赠者但失败）。因此，加入成员无法赶上组的进度。

+   *额外的事务* - 加入成员已经包含一些组中不存在的事务。如果进行了远程克隆操作，这些事务将被删除和丢失，因为加入成员上的数据目录被擦除。如果进行了从捐赠者的二进制日志进行状态传输，这些事务可能会与组的事务发生冲突。有关处理此情况的建议，请参阅额外事务。

+   *连接重试限制已达到* - 加入成员已经尝试了连接重试限制允许的所有连接尝试。您可以使用`group_replication_recovery_retry_count`系统变量进行配置（参见第 20.5.4.3 节，“配置分布式恢复”）。

+   *没有更多的捐赠者* - 加入成员已经尝试了每个在线支持克隆的捐赠者进行远程克隆操作（如果安装了克隆插件），然后尝试了每个适当的在线捐赠者进行二进制日志的状态传输，如果可能的话。

+   *加入成员离开组* - 加入成员离开组或在状态传输进行中时，加入成员上的 Group Replication 停止。

如果加入成员意外离开组，因此在上述任何情况下（除最后一种情况外），它将执行`group_replication_exit_state_action`系统变量指定的操作。

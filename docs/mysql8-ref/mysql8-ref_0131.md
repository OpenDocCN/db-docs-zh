> 原文：[`dev.mysql.com/doc/refman/8.0/en/date-calculations.html`](https://dev.mysql.com/doc/refman/8.0/en/date-calculations.html)

#### 5.3.4.5 日期计算

MySQL 提供了几个函数，您可以使用这些函数对日期进行计算，例如计算年龄或提取日期的部分。

要确定每只宠物的年龄，可以使用`TIMESTAMPDIFF()`函数。它的参数是您希望结果表达的单位，以及要计算差异的两个日期。以下查询显示了每只宠物的出生日期、当前日期和年龄。使用*别名*（`age`）使最终输出列标签更有意义。

```sql
mysql> SELECT name, birth, CURDATE(),
       TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age
       FROM pet;
+----------+------------+------------+------+
| name     | birth      | CURDATE()  | age  |
+----------+------------+------------+------+
| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |
| Claws    | 1994-03-17 | 2003-08-19 |    9 |
| Buffy    | 1989-05-13 | 2003-08-19 |   14 |
| Fang     | 1990-08-27 | 2003-08-19 |   12 |
| Bowser   | 1989-08-31 | 2003-08-19 |   13 |
| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |
| Whistler | 1997-12-09 | 2003-08-19 |    5 |
| Slim     | 1996-04-29 | 2003-08-19 |    7 |
| Puffball | 1999-03-30 | 2003-08-19 |    4 |
+----------+------------+------------+------+
```

查询是有效的，但如果按某种顺序呈现行，则结果可以更容易地扫描。这可以通过添加一个`ORDER BY name`子句来实现，以按名称对输出进行排序：

```sql
mysql> SELECT name, birth, CURDATE(),
       TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age
       FROM pet ORDER BY name;
+----------+------------+------------+------+
| name     | birth      | CURDATE()  | age  |
+----------+------------+------------+------+
| Bowser   | 1989-08-31 | 2003-08-19 |   13 |
| Buffy    | 1989-05-13 | 2003-08-19 |   14 |
| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |
| Claws    | 1994-03-17 | 2003-08-19 |    9 |
| Fang     | 1990-08-27 | 2003-08-19 |   12 |
| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |
| Puffball | 1999-03-30 | 2003-08-19 |    4 |
| Slim     | 1996-04-29 | 2003-08-19 |    7 |
| Whistler | 1997-12-09 | 2003-08-19 |    5 |
+----------+------------+------------+------+
```

要按`age`而不是`name`对输出进行排序，只需使用不同的`ORDER BY`子句：

```sql
mysql> SELECT name, birth, CURDATE(),
       TIMESTAMPDIFF(YEAR,birth,CURDATE()) AS age
       FROM pet ORDER BY age;
+----------+------------+------------+------+
| name     | birth      | CURDATE()  | age  |
+----------+------------+------------+------+
| Chirpy   | 1998-09-11 | 2003-08-19 |    4 |
| Puffball | 1999-03-30 | 2003-08-19 |    4 |
| Whistler | 1997-12-09 | 2003-08-19 |    5 |
| Slim     | 1996-04-29 | 2003-08-19 |    7 |
| Claws    | 1994-03-17 | 2003-08-19 |    9 |
| Fluffy   | 1993-02-04 | 2003-08-19 |   10 |
| Fang     | 1990-08-27 | 2003-08-19 |   12 |
| Bowser   | 1989-08-31 | 2003-08-19 |   13 |
| Buffy    | 1989-05-13 | 2003-08-19 |   14 |
+----------+------------+------------+------+
```

可以使用类似的查询来确定已经去世动物的死亡年龄。通过检查`death`值是否为`NULL`来确定这些动物，然后对具有非`NULL`值的动物计算`death`和`birth`值之间的差异：

```sql
mysql> SELECT name, birth, death,
       TIMESTAMPDIFF(YEAR,birth,death) AS age
       FROM pet WHERE death IS NOT NULL ORDER BY age;
+--------+------------+------------+------+
| name   | birth      | death      | age  |
+--------+------------+------------+------+
| Bowser | 1989-08-31 | 1995-07-29 |    5 |
+--------+------------+------------+------+
```

查询使用`death IS NOT NULL`而不是`death <> NULL`，因为`NULL`是一个特殊值，不能使用通常的比较运算符进行比较。这将在后面讨论。请参阅第 5.3.4.6 节，“处理 NULL 值”。

如果您想知道哪些动物下个月过生日怎么办？对于这种类型的计算，年份和日期都不重要；您只需提取`birth`列的月份部分。MySQL 提供了几个用于提取日期部分的函数，例如`YEAR()`、`MONTH()`和`DAYOFMONTH()`。在这里，`MONTH()`是适当的函数。要查看它的工作原理，请运行一个显示`birth`和`MONTH(birth)`值的简单查询：

```sql
mysql> SELECT name, birth, MONTH(birth) FROM pet;
+----------+------------+--------------+
| name     | birth      | MONTH(birth) |
+----------+------------+--------------+
| Fluffy   | 1993-02-04 |            2 |
| Claws    | 1994-03-17 |            3 |
| Buffy    | 1989-05-13 |            5 |
| Fang     | 1990-08-27 |            8 |
| Bowser   | 1989-08-31 |            8 |
| Chirpy   | 1998-09-11 |            9 |
| Whistler | 1997-12-09 |           12 |
| Slim     | 1996-04-29 |            4 |
| Puffball | 1999-03-30 |            3 |
+----------+------------+--------------+
```

查找下个月过生日的动物也很简单。假设当前月份是四月。那么月份值为`4`，您可以这样查找出生在五月（月份`5`）的动物：

```sql
mysql> SELECT name, birth FROM pet WHERE MONTH(birth) = 5;
+-------+------------+
| name  | birth      |
+-------+------------+
| Buffy | 1989-05-13 |
+-------+------------+
```

如果当前月份是十二月，会有一个小复杂性。您不能简单地将月份数字（`12`）加一，然后查找出生在第`13`个月的动物，因为没有这样的月份。相反，您应该查找出生在一月（月份`1`）的动物。

您可以编写查询，使其无论当前月份是什么都能正常工作，这样您就不必使用特定月份的数字。`DATE_ADD()`使您能够向给定日期添加时间间隔。如果您将一个月添加到`CURDATE()`的值，然后用`MONTH()`提取月份部分，结果将产生要查找生日的月份：

```sql
mysql> SELECT name, birth FROM pet
       WHERE MONTH(birth) = MONTH(DATE_ADD(CURDATE(),INTERVAL 1 MONTH));
```

通过在使用模运算（`MOD`）将月份值包装为`0`后，将`1`添加到当前月份以获得下一个月份的另一种方法：

```sql
mysql> SELECT name, birth FROM pet
       WHERE MONTH(birth) = MOD(MONTH(CURDATE()), 12) + 1;
```

`MONTH()`返回`1`到`12`之间的数字。而`MOD(某物,12)`返回`0`到`11`之间的数字。因此，加法操作必须在`MOD()`之后进行，否则我们会从十一月（`11`）跳到一月（`1`）。

如果计算使用无效日期，则计算将失败并产生警告：

```sql
mysql> SELECT '2018-10-31' + INTERVAL 1 DAY;
+-------------------------------+
| '2018-10-31' + INTERVAL 1 DAY |
+-------------------------------+
| 2018-11-01                    |
+-------------------------------+
mysql> SELECT '2018-10-32' + INTERVAL 1 DAY;
+-------------------------------+
| '2018-10-32' + INTERVAL 1 DAY |
+-------------------------------+
| NULL                          |
+-------------------------------+
mysql> SHOW WARNINGS;
+---------+------+----------------------------------------+
| Level   | Code | Message                                |
+---------+------+----------------------------------------+
| Warning | 1292 | Incorrect datetime value: '2018-10-32' |
+---------+------+----------------------------------------+
```

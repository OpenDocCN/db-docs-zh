# A.10 MySQL 8.0 FAQ: NDB Cluster

> 原文：[`dev.mysql.com/doc/refman/8.0/en/faqs-mysql-cluster.html`](https://dev.mysql.com/doc/refman/8.0/en/faqs-mysql-cluster.html)

在接下来的部分中，我们回答了关于 MySQL NDB Cluster 和`NDB`存储引擎经常被问到的问题。

A.10.1\. MySQL 软件的哪些版本支持 NDB Cluster？我需要从源代码编译吗？

A.10.2\. “NDB”和“NDBCLUSTER”是什么意思？

A.10.3\. 使用 NDB Cluster 与使用 MySQL 复制有什么区别？

A.10.4\. 运行 NDB Cluster 需要特殊的网络设置吗？集群中的计算机如何通信？

A.10.5\. 运行 NDB Cluster 需要多少台计算机，以及为什么？

A.10.6\. NDB Cluster 中的不同计算机有什么作用？

A.10.7\. 当我在 NDB Cluster 管理客户端中运行 SHOW 命令时，我看到一行输出看起来像这样：

A.10.8\. 我可以在哪些操作系统上使用 NDB Cluster？

A.10.9\. 运行 NDB Cluster 的硬件要求是什么？

A.10.10\. 我需要多少 RAM 才能使用 NDB Cluster？是否可以使用磁盘内存？

A.10.11\. NDB Cluster 可以使用哪些文件系统？网络文件系统或网络共享呢？

A.10.12\. 我可以在虚拟机中运行 NDB Cluster 节点吗（比如 VMWare、VirtualBox、Parallels 或 Xen 创建的）？

A.10.13\. 我正在填充 NDB Cluster 数据库。加载过程提前终止，我收到了这样的错误消息：

A.10.14\. NDB Cluster 使用 TCP/IP。这是否意味着我可以在 Internet 上运行它，远程位置有一个或多个节点？

A.10.15\. 我是否需要学习新的编程或查询语言来使用 NDB Cluster？

A.10.16\. NDB Cluster 支持哪些编程语言和 API？

A.10.17\. NDB Cluster 包含哪些管理工具？

A.10.18\. 在使用 NDB Cluster 时，如何查找错误或警告消息的含义？

A.10.19\. NDB Cluster 是否支持事务安全？支持哪些隔离级别？

A.10.20\. NDB Cluster 支持哪些存储引擎？

A.10.21\. 在发生灾难性故障时——例如，整个城市停电并且我的不间断电源失效——我会丢失所有数据吗？

A.10.22\. 是否可以在 NDB Cluster 中使用全文索引？

A.10.23\. 我可以在单台计算机上运行多个节点吗？

A.10.24\. 我可以在不重启的情况下向 NDB Cluster 添加数据节点吗？

A.10.25\. 在使用 NDB Cluster 时，有哪些限制我应该注意？

A.10.26\. NDB Cluster 支持外键吗？

A.10.27\. 如何将现有的 MySQL 数据库导入 NDB Cluster？

A.10.28\. NDB Cluster 节点如何相互通信？

A.10.29\. 什么是仲裁者？

A.10.30\. NDB Cluster 支持哪些数据类型？

A.10.31\. 如何启动和停止 NDB Cluster？

A.10.32\. 当集群关闭时，NDB Cluster 数据会发生什么？

A.10.33\. 为 NDB Cluster 拥有多个管理节点是个好主意吗？

A.10.34\. 我可以在一个 NDB Cluster 中混合不同类型的硬件和操作系统吗？

A.10.35\. 我可以在单个主机上运行两个数��节点吗？两个 SQL 节点？

A.10.36\. 我可以在 NDB Cluster 中使用主机名吗？

A.10.37\. NDB Cluster 支持 IPv6 吗？

A.10.38\. 在 NDB Cluster 中如何处理具有多个 MySQL 服务器的 MySQL 用户？

A.10.39\. 在一个 SQL 节点失败的情况下，如何继续发送查询？

A.10.40\. 如何备份和恢复 NDB Cluster？

A.10.41\. 什么是“天使进程”？

| **A.10.1.** | MySQL 软件的哪些版本支持 NDB Cluster？我是否必须从源代码编译？ |
| --- | --- |

|  | NDB Cluster 不支持标准 MySQL Server 版本。相反，MySQL NDB Cluster 作为一个独立产品提供。可用的 NDB Cluster 发布系列包括以下内容：

+   **NDB Cluster 7.3 / NDB Cluster 7.4. ** 这两个系列不再维护或支持新部署。NDB Cluster 7.3 或 7.4 的用户应尽快升级到 NDB 7.5 或更新版本。我们建议新部署使用最新的 NDB Cluster 8.0 版本。

+   **NDB Cluster 7.5. ** 这个系列是 NDB Cluster 的以前的通用可用性（GA）版本，仍然可用于生产使用，尽管我们建议新部署使用最新的 NDB Cluster 8.0 版本。最新的 NDB Cluster 7.5 版本可以从[`dev.mysql.com/downloads/cluster/`](https://dev.mysql.com/downloads/cluster/)获取。

+   **NDB Cluster 7.6. ** 这个系列是 NDB Cluster 的以前的通用可用性（GA）版本，仍然可用于生产使用，尽管我们建议新部署使用最新的 NDB Cluster 8.0 版本。最新的 NDB Cluster 7.6 版本可以从[`dev.mysql.com/downloads/cluster/`](https://dev.mysql.com/downloads/cluster/)获取。

+   **NDB Cluster 8.0. ** 这个系列是 NDB Cluster 的最新通用可用性（GA）版本，基于`NDB`存储引擎的 8.0 版本和 MySQL Server 8.0\. NDB Cluster 8.0 可用于生产使用；新的用于生产的部署应该使用此系列中最新的 GA 版本，目前是 NDB Cluster 8.0.35\. 您可以从[`dev.mysql.com/downloads/cluster/`](https://dev.mysql.com/downloads/cluster/)获取最新的 NDB Cluster 8.0 版本。有关此系列中的新功能和其他重要更改的信息，请参见第 25.2.4 节，“MySQL NDB Cluster 8.0 中的新功能”。

您可以从源代码获取并编译 NDB Cluster（参见第 25.3.1.4 节，“在 Linux 上从源代码构建 NDB Cluster”，以及第 25.3.2.2 节，“在 Windows 上从源代码编译和安装 NDB Cluster”），但除非是最专业的情况，我们建议使用 Oracle 提供的适合您操作平台和情况的以下安装程序：

+   Linux 二进制版本（`tar.gz` 文件）

+   Linux RPM 软件包

+   Linux `.deb` 文件

+   Windows 二进制“无需安装”版本

+   Windows MSI 安装程序

安装包也可能来自您平台的软件包管理系统。您可以使用以下语句之一来确定您的 MySQL 服务器是否支持 `NDB`：`SHOW VARIABLES LIKE 'have_%'`、`SHOW ENGINES` 或 `SHOW PLUGINS`。 |

| **A.10.2.** | “NDB” 和 “NDBCLUSTER” 是什么意思？ |
| --- | --- |
|  | `NDB` 代表 “**N**etwork **D**ata**b**ase”。`NDB` 和 `NDBCLUSTER` 都是启用 MySQL 集群支持的存储引擎的名称。`NDB` 是首选，但两个名称都是正确的。 |
| **A.10.3.** | 使用 NDB Cluster 与使用 MySQL 复制有什么区别？ |
|  | 在传统的 MySQL 复制中，源 MySQL 服务器更新一个或多个副本。事务按顺序提交，一个慢事务可能导致副本落后于源服务器。这意味着如果源服务器失败，副本可能没有记录最后几个事务。如果正在使用事务安全引擎如 `InnoDB`，事务要么在副本上完成，要么根本不被应用，但复制不能保证源服务器和副本上的所有数据始终保持一致。在 NDB Cluster 中，所有数据节点保持同步，任何一个数据节点提交的事务对所有数据节点都是提交的。在数据节点故障的情况下，所有剩余的数据节点保持一致。简而言之，标准 MySQL 复制是异步的，而 NDB Cluster 是同步的。NDB Cluster 也支持异步复制。NDB Cluster 复制（有时也称为“地理复制”）包括在两个 NDB Cluster 之间复制，以及从 NDB Cluster 到非集群 MySQL 服务器的复制。参见 第 25.7 节 “NDB Cluster 复制”。 |
| **A.10.4.** | 运行 NDB Cluster 需要特殊的网络设置吗？集群中的计算机如何通信？ |
|  | NDB Cluster 旨在在高带宽环境中使用，计算机通过 TCP/IP 连接。其性能直接取决于集群计算机之间的连接速度。NDB Cluster 的最低连接要求包括典型的 100 兆位以太网网络或等效网络。我们建议您在可用时使用千兆以太网。 |
| **A.10.5.** | 运行 NDB Cluster 需要多少台计算机，以及为什么？ |
|  | 至少需要三台计算机才能运行一个可行的集群。然而，在 NDB Cluster 中，最低*推荐*计算机数量为四台：一台用于运行管理和 SQL 节点，另外两台用作数据节点。这两个数据节点的目的是提供冗余性；管理节点必须在单独的机器上运行，以确保在其中一个数据节点发生故障时继续提供仲裁服务。为了提供增加的吞吐量和高可用性，您应该使用多个 SQL 节点（连接到集群的 MySQL 服务器）。也可以（虽然不是绝对必要）运行多个管理服务器。 |
| **A.10.6.** | NDB Cluster 中的不同计算机扮演什么角色？ |

|  | NDB Cluster 既有物理组织，也有逻辑组织，计算机是物理元素。集群的逻辑或功能元素称为节点，容纳集群节点的计算机有时被称为集群主机。有三种类型的节点，每种对应于集群中的特定角色。这些是：

+   **管理节点。** 此节点为整个集群提供管理服务，包括启动、关闭、备份和其他节点的配置数据。管理节点服务器实现为应用程序**ndb_mgmd**；用于控制 NDB Cluster 的管理客户端是**ndb_mgm**。有关这些程序的信息，请参见第 25.5.4 节，“ndb_mgmd — NDB Cluster 管理服务器守护程序”，以及第 25.5.5 节，“ndb_mgm — NDB Cluster 管理客户端”。

+   **数据节点。** 这种类型的节点存储和复制数据。数据节点功能由`NDB`数据节点进程**ndbd**的实例处理。有关更多信息，请参见第 25.5.1 节，“ndbd — NDB Cluster 数据节点守护程序”。

+   **SQL 节点。** 这只是一个构建有对`NDBCLUSTER`存储引擎支持的 MySQL 服务器实例（**mysqld**），并使用`--ndb-cluster`选项启动以启用引擎和`--ndb-connectstring`选项以使其连接到 NDB Cluster 管理服务器。有关这些选项的更多信息，请参见 Section 25.4.3.9.1, “MySQL Server Options for NDB Cluster”。

    注意

    API 节点是任何直接使用集群数据节点进行数据存储和检索的应用程序。因此，SQL 节点可以被视为一种使用 MySQL 服务器提供 SQL 接口给集群的 API 节点。您可以使用 NDB API 编写这种应用程序（不依赖于 MySQL 服务器），NDB API 提供了直接的、面向对象的事务和扫描接口给 NDB Cluster 数据；更多信息请参见 NDB Cluster API 概述：NDB API。

|

| **A.10.7.** | 当我在 NDB Cluster 管理客户端中运行`SHOW`命令时，我看到一行输出看起来像这样：

```sql
id=2    @10.100.10.32  (Version: 8.0.35-ndb-8.0.35 Nodegroup: 0, *)
```

`*`代表什么？这个节点与其他节点有什么不同？

|  | 最简单的答案是，“这不是你可以控制的东西，无论如何也不需要担心，除非你是一名编写或分析 NDB Cluster 源代码的软件工程师”。如果你觉得这个答案不够满意，这里有一个更长、更技术性的版本：NDB Cluster 中的许多机制需要数据节点之间的分布式协调。这些分布式算法和协议包括全局检查点、DDL（模式）更改和节点重启处理。为了使这种协调更简单，数据节点“选举”其中一个成员作为领导者。没有用户可影响此选择的机制，这完全是自动的；自动性是 NDB Cluster 内部架构的关键部分。当一个节点作为任何这些机制的“领导者”时，通常是活动的协调点，其他节点作为“跟随者”，按照领导者的指示执行他们的活动部分。如果充当领导者的节点失败，剩余节点将选举新的领导者。由旧领导者协调的正在进行的任务可能会失败，也可能由新领导者继续，这取决于实际涉及的机制。一些不同的机制和协议可能有不同的领导节点，但通常为它们选择相同的领导者。在管理客户端的`SHOW`输出中指示为领导者的节点在内部被称为`DICT`管理器，负责协调 DDL 和元数据活动。NDB Cluster 设计成领导者的选择对集群外部没有明显影响。例如，当前领导者的 CPU 或资源使用率并不比其他数据节点高出很多，领导者的失败对集群的影响不应与任何其他数据节点的失败有明显不同。 |
| --- | --- |
| **A.10.8.** | 我可以在哪些操作系统上使用 NDB Cluster？ |
|  | NDB Cluster 支持大多数类 Unix 操作系统。NDB Cluster 也在 Microsoft Windows 操作系统上的生产环境中得到支持。有关 NDB Cluster 在各种操作系统版本、操作系统发行版和硬件平台上提供的支持级别的更详细信息，请参考[`www.mysql.com/support/supportedplatforms/cluster.html`](https://www.mysql.com/support/supportedplatforms/cluster.html)。 |
| **A.10.9.** | 运行 NDB Cluster 的硬件要求是什么？ |
|  | NDB Cluster 应该在任何可用 `NDB` 启用二进制文件的平台上运行。对于数据节点和 API 节点，更快的 CPU 和更多的内存可能会提高性能，64 位 CPU 可能比 32 位处理器更有效。在用于数据节点的机器上必须有足够的内存来存储每个节点的数据库份额（有关更多信息，请参阅 *需要多少 RAM？*）。对于仅用于运行 NDB Cluster 管理服务器的计算机，要求很低；通常普通的台式 PC（或等效物）就足够完成这项任务。节点可以通过标准 TCP/IP 网络和硬件进行通信。它们还可以使用高速 SCI 协议；但是，使用 SCI 需要特殊的网络硬件和软件（请参阅第 25.4.4 节，“使用 NDB Cluster 的高速互连”）。 |
| **A.10.10.** | 我需要多少 RAM 才能使用 NDB Cluster？是否可以完全使用磁盘内存？ |

|  | NDB Cluster 最初仅作为内存实现，但当前所有版本也提供了将 NDB Cluster 存储在磁盘上的功能。查看第 25.6.11 节，“NDB Cluster 磁盘数据表”，获取更多信息。对于内存中的 `NDB` 表，您可以使用以下公式来粗略估算集群中每个数据节点所需的 RAM：

```sql
(SizeofDatabase × NumberOfReplicas × 1.1 ) / NumberOfDataNodes
```

要更精确地计算内存需求，需要确定集群数据库中每个表的每行所需的存储空间（有关详细信息，请参阅第 13.7 节，“数据类型存储需求”），并将其乘以行数。您还必须记住按照以下方式考虑任何列索引：

+   为 `NDBCLUSTER` 表创建的每个主键或哈希索引需要每条记录 21-25 字节。这些索引使用 `IndexMemory`。

+   每个有序索引需要每条记录 10 字节的存储空间，使用 `DataMemory`。

+   创建主键或唯一索引也会创建一个有序索引，除非此索引是使用 `USING HASH` 创建的。换句话说：

    +   集群表上的主键或唯一索引通常每条记录占用 31 到 35 字节。

    +   但是，如果主键或唯一索引是使用 `USING HASH` 创建的，则每条记录仅需要 21 到 25 字节。

使用`USING HASH`为所有主键和唯一索引创建 NDB Cluster 表通常会使表更新速度更快——在某些情况下比未在创建主键和唯一键时使用`USING HASH`的表快 20 到 30％。这是因为需要的内存更少（因为没有创建有序索引），并且需要利用的 CPU 更少（因为需要读取和可能更新的索引更少）。然而，这也意味着否则可以使用范围扫描的查询必须通过其他方式满足，这可能导致选择速度变慢。在计算集群内存需求时，您可能会发现最近 MySQL 8.0 版本中提供的**ndb_size.pl**实用程序很有用。这个 Perl 脚本连接到当前（非集群）MySQL 数据库，并创建一个报告，说明如果该数据库使用`NDBCLUSTER`存储引擎，该数据库将需要多少空间。有关更多信息，请参见 Section 25.5.28, “ndb_size.pl — NDBCLUSTER Size Requirement Estimator”。特别重要的是要记住*每个 NDB Cluster 表必须有一个主键*。如果未定义主键，则`NDB`存储引擎会自动创建一个主键；此主键是在不使用`USING HASH`的情况下创建的。您可以使用**ndb_mgm**客户端中的`REPORT MEMORYUSAGE`命令随时确定 NDB Cluster 数据和索引的存储使用情况；有关更多信息，请参见 Section 25.6.1, “Commands in the NDB Cluster Management Client”。此外，当可用`DataMemory`的 80％或（在 NDB 7.6 之前）`IndexMemory`被使用时，警告将写入集群日志，并且当使用率达到 90％，99％和 100％时再次写入。 |

| **A.10.11.** | 我可以在 NDB Cluster 中使用哪些文件系统？网络文件系统或网络共享呢？ |
| --- | --- |
|  | 一般来说，任何与主机操作系统原生兼容的文件系统都可以很好地与 NDB Cluster 配合使用。如果您发现某个文件系统与 NDB Cluster 特别适配（或者不太适配），我们邀请您在[NDB Cluster 论坛](https://forums.mysql.com/list.php?25)中讨论您的发现。对于 Windows，我们建议您像标准 MySQL 一样使用`NTFS`文件系统来运行 NDB Cluster。我们不测试 NDB Cluster 与`FAT`或`VFAT`文件系统的兼容性。因此，我们不建议在 MySQL 或 NDB Cluster 中使用它们。NDB Cluster 被实现为一种共享无解决方案；其背后的理念是，单个硬件部件的故障不应导致多个集群节点的故障，甚至可能导致整个集群的故障。因此，不支持使用网络共享或网络文件系统来运行 NDB Cluster。这也适用于 SAN 等共享存储设备。 |
| **A.10.12.** | 我可以在虚拟机中（如 VMWare、VirtualBox、Parallels 或 Xen 创建的虚拟机）运行 NDB Cluster 节点吗？ |
|  | NDB Cluster 支持在虚拟机中使用。我们目前支持并测试使用[Oracle VM](http://www.oracle.com/technetwork/server-storage/vm/index.html)。一些 NDB Cluster 用户已成功部署了 NDB Cluster，使用了其他虚拟化产品；在这种情况下，Oracle 可以提供 NDB Cluster 支持，但特定于虚拟环境的问题必须向该产品的供应商咨询。 |
| **A.10.13.** | 我正在尝试填充一个 NDB Cluster 数据库。加载过程会过早终止，并且我会收到这样的错误消息：`ERROR 1114: 表'my_cluster_table'已满`。为什么会发生这种情况？ |
|  | 很可能的原因是您的设置为所有表数据和所有索引提供的 RAM 不足，*包括`NDB`存储引擎所需的主键，在表定义中没有包含主键定义时会自动创建*。值得注意的是，所有数据节点应该具有相同数量的 RAM，因为集群中的任何数据节点都不能使用比任何单个数据节点可用的最少内存更多的内存。例如，如果有四台计算机托管集群数据节点，其中三台有 3GB 的 RAM 可用于存储集群数据，而剩下的数据节点只有 1GB 的 RAM，则每个数据节点最多可以将 1GB 用于 NDB Cluster 数据和索引。在某些情况下，即使**ndb_mgm -e "ALL REPORT MEMORYUSAGE"**显示有显着空闲的`DataMemory`，在 MySQL 客户端应用程序中也可能出现“表已满”错误。您可以通过为`CREATE TABLE`使用`MAX_ROWS`选项，强制`NDB`为 NDB Cluster 表创建额外的分区，从而为哈希索引提供更多可用内存。通常，将`MAX_ROWS`设置为您预计在表中存储的行数的两倍应该足够。出于类似的原因，有时您可能在负载较重的节点上遇到数据节点重新启动的问题。`MinFreePct`参数可以通过保留一部分（默认为 5%）`DataMemory`和（在 NDB 7.6 之前）`IndexMemory`来帮助解决此问题，用于重新启动。此保留的内存不可用于存储`NDB`表或数据。 |
| **A.10.14.** | NDB Cluster 使用 TCP/IP。这是否意味着我可以在 Internet 上运行它，其中一个或多个节点位于远程位置？ |
|  | 在这种情况下，集群能够可靠地运行的可能性*非常*小，因为 NDB 集群的设计和实现是基于这样的假设：它将在保证专用高速连接的条件下运行，例如在使用 100 Mbps 或千兆以太网的局域网设置中，最好是后者。我们既不测试也不保证在比这慢的任何情况下的性能。此外，需要牢记的是，NDB 集群中节点之间的通信不安全；它们既不加密也不受到任何其他保护机制的保护。集群的最安全配置是在防火墙后的私人网络中，外部无法直接访问任何集群数据或管理节点。（对于 SQL 节点，您应该像对待 MySQL 服务器的任何其他实例一样采取相同的预防措施。）有关更多信息，请参阅第 25.6.20 节，“NDB 集群安全问题”。 |
| **A.10.15.** | 我需要学习新的编程或查询语言才能使用 NDB 集群吗？ |

|  | *不需要*。虽然一些专门的命令用于管理和配置集群本身，但以下操作仅需要标准（My）SQL 语句：

+   创建、修改和删除表格

+   插入、更新和删除表格数据

+   创建、更改和删除主键和唯一索引

设置 NDB 集群需要一些专门的配置参数和文件，请参阅第 25.4.3 节，“NDB 集群配置文件”，了解相关信息。在 NDB 集群管理客户端（**ndb_mgm**）中使用一些简单的命令，如启动和停止集群节点。请参阅第 25.6.1 节，“NDB 集群管理客户端中的命令”。 |

| **A.10.16.** | NDB 集群支持哪些编程语言和 API？ |
| --- | --- |
|  | NDB Cluster 支持与标准 MySQL Server 相同的编程 API 和语言，包括 ODBC、.Net、MySQL C API 以及用于流行脚本语言（如 PHP、Perl 和 Python）的许多驱动程序。使用这些 API 编写的 NDB Cluster 应用程序的行为类似于其他 MySQL 应用程序；它们将 SQL 语句传输到 MySQL Server（在 NDB Cluster 的情况下，是一个 SQL 节点），并接收包含数据行的响应。有关这些 API 的更多信息，请参阅 Chapter 31, *Connectors and APIs*。NDB Cluster 还支持使用 NDB API 进行应用程序编程，该 API 提供了一个低级的 C++接口，用于访问 NDB Cluster 数据而无需经过 MySQL Server。请参阅 NDB API。此外，许多`NDBCLUSTER`管理功能通过 C 语言 MGM API 公开；有关更多信息，请参阅 MGM API。NDB Cluster 还支持使用 ClusterJ 进行 Java 应用程序编程，该工具支持使用会话和事务的数据域对象模型。有关更多信息，请参阅 Java and NDB Cluster。NDB Cluster 8.0 还包括支持使用 NDB Cluster 作为数据存储的`Node.js`的 NoSQL 应用程序的适配器。有关更多信息，请参阅 MySQL NoSQL Connector for JavaScript。 |
| **A.10.17.** | NDB Cluster 包括哪些管理工具？ |
|  | NDB Cluster 包括一个用于执行基本管理功能的命令行客户端。请参阅 Section 25.5.5, “ndb_mgm — The NDB Cluster Management Client”，以及 Section 25.6.1, “Commands in the NDB Cluster Management Client”。NDB Cluster 还受到 MySQL Cluster Manager 的支持，这是一个提供高级命令行界面的独立产品，可以自动化许多 NDB Cluster 管理任务，如滚动重启和配置更改。有关 MySQL Cluster Manager 的更多信息，请参阅 MySQL Cluster Manager 8.0.36 User Manual。 |
| **A.10.18.** | 当使用 NDB Cluster 时，如何找出错误或警告消息的含义？ |

|  | 有两种方法可以实现这��点：

+   从**mysql**客户端内部，在收到错误或警告条件的通知后立即使用**SHOW ERRORS**或**SHOW WARNINGS**。

+   从系统 shell 提示符中，使用 perror --ndb *`error_code`*。

|

| **A.10.19.** | NDB Cluster 是否支持事务安全？支持哪些隔离级别？ |
| --- | --- |
|  | *是的*。对于使用 `NDB` 存储引擎创建的表，支持事务。目前，NDB Cluster 仅支持 `READ COMMITTED` 事务隔离级别。 |
| **A.10.20.** | NDB Cluster 支持哪些存储引擎？ |
|  | NDB Cluster 需要 `NDB` 存储引擎。也就是说，为了使表在 NDB Cluster 中的节点之间共享，必须使用 `ENGINE=NDB`（或等效选项 `ENGINE=NDBCLUSTER`）创建表。在与 NDB Cluster 一起使用的 MySQL 服务器上可以使用其他存储引擎（如 `InnoDB` 或 `MyISAM`）创建表，但由于这些表不使用 `NDB`，它们不参与集群化；每个这样的表严格限定在创建它的个别 MySQL 服务器实例中。NDB Cluster 在架构、要求和实现方面与 `InnoDB` 集群有很大不同；尽管它们的名称相似，但两者不兼容。有关 `InnoDB` 集群的更多信息，请参阅 MySQL AdminAPI。另请参阅 第 25.2.6 节，“使用 InnoDB 的 MySQL 服务器与 NDB Cluster 比较”，了解 `NDB` 和 `InnoDB` 存储引擎之间的区别。 |
| **A.10.21.** | 在发生灾难性故障时——例如，整个城市停电 *并且* 我的 UPS 失效——我会丢失所有数据吗？ |
|  | 所有提交的事务都被记录。因此，尽管在灾难发生时可能会丢失一些数据，但这应该是相当有限的。通过最小化每个事务的操作数量，可以进一步减少数据丢失。（无论如何，一次执行大量操作的事务都不是一个好主意。） |
| **A.10.22.** | 是否可以在 NDB Cluster 中使用 `FULLTEXT` 索引？ |
|  | `FULLTEXT` 索引目前仅由 `InnoDB` 和 `MyISAM` 存储引擎支持。有关更多信息，请参阅 第 14.9 节，“全文搜索函数”。 |
| **A.10.23.** | 我可以在一台计算机上运行多个节点吗？ |
|  | 可以，但并非总是明智之举。运行集群的主要原因之一是提供冗余。为了获得这种冗余的全部好处，每个节点应该位于单独的机器上。如果将多个节点放在一台机器上，而该机器发生故障，那么所有这些节点都会丢失。因此，如果在单台机器上运行多个数据节点，非常重要的是要设置它们，以使该机器的故障不会导致给定节点组中所有数据节点的丢失。考虑到 NDB Cluster 可以在装载了低成本（甚至零成本）操作系统的商品硬件上运行，为了保护关键数据，额外购买一两台机器是非常值得的。还值得注意的是，运行管理节点的集群主机的要求很低。这项任务可以通过一台 300 MHz 的 Pentium 或等效 CPU 和足够的 RAM 用于操作系统，再加上一些用于 **ndb_mgmd** 和 **ndb_mgm** 进程的额外开销来完成。在具有多个 CPU、核心或两者的单个主机上运行多个集群数据节点是可以接受的。NDB Cluster 发行版还提供了数据节点二进制文件的多线程版本，旨在用于这些系统。有关更多信息，请参阅 第 25.5.3 节，“ndbmtd — NDB Cluster 数据节点守护进程（多线程）”。在某些情况下，还可以在同一台机器上同时运行数据节点和 SQL 节点；这种安排的性能如何取决于诸多因素，如核心和 CPU 的数量，以及数据节点和 SQL 节点进程可用的磁盘和内存量，您必须在规划这种配置时考虑这些因素。 |
| **A.10.24.** | 我可以在不重启 NDB Cluster 的情况下���加数据节点吗？ |
|  | 可以在运行中的 NDB Cluster 中添加新的数据节点而无需将集群下线。有关更多信息，请参阅 第 25.6.7 节，“在线添加 NDB Cluster 数据节点”。对于其他类型的 NDB Cluster 节点，只需要进行滚动重启（参见 第 25.6.5 节，“执行 NDB Cluster 的滚动重启”）即可。 |
| **A.10.25.** | 在使用 NDB Cluster 时，我应该注意哪些限制吗？ |

|  | 在 MySQL NDB Cluster 中，对`NDB` 表的限制包括以下内容：

+   不支持临时表；使用`ENGINE=NDB`或`ENGINE=NDBCLUSTER`的`CREATE TEMPORARY TABLE`语句会导致错误。

+   仅支持`NDBCLUSTER`表的`KEY`和`LINEAR KEY`两种用户定义的分区类型。尝试使用其他分区类型创建`NDB`表会导致错误。

+   不支持`FULLTEXT`索引。

+   不支持索引前缀。只能对完整列建立索引。

+   不支持空间索引（尽管可以使用空间列）。请参见第 13.4 节，“空间数据类型”。

+   支持部分事务和部分回滚的程度与其他事务存储引擎（如`InnoDB`）相当，可以回滚单个语句。

+   每个表允许的最大属性数为 512。属性名称不能超过 31 个字符。对于每个表，表名和数据库名的最大组合长度为 122 个字符。

+   在 NDB 8.0 之前，表行的最大大小为 14 千字节，不包括`BLOB`值。在 NDB 8.0 中，这个最大值增加到 30000 字节。有关更多信息，请参见第 25.2.7.5 节，“NDB 集群中与数据库对象相关的限制”。

    每个`NDB`表的行数没有固定限制。表大小的限制取决于许多因素，特别是每个数据节点可用的 RAM 量。

有关 NDB 集群中限制的完整列表，请参见第 25.2.7 节，“NDB 集群的已知限制”。另请参见第 25.2.7.11 节，“NDB 集群 8.0 中已解决的先前 NDB 集群问题”。 |

| **A.10.26.** | NDB 集群支持外键吗？ |
| --- | --- |
|  | NDB 集群提供了与`InnoDB`存储引擎中相似的外键约束支持；有关更详细信息，请参见第 1.6.3.2 节，“FOREIGN KEY 约束”，以及第 15.1.20.5 节，“FOREIGN KEY 约束”。需要外键支持的应用程序应使用 NDB 集群 7.3、7.4、7.5 或更高版本。 |
| **A.10.27.** | 如何将现有的 MySQL 数据库导入 NDB 集群中？ |
|  | 您可以像使用任何其他版本的 MySQL 一样将数据库导入 NDB 集群。除了本 FAQ 中其他地方提到的限制之外，唯一的其他特殊要求是要包含在集群中的任何表必须使用`NDB`存储引擎。这意味着表必须使用`ENGINE=NDB`或`ENGINE=NDBCLUSTER`创建。还可以使用一个或多个`ALTER TABLE`语句将使用其他存储引擎的现有表转换为`NDBCLUSTER`。但是，在进行转换之前，表的定义必须与`NDBCLUSTER`存储引擎兼容。在 MySQL 8.0 中，还需要额外的解决方法；有关详细信息，请参见第 25.2.7 节，“NDB 集群的已知限制”。 |
| **A.10.28.** | NDB 集群节点如何相互通信？ |
|  | 集群节点可以通过三种不同的传输机制进行通信：TCP/IP、SHM（共享内存）和 SCI（可扩展一致性接口）。在可用的情况下，同一集群主机上的节点之间默认使用 SHM；然而，这被视为实验性质。SCI 是一种高速（每秒 1 千兆位及更高）、高可用性协议，用于构建可扩展的多处理器系统；它需要特殊的硬件和驱动程序。有关将 SCI 用作 NDB 集群的传输机制的更多信息，请参见第 25.4.4 节，“使用高速互连与 NDB 集群”。 |
| **A.10.29.** | 仲裁者是什么？ |
|  | 如果集群中的一个或多个数据节点发生故障，可能导致并非所有集群数据节点都能“看到”彼此。事实上，在网络分区中，两组数据节点可能会相互隔离，也就是所谓的“脑裂”场景。这种情况是不可取的，因为每组数据节点都试图表现得像整个集群一样。需要一个仲裁者来在竞争的数据节点组之间做出决定。当至少一个节点组中的所有数据节点都存活时，网络分区就不是问题，因为没有单个子集可以独立形成一个功能性集群。真正的问题是当没有一个节点组的所有节点都存活时，这种情况下网络分区（“脑裂”场景）就可能发生。然后需要一个仲裁者。所有集群节点都将同一个节点识别为仲裁者，通常是管理服务器；但是，也可以配置集群中的任何 MySQL 服务器来充当仲裁者。仲裁者接受首先联系到它的一组集群节点，并告诉其余的集群节点关闭。仲裁者的选择由 MySQL 服务器和管理服务器节点的`ArbitrationRank`配置参数控制。您还可以使用`ArbitrationRank`配置参数来控制仲裁者选择过程。有关这些参数的更多信息，请参见第 25.4.3.5 节，“定义 NDB 集群管理服务器”。仲裁者的角色本身并不对指定的主机施加任何重大要求，因此仲裁者主机不需要特别快速或为此目的特别增加内存。 |
| **A.10.30.** | NDB Cluster 支持哪些数据类型？ |

|  | NDB Cluster 支持所有常见的 MySQL 数据类型，包括与 MySQL 的空间扩展相关的数据类型；但是，`NDB`存储引擎不支持空间索引。（空间索引仅由`MyISAM`支持；有关更多信息，请参见第 13.4 节，“空间数据类型”。此外，当与`NDB`表一起使用时，索引存在一些差异。注意

NDB Cluster Disk Data 表（即使用 `TABLESPACE ... STORAGE DISK ENGINE=NDB` 或 `TABLESPACE ... STORAGE DISK ENGINE=NDBCLUSTER` 创建的表）仅具有固定宽度的行。这意味着（例如）每个包含 `VARCHAR(255)` 列的 Disk Data 表记录需要为 255 个字符（根据表使用的字符集和校对规则所需的字符数）留出空间，而不管其中实际存储的字符数。

有关这些问题的更多信息，请参见第 25.2.7 节，“NDB Cluster 的已知限制”。

| **A.10.31.** | 如何启动和停止 NDB Cluster？ |
| --- | --- |

|  | 必须按以下顺序分别启动集群中的每个节点：

1.  使用**ndb_mgmd**命令启动管理节点。

    当首次启动集群时，必须包含`-f`或`--config-file`选项，告诉管理节点其配置文件的位置。

1.  使用**ndbd**命令启动每个数据节点。

    每个数据节点必须使用`-c`或`--ndb-connectstring`选项启动，以便数据节点知道如何连接到管理服务器。

1.  使用您喜欢的启动脚本（如**mysqld_safe**）启动每个 MySQL 服务器（SQL 节点）。

    每个 MySQL 服务器必须使用`--ndbcluster`和`--ndb-connectstring`选项启动。这些选项使**mysqld**启用`NDBCLUSTER`存储引擎支持，并指定如何连接到管理服务器。

每个这些命令必须从承载受影响节点的机器的系统 shell 中运行。（您不必亲自在机器上，可以使用远程登录 shell 来完成此操作。）您可以通过在承载管理节点的机器上启动`NDB`管理客户端**ndb_mgm**并发出`SHOW`或`ALL STATUS`命令来验证集群是否正在运行。要关闭正在运行的集群，请在管理客户端中发出`SHUTDOWN`命令。或者，您可以在系统 shell 中输入以下命令：

```sql
$> ndb_mgm -e "SHUTDOWN"
```

（在此示例中，引号是可选的，因为在 `-e` 选项后面的命令字符串中没有空格；此外，`SHUTDOWN`命令（像其他管理客户端命令一样）不区分大小写。）这两个命令都会导致**ndb_mgm**、**ndb_mgm**和任何**ndbd**进程优雅地终止。作为 SQL 节点运行的 MySQL 服务器可以使用**mysqladmin shutdown**停止。有关更多信息，请参阅第 25.6.1 节，“NDB 集群管理客户端中的命令”和第 25.3.6 节，“NDB 集群的安全关闭和重启”。MySQL 集群管理器提供了处理 NDB 集群节点启动和停止的其他方法。有关此工具的更多信息，请参阅 MySQL 集群管理器 8.0.36 用户手册。 |

| **A.10.32.** | 当集群关闭时，NDB 集群数据会发生什么？ |
| --- | --- |
|  | 集群数据节点在内存中保存的数据被写入磁盘，并在下次启动集群时重新加载到内存中。 |
| **A.10.33.** | 在 NDB 集群中是否有多个管理节点是个好主意？ |
|  | 它可以作为故障安全的辅助手段。在任何给定时间，只有一个管理节点控制集群，但可以配置一个管理节点作为主节点，以及一个或多个额外的管理节点在主管理节点发生故障时接管。请参阅第 25.4.3 节，“NDB 集群配置文件”，了解如何配置 NDB 集群管理节点的信息。 |
| **A.10.34.** | 我可以在一个 NDB 集群中混合不同类型的硬件和操作系统吗？ |
|  | 是的，只要所有机器和操作系统具有相同的“字节序”（全部大端或全部小端）。还可以在不同节点上使用不同 NDB 集群版本的软件。但是，我们仅支持此类用法作为滚动升级过程的一部分（请参见第 25.6.5 节，“执行 NDB 集群的滚动重启”）。 |
| **A.10.35.** | 我可以在单个主机上运行两个数据节点吗？两个 SQL 节点？ |
|  | 是的，可以这样做。在多个数据节点的情况下，建议（但不是必须）每个节点使用不同的数据目录。如果要在一台机器上运行多个 SQL 节点，**mysqld**的每个实例必须使用不同的 TCP/IP 端口。在同一主机上同时运行数据节点和 SQL 节点是可能的，但您应该知道**ndbd**或**ndbmtd**进程可能会与**mysqld**竞争内存。 |
| **A.10.36.** | 我可以在 NDB 集群中使用主机名吗？ |
|  | 是的，可以使用 DNS 和 DHCP 来为集群主机提供服务。但是，如果您的应用程序需要“五个九”可用性，您应该使用固定（数字）IP 地址，因为使集群主机之间的通信依赖于 DNS 和 DHCP 等服务会引入额外的潜在故障点。 |
| **A.10.37.** | NDB 集群支持 IPv6 吗？ |
|  | SQL 节点（MySQL 服务器）之间支持 IPv6 连接，但所有其他类型的 NDB 集群节点之间的连接必须使用 IPv4。实际上，这意味着您可以在 NDB 集群之间使用 IPv6 进行复制，但同一 NDB 集群中的节点之间的连接必须使用 IPv4。有关更多信息，请参见第 25.7.3 节，“NDB 集群复制中的已知问题”。 |
| **A.10.38.** | 如何处理在具有多个 MySQL 服务器的 NDB 集群中的 MySQL 用户？ |
|  | MySQL 用户帐户和权限通常不会在访问同一 NDB 集群的不同 MySQL 服务器之间自动传播。MySQL NDB 集群通过`NDB_STORED_USER`权限提供对共享和同步用户和权限的支持；有关更多信息，请参见使用共享授权表进行分布式权限。您应该知道，此实现是在 NDB 8.0 中引入的，与 NDB 集群早期版本中使用的共享权限机制不兼容。旧的实现在 NDB 8.0 中不再受支持。 |
| **A.10.39.** | 如果 SQL 节点之一失败，我如何继续发送查询？ |
|  | MySQL NDB 集群不提供任何自动故障转移功能，以在 SQL 节点之间进行故障转移。您的应用程序必须准备好处理 SQL 节点的丢失并在它们之间进行故障转移。 |
| **A.10.40.** | 如何备份和恢复 NDB 集群？ |
|  | 您可以在 NDB 管理客户端和 **ndb_restore** 程序中使用 NDB 集群的本地备份和恢复功能。请参阅 第 25.6.8 节，“NDB 集群的在线备份”，以及 第 25.5.23 节，“ndb_restore — 恢复 NDB 集群备份”。您还可以使用传统功能提供的功能在 **mysqldump** 和 MySQL 服务器中进行此操作。有关更多信息，请参阅 第 6.5.4 节，“mysqldump — 数据库备份程序”。 |
| **A.10.41.** | 什么是“天使进程”？ |

|  | 此进程监视并在必要时尝试重新启动数据节点进程。如果在启动 **ndbd** 后检查系统上的活动进程列表，您会看到实际上有 2 个同名进程正在运行，如下所示（为简洁起见，我们省略了 **ndb_mgmd** 和 **ndbd** 的输出）： |

```sql
$> ./ndb_mgmd

$> ps aux &#124; grep ndb
me      23002  0.0  0.0 122948  3104 ?        Ssl  14:14   0:00 ./ndb_mgmd
me      23025  0.0  0.0   5284   820 pts/2    S+   14:14   0:00 grep ndb

$> ./ndbd -c 127.0.0.1 --initial

$> ps aux &#124; grep ndb
me      23002  0.0  0.0 123080  3356 ?        Ssl  14:14   0:00 ./ndb_mgmd
me      23096  0.0  0.0  35876  2036 ?        Ss   14:14   0:00 ./ndbmtd -c 127.0.0.1 --initial
me      23097  1.0  2.4 524116 91096 ?        Sl   14:14   0:00 ./ndbmtd -c 127.0.0.1 --initial
me      23168  0.0  0.0   5284   812 pts/2    R+   14:15   0:00 grep ndb
```

显示内存和 CPU 使用率均为 `0.0` 的 **ndbd** 进程是天使进程（尽管实际上确实会使用很少量的内存和 CPU）。此进程仅检查主要的 **ndbd** 或 **ndbmtd**") 进程（实际处理数据的主要数据节点进程）是否正在运行。如果允许（例如，如果 `StopOnError` 配置参数设置为 `false`），天使进程会尝试重新启动主要数据节点进程。 |

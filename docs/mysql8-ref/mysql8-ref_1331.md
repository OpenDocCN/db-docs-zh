# 第十九章 复制

> 原文：[`dev.mysql.com/doc/refman/8.0/en/replication.html`](https://dev.mysql.com/doc/refman/8.0/en/replication.html)

**目录**

19.1 配置复制

19.1.1 基于二进制日志文件位置的复制配置概述

19.1.2 设置基于二进制日志文件位置的复制

19.1.3 使用全局事务标识符进行复制

19.1.4 在在线服务器上更改 GTID 模式

19.1.5 MySQL 多源复制

19.1.6 复制和二进制日志选项和变量

19.1.7 常见复制管理任务

19.2 复制实现

19.2.1 复制格式

19.2.2 复制通道

19.2.3 复制线程

19.2.4 中继日志和复制元数据存储库

19.2.5 服务器如何评估复制过滤规则

19.3 复制安全性

19.3.1 设置复制以使用加密连接

19.3.2 加密二进制日志文件和中继日志文件

19.3.3 复制权限检查

19.4 复制解决方案

19.4.1 使用复制进行备份

19.4.2 处理复制副本意外停止

19.4.3 监控基于行的复制

19.4.4 使用不同源和副本存储引擎进行复制

19.4.5 使用复制进行扩展

19.4.6 将不同数据库复制到不同副本

19.4.7 改善复制性能

19.4.8 在故障转移期间切换源

19.4.9 使用异步连接故障转移切换源和副本

19.4.10 半同步复制

19.4.11 延迟复制

19.5 复制注意事项和提示

19.5.1 复制功能和问题

19.5.2 MySQL 版本之间的复制兼容性

19.5.3 升级复制拓扑

19.5.4 复制故障排除

19.5.5 如何报告复制错误或问题

复制使得来自一个 MySQL 数据库服务器（称为源）的数据可以被复制到一个或多个 MySQL 数据库服务器（称为副本）上。默认情况下，复制是异步的；副本不需要永久连接以接收来自源端的更新。根据配置，可以复制所有数据库、选定的数据库，甚至是数据库中的选定表。

MySQL 中复制的优势包括：

+   扩展解决方案 - 将负载分散在多个副本之间以提高性能。在这种环境中，所有写入和更新必须在源服务器上进行。然而，读取可以在一个或多个副本上进行。这种模型可以提高写入性能（因为源端专用于更新），同时大大提高跨越越来越多副本的读取速度。

+   数据安全性 - 因为副本可以暂停复制过程，所以可以在副本上运行备份服务，而不会破坏相应的源数据。

+   分析 - 实时数据可以在源端创建，而信息分析可以在副本上进行，而不会影响源端的性能。

+   远程数据分发 - 可以使用复制在远程站点创建数据的本地副本，而无需永久访问源端。

有关如何在这种情况下使用复制的信息，请参阅第 19.4 节，“复制解决方案”。

MySQL 8.0 支持不同的复制方法。传统方法基于从源端二进制日志复制事件，并要求在源端和副本之间同步日志文件和位置。基于全局事务标识符（GTIDs）的新方法是事务性的，因此不需要处理日志文件或这些文件中的位置，这极大简化了许多常见的复制任务。使用 GTIDs 进行复制可以保证源端和副本之间的一致性，只要在源端提交的所有事务也已在副本上应用。有关 MySQL 中 GTIDs 和基于 GTID 的复制的更多信息，请参阅第 19.1.3 节，“使用全局事务标识符进行复制”。有关使用基于二进制日志文件位置的复制的信息，请参阅第 19.1 节，“配置复制”。

MySQL 中的复制支持不同类型的同步。最初的同步类型是单向异步复制，其中一个服务器充当源，而一个或多个其他服务器充当副本。这与*NDB Cluster*的同步复制形成对比（参见第二十五章，*MySQL NDB Cluster 8.0*）。在 MySQL 8.0 中，除了内置的异步复制外，还支持半同步复制。通过半同步复制，在源上执行的提交会在返回到执行事务的会话之前阻塞，直到至少一个副本确认已接收并记录了事务的事件；请参见第 19.4.10 节，“半同步复制”。MySQL 8.0 还支持延迟复制，使得副本故意落后源至少指定的时间量；请参见第 19.4.11 节，“延迟复制”。对于需要*同步*复制的情况，请使用 NDB Cluster（参见第二十五章，*MySQL NDB Cluster 8.0*）。

有许多可用的解决方案可用于设置服务器之间的复制，最佳使用方法取决于数据的存在以及您正在使用的引擎类型。有关可用选项的更多信息，请参见第 19.1.2 节，“设置基于二进制日志文件位置的复制”。

复制格式有两种核心类型，基于语句的复制（SBR），它复制整个 SQL 语句，以及基于行的复制（RBR），它只复制已更改的行。您还可以使用第三种类型，混合基于复制（MBR）。有关不同复制格式的更多信息，请参见第 19.2.1 节，“复制格式”。

复制通过许多不同的选项和变量进行控制。有关更多信息，请参见第 19.1.6 节，“复制和二进制日志选项和变量”。还可以应用额外的安全措施到复制拓扑中，如第 19.3 节，“复制安全性”中所述。

你可以使用复制来解决许多不同的问题，包括性能、支持不同数据库的备份，以及作为缓解系统故障的更大解决方案的一部分。有关如何解决这些问题的信息，请参见第 19.4 节，“复制解决方案”。

关于不同数据类型和语句在复制过程中的处理方式的注释和提示，包括复制功能的详细信息、版本兼容性、升级以及潜在问题及其解决方法，请参见第 19.5 节，“复制注释和提示”。对于那些对 MySQL 复制新手经常提出的一些问题的答案，请参见第 A.14 节，“MySQL 8.0 FAQ: 复制”。

关于复制实现、复制工作原理、二进制日志的过程和内容、后台线程以及用于决定如何记录和复制语句的规则的详细信息，请参见第 19.2 节，“复制实现”。

# 19.1.2 设置基于二进制日志文件位置的复制

> 原文：[`dev.mysql.com/doc/refman/8.0/en/replication-howto.html`](https://dev.mysql.com/doc/refman/8.0/en/replication-howto.html)

19.1.2.1 设置复制源配置

19.1.2.2 设置副本配置

19.1.2.3 为复制创建用户

19.1.2.4 获取复制源的二进制日志坐标

19.1.2.5 选择数据快照方法

19.1.2.6 设置副本

19.1.2.7 在副本上设置源配置

19.1.2.8 将副本添加到复制环境

本节描述了如何设置 MySQL 服务器以使用基于二进制日志文件位置的复制。有许多不同的设置复制的方法，要使用的确切方法取决于您如何设置复制，以及源数据库中是否已经有要复制的数据。

提示

要部署多个 MySQL 实例，您可以使用 InnoDB Cluster，它使您能够轻松管理一组 MySQL 服务器实例在 MySQL Shell 中。InnoDB Cluster 将 MySQL Group Replication 包装在一个编程环境中，使您可以轻松部署一组 MySQL 实例以实现高可用性。此外，InnoDB Cluster 与 MySQL Router 无缝接口，使您的应用程序可以连接到集群而无需编写自己的故障转移过程。然而，对于不需要高可用性的类似用例，您可以使用 InnoDB ReplicaSet。有关 MySQL Shell 的安装说明，请参见这里。

有一些通用任务适用于所有设置：

+   在源端，您必须确保启用了二进制日志记录，并配置一个唯一的服务器 ID。这可能需要重新启动服务器。参见 Section 19.1.2.1, “设置复制源配置”。

+   在每个要连接到源的副本上，您必须配置一个唯一的服务器 ID。这可能需要重新启动服务器。参见 Section 19.1.2.2, “设置副本配置”。

+   可选地，为您的副本创建一个单独的用户，用于在复制时与源进行身份验证以读取二进制日志。参见第 19.1.2.3 节，“为复制创建用户”。

+   在创建数据快照或启动复制过程之前，在源上记录二进制日志中的当前位置。在配置副本时，您需要这些信息，以便副本知道在二进制日志中从哪里开始执行事件。参见第 19.1.2.4 节，“获取复制源二进制日志坐标”。

+   如果您已经在源上有数据并希望使用它来同步副本，您需要创建一个数据快照将数据复制到副本。您正在使用的存储引擎会影响您如何创建快照。当您使用`MyISAM`时，您必须停止在源上处理语句以获取读锁，然后获取其当前的二进制日志坐标并转储其数据，然后允许源继续执行语句。如果您不停止执行语句，则数据转储和源状态信息将不匹配，导致副本上的数据库不一致或损坏。有关复制`MyISAM`源的更多信息，请参见第 19.1.2.4 节，“获取复制源二进制日志坐标”。如果您使用`InnoDB`，则不需要读锁，只需一个足够长的事务来传输数据快照即可。有关更多信息，请参见第 17.19 节，“InnoDB 和 MySQL 复制”。

+   配置副本以设置连接到源的设置，如主机名、登录凭据和二进制日志文件名和位置。参见第 19.1.2.7 节，“在副本上设置源配置”。

+   根据您的系统，在源和副本上实施特定于复制的安全措施。参见第 19.3 节，“复制安全”。

注意

设置过程中的某些步骤需要`SUPER`权限。如果您没有此权限，则可能无法启用复制。

配置基本选项后，选择您的场景：

+   要为不包含任何数据的新源和副本的新安装设置复制，请参阅第 19.1.2.6.1 节，“使用新源和副本设置复制”。

+   要设置使用现有 MySQL 服务器数据进行新源的复制，请参阅第 19.1.2.6.2 节，“使用现有数据设置复制”。

+   要向现有复制环境添加副本，请参阅第 19.1.2.8 节，“向复制环境添加副本”。

在管理 MySQL 复制服务器之前，请阅读本章的全部内容，并尝试执行第 15.4.1 节，“用于控制源服务器的 SQL 语句”和第 15.4.2 节，“用于控制副本服务器的 SQL 语句”中提到的所有语句，并熟悉第 19.1.6 节，“复制和二进制日志选项和变量”中描述的复制启动选项。

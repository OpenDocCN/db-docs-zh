> 原文：[`dev.mysql.com/doc/refman/8.0/en/replication-mode-change-online-verify-transactions.html`](https://dev.mysql.com/doc/refman/8.0/en/replication-mode-change-online-verify-transactions.html)

#### 19.1.4.4 验证匿名事务的复制

本节解释了如何监视复制拓扑并验证所有匿名事务是否已被复制。在在线更改复制模式时，这很有帮助，因为您可以验证更改为 GTID 事务是安全的。

有几种等待事务复制的可能方法：

最简单的方法是，无论您的拓扑如何，但依赖于时间的方法如下：如果您确信副本永远不会落后于 N 秒，只需等待多于 N 秒。或者等待一天，或者您认为对于您的部署是安全的任何时间段。

在某种意义上更安全的方法，因为它不依赖于时间：如果您只有一个带有一个或多个副本的源，则执行以下操作：

1.  在源端执行：

    ```sql
    SHOW MASTER STATUS;
    ```

    记下“文件”和“位置”列中的值。

1.  在每个副本上，使用源端的文件和位置信息执行：

    ```sql
    SELECT MASTER_POS_WAIT(file, position);

    Or from MySQL 8.0.26:
    SELECT SOURCE_POS_WAIT(file, position);
    ```

如果您有一个源和多个级别的副本，或者换句话说，您有副本的副本，请从源开始，然后在每个级别上重复步骤 2，然后所有直接副本，然后所有副本的副本，依此类推。

如果您使用循环复制拓扑，其中多个服务器可能有写客户端，请为每个源-副本连接执行步骤 2，直到完成整个循环。重复整个过程，以便完成整个循环*两次*。

例如，假设您有三台服务器 A、B 和 C，在一个循环中进行复制，即 A -> B -> C -> A。然后，操作步骤如下：

+   在 A 上执行步骤 1，在 B 上执行步骤 2。

+   在 B 上执行步骤 1，在 C 上执行步骤 2。

+   在 C 上执行步骤 1，在 A 上执行步骤 2。

+   在 A 上执行步骤 1，在 B 上执行步骤 2。

+   在 B 上执行步骤 1，在 C 上执行步骤 2。

+   在 C 上执行步骤 1，在 A 上执行步骤 2。

# 15.3.8 XA 事务

> 原文：[`dev.mysql.com/doc/refman/8.0/en/xa.html`](https://dev.mysql.com/doc/refman/8.0/en/xa.html)

15.3.8.1 XA 事务 SQL 语句

15.3.8.2 XA 事务状态

15.3.8.3 XA 事务的限制

`InnoDB`存储引擎支持 XA 事务。MySQL 的 XA 实现基于 X/Open CAE 文档*Distributed Transaction Processing: The XA Specification*。该文档由 The Open Group 发布，可在[`www.opengroup.org/public/pubs/catalog/c193.htm`](http://www.opengroup.org/public/pubs/catalog/c193.htm)获取。当前 XA 实现的限制在第 15.3.8.3 节“XA 事务的限制”中描述。

在客户端方面，没有特殊要求。MySQL 服务器的 XA 接口由以`XA`关键字开头的 SQL 语句组成。MySQL 客户端程序必须能够发送 SQL 语句并理解 XA 语句接口的语义。它们不需要链接到最新的客户端库。旧的客户端库也可以工作。

在 MySQL Connectors 中，MySQL Connector/J 5.0.0 及更高版本直接支持 XA，通过一个处理 XA SQL 语句接口的类接口。

XA 支持分布式事务，即允许多个独立的事务资源参与全局事务。事务资源通常是关系型数据库，但也可能是其他类型的资源。

一个全局事务涉及几个本身是事务性的操作，但所有这些操作必须作为一个组要么全部成功完成，要么全部回滚。实质上，这将 ACID 属性“提升”到一个更高的级别，以便多个 ACID 事务可以作为全局操作的组成部分一起执行，并且也具有 ACID 属性。（与非分布式事务一样，如果您的应用程序对读现象敏感，可能更喜欢`SERIALIZABLE`。`REPEATABLE READ`可能对分布式事务不够。）

一些分布式事务的例子：

+   一个应用程序可以充当一个集成工具，将消息服务与关系型数据库结合在一起。该应用程序确保处理涉及消息发送、检索和处理的事务，同时涉及事务性数据库，都发生在一个全局事务中。你可以将其视为“事务性电子邮件”。

+   一个应用程序执行涉及不同数据库服务器的操作，例如 MySQL 服务器和 Oracle 服务器（或多个 MySQL 服务器），其中涉及多个服务器的操作必须作为全局事务的一部分进行，而不是作为每个服务器本地的单独事务。

+   一家银行在关系数据库管理系统（RDBMS）中保留账户信息，并通过自动取款机（ATM）分发和接收资金。必须确保 ATM 操作在账户中正确反映，但这不能仅通过 RDBMS 完成。全局事务管理器整合 ATM 和数据库资源，以确保金融交易的整体一致性。

使用全局事务的应用程序涉及一个或多个资源管理器和一个事务管理器：

+   资源管理器（RM）提供对事务资源的访问。数据库服务器是资源管理器的一种。必须能够提交或回滚由 RM 管理的事务。

+   事务管理器（TM）协调作为全局事务一部分的事务。它与处理每个事务的 RM 进行通信。全局事务及其分支由稍后描述的命名方案标识。

MySQL 对 XA 的实现使 MySQL 服务器能够充当处理全局事务中的 XA 事务的资源管理器。连接到 MySQL 服务器的客户端程序充当事务管理器。

要执行全局事务，必须知道涉及哪些组件，并使每个组件达到可以提交或回滚的状态。根据每个组件报告的关于其成功能力的情况，它们必须作为一个原子组提交或回滚。也就是说，要么所有组件都必须提交，要么所有组件都必须回滚。要管理全局事务，必须考虑到任何组件或连接网络可能会失败。

执行全局事务的过程使用两阶段提交（2PC）。这发生在执行全局事务的分支执行的操作之后。

1.  在第一阶段，所有分支都被准备好了。也就是说，它们被 TM 告知准备好提交。通常，这意味着每个管理分支的 RM 在稳定存储中记录了分支的操作。这些分支指示它们是否能够这样做，这些结果将用于第二阶段。

1.  在第二阶段，TM 告诉 RM 是否提交或回滚。如果所有分支在准备时指示它们能够提交，那么所有分支都被告知提交。如果任何分支在准备时指示它不能提交，那么所有分支都被告知回滚。

在某些情况下，全局事务可能会使用一阶段提交（1PC）。例如，当事务管理器发现全局事务仅包含一个事务资源（即单个分支）时，可以要求该资源同时准备和提交。

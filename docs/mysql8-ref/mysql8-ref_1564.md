# 20.10 常见问题

> 原文：[`dev.mysql.com/doc/refman/8.0/en/group-replication-frequently-asked-questions.html`](https://dev.mysql.com/doc/refman/8.0/en/group-replication-frequently-asked-questions.html)

本节提供了常见问题的答案。

### 一个组中 MySQL 服务器的最大数量是多少？

一个组最多可以由 9 台服务器组成。尝试向具有 9 个成员的组添加另一台服务器会导致加入请求被拒绝。这个限制是通过测试和基准测试确定的，是一个安全边界，在稳定的本地区域网络上组表现可靠。

### 组中的服务器是如何连接的？

组中的服务器通过打开对等 TCP 连接连接到组中的其他服务器。这些连接仅用于组内通信和服务器之间的消息传递。此地址由`group_replication_local_address`变量配置。

### `group_replication_bootstrap_group`选项用于什么目的？

引导标志指示成员*创建*一个组并充当初始种子服务器。加入组的第二个成员需要请求引导组的成员动态更改配置，以便将其添加到组中。

成员需要在两种情况下引导组。当组最初创建时，或者当关闭并重新启动整个组时。

### 如何为分布式恢复过程设置凭据？

您可以将用户凭据永久设置为`group_replication_recovery`通道的凭据，使用`CHANGE REPLICATION SOURCE TO`语句（从 MySQL 8.0.23 开始）或`CHANGE MASTER TO`语句（MySQL 8.0.23 之前）。另外，从 MySQL 8.0.21 开始，您可以在每次启动 Group Replication 时在`START GROUP_REPLICATION`语句中指定它们。

使用`CHANGE REPLICATION SOURCE TO` | `CHANGE MASTER TO`设置的用户凭据以明文形式存储在服务器上的复制元数据存储库中，但在`START GROUP_REPLICATION`中指定的用户凭据仅保存在内存中，并且通过`STOP GROUP_REPLICATION`语句或服务器关闭时会被删除。因此，使用`START GROUP_REPLICATION`指定用户凭据有助于保护组复制服务器免受未经授权的访问。但是，此方法与通过`group_replication_start_on_boot`系统变量指定自动启动组复制不兼容。有关更多信息，请参见 Section 20.6.3.1, “Secure User Credentials for Distributed Recovery”。

### 我可以使用组复制来扩展我的写入负载吗？

不直接，但 MySQL 组复制是一种共享无内容完全复制解决方案，组中的所有服务器都复制相同数量的数据。因此，如果组中的一个成员将 N 字节写入存储作为事务提交操作的结果，那么其他成员上也大致会写入 N 字节到存储，因为事务在所有地方都被复制。

然而，由于其他成员不必像原始成员在最初执行事务时那样进行相同数量的处理，他们会更快地应用更改。事务以仅用于应用行转换的格式进行复制，而无需重新执行事务（基于行的格式）。

此外，由于更改以基于行的格式传播和应用，这意味着它们以优化和紧凑的格式接收，并且与原始成员相比，可能减少所需的 IO 操作次数。

总结一下，您可以通过将无冲突的事务分布到组中的不同成员来扩展处理能力。您可以很可能扩展出小部分 IO 操作，因为远程服务器只接收读取-修改-写入到稳定存储的必要更改。

### 与简单复制相比，组复制是否需要更多的网络带宽和 CPU，在相同的工作负载下？

由于服务器需要不断相互交互以进行同步，因此预计会有一些额外负载。很难量化需要多少数据。这也取决于组的大小（三台服务器对带宽需求的压力比九台服务器少）。

内存和 CPU 占用也更大，因为服务器同步部分和组消息传递需要执行更复杂的工作。

### 我可以在广域网上部署组复制吗？

是的，但是每个成员之间的网络连接 *必须* 是可靠的，并且具有适当的性能。低延迟、高带宽的网络连接是实现最佳性能的要求。

如果仅网络带宽是问题，那么可以使用 第 20.7.4 节，“消息压缩” 来降低所需的带宽。然而，如果网络丢包导致重传和更高的端到端延迟，吞吐量和延迟都会受到负面影响。

警告

当任何组成员之间的网络往返时间（RTT）为 5 秒或更长时，您可能会遇到问题，因为内置的故障检测机制可能会错误地触发。

### 在临时连接问题的情况下，成员是否会自动重新加入组？

这取决于连接问题的原因。如果连接问题是暂时的，并且重新连接足够快以至于故障检测器没有意识到它，那么服务器可能不会从组中移除。如果是一个“长期”的连接问题，那么故障检测器最终会怀疑存在问题，并将服务器从组中移除。

从 MySQL 8.0 开始，有两个设置可用于增加成员保持在组中或重新加入组的机会：

+   `group_replication_member_expel_timeout` 增加了在创建怀疑（在初始 5 秒检测期之后发生）和将成员驱逐之间的时间。您可以设置最多 1 小时的等待时间。从 MySQL 8.0.21 开始，默认设置为 5 秒的等待时间。

+   `group_replication_autorejoin_tries` 使成员在被驱逐或不可达的大多数超时后尝试重新加入组。成员将按照指定的次数间隔五分钟进行自动重新加入尝试。从 MySQL 8.0.21 开始，默认情况下激活此功能，并且成员进行三次自动重新加入尝试。

如果服务器被从组中驱逐，并且任何自动重新加入尝试都不成功，您需要手动重新加入它。换句话说，当服务器被明确从组中移除后，您需要手动重新加入它（或者有一个脚本自动执行）。

### 什么时候会将成员从组中排除？

如果成员变得沉默，其他成员将其从组配置中移除。实际上，当成员崩溃或存在网络断开时可能会发生这种情况。

在给定成员经过一定超时后检测到故障，并创建一个不包含静默成员的新配置。

### 当一个节点明显滞后时会发生什么？

没有一种方法可以自动定义何时从组中自动驱逐成员的策略。您需要找出为什么成员滞后并解决问题，或将该成员从组中移除。否则，如果服务器太慢以至于触发流量控制，那么整个组也会减速。流量控制可以根据您的需求进行配置。

### 在怀疑组内出现问题时，是否有特定成员负责触发重新配置？

不，组内没有特定成员负责触发重新配置。

任何成员都可以怀疑存在问题。所有成员需要（自动）同意某个成员已经失败。一个成员负责将其从组中驱逐，触发重新配置。负责驱逐成员的成员不是您可以控制或设置的。

### 我可以将 Group Replication 用于分片吗？

Group Replication 旨在提供高可用性的副本集；数据和写入在组内的每个成员上都会复制。为了扩展超出单个系统所能提供的范围，您需要围绕多个 Group Replication 集构建编排和分片框架，其中每个副本集维护和管理总数据集的给定分片或分区。这种设置通常称为“分片集群”，允许您线性扩展读取和写入，而且没有限制。

### 如何在使用 SELinux 时使用 Group Replication？

如果启用了 SELinux，您可以使用 **sestatus -v** 进行验证，然后需要启用 Group Replication 通信端口的使用。请参阅 为 Group Replication 设置 TCP 端口上下文。

### 如何在使用 iptables 时使用 Group Replication？

如果启用了 **iptables**，那么您需要为机器之间的通信打开 Group Replication 端口。要查看每台机器上当前的规则，请执行 **iptables -L**。假设配置的端口是 33061，在必要端口上启用通信，请执行 **iptables -A INPUT -p tcp --dport 33061 -j ACCEPT**。

### 如何恢复由组成员使用的复制通道的中继日志？

Group Replication 使用的复制通道的行为方式与异步源到副本复制中使用的复制通道相同，因此依赖于中继日志。在更改`relay_log`变量或主机名更改时，可能会出现错误。请参阅 Section 19.2.4.1, “The Relay Log”以了解在此情况下的恢复过程。另外，在 Group Replication 中专门解决此问题的另一种方法是发出`STOP GROUP_REPLICATION`语句，然后发出`START GROUP_REPLICATION`语句重新启动实例。Group Replication 插件会再次创建`group_replication_applier`通道。

### Group Replication 为什么使用两个绑定地址？

Group Replication 使用两个绑定地址，以便在 SQL 地址（客户端用于与成员通信的地址）和`group_replication_local_address`之间分割网络流量，成员内部使用该地址进行通信。例如，假设一个服务器有两个网络接口分配给网络地址`203.0.113.1`和`198.51.100.179`。在这种情况下，您可以通过设置`group_replication_local_address=203.0.113.1:33061`来使用`203.0.113.1:33061`作为内部组网络地址。然后您可以使用`198.51.100.179`作为`hostname`，`3306`作为`port`。客户端 SQL 应用程序将连接到`198.51.100.179:3306`的成员。这使您可以在不同网络上配置不同的规则。同样，内部组通信可以与用于客户端应用程序的网络连接分开，以增加安全性。

### Group Replication 如何使用网络地址和主机名？

Group Replication 使用成员之间的网络连接，因此其功能直接受到主机名和端口配置的影响。例如，Group Replication 的分布式恢复过程使用服务器的主机名和端口创建到现有组成员的连接。当成员加入组时，它会接收组成员信息，使用在`performance_schema.replication_group_members`中列出的网络地址信息。该表中列出的成员之一被选为从组到加入成员的缺失数据的捐赠者。

这意味着使用主机名配置的任何值，例如 SQL 网络地址或组种子地址，必须是完全合格的名称，并且每个组成员都可以解析。例如，您可以通过 DNS 或正确配置的`/etc/hosts`文件或其他本地进程来确保这一点。如果您想在服务器上配置`MEMBER_HOST`值，请在将其加入组之前使用服务器上的`--report-host`选项指定。

重要

分配的值直接使用，不受`skip_name_resolve`系统变量的影响。

要在服务器上配置`MEMBER_PORT`，请使用`report_port`系统变量指定。

### 为什么服务器上的自增设置发生了变化？

当在服务器上启动 Group Replication 时，`auto_increment_increment`的值会更改为`group_replication_auto_increment_increment`的值，默认为 7，并且`auto_increment_offset`的值会更改为服务器 ID。当 Group Replication 停止时，更改会被还原。这些设置避免了在组成员上写入时选择重复的自增值，从而导致事务回滚。Group Replication 的默认自增值 7 代表可用值数量和复制组的允许最大大小（9 个成员）之间的平衡。

只有当`auto_increment_increment`和`auto_increment_offset`的值都已经被修改为默认值 1 时，更改才会生效并回滚。如果它们的值已经从默认值修改过，Group Replication 不会改变它们。从 MySQL 8.0 开始，当 Group Replication 处于单主模式时，系统变量也不会被修改，只有一个服务器进行写入。

### 如何找到主服务器？

如果组在单主模式下运行，找出哪个成员是主要的可能很有用。请参阅 Section 20.1.3.1.2, “Finding the Primary”

# 10.12.1 优化磁盘 I/O

> 原文：[`dev.mysql.com/doc/refman/8.0/en/disk-issues.html`](https://dev.mysql.com/doc/refman/8.0/en/disk-issues.html)

本节描述了当你可以为数据库服务器提供更多和更快的存储硬件时如何配置存储设备。有关优化`InnoDB`配置以提高 I/O 性能的信息，请参见第 10.5.8 节，“优化 InnoDB 磁盘 I/O”。

+   磁盘寻道是一个巨大的性能瓶颈。当数据量变得如此之大以至于有效缓存变得不可能时，这个问题变得更加明显。对于访问数据比较随机的大型数据库，你可以确信你至少需要一个磁盘寻道来读取数据，以及几个磁盘寻道来写入数据。为了最小化这个问题，使用寻道时间较低的磁盘。

+   增加可用磁盘轴承的数量（从而减少寻道开销），可以通过将文件符号链接到不同的磁盘或者对磁盘进行条带化来实现：

    +   使用符号链接

        这意味着，对于`MyISAM`表，你可以将索引文件和数据文件从它们在数据目录中的通常位置创建符号链接到另一个磁盘（也可以进行条带化）。假设该磁盘没有用于其他目的，这将使寻道和读取时间更好。参见第 10.12.2 节，“使用符号链接”。

        `InnoDB`表不支持使用符号链接。但是，可以将`InnoDB`数据和日志文件放在不同的物理磁盘上。更多信息，请参见第 10.5.8 节，“优化 InnoDB 磁盘 I/O”。

    +   条带化

        条带化意味着你有许多磁盘，并且将第一个块放在第一个磁盘上，第二个块放在第二个磁盘上，第*`N`*个块放在（*`N`* MOD *`磁盘数量`*）磁盘上，依此类推。这意味着如果你的正常数据大小小于条带大小（或者完全对齐），你将获得更好的性能。条带化非常依赖于操作系统和条带大小，因此请使用不同的条带大小对你的应用程序进行基准测试。参见第 10.13.2 节，“使用自己的基准测试”。

        条带化的速度差异*非常*依赖于参数。根据你设置的条带化参数和磁盘数量，你可能会得到数量级差异的结果。你必须选择优化随机访问还是顺序访问。

+   为了可靠性，你可能希望使用 RAID 0+1（条带化加镜像），但在这种情况下，你需要 2×*`N`*个驱动器来存储*`N`*个驱动器的数据。如果你有资金，这可能是最好的选��。然而，你可能还需要投资一些卷管理软件来有效处理它。

+   根据数据类型的重要性，可以根据 RAID 级别进行调整。例如，将可以重新生成的半重要数据存储在 RAID 0 磁盘上，但将主机信息和日志等真正重要的数据存储在 RAID 0+1 或 RAID *`N`* 磁盘上。如果有许多写操作，RAID *`N`* 可能会成为问题，因为更新奇偶校验位需要时间。

+   您还可以设置数据库使用的文件系统的参数：

    如果您不需要知道文件上次访问的时间（这在数据库服务器上并不真正有用），您可以使用`-o noatime`选项挂载文件系统。这样可以跳过对文件系统中 inode 上的最后访问时间的更新，从而避免一些磁盘寻道。

    在许多操作系统上，您可以通过使用`-o async`选项挂载文件系统来异步更新文件系统。如果您的计算机相当稳定，这应该可以在不牺牲太多可靠性的情况下提供更好的性能。（在 Linux 上，默认情况下启用此标志。）

#### 使用 NFS 与 MySQL

在考虑是否与 MySQL 一起使用 NFS 时应谨慎。潜在问题因操作系统和 NFS 版本而异，包括以下内容：

+   放置在 NFS 卷上的 MySQL 数据和日志文件被锁定并无法使用。在多个 MySQL 实例访问相同数据目录或 MySQL 因不当关闭（例如由于断电）而发生锁定问题的情况下可能会发生。NFS 版本 4 通过引入咨询和基于租约的锁定来解决潜在的锁定问题。然而，不建议在多个 MySQL 实例之间共享数据目录。

+   由于消息接收顺序混乱或网络流量丢失而引入的数据不一致性。为避免此问题，请使用带有`hard`和`intr`挂载选项的 TCP。

+   最大文件大小限制。NFS 版本 2 客户端只能访问文件的最低 2GB（带符号 32 位偏移）。NFS 版本 3 客户端支持更大的文件（最多 64 位偏移）。支持的最大文件大小还取决于 NFS 服务器的本地文件系统。

在专业 SAN 环境或其他存储系统中使用 NFS 往往比在此类环境之外使用 NFS 提供更高的可靠性。然而，在 SAN 环境中使用 NFS 可能比直接连接或总线连接的非旋转存储慢。

如果选择使用 NFS，建议使用 NFS 版本 4 或更高版本，并在部署到生产环境之前彻底测试您的 NFS 设置。

# 20.5.4 分布式恢复

> 原文：[`dev.mysql.com/doc/refman/8.0/en/group-replication-distributed-recovery.html`](https://dev.mysql.com/doc/refman/8.0/en/group-replication-distributed-recovery.html)

20.5.4.1 用于分布式恢复的连接

20.5.4.2 用于分布式恢复的克隆

20.5.4.3 配置分布式恢复

20.5.4.4 分布式恢复的容错性

20.5.4.5 分布式恢复的工作原理

每当成员加入或重新加入复制组时，它必须赶上在其加入之前或离开期间组成员应用的事务。这个过程称为分布式恢复。

加入成员首先通过检查其`group_replication_applier`通道的中继日志，查看组中已接收但尚未应用的任何事务。如果加入成员以前曾在组中，它可能会发现在离开之前未应用的事务，这种情况下会将其作为第一步应用。新加入组的成员没有任何需要应用的事务。

在此之后，加入成员连接到在线现有成员以进行状态传输。加入成员传输了在其加入组之前或离开期间发生的所有事务，这些事务由现有成员（称为*捐赠者*）提供。接下来，加入成员应用了在此状态传输过程中组中发生的事务。当此过程完成时，加入成员已经赶上了组中的其余服务器，并开始正常参与组中的活动。

组复制在分布式恢复期间使用这些方法的组合进行状态传输：

+   使用克隆插件的功能进行远程克隆操作，该功能从 MySQL 8.0.17 起可用。要启用此状态传输方法，必须在组成员和加入成员上安装克隆插件。组复制自动配置所需的克隆插件设置，并管理远程克隆操作。

+   从捐赠者的二进制日志复制并在加入成员上应用事务。此方法使用一个名为`group_replication_recovery`的标准异步复制通道，在捐赠者和加入成员之间建立。

在加入成员上发出`START GROUP_REPLICATION`后，组复制会自动选择这些方法的最佳组合进行状态转移。为此，组复制会检查哪些现有成员适合作为捐赠者，加入成员需要从捐赠者那里获取多少事务，以及是否在任何组成员的二进制日志文件中不再存在任何必需的事务。如果加入成员与适当的捐赠者之间的事务差距很大，或者某些必需的事务不在任何捐赠者的二进制日志文件中，组复制将开始进行远程克隆操作的分布式恢复。如果事务差距不大，或者未安装克隆插件，则组复制直接进行从捐赠者的二进制日志进行状态转移。

+   在远程克隆操作期间，加入成员上的现有数据将被删除，并替换为捐赠者的数据副本。当远程克隆操作完成并加入成员重新启动时，将执行从捐赠者的二进制日志进行状态转移，以获取在远程克隆操作进行时组应用的事务。

+   在从捐赠者的二进制日志进行状态转移期间，加入成员复制并应用所需的事务从捐赠者的二进制日志中，按照接收到的事务逐个应用，直到二进制日志记录加入成员加入组的点（视图更改事件）。在此过程中，加入成员缓冲组应用的新事务。当从二进制日志的状态转移完成时，加入成员应用缓冲事务。

当加入成员与组的所有事务保持最新时，它被声明为在线，并可以作为正常成员参与组，并且分布式恢复完成。

提示

从二进制日志进行状态转移是组复制的分布式恢复的基本机制，如果您的复制组中的捐赠者和加入成员未设置为支持克隆，则这是唯一可用的选项。由于从二进制日志进行状态转移是基于经典的异步复制，如果加入组的服务器根本没有组的数据，或者具有来自非常旧的备份镜像的数据，可能需要很长时间。因此，在将服务器添加到组之前，建议您通过传输一个相当新的服务器快照来设置具有组数据的服务器。这样可以最大程度地减少分布式恢复所需的时间，并减少对捐赠者服务器的影响，因为它们需要保留和传输更少的二进制日志文件。

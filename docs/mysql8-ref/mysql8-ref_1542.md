# 20.7.7 响应故障检测和网络分区

> 原文：[`dev.mysql.com/doc/refman/8.0/en/group-replication-responses-failure.html`](https://dev.mysql.com/doc/refman/8.0/en/group-replication-responses-failure.html)

20.7.7.1 驱逐超时

20.7.7.2 不可达多数超时

20.7.7.3 自动重新加入

20.7.7.4 退出操作

组复制的故障检测机制旨在识别不再与组通信并在看似可能已经失败时将其驱逐的组成员。拥有故障检测机制增加了组包含大多数正常工作成员的机会，因此客户端的请求能够被正确处理。

通常，所有组成员定期与所有其他组成员交换消息。如果某个组成员在 5 秒内没有收到来自特定成员的任何消息，当检测期结束时，会对该成员产生怀疑。当怀疑超时时，被怀疑的成员被认为已经失败，并被驱逐出组。被驱逐的成员从其他成员看到的成员列表中被移除，但它并不知道自己已经被驱逐出组，因此它认为自己在线，而其他成员无法到达。如果成员实际上没有失败（例如，因为仅因临时网络问题而断开连接），并且能够恢复与其他成员的通信，它将接收一个包含其被驱逐出组信息的视图。

组成员对这些情况的响应，包括故障成员本身，在整个过程中可以进行配置。默认情况下，如果怀疑某个成员已经失败，则会发生以下行为：

1.  在 MySQL 8.0.20 之前，当产生怀疑时，立即超时。一旦组识别到已过期的怀疑，被怀疑的成员就有可能在超时后的几秒内存活，因为定期进行过期怀疑检查。从 MySQL 8.0.21 开始，在怀疑超时并且被怀疑的成员有可能被驱逐之前，会添加 5 秒的等待时间。

1.  如果被驱逐的成员恢复通信并意识到自己已被驱逐，在 MySQL 8.0.20 之前，它不会尝试重新加入组。从 MySQL 8.0.21 开始，它将自动尝试三次重新加入组（每次尝试之间间隔 5 分钟），如果此自动重新加入过程不起作用，则停止尝试重新加入组。

1.  当被驱逐的成员不尝试重新加入组时，它会切换到超级只读模式并等待操作员注意。（例外情况是在 MySQL 8.0.12 至 8.0.15 的版本中，默认情况下成员会关闭自身。从 MySQL 8.0.16 开始，行为已更改以匹配 MySQL 5.7 中的行为。）

您可以使用本节中描述的组复制配置选项来永久或临时更改这些行为，以适应您系统的要求和您的优先级。如果您遇到由较慢的网络或机器引起的不必要的驱逐、具有高意外瞬时中断率的网络，或计划中的网络中断，考虑增加驱逐超时和自动重新加入尝试次数。从 MySQL 8.0.21 开始，已更改默认设置以减少在这些情况下需要操作员干预以恢复被驱逐成员的频率。请注意，虽然成员正在经历上述任何默认行为之一时，尽管它不接受写入，但如果成员仍在与客户端通信，则仍然可以进行读取，随着时间的推移，过时读取的可能性会增加。如果避免过时读取对您而言比避免操作员干预更重要，请考虑减少驱逐超时和自动重新加入尝试次数或将其设置为零。

未发生故障的成员可能会由于网络分区而失去与复制组的部分但不是全部的联系。例如，在一个由 5 台服务器（S1、S2、S3、S4、S5）组成的组中，如果（S1、S2）和（S3、S4、S5）之间存在断开连接，则存在网络分区。第一组（S1、S2）现在处于少数派，因为它无法与超过一半的组联系。由少数派组成员处理的任何事务都会被阻塞，因为组的大多数是不可达的，因此组无法达成法定人数。有关此场景的详细描述，请参见第 20.7.8 节，“处理网络分区和法定人数丧失”。在这种情况下，默认行为是使少数派和多数派的成员继续留在组中，继续接受事务（尽管在少数派成员上被阻塞），并等待操作员干预。此行为也是可配置的。

请注意，如果团队成员使用的是较旧的 MySQL 服务器版本，不支持相关设置，或者使用具有不同默认设置的版本，则他们会根据上述默认行为对自己和其他团队成员采取行动。例如，不支持`group_replication_member_expel_timeout`系统变量的成员会在检测到过期的怀疑时立即驱逐其他成员，并即使其他成员支持该系统变量并设置了更长的超时时间，他们也会接受这种驱逐。

> 原文：[`dev.mysql.com/doc/refman/8.0/en/error-log-format.html`](https://dev.mysql.com/doc/refman/8.0/en/error-log-format.html)

#### 7.4.2.9 错误日志输出格式

每个错误日志输出组件都有其用于将消息写入目的地的特征输出格式，但其他因素可能影响消息的内容：

+   日志输出可用的信息。如果在执行输出组件之前执行了日志过滤组件以删除日志事件字段，则该字段不可用于写入。有关日志过滤的信息，请参阅第 7.4.2.4 节，“错误日志过滤类型”。

+   与日志输出组件相关的信息。并非每个输出组件都会写入错误事件中可用的所有字段。

+   系统变量可能会影响日志输出。请参阅影响错误日志格式的系统变量。

有关错误事件中字段的名称和描述，请参阅第 7.4.2.3 节，“错误事件字段”。对于所有日志输出，包含在错误日志消息中的线程 ID 是负责编写消息的**mysqld**内的线程 ID。此 ID 指示服务器的哪个部分生成了消息，并与一般查询日志和慢查询日志消息一致，这些消息包括连接线程 ID。

+   log_sink_internal 输出格式

+   log_sink_json 输出格式

+   log_sink_syseventlog 输出格式

+   早期启动日志输出格式

+   影响错误日志格式的系统变量

##### log_sink_internal 输出格式

内部日志输出产生传统错误日志输出。例如：

```sql
2020-08-06T14:25:02.835618Z 0 [Note] [MY-012487] [InnoDB] DDL log recovery : begin
2020-08-06T14:25:02.936146Z 0 [Warning] [MY-010068] [Server] CA certificate /var/mysql/sslinfo/cacert.pem is self signed.
2020-08-06T14:25:02.963127Z 0 [Note] [MY-010253] [Server] IPv6 is available.
2020-08-06T14:25:03.109022Z 5 [Note] [MY-010051] [Server] Event Scheduler: scheduler thread started with id 5
```

传统格式消息具有以下字段：

```sql
time thread [label] [err_code] [subsystem] msg
```

`[` 和 `]` 方括号字符是消息格式中的文字字符。它们不表示字段是可选的。

`label` 值对应于 `prio` 错误事件优先级字段的字符串形式。

`[err_code]` 和 `[subsystem]` 字段在 MySQL 8.0 中添加。这些字段在旧服务器生成的日志中缺失。日志解析器可以将这些字段视为仅在包含它们的新服务器生成的日志中存在的消息文本的一部分。解析器必须将 `[err_code]` 指示器中的 `err_code` 部分视为字符串值，而不是数字，因为像 `MY-012487` 和 `MY-010051` 这样的值包含非数字字符。

##### log_sink_json 输出格式

JSON 格式的日志接收器生成包含键值对的 JSON 对象作为消息。例如：

```sql
{
  "prio": 3,
  "err_code": 10051,
  "source_line": 561,
  "source_file": "event_scheduler.cc",
  "function": "run",
  "msg": "Event Scheduler: scheduler thread started with id 5",
  "time": "2020-08-06T14:25:03.109022Z",
  "ts": 1596724012005,
  "thread": 5,
  "err_symbol": "ER_SCHEDULER_STARTED",
  "SQL_state": "HY000",
  "subsystem": "Server",
  "buffered": 1596723903109022,
  "label": "Note"
}
```

显示的消息已经重新格式化以提高可读性。写入错误日志的事件每行显示一条消息。

`ts`（时间戳）键在 MySQL 8.0.20 中添加，是 JSON 格式日志接收器特有的。其值是一个整数，表示自纪元（`'1970-01-01 00:00:00'` UTC）以来的毫秒数。

`ts` 和 `buffered` 值是 Unix 时间戳值，可以使用 `FROM_UNIXTIME()` 和适当的除数进行转换：

```sql
mysql> SET time_zone = '+00:00';
mysql> SELECT FROM_UNIXTIME(1596724012005/1000.0);
+-------------------------------------+
| FROM_UNIXTIME(1596724012005/1000.0) |
+-------------------------------------+
| 2020-08-06 14:26:52.0050            |
+-------------------------------------+
mysql> SELECT FROM_UNIXTIME(1596723903109022/1000000.0);
+-------------------------------------------+
| FROM_UNIXTIME(1596723903109022/1000000.0) |
+-------------------------------------------+
| 2020-08-06 14:25:03.1090                  |
+-------------------------------------------+
```

##### log_sink_syseventlog 输出格式

系统日志接收器生成符合本地平台使用的系统日志格式的输出。

##### 早期启动日志输出格式

服务器在启动选项被处理之前生成一些错误日志消息，因此在了解错误日志设置（如`log_error_verbosity`和`log_timestamps`系统变量值）以及要使用的日志组件之前。服务器处理在启动过程中生成的错误日志消息如下：

+   在 MySQL 8.0.14 之前，服务器生成具有默认时间戳、格式和详细级别的消息，并对其进行缓冲。在处理启动选项并了解错误日志配置之后，服务器会刷新缓冲的消息。由于这些早期消息使用默认日志配置，它们可能与启动选项指定的内容不同。此外，早期消息不会刷新到除默认接收器之外的日志接收器。例如，记录到 JSON 接收器不包括这些早期消息，因为它们不是 JSON 格式。

+   从 MySQL 8.0.14 开始，服务器缓冲日志事件而不是格式化的日志消息。这使得在了解设置之后可以对这些事件进行追溯应用配置设置，结果是刷新的消息使用配置的设置，而不是默认设置。此外，消息会刷新到所有配置的接收器，而不仅仅是默认接收器。

    如果在日志配置未知之前发生致命错误并且服务器必须退出，则服务器使用日志默认值格式化缓冲消息，以免丢失。如果没有发生致命错误，但启动在处理启动选项之前过于缓慢，则服务器会定期使用日志默认值格式化和刷新缓冲消息，以免显得无响应。尽管这种行为类似于 8.0.14 之前的行为，即使用默认值，但在异常情况发生时不丢失消息更为可取。

##### 影响错误日志格式的系统变量

`log_timestamps`系统变量控制写入错误日志（以及一般查询日志和慢查询日志文件）中时间戳的时区。服务器在错误事件到达任何日志接收端之前应用`log_timestamps`，因此它影响所有接收端的错误消息输出。

允许的`log_timestamps`值为`UTC`（默认）和`SYSTEM`（本地系统时区）。时间戳使用 ISO 8601 / RFC 3339 格式写入：`*`YYYY-MM-DD`*T*`hh:mm:ss.uuuuuu`*` 加上一个尾部值`Z`表示 Zulu 时间（UTC）或`±hh:mm`（一个指示本地系统时区相对于 UTC 的调整偏移）。例如：

```sql
2020-08-07T15:02:00.832521Z            (UTC)
2020-08-07T10:02:00.832521-05:00       (SYSTEM)
```

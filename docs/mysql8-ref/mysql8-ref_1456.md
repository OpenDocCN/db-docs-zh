> 译文：[`dev.mysql.com/doc/refman/8.0/en/replication-features-shutdowns.html`](https://dev.mysql.com/doc/refman/8.0/en/replication-features-shutdowns.html)

#### 19.5.1.28 复制和源或复制关闭

安全地关闭复制源服务器并稍后重新启动是安全的。当副本失去与源的连接时，副本会立即尝试重新连接，如果失败，则定期重试。默认情况下，每隔 60 秒重试一次。可以使用`CHANGE REPLICATION SOURCE TO`语句（从 MySQL 8.0.23 开始）或`CHANGE MASTER TO`语句（在 MySQL 8.0.23 之前）来更改此值。副本还能够处理网络连接中断。但是，副本只有在从源接收到`replica_net_timeout`或`slave_net_timeout`秒内没有数据后才会注意到网络中断。如果您的中断时间很短，您可能希望减少`replica_net_timeout`或`slave_net_timeout`的值。参见第 19.4.2 节，“处理副本意外停止”。

源端发生不干净的关闭（例如崩溃）可能导致源的二进制日志的最终位置小于副本最近读取的位置，因为源的二进制日志文件没有被刷新。这可能导致源重新启动时副本无法复制。在源服务器的`my.cnf`文件中设置`sync_binlog=1`有助于最小化此问题，因为它会导致源更频繁地刷新其二进制日志。对于使用带有事务的`InnoDB`的复制设置，为了获得最大可能的耐久性和一致性，还应该设置`innodb_flush_log_at_trx_commit=1`。使用此设置，`InnoDB`重做日志缓冲区的内容在每个事务提交时写入日志文件，并且日志文件被刷新到磁盘。请注意，即使使用此设置，事务的耐久性仍然不能得到保证，因为操作系统或磁盘硬件可能告诉**mysqld**刷新到磁盘的操作已经完成，尽管实际上并没有。

干净地关闭一个副本是安全的，因为它会记录下关闭时的位置。但是，请注意副本没有打开临时表；参见 Section 19.5.1.31，“复制和临时表”。不干净的关闭可能会产生问题，特别是如果在问题发生之前磁盘缓存没有刷新到磁盘上：

+   对于事务，副本会先提交然后更新`relay-log.info`。如果在这两个操作之间发生意外退出，中继日志处理会继续进行，超过信息文件所指示的位置，并且在重新启动后，副本会重新执行中继日志中最后一个事务之后的事件。

+   如果副本更新`relay-log.info`但是在写入刷新到磁盘之前服务器主机崩溃，就会出现类似的问题。为了最大程度减少这种情况发生的机会，在副本的`my.cnf`文件中设置`sync_relay_log_info=1`。将`sync_relay_log_info`设置为 0 会导致不强制写入磁盘，服务器依赖操作系统不时地刷新文件。

对于这些问题类型，系统的容错性会大大增加，如果你有一个良好的不间断电源供应。

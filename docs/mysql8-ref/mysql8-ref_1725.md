> 原文：[`dev.mysql.com/doc/refman/8.0/en/mysql-cluster-log-statistics.html`](https://dev.mysql.com/doc/refman/8.0/en/mysql-cluster-log-statistics.html)

#### 25.6.3.3 在 NDB Cluster 管理客户端中使用 CLUSTERLOG STATISTICS

`NDB`管理客户端的`CLUSTERLOG STATISTICS`命令可以在其输出中提供许多有用的统计信息。提供有关集群状态的计数器每 5 秒由事务协调器 (TC) 和本地查询处理程序 (LQH) 更新一次，并写入集群日志。

**事务协调器统计信息。** 每个事务都有一个事务协调器，可以通过以下方法之一选择：

+   以轮询方式

+   通过通信接近度

+   在事务启动时提供数据放置提示

注意

你可以通过`ndb_optimized_node_selection`系统变量确定从给定 SQL 节点开始的事务使用哪种 TC 选择方法。

同一事务内的所有操作使用相同的事务协调器，报告以下统计信息：

+   **事务计数。** 这是在上一个间隔内使用此 TC 作为事务协调器启动的事务数量。这些事务中的任何一个可能已提交、已中止或在报告间隔结束时仍未提交。

    注意

    事务不会在 TC 之间迁移。

+   **提交计数。** 这是在上一个报告间隔内使用此 TC 作为事务协调器提交的事务数量。因为一些在此报告间隔内提交的事务可能在之前的报告间隔内启动，所以`提交计数`可能大于`事务计数`。

+   **读取计数。** 这是在上一个报告间隔内使用此 TC 作为事务协调器启动的主键读取操作次数，包括简单读取。此计数还包括作为唯一索引操作的读取。唯一索引读取操作生成 2 个主键读取操作——一个用于隐藏的唯一索引表，一个用于读取发生的表。

+   **简单读取计数。** 这是在上一个报告间隔内使用此 TC 作为事务协调器启动的简单读取操作次数。

+   **写入计数。** 这是在上一个报告间隔内以此 TC 作为事务协调器启动的主键写入操作次数。这包括所有插入、更新、写入和删除操作，以及作为唯一索引操作的写入。

    注意

    唯一索引更新操作可能在索引表和基表上生成多个主键读取和写入操作。

+   **AttrInfoCount. ** 这是在上一个报告间隔中接收的 32 位数据字的数量，用于使用此 TC 作为事务协调器的主键操作。对于读取操作，这与请求的列数成比例。对于插入和更新操作，这与写入的列数以及它们的数据大小成比例。对于删除操作，这通常为零。

    唯一索引操作会生成多个 PK 操作，因此会增加此计数。但是，用于描述 PK 操作本身的数据字以及发送的关键信息在此处*不*计入。用于描述扫描读取的列或描述 ScanFilters 的属性信息也不计入 `AttrInfoCount`。

+   **Concurrent Operations. ** 这是在上一个报告间隔中启动但未完成的使用此 TC 作为事务协调器的主键或扫描操作的数量。当操作启动时，此计数器会递增，并在操作完成后递减；这发生在事务提交后。脏读和写操作以及失败的操作会递减此计数器。

    `Concurrent Operations` 可以达到的最大值是 TC 块可以支持的操作数的最大值；目前，这是 `(2 * MaxNoOfConcurrentOperations) + 16 + MaxNoOfConcurrentTransactions`。（有关这些配置参数的更多信息，请参见 25.4.3.6 节，“定义 NDB 集群数据节点”的*事务参数*部分。）

+   **Abort count. ** 这是在上一个报告间隔中被中止的使用此 TC 作为事务协调器的事务的数量。因为在上一个报告间隔中被中止的一些事务可能在先前的报告间隔中开始，`Abort count` 有时可能大于 `Trans count`。

+   **Scans. ** 这是在上一个报告间隔中启动的使用此 TC 作为事务协调器的表扫描的数量。这不包括范围扫描（即，有序索引扫描）。

+   **Range scans. ** 这是在上一个报告间隔中启动的使用此 TC 作为事务协调器的有序索引扫描的数量。

+   **Local reads. ** 这是在一个节点上使用事务协调器执行的主键读取操作的数量，该节点还保存记录的主键片段副本。此计数也可以从`ndbinfo.counters`表中的 `LOCAL_READS` 计数器中获取。

+   **本地写入。** 这包含使用事务协调器在同时还持有记录主要片段副本的节点上执行的主键读取操作的数量。此计数也可以从`ndbinfo.counters`表中的`LOCAL_WRITES`计数器中获取。

**本地查询处理程序统计信息（操作）。** 每个本地查询处理程序块（即每个数据节点进程）有 1 个集群事件。操作记录在数据所在的 LQH 中。

注意

单个事务可能操作存储在多个 LQH 块中的数据。

`Operations`统计数据提供了此 LQH 块在上一个报告间隔中执行的本地操作数量，并包括所有类型的读取和写入操作（插入、更新、写入和删除操作）。这还包括用于复制写入的操作。例如，在具有两个片段副本的集群中，对主要片段副本的写入记录在主 LQH 中，对备份的写入记录在备份 LQH 中。唯一键操作可能导致多个本地操作；但是，这*不*包括由于表扫描或有序索引扫描而生成的本地操作，这些操作不计入统计。

**进程调度器统计信息。** 除了事务协调器和本地查询处理程序报告的统计信息外，每个**ndbd**进程都有一个调度程序，还提供与 NDB Cluster 性能相关的有用指标。此调度程序在无限循环中运行；在每个循环期间，调度程序执行以下任务：

1.  从套接字中读取任何传入的消息到作业缓冲区中。

1.  检查是否有任何定时消息需要执行；如果有，也将这些放入作业缓冲区中。

1.  执行（循环执行）作业缓冲区中的任何消息。

1.  发送通过执行作业缓冲区中的消息生成的任何分布式消息。

1.  等待任何新到来的消息。

进程调度器统计信息包括以下内容：

+   **平均循环计数器。** 这是从前述列表的第三步中执行的循环次数。随着 TCP/IP 缓冲区的利用率提高，此统计数据会增加。您可以使用此功能来监视随着添加新数据节点进程而发生的性能变化。

+   **平均发送大小和平均接收大小。** 这些统计数据使您能够衡量节点之间的写入和读取的效率。这些值以字节为单位给出。较高的值意味着每个字节发送或接收的成本较低；最大值为 64K。

要导致记录所有集群日志统计信息，您可以在`NDB`管理客户端中使用以下命令：

```sql
ndb_mgm> ALL CLUSTERLOG STATISTICS=15
```

注意

将`STATISTICS`的阈值设置为 15 会导致集群日志变得非常冗长，并且随着集群节点数量和 NDB 集群中活动量的增加而迅速增长。

有关与日志记录和报告相关的 NDB 集群管理客户端命令的更多信息，请参见第 25.6.3.1 节，“NDB 集群日志管理命令”。

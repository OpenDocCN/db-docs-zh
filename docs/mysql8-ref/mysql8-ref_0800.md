# 14.6.2 数学函数

> 原文：[`dev.mysql.com/doc/refman/8.0/en/mathematical-functions.html`](https://dev.mysql.com/doc/refman/8.0/en/mathematical-functions.html)

**Table 14.10 数学函数**

| 名称 | 描述 |
| --- | --- |
| `ABS()` | 返回绝对值 |
| `ACOS()` | 返回反余弦值 |
| `ASIN()` | 返回反正弦值 |
| `ATAN()` | 返回反正切值 |
| `ATAN2()`, `ATAN()` | 返回两个参数的反正切 |
| `CEIL()` | 返回不小于参数的最小整数值 |
| `CEILING()` | 返回不小于参数的最小整数值 |
| `CONV()` | 在不同进制之间转换数字 |
| `COS()` | 返回余弦值 |
| `COT()` | 返回余切值 |
| `CRC32()` | 计算循环冗余校验值 |
| `DEGREES()` | 将弧度转换为角度 |
| `EXP()` | 求幂 |
| `FLOOR()` | 返回不大于参数的最大整数值 |
| `LN()` | 返回参数的自然对数 |
| `LOG()` | 返回第一个参数的自然对数 |
| `LOG10()` | 返回参数的以 10 为底的对数 |
| `LOG2()` | 返回参数的以 2 为底的对数 |
| `MOD()` | 返回余数 |
| `PI()` | 返回圆周率的值 |
| `POW()` | 返回指定幂次的参数 |
| `POWER()` | 返回指定幂次的参数 |
| `RADIANS()` | 返回转换为弧度的参数 |
| `RAND()` | 返回一个随机浮点值 |
| `ROUND()` | 四舍五入参数 |
| `SIGN()` | 返回参数的符号 |
| `SIN()` | 返回参数的正弦值 |
| `SQRT()` | 返回参数的平方根 |
| `TAN()` | 返回参数的正切 |
| `TRUNCATE()` | 截断到指定的小数位数 |
| 名称 | 描述 |

所有数学函数在出现错误时返回`NULL`。

+   `ABS(*`X`*)`

    返回*`X`*的绝对值，如果*`X`*为`NULL`，则返回`NULL`。

    结果类型源自参数类型。这意味着`ABS(-9223372036854775808)`会产生错误，因为结果无法存储在有符号的`BIGINT`值中。

    ```sql
    mysql> SELECT ABS(2);
     -> 2
    mysql> SELECT ABS(-32);
     -> 32
    ```

    此函数可安全用于`BIGINT`值。

+   `ACOS(*`X`*)`

    返回*`X`*的反余弦，即，其余弦值为*`X`*的值。如果*`X`*不在`-1`到`1`的范围内，或者*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT ACOS(1);
     -> 0
    mysql> SELECT ACOS(1.0001);
     -> NULL
    mysql> SELECT ACOS(0);
     -> 1.5707963267949
    ```

+   `ASIN(*`X`*)`

    返回*`X`*的反正弦，即，其正弦值为*`X`*的值。如果*`X`*不在`-1`到`1`的范围内，或者*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT ASIN(0.2);
     -> 0.20135792079033
    mysql> SELECT ASIN('foo');

    +-------------+
    | ASIN('foo') |
    +-------------+
    |           0 |
    +-------------+
    1 row in set, 1 warning (0.00 sec)

    mysql> SHOW WARNINGS;
    +---------+------+-----------------------------------------+
    | Level   | Code | Message                                 |
    +---------+------+-----------------------------------------+
    | Warning | 1292 | Truncated incorrect DOUBLE value: 'foo' |
    +---------+------+-----------------------------------------+
    ```

+   `ATAN(*`X`*)`

    返回*`X`*的反正切。即，其正切值为*`X`*的值。如果*`X`*为`NULL`，则返回*`NULL`*。

    ```sql
    mysql> SELECT ATAN(2);
     -> 1.1071487177941
    mysql> SELECT ATAN(-2);
     -> -1.1071487177941
    ```

+   `ATAN(*`Y`*,*`X`*)`, `ATAN2(*`Y`*,*`X`*)`

    返回两个变量*`X`*和*`Y`*的反正切。它类似于计算`*`Y`* / *`X`*`的反正切，只是使用两个参数的符号来确定结果的象限。如果*`X`*或*`Y`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT ATAN(-2,2);
     -> -0.78539816339745
    mysql> SELECT ATAN2(PI(),0);
     -> 1.5707963267949
    ```

+   `CEIL(*`X`*)`

    `CEIL()`是`CEILING()`的同义词。

+   `CEILING(*`X`*)`

    返回不小于*`X`*的最小整数值。如果*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT CEILING(1.23);
     -> 2
    mysql> SELECT CEILING(-1.23);
     -> -1
    ```

    对于精确值数值参数，返回值具有精确值数值类型。对于字符串或浮点参数，返回值具有浮点类型。

+   `CONV(*`N`*,*`from_base`*,*`to_base`*)`

    在不同进制之间转换数字。返回从基数*`from_base`*转换为基数*`to_base`*的数字*`N`*的字符串表示。如果任何参数为`NULL`，则返回`NULL`。参数*`N`*被解释为整数，但可以指定为整数或字符串。最小基数为`2`，最大基数为`36`。如果*`from_base`*是负数，则*`N`*被视为有符号数。否则，*`N`*被视为无符号数。`CONV()`以 64 位精度工作。

    如果`CONV()`的任何参数为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT CONV('a',16,2);
     -> '1010'
    mysql> SELECT CONV('6E',18,8);
     -> '172'
    mysql> SELECT CONV(-17,10,-18);
     -> '-H'
    mysql> SELECT CONV(10+'10'+'10'+X'0a',10,10);
     -> '40'
    ```

+   `COS(*`X`*)`

    返回*`X`*的余弦值，其中*`X`*以弧度给出。如果*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT COS(PI());
     -> -1
    ```

+   `COT(*`X`*)`

    返回*`X`*的余切值。如果*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT COT(12);
     -> -1.5726734063977
    mysql> SELECT COT(0);
     -> out-of-range error
    ```

+   `CRC32(*`expr`*)`

    计算循环冗余校验值并返回一个 32 位无符号值。如果参数为`NULL`，则结果为`NULL`。预期参数为字符串，如果可能的话，如果参数不是字符串，则会被视为字符串。

    ```sql
    mysql> SELECT CRC32('MySQL');
     -> 3259397556
    mysql> SELECT CRC32('mysql');
     -> 2501908538
    ```

+   `DEGREES(*`X`*)`

    返回将弧度转换为度的参数*`X`*。如果*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT DEGREES(PI());
     -> 180
    mysql> SELECT DEGREES(PI() / 2);
     -> 90
    ```

+   `EXP(*`X`*)`

    返回*e*（自然对数的底）的*`X`*次幂的值。该函数的反函数是`LOG()`（仅使用单个参数）或`LN()`。

    如果*`X`*为`NULL`，此函数返回`NULL`。

    ```sql
    mysql> SELECT EXP(2);
     -> 7.3890560989307
    mysql> SELECT EXP(-2);
     -> 0.13533528323661
    mysql> SELECT EXP(0);
     -> 1
    ```

+   `FLOOR(*`X`*)`

    返回不大于*`X`*的最大整数值。如果*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT FLOOR(1.23), FLOOR(-1.23);
     -> 1, -2
    ```

    对于精确值数值参数，返回值具有精确值数值类型。对于字符串或浮点参数，返回值具有浮点类型。

+   `FORMAT(*`X`*,*`D`*)`

    将数字*`X`*格式化为类似`'#,###,###.##'`的格式，四舍五入到*`D`*位小数，并将结果作为字符串返回。有关详细信息，请参阅第 14.8 节“字符串函数和运算符”。

+   `HEX(N_or_S)`

    此函数可用于获取十进制数或字符串的十六进制表示；它的工作方式根据参数的类型而变化。有关详细信息，请参阅第 14.8 节“字符串函数和运算符”中此函数的描述。

+   `LN(*`X`*)`

    返回*`X`*的自然对数；即*`X`*的以*e*为底的对数。如果*`X`*小于或等于 0.0E0，则函数返回`NULL`并报告警告“对数的参数无效”。如果*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT LN(2);
     -> 0.69314718055995
    mysql> SELECT LN(-2);
     -> NULL
    ```

    此函数与`LOG(*`X`*)`是同义词。该函数的反函数是`EXP()`函数。

+   `LOG(*`X`*)`, `LOG(*`B`*,*`X`*)`

    如果使用一个参数调用此函数，则返回*`X`*的自然对数。如果*`X`*小于或等于 0.0E0，则函数返回`NULL`并报告警告“对数的参数无效”。如果*`X`*或*`B`*为`NULL`，则返回`NULL`。

    此函数的倒数（使用单个参数调用时）是`EXP()`函数。

    ```sql
    mysql> SELECT LOG(2);
     -> 0.69314718055995
    mysql> SELECT LOG(-2);
     -> NULL
    ```

    如果使用两个参数调用此函数，则返回以*`B`*为底的*`X`*的对数。如果*`X`*小于或等于 0，或者*`B`*小于或等于 1，则返回`NULL`。

    ```sql
    mysql> SELECT LOG(2,65536);
     -> 16
    mysql> SELECT LOG(10,100);
     -> 2
    mysql> SELECT LOG(1,100);
     -> NULL
    ```

    `LOG(*`B`*,*`X`*)` 等同于`LOG(*`X`*) / LOG(*`B`*)`。

+   `LOG2(*`X`*)`

    返回`*`X`*`的以 2 为底的对数。如果*`X`*小于或等于 0.0E0，则函数返回`NULL`并报告警告“对数的参数无效”。如果*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT LOG2(65536);
     -> 16
    mysql> SELECT LOG2(-100);
     -> NULL
    ```

    `LOG2()` 用于查找一个数字需要多少位来存储。此函数等同于表达式`LOG(*`X`*) / LOG(2)`。

+   `LOG10(*`X`*)`

    返回*`X`*的以 10 为底的对数。如果*`X`*小于或等于 0.0E0，则函数返回`NULL`并报告警告“对数的参数无效”。如果*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT LOG10(2);
     -> 0.30102999566398
    mysql> SELECT LOG10(100);
     -> 2
    mysql> SELECT LOG10(-100);
     -> NULL
    ```

    `LOG10(*`X`*)` 等同于`LOG(10,*`X`*)`。

+   `MOD(*`N`*,*`M`*)`, `*`N`* % *`M`*`, `*`N`* MOD *`M`*`

    取模运算。返回*`N`*除以*`M`*的余数。如果*`M`*或*`N`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT MOD(234, 10);
     -> 4
    mysql> SELECT 253 % 7;
     -> 1
    mysql> SELECT MOD(29,9);
     -> 2
    mysql> SELECT 29 MOD 9;
     -> 2
    ```

    此函数可安全用于`BIGINT` 值。

    `MOD()` 也适用于具有小数部分的值，并返回除法后的确切余数：

    ```sql
    mysql> SELECT MOD(34.5,3);
     -> 1.5
    ```

    `MOD(*`N`*,0)` 返回`NULL`。

+   `PI()`

    返回π（pi）的值。显示的小数位数默认为七位，但 MySQL 在内部使用完整的双精度值。

    因为此函数的返回值是双精度值，其精确表示可能因平台或实现而异。这也适用于使用`PI()`的任何表达式。参见第 13.1.4 节，“浮点类型（近似值） - FLOAT，DOUBLE”。

    ```sql
    mysql> SELECT PI();
     -> 3.141593
    mysql> SELECT PI()+0.000000000000000000;
     -> 3.141592653589793000
    ```

+   `POW(*`X`*,*`Y`*)`

    返回*`X`*的*`Y`*次幂的值。如果*`X`*或*`Y`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT POW(2,2);
     -> 4
    mysql> SELECT POW(2,-2);
     -> 0.25
    ```

+   `POWER(*`X`*,*`Y`*)`

    这是`POW()`的同义词。

+   `RADIANS(*`X`*)`

    返回将参数*`X`*从度转换为弧度的值。（注意π弧度等于 180 度。）如果*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT RADIANS(90);
     -> 1.5707963267949
    ```

+   [`RAND([*`N`*])`](mathematical-functions.html#function_rand)

    返回范围为`0` <= *`v`* < `1.0`的随机浮点值*`v`*。要在范围*`i`* <= *`R`* < *`j`*内获取随机整数*`R`*，可以使用表达式`FLOOR(*`i`* + RAND() * (*`j`*` − `*`i`*))`。例如，要在范围`7` <= *`R`* < `12`内获取随机整数，请使用以下语句：

    ```sql
    SELECT FLOOR(7 + (RAND() * 5));
    ```

    如果指定了整数参数*`N`*，则将其用作种子值：

    +   使用常量初始化参数时，种子在语句准备之前一次性初始化，然后执行。

    +   使用非常量初始化参数（例如列名），种子在每次调用`RAND()`时都会被初始化为该值。

    这种行为的一个含义是，对于相等的参数值，`RAND(*`N`*)`每次都返回相同的值，从而产生一系列可重复的列值。在以下示例中，`RAND(3)`产生的值序列在两个位置都是相同的。

    ```sql
    mysql> CREATE TABLE t (i INT);
    Query OK, 0 rows affected (0.42 sec)

    mysql> INSERT INTO t VALUES(1),(2),(3);
    Query OK, 3 rows affected (0.00 sec)
    Records: 3  Duplicates: 0  Warnings: 0

    mysql> SELECT i, RAND() FROM t;
    +------+------------------+
    | i    | RAND()           |
    +------+------------------+
    |    1 | 0.61914388706828 |
    |    2 | 0.93845168309142 |
    |    3 | 0.83482678498591 |
    +------+------------------+
    3 rows in set (0.00 sec)

    mysql> SELECT i, RAND(3) FROM t;
    +------+------------------+
    | i    | RAND(3)          |
    +------+------------------+
    |    1 | 0.90576975597606 |
    |    2 | 0.37307905813035 |
    |    3 | 0.14808605345719 |
    +------+------------------+
    3 rows in set (0.00 sec)

    mysql> SELECT i, RAND() FROM t;
    +------+------------------+
    | i    | RAND()           |
    +------+------------------+
    |    1 | 0.35877890638893 |
    |    2 | 0.28941420772058 |
    |    3 | 0.37073435016976 |
    +------+------------------+
    3 rows in set (0.00 sec)

    mysql> SELECT i, RAND(3) FROM t;
    +------+------------------+
    | i    | RAND(3)          |
    +------+------------------+
    |    1 | 0.90576975597606 |
    |    2 | 0.37307905813035 |
    |    3 | 0.14808605345719 |
    +------+------------------+
    3 rows in set (0.01 sec)
    ```

    在`WHERE`子句中使用`RAND()`会为每一行（从一个表中选择）或每一行组合（从多个表连接中选择）评估。因此，对于优化器而言，`RAND()`不是一个常量值，不能用于索引优化。有关更多信息，请参见第 10.2.1.20 节，“函数调用优化”。

    在`ORDER BY`或`GROUP BY`子句中使用带有`RAND()`值的列可能会产生意外结果，因为对于任一子句，`RAND()`表达式可能会对同一行进行多次评估，每次返回不同的结果。如果目标是以随机顺序检索行，可以使用类似以下语句：

    ```sql
    SELECT * FROM *tbl_name* ORDER BY RAND();
    ```

    要从一组行中选择随机样本，请将`ORDER BY RAND()`与`LIMIT`结合使用：

    ```sql
    SELECT * FROM table1, table2 WHERE a=b AND c<d ORDER BY RAND() LIMIT 1000;
    ```

    `RAND()`并不是一个完美的随机生成器。它是一种快速生成随机数的方式，可在相同的 MySQL 版本的不同平台之间移植。

    此函数对基于语句的复制不安全。如果在将`binlog_format`设置为`STATEMENT`时使用此函数，将记录警告。

+   `ROUND(*`X`*)`, `ROUND(*`X`*,*`D`*)`

    将参数*`X`*四舍五入到*`D`*位小数。舍入算法取决于*`X`*的数据类型。如果未指定，*`D`*默认为 0。*`D`*可以为负，使得值*`X`*小数点左边的*`D`*位变为零。*`D`*的最大绝对值为 30；超过 30（或-30）的任何数字将被截断。如果*`X`*或*`D`*为`NULL`，则函数返回`NULL`。

    ```sql
    mysql> SELECT ROUND(-1.23);
     -> -1
    mysql> SELECT ROUND(-1.58);
     -> -2
    mysql> SELECT ROUND(1.58);
     -> 2
    mysql> SELECT ROUND(1.298, 1);
     -> 1.3
    mysql> SELECT ROUND(1.298, 0);
     -> 1
    mysql> SELECT ROUND(23.298, -1);
     -> 20
    mysql> SELECT ROUND(.12345678901234567890123456789012345, 35);
     -> 0.123456789012345678901234567890
    ```

    返回值与第一个参数的类型相同（假设它是整数、双精度或十进制）。这意味着对于整数参数，结果是一个整数（没有小数位）：

    ```sql
    mysql> SELECT ROUND(150.000,2), ROUND(150,2);
    +------------------+--------------+
    | ROUND(150.000,2) | ROUND(150,2) |
    +------------------+--------------+
    |           150.00 |          150 |
    +------------------+--------------+
    ```

    `ROUND()`根据第一个参数的类型使用以下规则：

    +   对于精确值数字，`ROUND()`使用“远离零的一半”或“向最近整数四舍五入”的规则：具有小数部分为.5 或更大的值，如果为正则四舍五入到下一个整数，如果为负则四舍五入到下一个整数。（换句话说，它远离零。）具有小于.5 的小数部分的值，如果为正则向下舍入到下一个整数，如果为负则向上舍入到下一个整数。

    +   对于近似值数字，结果取决于 C 库。在许多系统上，这意味着`ROUND()`使用“四舍五入到最近偶数”的规则：具有恰好处于两个整数之间的小数部分的值将四舍五入为最接近的偶数。

    以下示例显示了精确值和近似值的舍入方式不同：

    ```sql
    mysql> SELECT ROUND(2.5), ROUND(25E-1);
    +------------+--------------+
    | ROUND(2.5) | ROUND(25E-1) |
    +------------+--------------+
    | 3          |            2 |
    +------------+--------------+
    ```

    有关更多信息，请参阅第 14.24 节，“精确数学”。

    在 MySQL 8.0.21 及更高版本中，`ROUND()`（以及`TRUNCATE()`）返回的数据类型根据以下规则确定：

    +   当第一个参数是任何整数类型时，返回类型始终为`BIGINT` - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT")。

    +   当第一个参数是任何浮点类型或任何非数值类型时，返回类型始终为`DOUBLE` - FLOAT, DOUBLE")。

    +   当第一个参数是`DECIMAL` - DECIMAL, NUMERIC")值时，返回类型也是`DECIMAL`。

    +   返回值的类型属性也从第一个参数复制，除非第二个参数是常量值时，此时为`DECIMAL`。

        当所需小数位数少于参数的精度时，结果的精度和精度将相应调整。

        此外，对于`ROUND()`（但不适用于`TRUNCATE()`函数），精度会增加一位以适应增加有效数字的四舍五入。如果第二个参数为负数，则调整返回类型，使其精度为 0，具有相应的精度。例如，`ROUND(99.999, 2)`返回`100.00`—第一个参数为`DECIMAL(5, 3)`，返回类型为`DECIMAL(5, 2)`。

        如果第二个参数为负数，则返回类型的精度为 0，并具有相应的精度；`ROUND(99.999, -1)`返回`100`，即`DECIMAL(3, 0)`。

+   `SIGN(*`X`*)`

    返回参数的符号为`-1`、`0`或`1`，取决于*`X`*是负数、零还是正数。如果*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT SIGN(-32);
     -> -1
    mysql> SELECT SIGN(0);
     -> 0
    mysql> SELECT SIGN(234);
     -> 1
    ```

+   `SIN(*`X`*)`

    返回以弧度表示的*`X`*的正弦值。如果*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT SIN(PI());
     -> 1.2246063538224e-16
    mysql> SELECT ROUND(SIN(PI()));
     -> 0
    ```

+   `SQRT(*`X`*)`

    返回非负数*`X`*的平方根。如果*`X`*为`NULL`，则函数返回`NULL`。

    ```sql
    mysql> SELECT SQRT(4);
     -> 2
    mysql> SELECT SQRT(20);
     -> 4.4721359549996
    mysql> SELECT SQRT(-16);
     -> NULL
    ```

+   `TAN(*`X`*)`

    返回以弧度表示的*`X`*的正切值。如果*`X`*为`NULL`，则返回`NULL`。

    ```sql
    mysql> SELECT TAN(PI());
     -> -1.2246063538224e-16
    mysql> SELECT TAN(PI()+1);
     -> 1.5574077246549
    ```

+   `TRUNCATE(*`X`*,*`D`*)`

    返回将*`X`*截断为*`D`*位小数的数字。如果*`D`*为`0`，则结果没有小数点或小数部分。*`D`*可以为负数，以使值*`X`*的小数点左边的*D*位变为零。如果*`X`*或*`D`*为`NULL`，则函数返回`NULL`。

    ```sql
    mysql> SELECT TRUNCATE(1.223,1);
     -> 1.2
    mysql> SELECT TRUNCATE(1.999,1);
     -> 1.9
    mysql> SELECT TRUNCATE(1.999,0);
     -> 1
    mysql> SELECT TRUNCATE(-1.999,1);
     -> -1.9
    mysql> SELECT TRUNCATE(122,-2);
     -> 100
    mysql> SELECT TRUNCATE(10.28*100,0);
     -> 1028
    ```

    所有数字都向零舍入。

    在 MySQL 8.0.21 及更高版本中，`TRUNCATE()`返回的数据类型遵循确定`ROUND()`函数返回类型的相同规则；有关详细信息，请参阅`ROUND()`的描述。

> 原文：[`dev.mysql.com/doc/refman/8.0/en/group-replication-online-upgrade-methods.html`](https://dev.mysql.com/doc/refman/8.0/en/group-replication-online-upgrade-methods.html)

#### 20.8.3.3 Group Replication Online Upgrade Methods

选择以下升级 Group Replication 组的方法之一：

##### 滚动式组内升级

只要运行较新版本的服务器不会在仍有较旧版本的服务器的情况下向组生成工作负载，此方法就受支持。换句话说，只有运行较新版本的服务器可以作为辅助服务器加入组。在此方法中，只有一个组，每个服务器实例都会从组中移除，升级，然后重新加入组。

此方法非常适用于单主组。当组以单主模式运行时，如果您要求主服务器在整个过程中保持不变（除非正在升级自身），则应将其作为最后一个升级的成员。主服务器必须在组中运行最低版本的 MySQL 服务器版本才能保持为主服务器。主服务器升级后，您可以使用`group_replication_set_as_primary()`函数将其重新指定为主服务器。如果您不在意哪个成员是主服务器，那么成员可以以任何顺序进行升级。组在必要时从运行最低 MySQL 服务器版本的成员中选举新的主服务器，遵循第 20.1.3.1 节，“单主模式”中描述的选举策略。

对于以多主模式运行的组，在组内滚动升级期间，主服务器数量会减少，导致写入可用性降低。这是因为如果成员在组运行时加入组，而其运行的 MySQL 服务器版本高于现有组成员运行的最低版本，则它会自动保持为只读模式（`super_read_only=ON`）。请注意，运行 MySQL 8.0.17 或更高版本的成员在检查时会考虑发布的补丁版本，但运行 MySQL 8.0.16 或更低版本，或 MySQL 5.7 的成员只会考虑主要版本。当所有成员升级到相同版本后，从 MySQL 8.0.17 开始，它们会自动恢复为读写模式。对于早期版本，您必须在每个成员上手动设置`super_read_only=OFF`，以便在升级后作为主服务器运行。

有关组中版本兼容性的完整信息以及这如何影响升级过程中组的行为，请参阅第 20.8.1 节，“组中不同成员版本的组合”。

##### 滚动式迁移升级

在这种方法中，您将从组中移除成员，升级它们，然后使用升级后的成员创建第二组。对于在多主模式下运行的组，在此过程中主节点的数量会减少，导致写入可用性降低。这不会影响在单主模式下运行的组。

因为在升级成员时运行较旧版本的组在线，所以需要运行较新版本的组赶上在升级成员时执行的任何事务。因此，新组中的一个服务器被配置为较旧组的主节点的副本。这确保新组赶上较旧组。由于此方法依赖于用于将数据从一个组复制到另一个组的异步复制通道，因此它在异步源-副本复制的相同假设和要求下受支持，参见 Chapter 19, *复制*。对于在单主模式下运行的组，向旧组的异步复制连接必须发送数据到新组的主节点，对于多主组，异步复制通道可以连接到任何主节点。

过程如下：

+   逐个从运行较旧服务器版本的原始组中移除成员，参见 Section 20.8.3.2, “升级组复制成员”

+   升级运行在成员上的服务器版本，参见 Chapter 3, *升级 MySQL*。您可以选择进行就地升级或预置升级的方法。

+   创建一个具有升级成员的新组，参见 Chapter 20, *组复制*。在这种情况下，您需要在每个成员上配置一个新组名称（因为旧组仍在运行并使用旧名称），引导一个初始升级成员，然后添加其余的升级成员。

+   在旧组和新组之间建立一个异步复制通道，参见 Section 19.1.3.4, “使用 GTIDs 设置复制”。将较旧的主节点配置为异步复制源服务器，将新组成员配置为基于 GTID 的副本。

在将应用程序重定向到新组之前，您必须确保新组具有合适数量的成员，例如使组能够处理成员的故障。执行`SELECT * FROM performance_schema.replication_group_members`并比较初始组大小和新组大小。等到所有旧组的数据传播到新组，然后删除异步复制连接并升级任何缺失的成员。

##### 滚动复制升级

在这种方法中，您创建一个由运行较新版本的成员组成的第二组，并将旧组缺失的数据复制到较新组。这假定您有足够的服务器同时运行两个组。由于在此过程中主服务器的数量*不*减少，对于运行在多主模式下的组来说，写入可用性不会减少。这使得滚动复制升级非常适合在多主模式下运行的组。这不会影响在单主模式下运行的组。

因为在为新组的成员提供资源时，运行旧版本的组在线，您需要确保运行较新版本的组赶上在为成员提供资源时执行的任何事务。因此，新组中的一个服务器被配置为旧组的主服务器的副本。这确保新组赶上旧组。由于此方法依赖于用于将数据从一个组复制到另一个组的异步复制通道，因此它在相同的异步源-副本复制的假设和要求下受支持，请参阅第十九章，*复制*。对于在单主模式下运行的组，异步复制连接到旧组必须将数据发送到新组的主服务器，对于多主组，异步复制通道可以连接到任何主服务器。

过程是：

+   部署适当数量的成员，以便运行较新版本的组可以处理成员的故障

+   对组中的一个成员进行现有数据的备份

+   使用来自旧成员的备份为新组的成员提供资源，请参阅第 20.8.3.4 节，“使用**mysqlbackup**进行组复制升级”中的一种方法。

    注意

    您必须将备份还原到与备份所在的 MySQL 版本相同的版本，然后执行就地升级。有关说明，请参阅第三章，*升级 MySQL*。

+   创建一个包含升级成员的新组，请参阅第二十章，*组复制*。在这种情况下，您需要在每个成员上配置一个新的组名（因为旧组仍在运行并使用旧名称），引导一个初始升级成员，然后添加其余的升级成员。

+   在旧组和新组之间建立一个异步复制通道，请参阅第 19.1.3.4 节，“使用 GTIDs 设置复制”。将较旧的主服务器配置为异步复制源服务器，将新组成员配置为基于 GTID 的副本。

一旦新组中缺失的持续数据量足够小，可以快速传输，您必须将写操作重定向到新组。等到所有旧组的数据传播到新组，然后断开异步复制连接。

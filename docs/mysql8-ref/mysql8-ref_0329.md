# 7.8 在一台机器上运行多个 MySQL 实例

> 原文：[`dev.mysql.com/doc/refman/8.0/en/multiple-servers.html`](https://dev.mysql.com/doc/refman/8.0/en/multiple-servers.html)

7.8.1 设置多个数据目录

7.8.2 在 Windows 上运行多个 MySQL 实例

7.8.3 在 Unix 上运行多个 MySQL 实例

7.8.4 在多服务器环境中使用客户端程序

在某些情况下，您可能希望在单台机器上运行多个 MySQL 实例。您可能希望在保持现有生产设置不受干扰的同时测试新的 MySQL 发布版。或者您可能希望为不同的用户提供对他们自己管理的不同 **mysqld** 服务器的访问权限。（例如，您可能是一个希望为不同客户提供独立的 MySQL 安装的互联网服务提供商。）

每个实例可以使用不同的 MySQL 服务器二进制文件，或者对多个实例使用相同的二进制文件，或者两种方法的任意组合。例如，您可以从 MySQL 5.7 运行一个服务器，从 MySQL 8.0 运行另一个服务器，以查看不同版本如何处理给定的工作负载。或者您可以运行当前生产版本的多个实例，每个实例管理不同的数据库集。

无论您是否使用不同的服务器二进制文件，您运行的每个实例都必须配置具有几个操作参数的唯一值。这消除了实例之间冲突的可能性。参数可以在命令行上设置，选项文件中设置，或通过设置环境变量设置。请参见 Section 6.2.2, “指定程序选项”。要查看给定实例使用的值，请连接到该实例并执行 `SHOW VARIABLES` 语句。

MySQL 实例管理的主要资源是数据目录。每个实例应该使用不同的数据目录，其位置使用 `--datadir=*`dir_name`*` 选项指定。有关配置每个实例使用自己的数据目录的方法，以及未能这样做的危险的警告，请参见 Section 7.8.1, “设置多个数据目录”。

除了使用不同的数据目录外，几个其他选项必须为每个服务器实例具有不同的值：

+   `--port=*`port_num`*`

    `--port` 控制 TCP/IP 连接的端口号。或者，如果主机有多个网络地址，您可以设置 `bind_address` 系统变量，使每个服务器监听不同的地址。

+   `--socket={*`file_name`*|*`pipe_name`*}`

    `--socket` 控制 Unix 上的 Unix 套接字文件路径或 Windows 上的命名管道名称。在 Windows 上，仅需要为允许命名管道连接的服务器指定不同的管道名称。

+   `--shared-memory-base-name=*`name`*`

    此选项仅在 Windows 上使用。它指定 Windows 服务器用于允许客户端使用共享内存连接的共享内存名称。仅需要为允许共享内存连接的服务器指定不同的共享内存名称。

+   `--pid-file=*`file_name`*`

    此选项指示服务器写入其进程 ID 的文件的路径名。

如果您使用以下日志文件选项，则它们的值必须对每个服务器不同：

+   `--general_log_file=*`file_name`*`

+   [`--log-bin[=*`file_name`*]`](replication-options-binary-log.html#option_mysqld_log-bin)

+   `--slow_query_log_file=*`file_name`*`

+   [`--log-error[=*`file_name`*]`](server-options.html#option_mysqld_log-error)

有关日志文件选项的进一步讨论，请参见 第 7.4 节，“MySQL 服务器日志”。

为了获得更好的性能，您可以为每个服务器单独指定以下选项，以在几个物理磁盘之间分散负载：

+   `--tmpdir=*`dir_name`*`

拥有不同的临时目录还可以更容易地确定哪个 MySQL 服务器创建了任何给定的临时文件。

如果您在不同位置安装了多个 MySQL 实例，可以使用 `--basedir=*dir_name*` 选项为每个安装指定基目录。这会导致每个实例自动使用不同的数据目录、日志文件和 PID 文件，因为这些参数的默认值都是相对于基目录的。在这种情况下，您需要指定的其他选项只有 `--socket` 和 `--port` 选项。假设您使用 `tar` 文件二进制发行版安装了不同版本的 MySQL。这些安装在不同的位置，因此您可以在相应的基目录下使用命令 **bin/mysqld_safe** 启动每个安装的服务器。**mysqld_safe** 确定要传递给 **mysqld** 的正确 `--basedir` 选项，您只需指定给 **mysqld_safe** 的 `--socket` 和 `--port` 选项。

如下节所讨论的，可以通过指定适当的命令选项或设置环境变量来启动额外的服务器。但是，如果您需要更长期地运行多个服务器，最方便的方法是使用选项文件为每个服务器指定那些必须对其唯一的选项值。`--defaults-file` 选项对此很有用。

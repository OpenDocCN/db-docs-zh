> [`dev.mysql.com/doc/refman/8.0/en/password-logging.html`](https://dev.mysql.com/doc/refman/8.0/en/password-logging.html)

#### 8.1.2.3 密码和日志记录

密码可以以明文形式写入 SQL 语句，例如`CREATE USER`、`GRANT`和`SET PASSWORD`。如果 MySQL 服务器按原样记录这些语句，其中的密码将对任何具有日志访问权限的人可见。

语句记录避免以明文形式写入以下语句的密码：

```sql
CREATE USER ... IDENTIFIED BY ...
ALTER USER ... IDENTIFIED BY ...
SET PASSWORD ...
START SLAVE ... PASSWORD = ...
START REPLICA ... PASSWORD = ...
CREATE SERVER ... OPTIONS(... PASSWORD ...)
ALTER SERVER ... OPTIONS(... PASSWORD ...)
```

这些语句中的密码被重写，以便在写入一般查询日志、慢查询日志和二进制日志的语句文本中不会直接显示。重写不适用于其他语句。特别是，对于引用明文密码的`mysql.user`系统表的`INSERT`或`UPDATE`语句，将按原样记录，因此应避免使用这些语句。（直接修改授权表是不鼓励的。）

对于一般的查询日志，可以通过使用`--log-raw`选项启动服务器来抑制密码重写。出于安全原因，不建议在生产环境中使用此选项。出于诊断目的，查看服务器接收到的语句的确切文本可能是有用的。

默认情况下，由审计日志插件生成的审计日志文件的内容未加密，可能包含敏感信息，例如 SQL 语句的文本。出于安全原因，审计日志文件应写入仅对 MySQL 服务器和有合法查看日志原因的用户可访问的目录。参见第 8.4.5.3 节，“MySQL 企业审计安全注意事项”。

如果安装了查询重写插件（参见查询重写插件），则服务器接收到的语句可能会被重写。在这种情况下，`--log-raw`选项会影响语句记录如下：

+   没有`--log-raw`，服务器记录由查询重写插件返回的语句。这可能与接收到的语句不同。

+   使用`--log-raw`，服务器记录接收到的原始语句。

密码重写的一个影响是，无法解析的语句（例如由于语法错误）不会写入一般查询日志，因为无法确定是否不包含密码。需要记录所有语句（包括出现错误的语句）的用例应使用`--log-raw`选项，但要注意这也会绕过密码重写。

当期望明文密码时，密码重写仅会发生。对于期望密码哈希值的语法语句，不会进行重写。如果错误地为此类语法提供了明文密码，则密码将被记录为给定的形式，而不进行重写。

为了保护日志文件免受未经授权的暴露，将它们放在一个限制服务器和数据库管理员访问的目录中。如果服务器将日志记录到`mysql`数据库中的表中，请仅授予数据库管理员对这些表的访问权限。

复制品将复制源服务器的密码存储在它们的连接元数据存储库中，默认情况下是`mysql`数据库中名为`slave_master_info`的表。现在已不推荐使用数据目录中的文件作为连接元数据存储库，但仍然可能（参见第 19.2.4 节，“中继日志和复制元数据存储库”）。确保连接元数据存储库只能由数据库管理员访问。将密码存储在连接元数据存储库中的替代方法是使用`START REPLICA`（或在 MySQL 8.0.22 之前，`START SLAVE`）或`START GROUP_REPLICATION`语句指定连接到源的凭据。

使用受限访问模式保护包含日志表或包含密码的日志文件的数据库备份。

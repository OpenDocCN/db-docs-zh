> 原文：[`dev.mysql.com/doc/refman/8.0/en/group-replication-responses-failure-expel.html`](https://dev.mysql.com/doc/refman/8.0/en/group-replication-responses-failure-expel.html)

#### 20.7.7.1 驱逐超时

你可以使用`group_replication_member_expel_timeout`系统变量，该变量从 MySQL 8.0.13 开始提供，以允许在怀疑创建和怀疑成员被驱逐之间提供额外时间。当一个服务器没有从另一个服务器接收消息时，就会创建怀疑，如第 20.1.4.2 节“故障检测”中所解释的那样。

在 Group Replication 组成员创建对另一个成员（或自身）的怀疑之前，会有一个初始的 5 秒检测期。然后，在另一个成员对其（或自身对自身）的怀疑超时后，该组成员将被驱逐。在此之后可能会有一个短暂的时间段，然后驱逐机制会检测并执行驱逐。`group_replication_member_expel_timeout`指定了在创建怀疑和驱逐被怀疑成员之间等待的时间段，称为驱逐超时，期间组成员被列为`UNREACHABLE`，但不会从组的成员列表中移除。

+   如果怀疑成员在等待期结束时再次活动，成员将应用由剩余组成员在 XCom 消息缓存中缓冲的所有消息，并进入`ONLINE`状态，无需操作员干预。在这种情况下，组将认为该成员是同一实例。

+   如果怀疑成员在怀疑超时后才重新活动并能恢复通信，它会收到一个被驱逐的视图，此时意识到自己被驱逐。你可以使用`group_replication_autorejoin_tries`系统变量，该变量从 MySQL 8.0.16 开始提供，使成员在此时自动尝试重新加入组。从 MySQL 8.0.21 开始，默认情况下激活此功能，并且成员会进行三次自动重新加入尝试。如果自动重新加入过程失败或未尝试，则被驱逐成员将按照`group_replication_exit_state_action`指定的退出操作进行。

在驱逐成员之前的等待时间仅适用于先前在组中活动过的成员。从未在组中活动过的非成员不会获得此等待时间，并且在初始检测期结束后因加入时间过长而被移除。

如果`group_replication_member_expel_timeout`设置为 0，则没有等待期，而在 5 秒检测期结束后，疑似成员立即有可能被驱逐。这是 MySQL 8.0.20 及更早版本的默认设置。这也是不支持`group_replication_member_expel_timeout`系统变量的 MySQL 服务器版本的组成员的行为。从 MySQL 8.0.21 开始，默认值为 5，意味着在 5 秒检测期后的 5 秒内，疑似成员有可能被驱逐。并非所有组成员都必须具有相同的`group_replication_member_expel_timeout`设置，但建议这样做以避免意外驱逐。任何成员都可以对任何其他成员（包括自身）产生怀疑，因此有效的驱逐超时是具有最低设置的成员的超时。

在以下情况下考虑增加`group_replication_member_expel_timeout`的值，而不使用默认值：

+   网络速度较慢，默认的 5 或 10 秒在驱逐之前不足以确保组成员始终交换至少一条消息。

+   网络有时会出现短暂中断，您希望在这些时候避免不必要的驱逐和主要成员更改。

+   网络不在您的直接控制之下，您希望最大程度减少操作员干预的需求。

+   预计会发生临时网络中断，您不希望因此而有些或全部成员被驱逐。

+   个别机器正在经历减速，您不希望它被从组中驱逐。

您可以指定最长达 3600 秒（1 小时）的驱逐超时。重要的是要确保 XCom 的消息缓存足够大，以容纳在指定时间段内预期的消息量，再加上初始的 5 秒检测期，否则成员无法重新连接。您可以使用`group_replication_message_cache_size`系统变量来调整缓存大小限制。有关更多信息，请参见第 20.7.6 节，“XCom 缓存管理”。

如果一个群组中的任何成员目前受到怀疑，那么群组成员资格不能重新配置（通过添加或删除成员或选举新领导者）。如果需要实施群组成员变更，而其中一个或多个成员受到怀疑，并且你希望怀疑成员继续留在群组中，那么请采取任何必要行动使这些成员重新活跃，如果可能的话。如果你无法使这些成员重新活跃，并且希望将他们从群组中驱逐，你可以立即强制怀疑超时。方法是在任何活跃成员上更改`group_replication_member_expel_timeout`的值为低于自怀疑创建以来已经经过的时间的值。这样一来，怀疑成员将立即有可能被驱逐。

如果一个复制组成员意外停止并立即重新启动（例如，因为它是使用`mysqld_safe`启动的），如果设置了`group_replication_start_on_boot=on`，它会自动尝试重新加入群组。在这种情况下，重新启动和重新加入尝试可能发生在成员的先前实例被驱逐出群组之前，这样该成员就无法重新加入。从 MySQL 8.0.19 开始，Group Replication 自动使用群组通信系统（GCS）功能为成员重试重新加入尝试 10 次，每次重试之间间隔 5 秒。这应该涵盖大多数情况，并允许足够的时间让先前的实例被驱逐出群组，从而让成员重新加入。请注意，如果`group_replication_member_expel_timeout`系统变量设置为指定成员被驱逐之前等待的较长时间，自动重新加入尝试可能仍然不会成功。

对于在`group_replication_member_expel_timeout`系统变量不可用的情况下避免不必要驱逐的替代缓解策略，请参阅 Section 20.3.2, “Group Replication Limitations”。

# 25.7 NDB 集群复制

> 原文：[`dev.mysql.com/doc/refman/8.0/en/mysql-cluster-replication.html`](https://dev.mysql.com/doc/refman/8.0/en/mysql-cluster-replication.html)

25.7.1 NDB 集群复制：缩写和符号

25.7.2 NDB 集群复制的一般要求

25.7.3 NDB 集群复制中已知问题

25.7.4 NDB 集群复制模式和表

25.7.5 准备 NDB 集群进行复制

25.7.6 启动 NDB 集群复制（单一复制通道）

25.7.7 使用两个复制通道进行 NDB 集群复制

25.7.8 使用 NDB 集群复制实现故障切换

25.7.9 使用 NDB 集群复制进行 NDB 集群备份

25.7.10 NDB 集群复制：双向和循环复制

25.7.11 使用多线程应用程序的 NDB 集群复制

25.7.12 NDB 集群复制冲突解决

NDB 集群支持异步复制，通常简称为“复制”。本节解释了如何设置和管理一个配置，其中一组计算机作为 NDB 集群操作，复制到第二台计算机或一组计算机。我们假定读者在标准 MySQL 复制方面有一定了解，如本手册的其他地方所述。 (参见 第十九章，*复制*).

注意

NDB 集群不支持使用 GTID 进行复制；半同步复制和组复制也不受 `NDB` 存储引擎支持。

正常（非集群）复制涉及源服务器和副本服务器，源被命名为源是因为要复制的操作和数据源自它，而副本是这些操作和数据的接收者。在 NDB Cluster 中，复制在概念上非常相似，但在实践中可能更加复杂，因为它可以扩展到涵盖许多不同的配置，包括在两个完整集群之间进行复制。虽然 NDB Cluster 本身依赖于`NDB`存储引擎进行集群功能，但不需要使用`NDB`作为副本的复制表的存储引擎（请参见从 NDB 到其他存储引擎的复制）。然而，为了最大的可用性，可以（并且最好）从一个 NDB Cluster 复制到另一个 NDB Cluster，我们将讨论这种情况，如下图所示：

**图 25.10 NDB Cluster 到集群复制布局**

![大部分内容在周围的文本中有描述。它展示了 MySQL 源是如何复制的。副本的不同之处在于它显示了一个 I/O（接收器）线程指向一个中继二进制日志，该中继二进制日志指向一个 SQL（应用程序）线程。此外，虽然二进制日志在源服务器上指向和从 NDBCLUSTER 引擎，但在副本上直接指向一个 SQL 节点（MySQL 服务器）。

在这种情况下，复制过程是一个连续记录源集群状态并保存到副本集群的过程。这个过程是通过一个特殊的线程完成的，称为 NDB 二进制日志注入器线程，它在每个 MySQL 服务器上运行并生成一个二进制日志（`binlog`）。该线程确保将产生二进制日志的集群中的所有更改（而不仅仅是通过 MySQL Server 实现的那些更改）以正确的序列化顺序插入到二进制日志中。我们将 MySQL 源和副本服务器称为复制服务器或复制节点，它们之间的数据流或通信线路称为复制通道。

有关使用 NDB Cluster 和 NDB Cluster Replication 执行时点恢复的信息，请参见 Section 25.7.9.2，“使用 NDB Cluster Replication 进行时点恢复”。

**NDB API 复制状态变量。** NDB API 计数器可以提供增强的监控能力，用于监视副本集群。这些计数器实现为 NDB 统计 `_slave` 状态变量，如在 `SHOW STATUS` 的输出中所见，或者在连接到充当 NDB 集群复制中的副本的 MySQL 服务器的 **mysql** 客户端会话中对 Performance Schema `session_status` 或 `global_status` 表进行查询的结果中。通过比较执行影响复制的 `NDB` 表的语句之前和之后这些状态变量的值，您可以观察副本在 NDB API 级别上采取的相应操作，这在监视或故障排除 NDB 集群复制时可能很有用。第 25.6.15 节，“NDB API 统计计数器和变量”提供了额外信息。

**从 NDB 复制到非 NDB 表。** 可以将 `NDB` 表从作为复制源的 NDB 集群复制到使用其他 MySQL 存储引擎（如 `InnoDB` 或 `MyISAM`）的表上，这些表位于一个副本 **mysqld** 上。这受到一些条件的限制；请参阅从 NDB 复制到其他存储引擎和从 NDB 复制到非事务性存储引擎以获取更多信息。

# 13.3.2 CHAR 和 VARCHAR 类型

> 原文：[`dev.mysql.com/doc/refman/8.0/en/char.html`](https://dev.mysql.com/doc/refman/8.0/en/char.html)

`CHAR`和`VARCHAR`类型相似，但在存储和检索方式、最大长度以及是否保留尾随空格方面有所不同。

`CHAR`和`VARCHAR`类型声明的长度指示您希望存储的最大字符数。例如，`CHAR(30)`可以容纳最多 30 个字符。

`CHAR`列的长度在创建表时声明为固定长度。长度可以是 0 到 255 之间的任何值。存储`CHAR`值时，它们会右填充空格以达到指定长度。检索`CHAR`值时，除非启用了`PAD_CHAR_TO_FULL_LENGTH` SQL 模式，否则会移除尾随空格。

`VARCHAR`列中的值是可变长度字符串。长度可以指定为 0 到 65,535 之间的值。`VARCHAR`的有效最大长度取决于最大行大小（65,535 字节，这些字节在所有列之间共享）和所使用的字符集。参见第 10.4.7 节，“表列计数和行大小限制”。

与`CHAR`相反，`VARCHAR`值存储为 1 字节或 2 字节长度前缀加数据。长度前缀指示值中的字节数。如果值不超过 255 字节，则列使用一个长度字节，如果值可能需要超过 255 字节，则使用两个长度字节。

如果未启用严格的 SQL 模式，并且将值分配给超出列最大长度的`CHAR`或`VARCHAR`列，则该值将被截断以适应，并生成警告。对于非空格字符的截断，您可以通过使用严格的 SQL 模式来导致错误发生（而不是警告），并抑制值的插入。参见第 7.1.11 节，“服务器 SQL 模式”。

对于`VARCHAR`列，在插入之前会截断超出列长度的尾随空格，并生成警告，无论使用的 SQL 模式如何。对于`CHAR`列，无论使用的 SQL 模式如何，插入值时都会静默执行超出尾随空格的截断。

存储`VARCHAR`值时不会填充。在存储和检索值时，尾随空格会被保留，符合标准 SQL。

以下表格通过展示将各种字符串值存储到`CHAR(4)`和`VARCHAR(4)`列中的结果（假设列使用单字节字符集如`latin1`）来说明`CHAR`和`VARCHAR`之间的差异。

| 值 | `CHAR(4)` | 存储空间 | `VARCHAR(4)` | 存储空间 |
| --- | --- | --- | --- | --- |
| `''` | `'    '` | 4 字节 | `''` | 1 字节 |
| `'ab'` | `'ab  '` | 4 字节 | `'ab'` | 3 字节 |
| `'abcd'` | `'abcd'` | 4 字节 | `'abcd'` | 5 字节 |
| `'abcdefgh'` | `'abcd'` | 4 字节 | `'abcd'` | 5 字节 |

在表的最后一行显示的值仅在*不使用严格 SQL 模式*时适用；如果启用了严格模式，超过列长度的值将*不会被存储*，并且会导致错误。

`InnoDB`将长度大于或等于 768 字节的固定长度字段编码为可变长度字段，可以存储在页外。例如，如果字符集的最大字节长度大于 3，如`utf8mb4`，则`CHAR(255)`列可以超过 768 字节。

如果给定值存储到`CHAR(4)`和`VARCHAR(4)`列中，从列中检索的值并不总是相同，因为从`CHAR`列中检索时会删除尾随空格。以下示例说明了这种差异：

```sql
mysql> CREATE TABLE vc (v VARCHAR(4), c CHAR(4));
Query OK, 0 rows affected (0.01 sec)

mysql> INSERT INTO vc VALUES ('ab  ', 'ab  ');
Query OK, 1 row affected (0.00 sec)

mysql> SELECT CONCAT('(', v, ')'), CONCAT('(', c, ')') FROM vc;
+---------------------+---------------------+
| CONCAT('(', v, ')') | CONCAT('(', c, ')') |
+---------------------+---------------------+
| (ab  )              | (ab)                |
+---------------------+---------------------+
1 row in set (0.06 sec)
```

`CHAR`、`VARCHAR`和`TEXT`列中的值根据分配给列的字符集排序和比较。

MySQL 排序具有`PAD SPACE`填充属性，除了基于 UCA 9.0.0 及更高版本的 Unicode 排序具有`NO PAD`填充属性。 (参见第 12.10.1 节，“Unicode 字符集”).

要确定排序的填充属性，请使用`INFORMATION_SCHEMA` `COLLATIONS`表，该表具有一个`PAD_ATTRIBUTE`列。

对于非二进制字符串（`CHAR`、`VARCHAR`和`TEXT`值），字符串排序填充属性决定了在字符串末尾的尾随空格比较中的处理方式。`NO PAD`排序将尾随空格视为比较中的重要部分，就像任何其他字符一样。`PAD SPACE`排序将尾随空格视为比较中不重要的部分；字符串将在不考虑尾随空格的情况下进行比较。参见比较中的尾随空格处理。服务器 SQL 模式对于尾随空格的比较行为没有影响。

注意

有关 MySQL 字符集和排序的更多信息，请参见第十二章，“字符集、排序、Unicode”。有关存储要求的其他信息，请参见第 13.7 节，“数据类型存储要求”。

对于那些尾随填充字符被剥离或比较忽略它们的情况，如果一个列有一个需要唯一值的索引，插入到列中仅在尾随填充字符数量不同的值会导致重复键错误。例如，如果一个表包含`'a'`，尝试存储`'a '`会导致重复键错误。

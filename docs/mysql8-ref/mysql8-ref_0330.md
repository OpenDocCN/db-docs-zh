# 7.8.1 设置多个数据目录

> 原文：[`dev.mysql.com/doc/refman/8.0/en/multiple-data-directories.html`](https://dev.mysql.com/doc/refman/8.0/en/multiple-data-directories.html)

机器上的每个 MySQL 实例应该有自己的数据目录。位置是使用`--datadir=*`dir_name`*`选项指定的。

有不同的方法来为新实例设置数据目录：

+   创建一个新的数据目录。

+   复制现有数据目录。

以下讨论提供了有关每种方法的更多详细信息。

警告

通常，您不应该有两个更新同一数据库中数据的服务器。如果您的操作系统不支持无故障系统锁定，这可能会导致令人不快的惊喜。如果（尽管有此警告）您运行使用相同数据目录的多个服务器，并且它们启用了日志记录，则必须使用适当的选项来指定每个服务器唯一的日志文件名。否则，服务器会尝试记录到相同的文件。

即使遵守了前面的预防措施，这种设置仅适用于`MyISAM`和`MERGE`表，而不适用于任何其他存储引擎。此外，在 NFS 环境中，始终不要在多个服务器之间共享数据目录。允许多个 MySQL 服务器通过 NFS 访问共享数据目录是*非常糟糕的想法*。主要问题是 NFS 是速度瓶颈。它不适用于这种用途。NFS 的另一个风险是你必须想出一种方法来确保两个或更多服务器不会相互干扰。通常，NFS 文件锁定由`lockd`守护程序处理，但目前没有平台可以在任何情况下 100%可靠地执行锁定。

#### 创建一个新的数据目录

使用此方法，数据目录的状态与您首次安装 MySQL 时相同，并且具有默认的 MySQL 帐户集和没有用户数据。

在 Unix 上，初始化数据目录。参见第 2.9 节，“安装后设置和测试”。

在 Windows 上，数据目录包含在 MySQL 发行版中：

+   Windows 的 MySQL Zip 存档发行版包含一个未修改的数据目录。您可以将这样的发行版解压缩到临时位置，然后将`data`目录复制到您设置新实例的位置。

+   Windows MSI 软件包安装程序创建并设置安装的服务器使用的数据目录，但还创建一个干净的“模板”数据目录，名称为`data`，位于安装目录下。使用 MSI 软件包执行安装后，可以复制模板数据目录以设置其他 MySQL 实例。

#### 复制现有数据目录。

使用此方法，数据目录中存在的任何 MySQL 帐户或用户数据都将转移到新的数据目录。

1.  停止使用数据目录的现有 MySQL 实例。这必须是一个干净的关闭，以便实例将任何未决更改刷新到磁盘。

1.  将数据目录复制到新数据目录应该所在的位置。

1.  复制现有实例使用的`my.cnf`或`my.ini`选项文件。这将作为新实例的基础。

1.  修改新的选项文件，使得任何指向原数据目录的路径都指向新数据目录。同时，修改任何其他必须在每个实例中唯一的选项，比如 TCP/IP 端口号和日志文件。有关必须在每个实例中唯一的参数列表，请参见第 7.8 节，“在一台机器上运行多个 MySQL 实例”。

1.  启动新实例，并告诉它使用新的选项文件。

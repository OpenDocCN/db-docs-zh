# -   1\. 语法

> 原文：[`sqlite.com/lang_aggfunc.html`](https://sqlite.com/lang_aggfunc.html)

**聚合函数调用:**

<svg class="pikchr" viewBox="0 0 909.533 223.344"><text x="102" y="56" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">聚合函数</text> <text x="204" y="56" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="326" y="26" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">DISTINCT</text> <text x="489" y="56" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="672" y="56" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="790" y="86" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">过滤子句</text> <text x="489" y="17" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="438" y="192" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">*</text> <text x="337" y="117" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">按</text> <text x="409" y="117" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">顺序</text> <text x="520" y="117" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排序条件</text> <text x="520" y="154" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text></svg>

**表达式:**

`<svg class="pikchr" viewBox="0 0 963.96 1068.77"><text x="101" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">literal-value</text> <text x="116" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">bind-parameter</text> <text x="108" y="115" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">schema-name</text> <text x="210" y="115" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">.</text> <text x="313" y="115" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">table-name</text> <text x="404" y="115" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">.</text> <text x="518" y="115" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">column-name</text> <text x="114" y="153" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">unary-operator</text> <text x="231" y="153" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="69" y="191" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="189" y="191" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">binary-operator</text> <text x="308" y="191" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="111" y="230" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">function-name</text> <text x="209" y="230" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="348" y="230" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">function-arguments</text> <text x="488" y="230" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="597" y="260" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">filter-clause</text> <text x="783" y="260" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">over-clause</text> <text x="60" y="306" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="136" y="306" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="211" y="306" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="136" y="269" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="74" y="343" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">CAST</text> <text x="141" y="343" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="204" y="343" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="269" y="343" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">AS</text> <text x="358" y="343" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">type-name</text> <text x="446" y="343" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="69" y="381" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="164" y="381" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">COLLATE</text> <text x="302" y="381" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">collation-name</text> <text x="69" y="419" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="155" y="419" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">NOT</text> <text x="261" y="419" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">LIKE</text> <text x="264" y="457" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">GLOB</text> <text x="276" y="495" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">REGEXP</text> <text x="274" y="532" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">MATCH</text> <text x="403" y="495" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="403" y="419" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="506" y="449" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">ESCAPE</text> <text x="595" y="449" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="69" y="570" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="170" y="570" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">ISNULL</text> <text x="180" y="608" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">NOTNULL</text> <text x="155" y="646" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">NOT</text> <text x="234" y="646" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">NULL</text> <text x="69" y="684" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="132" y="684" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">IS</text> <text x="209" y="684" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">NOT</text> <text x="355" y="684" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">DISTINCT</text> <text x="473" y="684" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">FROM</text> <text x="566" y="684" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="69" y="729" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="155" y="729" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">NOT</text> <text x="268" y="729" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">BETWEEN</text> <text x="367" y="729" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text

**函数参数：**

<svg class="pikchr" viewBox="0 0 456.566 223.344"><text x="116" y="26" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">DISTINCT</text> <text x="278" y="56" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="278" y="17" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="228" y="192" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">*</text> <text x="127" y="117" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">按照</text> <text x="199" y="117" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">顺序</text> <text x="310" y="117" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排序项</text> <text x="310" y="154" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text></svg>

**字面值：**

<svg class="pikchr" viewBox="0 0 341.376 336.96"><text x="159" y="319" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">CURRENT_TIMESTAMP</text> <text x="119" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">numeric-literal</text> <text x="109" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">string-literal</text> <text x="103" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">blob-literal</text> <text x="81" y="130" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">NULL</text> <text x="81" y="168" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">TRUE</text> <text x="85" y="206" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">FALSE</text> <text x="128" y="244" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">CURRENT_TIME</text> <text x="129" y="281" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">CURRENT_DATE</text></svg>

**over 子句：**

<svg class="pikchr" viewBox="0 0 600.706 418.392"><text x="62" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">OVER</text> <text x="192" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">窗口名称</text> <text x="149" y="55" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="292" y="82" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">基础窗口名称</text> <text x="261" y="157" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">按</text> <text x="356" y="157" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="434" y="157" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">分区</text> <text x="434" y="195" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="244" y="271" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">按</text> <text x="321" y="271" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排序项</text> <text x="439" y="271" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排序</text> <text x="439" y="309" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="258" y="384" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">帧规范</text> <text x="534" y="384" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text></svg>

**帧规范:**

<svg class="pikchr" viewBox="0 0 1039.65 522.72"><text x="93" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">分组</text> <text x="258" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">在</text> <text x="417" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">无限制的</text> <text x="559" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">前</text> <text x="685" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">和</text> <text x="817" y="130" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">无限制的</text> <text x="961" y="130" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">后</text> <text x="87" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">范围</text> <text x="83" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">行</text> <text x="272" y="168" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">无限制的</text> <text x="420" y="168" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">前</text> <text x="231" y="206" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="338" y="206" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">前</text> <text x="257" y="244" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">当前</text> <text x="357" y="244" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">行</text> <text x="375" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="482" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">前</text> <text x="401" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">当前</text> <text x="501" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">行</text> <text x="375" y="130" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="484" y="130" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">后</text> <text x="776" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="883" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">前</text> <text x="802" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">当前</text> <text x="902" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">行</text> <text x="776" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="885" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">后</text> <text x="495" y="395" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排除</text> <text x="617" y="395" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">当前</text> <text x="717" y="395" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">行</text> <text x="495" y="433" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排除</text> <text x="604" y="433" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">分组</text> <text x="495" y="470" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排除</text> <text x="593" y="470" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">平局</text> <text x="495" y="357" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排除</text> <text x="586" y="357" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">无</text> <text x="672" y="357" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">其他</text></svg>

**raise-function:**

<svg class="pikchr" viewBox="0 0 627.302 147.96"><text x="65" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">RAISE</text> <text x="135" y="17" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="246" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">ROLLBACK</text> <text x="351" y="55" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="456" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">error-message</text> <text x="579" y="17" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="233" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">IGNORE</text> <text x="228" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">ABORT</text> <text x="218" y="130" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">FAIL</text></svg>

**select-stmt:**

`<svg class="pikchr" viewBox="0 0 669.677 1162.3"><text x="76" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">WITH</text> <text x="210" y="47" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">RECURSIVE</text> <text x="471" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">common-table-expression</text> <text x="471" y="55" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="167" y="129" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">SELECT</text> <text x="299" y="159" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">DISTINCT</text> <text x="481" y="129" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">result-column</text> <text x="481" y="166" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="272" y="197" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">ALL</text> <text x="186" y="272" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">FROM</text> <text x="371" y="272" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">table-or-subquery</text> <text x="371" y="346" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">join-clause</text> <text x="371" y="309" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="193" y="422" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">WHERE</text> <text x="280" y="422" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="190" y="520" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">GROUP</text> <text x="267" y="520" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">BY</text> <text x="345" y="520" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="493" y="520" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">HAVING</text> <text x="582" y="520" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="345" y="558" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="200" y="634" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">WINDOW</text> <text x="346" y="634" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">window-name</text> <text x="450" y="634" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">AS</text> <text x="550" y="634" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">window-defn</text> <text x="446" y="671" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="168" y="785" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">VALUES</text> <text x="260" y="785" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="336" y="785" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="412" y="785" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="336" y="747" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="336" y="823" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="336" y="876" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">compound-operator</text> <text x="667" y="275" text-anchor="middle" font-style="italic" fill="rgb(128,128,128)" transform="rotate(-90 667,285)" dominant-baseline="central">select-core</text> <text x="190" y="951" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">ORDER</text> <text x="268" y="951" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">BY</text> <text x="185" y="1057" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">LIMIT</text> <text x="264" y="1057" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="395" y="951" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">ordering-term</text> <text x="395" y="989" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="389" y="1087" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">OFFSET</text> <text x="477" y="1087" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="363" y="1125" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="426" y="1125" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text></svg>`

**公共表达式:**

<svg class="pikchr" viewBox="0 0 638.525 167.4"><text x="85" y="29" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表名</text> <text x="211" y="29" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="348" y="29" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">列名</text> <text x="461" y="29" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="49" y="150" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">AS</text> <text x="137" y="119" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">NOT</text> <text x="278" y="119" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">MATERIALIZED</text> <text x="410" y="150" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="500" y="150" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">选择语句</text> <text x="591" y="150" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="348" y="66" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text></svg>

**复合运算符:**

<svg class="pikchr" viewBox="0 0 293.842 147.96"><text x="105" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">并集</text> <text x="105" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">交集</text> <text x="125" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排除</text> <text x="109" y="130" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">除</text> <text x="187" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">全部</text></svg>

**连接子句:**

<svg class="pikchr" viewBox="0 0 793.282 84.24"><text x="112" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表或子查询</text> <text x="319" y="47" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">连接操作符</text> <text x="483" y="47" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表或子查询</text> <text x="654" y="47" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">连接约束</text></svg>

**连接约束:**

<svg class="pikchr" viewBox="0 0 483.336 126.576"><text x="85" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">使用</text> <text x="158" y="55" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="271" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">列名</text> <text x="384" y="55" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="271" y="92" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="70" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">在</text> <text x="137" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text></svg>

**连接运算符:**

<svg class="pikchr" viewBox="0 0 620.333 255.312"><text x="99" y="71" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">自然</text> <text x="259" y="71" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">左</text> <text x="415" y="71" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">外</text> <text x="543" y="41" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">连接</text> <text x="310" y="17" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="265" y="109" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">右</text> <text x="260" y="147" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">全</text> <text x="267" y="192" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">内</text> <text x="267" y="238" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">交叉</text></svg>

**结果列:**

<svg class="pikchr" viewBox="0 0 398.054 163.08"><text x="69" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="153" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">作为</text> <text x="265" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">列别名</text> <text x="66" y="108" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">*</text> <text x="103" y="145" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表名</text> <text x="194" y="145" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">.</text> <text x="247" y="145" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">*</text></svg>

**表或子查询:**

<svg class="pikchr" viewBox="0 0 720.778 457.704"><text x="114" y="74" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">schema-name</text> <text x="209" y="74" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">.</text> <text x="319" y="36" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">table-name</text> <text x="425" y="36" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">AS</text> <text x="527" y="36" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">table-alias</text> <text x="356" y="112" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">INDEXED</text> <text x="443" y="112" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">BY</text> <text x="538" y="112" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">index-name</text> <text x="333" y="150" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">NOT</text> <text x="429" y="150" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">INDEXED</text> <text x="356" y="213" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">table-function-name</text> <text x="478" y="213" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="554" y="213" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="630" y="213" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="554" y="175" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="409" y="289" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">AS</text> <text x="548" y="289" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">table-alias</text> <text x="66" y="327" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="156" y="327" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">select-stmt</text> <text x="246" y="327" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="65" y="364" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="215" y="364" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">table-or-subquery</text> <text x="365" y="364" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="215" y="402" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="173" y="440" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">join-clause</text></svg>

**window-defn:**

<svg class="pikchr" viewBox="0 0 479.765 380.592"><text x="47" y="17" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="190" y="44" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">base-window-name</text> <text x="159" y="120" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">分区</text> <text x="254" y="120" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">按</text> <text x="332" y="120" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="332" y="157" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="141" y="233" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">按</text> <text x="219" y="233" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排序</text> <text x="337" y="233" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排序项</text> <text x="337" y="271" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="156" y="346" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">框架规范</text> <text x="432" y="346" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text></svg>

**框架规范:**

<svg class="pikchr" viewBox="0 0 1039.65 522.72"><text x="93" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">分组</text> <text x="258" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">在</text> <text x="417" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">无限制</text> <text x="559" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">之间</text> <text x="685" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">和</text> <text x="817" y="130" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">无限制</text> <text x="961" y="130" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">之后</text> <text x="87" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">范围</text> <text x="83" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">行</text> <text x="272" y="168" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">无限制</text> <text x="420" y="168" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">之前</text> <text x="231" y="206" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="338" y="206" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">之前</text> <text x="257" y="244" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">当前</text> <text x="357" y="244" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">行</text> <text x="375" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="482" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">之前</text> <text x="401" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">当前</text> <text x="501" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">行</text> <text x="375" y="130" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="484" y="130" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">之后</text> <text x="776" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="883" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">之前</text> <text x="802" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">当前</text> <text x="902" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">行</text> <text x="776" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">表达式</text> <text x="885" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">之后</text> <text x="495" y="395" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排除</text> <text x="617" y="395" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">当前</text> <text x="717" y="395" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">行</text> <text x="495" y="433" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排除</text> <text x="604" y="433" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">组</text> <text x="495" y="470" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排除</text> <text x="593" y="470" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">平局</text> <text x="495" y="357" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">排除</text> <text x="586" y="357" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">其他</text> <text x="672" y="357" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">人</text></svg>

**type-name:**

<svg class="pikchr" viewBox="0 0 661.008 110.16"><text x="74" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">name</text> <text x="180" y="92" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="281" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">signed-number</text> <text x="382" y="92" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">,</text> <text x="484" y="92" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">signed-number</text> <text x="585" y="92" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text> <text x="180" y="55" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="281" y="55" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">signed-number</text> <text x="382" y="55" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text></svg>

**signed-number:**

<svg class="pikchr" viewBox="0 0 292.013 99.576"><text x="66" y="44" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">+</text> <text x="191" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">numeric-literal</text> <text x="66" y="82" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">-</text></svg>

**filter-clause:**

<svg class="pikchr" viewBox="0 0 422.381 34.56"><text x="70" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">过滤器</text> <text x="146" y="17" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">(</text> <text x="224" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">WHERE</text> <text x="312" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="374" y="17" text-anchor="middle" font-weight="bold" fill="rgb(0,0,0)" dominant-baseline="central">)</text></svg>

**ordering-term:**

<svg class="pikchr" viewBox="0 0 798.451 99.576"><text x="56" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">expr</text> <text x="158" y="44" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">COLLATE</text> <text x="296" y="44" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">collation-name</text> <text x="477" y="82" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">DESC</text> <text x="471" y="44" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">ASC</text> <text x="627" y="44" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">NULLS</text> <text x="718" y="44" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">FIRST</text> <text x="627" y="82" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">NULLS</text> <text x="714" y="82" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">LAST</text></svg>

下面显示的聚合函数默认可用。还有两个聚合函数与 JSON SQL 函数 分组在一起。应用程序可以使用 sqlite3_create_function() 接口定义自定义聚合函数。API。

在接受单个参数的任何聚合函数中，该参数可以由关键字 DISTINCT 预先。在这种情况下，重复元素在传递到聚合函数之前被过滤。例如，函数 "count(distinct X)" 将返回列 X 的不同值的数量，而不是列 X 中非空值的总数。

如果提供了 FILTER 子句，则仅包括 *expr* 为真的行在聚合中。

如果提供了 ORDER BY 子句，则该子句确定了在进行聚合时输入的顺序。对于 max() 和 count() 等聚合函数，输入顺序无关紧要。但对于像 string_agg() 和 json_group_object() 这样的函数，ORDER BY 子句将影响结果。如果未指定 ORDER BY 子句，则聚合的输入以任意顺序发生，可能会在每次调用时更改。

另请参阅：标量函数 和 窗口函数。

# 2\. 内置聚合函数列表

+   avg(X)

+   count(*)

+   count(X)

+   group_concat(X)

+   group_concat(X,Y)

+   max(X)

+   min(X)

+   string_agg(X,Y)

+   sum(X)

+   total(X)

# 3\. 内置聚合函数描述

**avg(*X*)**

avg()函数返回组中所有非 NULL *X*的平均值。不像数字的字符串和 BLOB 值被解释为 0。如果至少有一个非 NULL 输入，则 avg()的结果始终是浮点值。如果没有非 NULL 输入，则 avg()的结果为 NULL。avg()的结果被计算为 total()/count()，因此适用于 total()的所有约束条件也适用于 avg()。

**count(*X*)

**count(*)**

count(X)函数返回在组中*X*不为 NULL 的次数。count(*)函数（没有参数）返回组中的总行数。

**group_concat(*X*)

group_concat(*X*,*Y*)

string_agg(*X*,*Y*)**

group_concat()函数返回一个字符串，该字符串是*X*的所有非 NULL 值的串联。如果参数*Y*存在，则将其用作*X*实例之间的分隔符。如果省略*Y*，则使用逗号(",")作为分隔符。

string_agg(X,Y)函数是 group_concat(X,Y)的别名。String_agg()兼容 PostgreSQL 和 SQL-Server，而 group_concat()兼容 MySQL。

拼接元素的顺序是任意的，除非在最后一个参数之后立即包含 ORDER BY 参数。

**max(*X*)**

max()聚合函数返回组中所有值的最大值。最大值是在相同列的 ORDER BY 中返回的最后一个值。如果组中没有非 NULL 值，则聚合 max()返回 NULL。

**min(*X*)**

min()聚合函数返回组中所有值的最小非 NULL 值。最小值是在列的 ORDER BY 中第一个出现的非 NULL 值。如果组中没有非 NULL 值，则聚合 min()返回 NULL。

**sum(*X*)

total(*X*)**

sum()和 total()聚合函数返回组中所有非 NULL 值的总和。如果没有非 NULL 输入行，则 sum()返回 NULL，但 total()返回 0.0。NULL 通常不是没有行的总和的有用结果，但 SQL 标准要求如此，大多数其他 SQL 数据库引擎都以这种方式实现 sum()，因此 SQLite 也以相同的方式实现它以保持兼容性。非标准的 total()函数提供了一种解决 SQL 语言中的这一设计问题的便捷方式。

总数()的结果始终是一个浮点值。如果所有非 NULL 输入都是整数，则 sum()的结果是整数值。如果 sum()的任何输入既不是整数也不是 NULL，则 sum()返回一个浮点值，这是数学求和的近似值。

如果所有输入都是整数或 NULL，并且在计算过程中发生整数溢出，则 Sum() 将抛出“整数溢出”异常。如果任何先前的输入是浮点数值，则不会引发溢出错误。Total() 从不引发整数溢出。

在对浮点数值求和时，如果各值的数量级差异很大，由于 IEEE 754 浮点数值是近似值，结果可能不精确。使用十进制扩展中的 decimal_sum(X) 聚合函数可以精确地求和浮点数。考虑以下测试案例：

> ```sql
> CREATE TABLE t1(x REAL);
> INSERT INTO t1 VALUES(1.55e+308),(1.23),(3.2e-16),(-1.23),(-1.55e308);
> SELECT sum(x), decimal_sum(x) FROM t1;
> 
> ```

大值 ±1.55e+308 会相互抵消，但直到求和结束时才会发生抵消，而在此期间，大值 +1.55e+308 会压倒微小的 3.2e-16 值。因此，sum() 的最终结果是不精确的。decimal_sum() 聚合函数可以生成精确的答案，但会增加 CPU 和内存使用量。还要注意，decimal_sum() 不是 SQLite 核心的一部分；它是一个可加载扩展。

如果输入的和过大，无法表示为 IEEE 754 浮点数值，则可能返回 +Infinity 或 -Infinity。如果使用了数量级相差很大且符号不同的非常大值，以至于 SUM() 或 TOTAL() 函数无法确定正确的结果是 +Infinity、-Infinity 还是介于两者之间的某个值，则结果是 NULL。因此，例如，以下查询将返回 NULL：

> ```sql
> WITH t1(x) AS (VALUES(1.0),(-9e+999),(2.0),(+9e+999),(3.0))
>  SELECT sum(x) FROM t1;
> 
> ```

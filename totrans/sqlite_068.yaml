- en: 1\. Usage
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://sqlite.com/sqldiff.html](https://sqlite.com/sqldiff.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The `sqldiff.exe` binary is a command-line utility program that displays content
    differences between SQLite databases. Example usage:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'The usual output is an SQL script that will transform database1.sqlite (the
    "source" database) into database2.sqlite (the "destination" database). This behavior
    can be altered using command-line switches:'
  prefs: []
  type: TYPE_NORMAL
- en: '**--changeset FILE**'
  prefs: []
  type: TYPE_NORMAL
- en: Do not write changes to standard output. Instead, write a (binary) changeset
    file into FILE. The changeset can be interpreted using the [session extension](sessionintro.html)
    to SQLite.
  prefs: []
  type: TYPE_NORMAL
- en: '**--lib LIBRARY**'
  prefs: []
  type: TYPE_NORMAL
- en: '**-L LIBRARY**'
  prefs: []
  type: TYPE_NORMAL
- en: Load the shared library or DLL file LIBRARY into SQLite prior to computing the
    differences. This can be used to add application-defined [collating sequences](datatype3.html#collation)
    that are required by the schema.
  prefs: []
  type: TYPE_NORMAL
- en: '**--primarykey**'
  prefs: []
  type: TYPE_NORMAL
- en: Use the schema-defined [PRIMARY KEY](lang_createtable.html#primkeyconst) instead
    of the [rowid](lang_createtable.html#rowid) to pair rows in the source and destination
    database. (See additional explanation below.)
  prefs: []
  type: TYPE_NORMAL
- en: '**--schema**'
  prefs: []
  type: TYPE_NORMAL
- en: Show only column name and table differences in the schema, not the table content
  prefs: []
  type: TYPE_NORMAL
- en: '**--summary**'
  prefs: []
  type: TYPE_NORMAL
- en: Show how many rows have changed on each table, but do not show the actual changes
  prefs: []
  type: TYPE_NORMAL
- en: '**--table TABLE**'
  prefs: []
  type: TYPE_NORMAL
- en: Show only the differences in content for TABLE, not for the entire database
  prefs: []
  type: TYPE_NORMAL
- en: '**--transaction**'
  prefs: []
  type: TYPE_NORMAL
- en: Wrap SQL output in a single large transaction
  prefs: []
  type: TYPE_NORMAL
- en: '**--vtab**'
  prefs: []
  type: TYPE_NORMAL
- en: Add support for handling [FTS3](fts3.html), [FTS5](fts5.html) and [rtree](rtree.html)
    virtual tables. [See below](#sqldiff_vtab) for details.
  prefs: []
  type: TYPE_NORMAL
- en: 2\. How It Works
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The sqldiff.exe utility works by finding rows in the source and destination
    that are logical "pairs". The default behavior is to treat two rows as pairs if
    they are in tables with the same name and they have the same [rowid](lang_createtable.html#rowid),
    or in the case of a [WITHOUT ROWID](withoutrowid.html) table if they have the
    same [PRIMARY KEY](lang_createtable.html#primkeyconst). Any differences in the
    content of paired rows are output as UPDATEs. Rows in the source database that
    could not be paired are output as DELETEs. Rows in the destination database that
    could not be paired are output as INSERTs.
  prefs: []
  type: TYPE_NORMAL
- en: The --primarykey flag changes the pairing algorithm slightly so that the schema-declared
    [PRIMARY KEY](lang_createtable.html#primkeyconst) is always used for pairing,
    even on tables that have a [rowid](lang_createtable.html#rowid). This is often
    a better choice for finding differences, however it can lead to missed differences
    in the case of rows that have one or more PRIMARY KEY columns set to NULL.
  prefs: []
  type: TYPE_NORMAL
- en: 3\. Limitations
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The sqldiff.exe utility does not compute changesets for either: rowid tables
    for which the rowid is inaccessible; or tables which have no explicit primary
    key. Given the --changeset option, sqldiff omits them from the comparison. Examples
    of such tables are:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: and
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'When sqldiff is made to compare only such tables, no error occurs. However,
    the result may be unexpected. For example, the effect of this invocation:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: will be to produce an empty file named "CHANGESET_OUT". See [session limitations](sessionintro.html#limitations)
    for details.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: The sqldiff.exe utility does not (currently) display differences in [TRIGGERs](lang_createtrigger.html)
    or [VIEWs](lang_createview.html).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The sqldiff utility is not designed to support schema migrations and is forgiving
    with respect to differing column definitions. Normally, only the column names
    and their order are compared for like-named tables before content comparison proceeds.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: However, the single-table comparison option, with "sqlite_schema" named, can
    be used to show or detect detailed schema differences between a pair of databases.
    When doing this, the output should not be used directly to modify a database.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: By default, differences in the schema or content of virtual tables are not reported
    on.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: However, if a [virtual table](vtab.html) implementation creates real tables
    (sometimes referred to as "shadow" tables) within the database to store its data
    in, then sqldiff.exe does calculate the difference between these. This can have
    surprising effects if the resulting SQL script is then run on a database that
    is not *exactly* the same as the source database. For several of SQLite's bundled
    virtual tables (FTS3, FTS5, rtree and others), the surprising effects may include
    corruption of the virtual table content.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: If the --vtab option is passed to sqldiff.exe, then it ignores all underlying
    shadow tables belonging to an FTS3, FTS5 or rtree virtual table and instead includes
    the virtual table differences directly.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL

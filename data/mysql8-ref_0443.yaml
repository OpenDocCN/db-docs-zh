- en: 原文：[https://dev.mysql.com/doc/refman/8.0/en/audit-log-filter-definitions.html](https://dev.mysql.com/doc/refman/8.0/en/audit-log-filter-definitions.html)
  id: totrans-0
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://dev.mysql.com/doc/refman/8.0/en/audit-log-filter-definitions.html](https://dev.mysql.com/doc/refman/8.0/en/audit-log-filter-definitions.html)
- en: 8.4.5.8 Writing Audit Log Filter Definitions
  id: totrans-1
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.4.5.8 编写审计日志过滤器定义
- en: Filter definitions are [`JSON`](json.html "13.5 The JSON Data Type") values.
    For information about using [`JSON`](json.html "13.5 The JSON Data Type") data
    in MySQL, see [Section 13.5, “The JSON Data Type”](json.html "13.5 The JSON Data
    Type").
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤器定义是[`JSON`](json.html "13.5 JSON数据类型")值。有关在MySQL中使用[`JSON`](json.html "13.5 JSON数据类型")数据的信息，请参见[第13.5节，“JSON数据类型”](json.html
    "13.5 JSON数据类型")。
- en: 'Filter definitions have this form, where *`actions`* indicates how filtering
    takes place:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤器定义采用以下形式，其中*`actions`*表示过滤如何进行：
- en: '[PRE0]'
  id: totrans-4
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The following discussion describes permitted constructs in filter definitions.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 以下讨论描述了过滤器定义中允许的结构。
- en: '[Logging All Events](audit-log-filter-definitions.html#audit-log-filtering-enabling-logging
    "Logging All Events")'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[记录所有事件](audit-log-filter-definitions.html#audit-log-filtering-enabling-logging
    "记录所有事件")'
- en: '[Logging Specific Event Classes](audit-log-filter-definitions.html#audit-log-filtering-class-logging
    "Logging Specific Event Classes")'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[记录特定事件类](audit-log-filter-definitions.html#audit-log-filtering-class-logging
    "记录特定事件类")'
- en: '[Logging Specific Event Subclasses](audit-log-filter-definitions.html#audit-log-filtering-subclass-logging
    "Logging Specific Event Subclasses")'
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[记录特定事件子类](audit-log-filter-definitions.html#audit-log-filtering-subclass-logging
    "记录特定事件子类")'
- en: '[Inclusive and Exclusive Logging](audit-log-filter-definitions.html#audit-log-filtering-inclusive-exclusive
    "Inclusive and Exclusive Logging")'
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[包容性和排他性日志记录](audit-log-filter-definitions.html#audit-log-filtering-inclusive-exclusive
    "包容性和排他性日志记录")'
- en: '[Testing Event Field Values](audit-log-filter-definitions.html#audit-log-filtering-event-fields
    "Testing Event Field Values")'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[测试事件字段值](audit-log-filter-definitions.html#audit-log-filtering-event-fields
    "测试事件字段值")'
- en: '[Blocking Execution of Specific Events](audit-log-filter-definitions.html#audit-log-filtering-blocking-events
    "Blocking Execution of Specific Events")'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[阻止特定事件的执行](audit-log-filter-definitions.html#audit-log-filtering-blocking-events
    "阻止特定事件的执行")'
- en: '[Logical Operators](audit-log-filter-definitions.html#audit-log-filtering-logical-operators
    "Logical Operators")'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[逻辑运算符](audit-log-filter-definitions.html#audit-log-filtering-logical-operators
    "逻辑运算符")'
- en: '[Referencing Predefined Variables](audit-log-filter-definitions.html#audit-log-filtering-predefined-variables
    "Referencing Predefined Variables")'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[引用预定义变量](audit-log-filter-definitions.html#audit-log-filtering-predefined-variables
    "引用预定义变量")'
- en: '[Referencing Predefined Functions](audit-log-filter-definitions.html#audit-log-filtering-predefined-functions
    "Referencing Predefined Functions")'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[引用预定义函数](audit-log-filter-definitions.html#audit-log-filtering-predefined-functions
    "引用预定义函数")'
- en: '[Replacement of Event Field Values](audit-log-filter-definitions.html#audit-log-filtering-field-replacement
    "Replacement of Event Field Values")'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[替换事件字段值](audit-log-filter-definitions.html#audit-log-filtering-field-replacement
    "替换事件字段值")'
- en: '[Replacing a User Filter](audit-log-filter-definitions.html#audit-log-filtering-filter-replacement
    "Replacing a User Filter")'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[替换用户过滤器](audit-log-filter-definitions.html#audit-log-filtering-filter-replacement
    "替换用户过滤器")'
- en: Logging All Events
  id: totrans-17
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 记录所有事件
- en: 'To explicitly enable or disable logging of all events, use a `log` item in
    the filter:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 要明确启用或禁用所有事件的记录，请在过滤器中使用`log`项：
- en: '[PRE1]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The `log` value can be either `true` or `false`.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '`log`值可以是`true`或`false`。'
- en: 'The preceding filter enables logging of all events. It is equivalent to:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的过滤器启用了所有事件的记录。这等同于：
- en: '[PRE2]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Logging behavior depends on the `log` value and whether `class` or `event`
    items are specified:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 记录行为取决于`log`值以及是否指定了`class`或`event`项：
- en: With `log` specified, its given value is used.
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果指定了`log`，则使用给定的值。
- en: Without `log` specified, logging is `true` if no `class` or `event` item is
    specified, and `false` otherwise (in which case, `class` or `event` can include
    their own `log` item).
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果未指定`log`，则如果未指定`class`或`event`项，则记录为`true`，否则为`false`（在这种情况下，`class`或`event`可以包括自己的`log`项）。
- en: Logging Specific Event Classes
  id: totrans-26
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 记录特定事件类
- en: 'To log events of a specific class, use a `class` item in the filter, with its
    `name` field denoting the name of the class to log:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 要记录特定类别的事件，请在过滤器中使用`class`项，其��`name`字段表示要记录的类别的名称：
- en: '[PRE3]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The `name` value can be `connection`, `general`, or `table_access` to log connection,
    general, or table-access events, respectively.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '`name`值可以是`connection`、`general`或`table_access`，分别用于记录连接、一般或表访问事件。'
- en: 'The preceding filter enables logging of events in the `connection` class. It
    is equivalent to the following filter with `log` items made explicit:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 上述过滤器启用了`connection`类中事件的记录。它等同于以下过滤器，其中`log`项目被明确指定：
- en: '[PRE4]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'To enable logging of multiple classes, define the `class` value as a [`JSON`](json.html
    "13.5 The JSON Data Type") array element that names the classes:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用多个类别的记录，将`class`值定义为[`JSON`](json.html "13.5 JSON 数据类型")数组元素，命名这些类别：
- en: '[PRE5]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Note
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: 'When multiple instances of a given item appear at the same level within a filter
    definition, the item values can be combined into a single instance of that item
    within an array value. The preceding definition can be written like this:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 当在过滤器定义中同一级别出现给定项目的多个实例时，可以将项目值合并为数组值中的单个项目实例。上述定义可以写成这样：
- en: '[PRE6]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Logging Specific Event Subclasses
  id: totrans-37
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 记录特定事件子类
- en: 'To select specific event subclasses, use an `event` item containing a `name`
    item that names the subclasses. The default action for events selected by an `event`
    item is to log them. For example, this filter enables logging for the named event
    subclasses:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 要选择特定的事件子类，使用包含命名子类的`name`项目的`event`项目。由`event`项目选择的事件的默认操作是记录它们。例如，此过滤器启用了命名事件子类的记录：
- en: '[PRE7]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The `event` item can also contain explicit `log` items to indicate whether
    to log qualifying events. This `event` item selects multiple events and explicitly
    indicates logging behavior for them:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: '`event`项目还可以包含显式的`log`项目，以指示是否记录符合条件的事件。此`event`项目选择多个事件，并明确指示它们的记录行为：'
- en: '[PRE8]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The `event` item can also indicate whether to block qualifying events, if it
    contains an `abort` item. For details, see [Blocking Execution of Specific Events](audit-log-filter-definitions.html#audit-log-filtering-blocking-events
    "Blocking Execution of Specific Events").
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: '`event`项目还可以指示是否阻止符合条件的事件，如果包含`abort`项目。详情请参见[阻止特定事件的执行](audit-log-filter-definitions.html#audit-log-filtering-blocking-events
    "阻止特定事件的执行")。'
- en: '[Table 8.35, “Event Class and Subclass Combinations”](audit-log-filter-definitions.html#audit-log-event-subclass-combinations
    "Table 8.35 Event Class and Subclass Combinations") describes the permitted subclass
    values for each event class.'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '[表 8.35，“事件类和子类组合”](audit-log-filter-definitions.html#audit-log-event-subclass-combinations
    "表 8.35 事件类和子类组合")描述了每个事件类的允许子类值。'
- en: '**Table 8.35 Event Class and Subclass Combinations**'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '**表 8.35 事件类和子类组合**'
- en: '| Event Class | Event Subclass | Description |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| 事件类 | 事件子类 | 描述 |'
- en: '| `connection` | `connect` | Connection initiation (successful or unsuccessful)
    |'
  id: totrans-46
  prefs: []
  type: TYPE_TB
  zh: '| `connection` | `connect` | 连接初始化（成功或失败） |'
- en: '| `connection` | `change_user` | User re-authentication with different user/password
    during session |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '| `connection` | `change_user` | 会话期间使用不同用户/密码重新认证 |'
- en: '| `connection` | `disconnect` | Connection termination |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| `connection` | `disconnect` | 连接终止 |'
- en: '| `general` | `status` | General operation information |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
  zh: '| `general` | `status` | 一般操作信息 |'
- en: '| `message` | `internal` | Internally generated message |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '| `message` | `internal` | 内部生成的消息 |'
- en: '| `message` | `user` | Message generated by [`audit_api_message_emit_udf()`](audit-api-message-emit.html#function_audit-api-message-emit-udf)
    |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '| `message` | `user` | 由[`audit_api_message_emit_udf()`](audit-api-message-emit.html#function_audit-api-message-emit-udf)生成的消息
    |'
- en: '| `table_access` | `read` | Table read statements, such as [`SELECT`](select.html
    "15.2.13 SELECT Statement") or [`INSERT INTO ... SELECT`](insert-select.html "15.2.7.1 INSERT
    ... SELECT Statement") |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '| `table_access` | `read` | 表读取语句，如[`SELECT`](select.html "15.2.13 SELECT 语句")或[`INSERT
    INTO ... SELECT`](insert-select.html "15.2.7.1 INSERT ... SELECT 语句") |'
- en: '| `table_access` | `delete` | Table delete statements, such as [`DELETE`](delete.html
    "15.2.2 DELETE Statement") or [`TRUNCATE TABLE`](truncate-table.html "15.1.37 TRUNCATE
    TABLE Statement") |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
  zh: '| `table_access` | `delete` | 表删除语句，如[`DELETE`](delete.html "15.2.2 DELETE
    语句")或[`TRUNCATE TABLE`](truncate-table.html "15.1.37 TRUNCATE TABLE 语句") |'
- en: '| `table_access` | `insert` | Table insert statements, such as [`INSERT`](insert.html
    "15.2.7 INSERT Statement") or [`REPLACE`](replace.html "15.2.12 REPLACE Statement")
    |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
  zh: '| `table_access` | `insert` | 表插入语句，如[`INSERT`](insert.html "15.2.7 INSERT
    语句")或[`REPLACE`](replace.html "15.2.12 REPLACE 语句") |'
- en: '| `table_access` | `update` | Table update statements, such as [`UPDATE`](update.html
    "15.2.17 UPDATE Statement") |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '| `table_access` | `update` | 表更新语句，如[`UPDATE`](update.html "15.2.17 UPDATE
    语句") |'
- en: '| Event Class | Event Subclass | Description |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
  zh: '| 事件类 | 事件子类 | 描述 |'
- en: '[Table 8.36, “Log and Abort Characteristics Per Event Class and Subclass Combination”](audit-log-filter-definitions.html#audit-log-event-subclass-log-abort
    "Table 8.36 Log and Abort Characteristics Per Event Class and Subclass Combination")
    describes for each event subclass whether it can be logged or aborted.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '[表 8.36，“每个事件类和子类组合的记录和中止特性”](audit-log-filter-definitions.html#audit-log-event-subclass-log-abort
    "表 8.36 每个事件类和子类组合的记录和中止特性")描述了每个事件子类是否可以被记录或中止。'
- en: '**Table 8.36 Log and Abort Characteristics Per Event Class and Subclass Combination**'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**表 8.36 每个事件类和子类组合的记录和中止特性**'
- en: '| Event Class | Event Subclass | Can be Logged | Can be Aborted |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| 事件类 | 事件子类 | 可以被记录 | 可以被中止 |'
- en: '| `connection` | `connect` | Yes | No |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| `connection` | `connect` | 是 | 否 |'
- en: '| `connection` | `change_user` | Yes | No |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
  zh: '| `connection` | `change_user` | 是 | 否 |'
- en: '| `connection` | `disconnect` | Yes | No |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| `connection` | `disconnect` | 是 | 否 |'
- en: '| `general` | `status` | Yes | No |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| `general` | `status` | 是 | 否 |'
- en: '| `message` | `internal` | Yes | Yes |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
  zh: '| `message` | `internal` | 是 | 是 |'
- en: '| `message` | `user` | Yes | Yes |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| `message` | `user` | 是 | 是 |'
- en: '| `table_access` | `read` | Yes | Yes |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| `table_access` | `read` | 是 | 是 |'
- en: '| `table_access` | `delete` | Yes | Yes |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| `table_access` | `delete` | 是 | 是 |'
- en: '| `table_access` | `insert` | Yes | Yes |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| `table_access` | `insert` | 是 | 是 |'
- en: '| `table_access` | `update` | Yes | Yes |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| `table_access` | `update` | 是 | 是 |'
- en: '| Event Class | Event Subclass | Can be Logged | Can be Aborted |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '| 事件类 | 事件子类 | 可以被记录 | 可以被中止 |'
- en: Inclusive and Exclusive Logging
  id: totrans-71
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 包容性和独占性记录
- en: 'A filter can be defined in inclusive or exclusive mode:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 可以定义包容性或独占性模式的过滤器：
- en: Inclusive mode logs only explicitly specified items.
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包容性模式仅记录明确指定的项目。
- en: Exclusive mode logs everything but explicitly specified items.
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 独占模式记录除明确指定的项目之外的所有内容。
- en: 'To perform inclusive logging, disable logging globally and enable logging for
    specific classes. This filter logs `connect` and `disconnect` events in the `connection`
    class, and events in the `general` class:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行包容性记录，全局禁用记录并为特定类启用记录。此过滤器记录`connection`类中的`connect`和`disconnect`事件，以及`general`类中的事件：
- en: '[PRE9]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'To perform exclusive logging, enable logging globally and disable logging for
    specific classes. This filter logs everything except events in the `general` class:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行独占性记录，全局启用记录并为特定类禁用记录。此过滤器记录除`general`类中的事件之外的所有内容：
- en: '[PRE10]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'This filter logs `change_user` events in the `connection` class, `message`
    events, and `table_access` events, by virtue of *not* logging everything else:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 此过滤器记录`connection`类中的`change_user`事件，`message`事件和`table_access`事件，因为*不*记录其他所有内容：
- en: '[PRE11]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Testing Event Field Values
  id: totrans-81
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 测试事件字段值
- en: 'To enable logging based on specific event field values, specify a `field` item
    within the `log` item that indicates the field name and its expected value:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 要基于特定事件字段值启用记录，请在指示字段名称及其预期值的`log`项内指定一个`field`项：
- en: '[PRE12]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Each event contains event class-specific fields that can be accessed from within
    a filter to perform custom filtering.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 每个事件包含特定于事件类的字段，可以从过滤器内部访问以执行自定义过滤。
- en: An event in the `connection` class indicates when a connection-related activity
    occurs during a session, such as a user connecting to or disconnecting from the
    server. [Table 8.37, “Connection Event Fields”](audit-log-filter-definitions.html#audit-log-connection-event-fields
    "Table 8.37 Connection Event Fields") indicates the permitted fields for `connection`
    events.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '`connection`类中的事件指示会话期间发生的与连接相关的活动，例如用户连接到服务器或从服务器断开连接。[表 8.37，“连接事件字段”](audit-log-filter-definitions.html#audit-log-connection-event-fields
    "表 8.37 连接事件字段")指示了`connection`事件的允许字段。'
- en: '**Table 8.37 Connection Event Fields**'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '**表 8.37 连接事件字段**'
- en: '| Field Name | Field Type | Description |'
  id: totrans-87
  prefs: []
  type: TYPE_TB
  zh: '| 字段名称 | 字段类型 | 描述 |'
- en: '| `status` | integer | Event status:0: OKOtherwise: Failed |'
  id: totrans-88
  prefs: []
  type: TYPE_TB
  zh: '| `status` | 整数 | 事件状态：0：成功否则：失败 |'
- en: '| `connection_id` | unsigned integer | Connection ID |'
  id: totrans-89
  prefs: []
  type: TYPE_TB
  zh: '| `connection_id` | 无符号整数 | 连接ID |'
- en: '| `user.str` | string | User name specified during authentication |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '| `user.str` | 字符串 | 在认证期间指定的用户名 |'
- en: '| `user.length` | unsigned integer | User name length |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '| `user.length` | 无符号整数 | 用户名称长度 |'
- en: '| `priv_user.str` | string | Authenticated user name (account user name) |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| `priv_user.str` | 字符串 | 已认证的用户名称（帐户用户名） |'
- en: '| `priv_user.length` | unsigned integer | Authenticated user name length |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '| `priv_user.length` | 无符号整数 | 已认证的用户名称长度 |'
- en: '| `external_user.str` | string | External user name (provided by third-party
    authentication plugin) |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| `external_user.str` | 字符串 | 外部用户名称（由第三方认证插件提供） |'
- en: '| `external_user.length` | unsigned integer | External user name length |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '| `external_user.length` | 无符号整数 | 外部用户名称长度 |'
- en: '| `proxy_user.str` | string | Proxy user name |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| `proxy_user.str` | string | 代理用户名称 |'
- en: '| `proxy_user.length` | unsigned integer | Proxy user name length |'
  id: totrans-97
  prefs: []
  type: TYPE_TB
  zh: '| `proxy_user.length` | unsigned integer | 代理用户名称长度 |'
- en: '| `host.str` | string | Connected user host |'
  id: totrans-98
  prefs: []
  type: TYPE_TB
  zh: '| `host.str` | string | 连接用户主机 |'
- en: '| `host.length` | unsigned integer | Connected user host length |'
  id: totrans-99
  prefs: []
  type: TYPE_TB
  zh: '| `host.length` | unsigned integer | 连接用户主机长度 |'
- en: '| `ip.str` | string | Connected user IP address |'
  id: totrans-100
  prefs: []
  type: TYPE_TB
  zh: '| `ip.str` | string | 连接用户 IP 地址 |'
- en: '| `ip.length` | unsigned integer | Connected user IP address length |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
  zh: '| `ip.length` | unsigned integer | 连接用户 IP 地址长度 |'
- en: '| `database.str` | string | Database name specified at connect time |'
  id: totrans-102
  prefs: []
  type: TYPE_TB
  zh: '| `database.str` | string | 连接时指定的数据库名称 |'
- en: '| `database.length` | unsigned integer | Database name length |'
  id: totrans-103
  prefs: []
  type: TYPE_TB
  zh: '| `database.length` | unsigned integer | 数据库名称长度 |'
- en: '| `connection_type` | integer | Connection type:0 or `"::undefined"`: Undefined1
    or `"::tcp/ip"`: TCP/IP2 or `"::socket"`: Socket3 or `"::named_pipe"`: Named pipe4
    or `"::ssl"`: TCP/IP with encryption5 or `"::shared_memory"`: Shared memory |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
  zh: '| `connection_type` | integer | 连接类型：0 或 `"::undefined"`: 未定义1 或 `"::tcp/ip"`:
    TCP/IP2 或 `"::socket"`: Socket3 或 `"::named_pipe"`: 命名管道4 或 `"::ssl"`: 带加密的 TCP/IP5
    或 `"::shared_memory"`: 共享内存 |'
- en: '| Field Name | Field Type | Description |'
  id: totrans-105
  prefs: []
  type: TYPE_TB
  zh: '| 字段名称 | 字段类型 | 描述 |'
- en: The `"::*`xxx`*"` values are symbolic pseudo-constants that may be given instead
    of the literal numeric values. They must be quoted as strings and are case-sensitive.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: '`"::*`xxx`*"` 值是符号伪常量，可以代替文字数字值。 它们必须被引用为字符串，并且区分大小写。'
- en: An event in the `general` class indicates the status code of an operation and
    its details. [Table 8.38, “General Event Fields”](audit-log-filter-definitions.html#audit-log-general-event-fields
    "Table 8.38 General Event Fields") indicates the permitted fields for `general`
    events.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: '`general` 类中的事件指示操作的状态代码及其详细信息。 [表 8.38，“通用事件字段”](audit-log-filter-definitions.html#audit-log-general-event-fields
    "表 8.38 通用事件字段") 指示 `general` 事件的允许字段。'
- en: '**Table 8.38 General Event Fields**'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '**表 8.38 通用事件字段**'
- en: '| Field Name | Field Type | Description |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '| 字段名称 | 字段类型 | 描述 |'
- en: '| `general_error_code` | integer | Event status:0: OKOtherwise: Failed |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '| `general_error_code` | integer | 事件状态：0: OK否则: 失败 |'
- en: '| `general_thread_id` | unsigned integer | Connection/thread ID |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| `general_thread_id` | unsigned integer | 连接/线程 ID |'
- en: '| `general_user.str` | string | User name specified during authentication |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| `general_user.str` | string | 认证期间指定的用户名 |'
- en: '| `general_user.length` | unsigned integer | User name length |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| `general_user.length` | unsigned integer | 用户��称长度 |'
- en: '| `general_command.str` | string | Command name |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
  zh: '| `general_command.str` | string | 命令名称 |'
- en: '| `general_command.length` | unsigned integer | Command name length |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '| `general_command.length` | unsigned integer | 命令名称长度 |'
- en: '| `general_query.str` | string | SQL statement text |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
  zh: '| `general_query.str` | string | SQL 语句文本 |'
- en: '| `general_query.length` | unsigned integer | SQL statement text length |'
  id: totrans-117
  prefs: []
  type: TYPE_TB
  zh: '| `general_query.length` | unsigned integer | SQL 语句文本长度 |'
- en: '| `general_host.str` | string | Host name |'
  id: totrans-118
  prefs: []
  type: TYPE_TB
  zh: '| `general_host.str` | string | 主机名 |'
- en: '| `general_host.length` | unsigned integer | Host name length |'
  id: totrans-119
  prefs: []
  type: TYPE_TB
  zh: '| `general_host.length` | unsigned integer | 主机名长度 |'
- en: '| `general_sql_command.str` | string | SQL command type name |'
  id: totrans-120
  prefs: []
  type: TYPE_TB
  zh: '| `general_sql_command.str` | string | SQL 命令类型名称 |'
- en: '| `general_sql_command.length` | unsigned integer | SQL command type name length
    |'
  id: totrans-121
  prefs: []
  type: TYPE_TB
  zh: '| `general_sql_command.length` | unsigned integer | SQL 命令类型名称长度 |'
- en: '| `general_external_user.str` | string | External user name (provided by third-party
    authentication plugin) |'
  id: totrans-122
  prefs: []
  type: TYPE_TB
  zh: '| `general_external_user.str` | string | 外部用户名称（由第三方认证插件提供） |'
- en: '| `general_external_user.length` | unsigned integer | External user name length
    |'
  id: totrans-123
  prefs: []
  type: TYPE_TB
  zh: '| `general_external_user.length` | unsigned integer | 外部用户名称长度 |'
- en: '| `general_ip.str` | string | Connected user IP address |'
  id: totrans-124
  prefs: []
  type: TYPE_TB
  zh: '| `general_ip.str` | string | 连接用户 IP 地址 |'
- en: '| `general_ip.length` | unsigned integer | Connection user IP address length
    |'
  id: totrans-125
  prefs: []
  type: TYPE_TB
  zh: '| `general_ip.length` | unsigned integer | 连接用户 IP 地址长度 |'
- en: '| Field Name | Field Type | Description |'
  id: totrans-126
  prefs: []
  type: TYPE_TB
  zh: '| 字段名称 | 字段类型 | 描述 |'
- en: '`general_command.str` indicates a command name: `Query`, `Execute`, `Quit`,
    or `Change user`.'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '`general_command.str` 指示命令名称：`Query`、`Execute`、`Quit` 或 `Change user`。'
- en: 'A `general` event with the `general_command.str` field set to `Query` or `Execute`
    contains `general_sql_command.str` set to a value that specifies the type of SQL
    command: `alter_db`, `alter_db_upgrade`, `admin_commands`, and so forth. The available
    `general_sql_command.str` values can be seen as the last components of the Performance
    Schema instruments displayed by this statement:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 一个 `general` 事件，其中 `general_command.str` 字段设置为 `Query` 或 `Execute`，包含 `general_sql_command.str`
    设置为指定 SQL 命令类型的值：`alter_db`、`alter_db_upgrade`、`admin_commands` 等。 可以在此语句显示的性能模式工具的最后组件中看到可用的
    `general_sql_command.str` 值：
- en: '[PRE13]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: An event in the `table_access` class provides information about a specific type
    of access to a table. [Table 8.39, “Table-Access Event Fields”](audit-log-filter-definitions.html#audit-log-table-access-event-fields
    "Table 8.39 Table-Access Event Fields") indicates the permitted fields for `table_access`
    events.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '`table_access` 类中的事件提供有关对表的特定类型访问的信息。[Table 8.39, “Table-Access Event Fields”](audit-log-filter-definitions.html#audit-log-table-access-event-fields
    "Table 8.39 Table-Access Event Fields") 指示了`table_access`事件的允许字段。'
- en: '**Table 8.39 Table-Access Event Fields**'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '**Table 8.39 Table-Access Event Fields**'
- en: '| Field Name | Field Type | Description |'
  id: totrans-132
  prefs: []
  type: TYPE_TB
  zh: '| Field Name | Field Type | 描述 |'
- en: '| `connection_id` | unsigned integer | Event connection ID |'
  id: totrans-133
  prefs: []
  type: TYPE_TB
  zh: '| `connection_id` | 无符号整数 | 事件连接 ID |'
- en: '| `sql_command_id` | integer | SQL command ID |'
  id: totrans-134
  prefs: []
  type: TYPE_TB
  zh: '| `sql_command_id` | integer | SQL 命令 ID |'
- en: '| `query.str` | string | SQL statement text |'
  id: totrans-135
  prefs: []
  type: TYPE_TB
  zh: '| `query.str` | string | SQL 语句文本 |'
- en: '| `query.length` | unsigned integer | SQL statement text length |'
  id: totrans-136
  prefs: []
  type: TYPE_TB
  zh: '| `query.length` | 无符号整数 | SQL 语句文本长度 |'
- en: '| `table_database.str` | string | Database name associated with event |'
  id: totrans-137
  prefs: []
  type: TYPE_TB
  zh: '| `table_database.str` | string | 与事件相关联的数据库名 |'
- en: '| `table_database.length` | unsigned integer | Database name length |'
  id: totrans-138
  prefs: []
  type: TYPE_TB
  zh: '| `table_database.length` | 无符号整数 | 数据库名长度 |'
- en: '| `table_name.str` | string | Table name associated with event |'
  id: totrans-139
  prefs: []
  type: TYPE_TB
  zh: '| `table_name.str` | string | 与事件相关联的表名 |'
- en: '| `table_name.length` | unsigned integer | Table name length |'
  id: totrans-140
  prefs: []
  type: TYPE_TB
  zh: '| `table_name.length` | 无符号整数 | 表名长度 |'
- en: 'The following list shows which statements produce which table-access events:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表显示了哪些语句产生哪些表访问事件：
- en: '`read` event:'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`read` 事件：'
- en: '`SELECT`'
  id: totrans-143
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`SELECT`'
- en: '`INSERT ... SELECT` (for tables referenced in `SELECT` clause)'
  id: totrans-144
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`INSERT ... SELECT`（用于`SELECT`子句中引用的表）'
- en: '`REPLACE ... SELECT` (for tables referenced in `SELECT` clause)'
  id: totrans-145
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`REPLACE ... SELECT`（用于`SELECT`子句中引用的表）'
- en: '`UPDATE ... WHERE` (for tables referenced in `WHERE` clause)'
  id: totrans-146
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`UPDATE ... WHERE`（用于`WHERE`子句中引用的表）'
- en: '`HANDLER ... READ`'
  id: totrans-147
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`HANDLER ... READ`'
- en: '`delete` event:'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`delete` 事件：'
- en: '`DELETE`'
  id: totrans-149
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DELETE`'
- en: '`TRUNCATE TABLE`'
  id: totrans-150
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`TRUNCATE TABLE`'
- en: '`insert` event:'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`insert` 事件：'
- en: '`INSERT`'
  id: totrans-152
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`INSERT`'
- en: '`INSERT ... SELECT` (for table referenced in `INSERT` clause)'
  id: totrans-153
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`INSERT ... SELECT`（用于`INSERT`子句中引用的表）'
- en: '`REPLACE`'
  id: totrans-154
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`REPLACE`'
- en: '`REPLACE ... SELECT` (for table referenced in `REPLACE` clause'
  id: totrans-155
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`REPLACE ... SELECT`（用于`REPLACE`子句中引用的表）'
- en: '`LOAD DATA`'
  id: totrans-156
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`LOAD DATA`'
- en: '`LOAD XML`'
  id: totrans-157
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`LOAD XML`'
- en: '`update` event:'
  id: totrans-158
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`update` 事件：'
- en: '`UPDATE`'
  id: totrans-159
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`UPDATE`'
- en: '`UPDATE ... WHERE` (for tables referenced in `UPDATE` clause)'
  id: totrans-160
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`UPDATE ... WHERE`（用于`UPDATE`子句中引用的表）'
- en: Blocking Execution of Specific Events
  id: totrans-161
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 阻止特定事件的执行
- en: '`event` items can include an `abort` item that indicates whether to prevent
    qualifying events from executing. `abort` enables rules to be written that block
    execution of specific SQL statements.'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '`event` 项可以包括一个`abort`项，指示是否阻止符合条件的事件执行。`abort`使得可以编写规则来阻止特定 SQL 语句的执行。'
- en: Important
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 重要
- en: It is theoretically possible for a user with sufficient permissions to mistakenly
    create an `abort` item in the audit log filter that prevents themselves and other
    administrators from accessing the system. From MySQL 8.0.28, the [`AUDIT_ABORT_EXEMPT`](privileges-provided.html#priv_audit-abort-exempt)
    privilege is available to permit a user account’s queries to always be executed
    even if an `abort` item would block them. Accounts with this privilege can therefore
    be used to regain access to a system following an audit misconfiguration. The
    query is still logged in the audit log, but instead of being rejected, it is permitted
    due to the privilege.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 理论上，具有足够权限的用户可能会错误地在审计日志过滤器中创建一个`abort`项，从而阻止自己和其他管理员访问系统。从 MySQL 8.0.28 开始，[`AUDIT_ABORT_EXEMPT`](privileges-provided.html#priv_audit-abort-exempt)权限可用于允许用户帐户的查询始终执行，即使`abort`项会阻止它们。具有此权限的帐户因此可以用于在审计配置错误后恢复对系统的访问。查询仍然记录在审计日志中，但不会被拒绝，而是由于权限而被允许。
- en: Accounts created in MySQL 8.0.28 or later with the [`SYSTEM_USER`](privileges-provided.html#priv_system-user)
    privilege have the [`AUDIT_ABORT_EXEMPT`](privileges-provided.html#priv_audit-abort-exempt)
    privilege assigned automatically when they are created. The [`AUDIT_ABORT_EXEMPT`](privileges-provided.html#priv_audit-abort-exempt)
    privilege is also assigned to existing accounts with the [`SYSTEM_USER`](privileges-provided.html#priv_system-user)
    privilege when you carry out an upgrade procedure with MySQL 8.0.28 or later,
    if no existing accounts have that privilege assigned.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在 MySQL 8.0.28 或更高版本中创建的带有[`SYSTEM_USER`](privileges-provided.html#priv_system-user)权限的帐户在创建时会自动分配[`AUDIT_ABORT_EXEMPT`](privileges-provided.html#priv_audit-abort-exempt)权限。在进行
    MySQL 8.0.28 或更高版本的升级过程时，如果没有现有帐户被分配该权限，则现有帐户也会被分配[`AUDIT_ABORT_EXEMPT`](privileges-provided.html#priv_audit-abort-exempt)权限。
- en: 'The `abort` item must appear within an `event` item. For example:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '`abort`项必须出现在`event`项内。例如：'
- en: '[PRE14]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: For event subclasses selected by the `name` item, the `abort` action is true
    or false, depending on *`condition`* evaluation. If the condition evaluates to
    true, the event is blocked. Otherwise, the event continues executing.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 对于由`name`项选择的事件子类，`abort`操作为真或假，取决于*`condition`*的评估。如果条件评估为真，则阻止事件。否则，事件继续执行。
- en: The *`condition`* specification can be as simple as `true` or `false`, or it
    can be more complex such that evaluation depends on event characteristics.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: '*`condition`*规范可以简单到`true`或`false`，也可以更复杂，以至于评估取决于事件特征。'
- en: 'This filter blocks [`INSERT`](insert.html "15.2.7 INSERT Statement"), [`UPDATE`](update.html
    "15.2.17 UPDATE Statement"), and [`DELETE`](delete.html "15.2.2 DELETE Statement")
    statements:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 此过滤器阻止[`INSERT`](insert.html "15.2.7 INSERT语句")、[`UPDATE`](update.html "15.2.17 UPDATE语句")和[`DELETE`](delete.html
    "15.2.2 DELETE语句")语句：
- en: '[PRE15]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'This more complex filter blocks the same statements, but only for a specific
    table (`finances.bank_account`):'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 这个更复杂的过滤器仅针对特定表（`finances.bank_account`）阻止相同的语句：
- en: '[PRE16]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Statements matched and blocked by the filter return an error to the client:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 由过滤器匹配并阻止的语句会向客户端返回错误：
- en: '[PRE17]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Not all events can be blocked (see [Table 8.36, “Log and Abort Characteristics
    Per Event Class and Subclass Combination”](audit-log-filter-definitions.html#audit-log-event-subclass-log-abort
    "Table 8.36 Log and Abort Characteristics Per Event Class and Subclass Combination")).
    For an event that cannot be blocked, the audit log writes a warning to the error
    log rather than blocking it.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 并非所有事件都可以被阻止（参见[表8.36，“每个事件类和子类组合的日志和中止特性”](audit-log-filter-definitions.html#audit-log-event-subclass-log-abort
    "表8.36 每个事件类和子类组合的日志和中止特性")）。对于无法被阻止的事件，审计日志会向错误日志写入警告，而不是阻止它。
- en: For attempts to define a filter in which the `abort` item appears elsewhere
    than in an `event` item, an error occurs.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试定义一个过滤器，其中`abort`项出现在`event`项之外时，会出现错误。
- en: Logical Operators
  id: totrans-178
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 逻辑运算符
- en: 'Logical operators (`and`, `or`, `not`) permit construction of complex conditions,
    enabling more advanced filtering configurations to be written. The following `log`
    item logs only `general` events with `general_command` fields having a specific
    value and length:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 逻辑运算符（`and`、`or`、`not`）允许构建复杂条件，从而编写更高级的过滤配置。以下`log`项仅记录具有特定值和长度的`general_command`字段的`general`事件：
- en: '[PRE18]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Referencing Predefined Variables
  id: totrans-181
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 引用预定义变量
- en: 'To refer to a predefined variable in a `log` condition, use a `variable` item,
    which takes `name` and `value` items and tests equality of the named variable
    against a given value:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 要在`log`条件中引用预定义变量，请使用`variable`项，该项接受`name`和`value`项并测试命名变量与给定值的相等性：
- en: '[PRE19]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: This is true if *`variable_name`* has the value *`comparison_value`*, false
    otherwise.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 如果*`variable_name`*具有值*`comparison_value`*，则为真，否则为假。
- en: 'Example:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 示例：
- en: '[PRE20]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Each predefined variable corresponds to a system variable. By writing a filter
    that tests a predefined variable, you can modify filter operation by setting the
    corresponding system variable, without having to redefine the filter. For example,
    by writing a filter that tests the value of the `audit_log_connection_policy_value`
    predefined variable, you can modify filter operation by changing the value of
    the [`audit_log_connection_policy`](audit-log-reference.html#sysvar_audit_log_connection_policy)
    system variable.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 每个预定义变量对应一个系统变量。通过编写测试预定义变量的过滤器，您可以通过设置相应的系统变量来修改过滤器操作，而无需重新定义过滤器。例如，通过编写测试`audit_log_connection_policy_value`预定义变量值的过滤器，您可以通过更改[`audit_log_connection_policy`](audit-log-reference.html#sysvar_audit_log_connection_policy)系统变量的值来修改过滤器操作。
- en: The `audit_log_*`xxx`*_policy` system variables are used for the deprecated
    legacy mode audit log (see [Section 8.4.5.10, “Legacy Mode Audit Log Filtering”](audit-log-legacy-filtering.html
    "8.4.5.10 Legacy Mode Audit Log Filtering")). With rule-based audit log filtering,
    those variables remain visible (for example, using [`SHOW VARIABLES`](show-variables.html
    "15.7.7.41 SHOW VARIABLES Statement")), but changes to them have no effect unless
    you write filters containing constructs that refer to them.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: '`audit_log_*`xxx`*_policy`系统变量用于废弃的传统模式审计日志（参见[第8.4.5.10节，“传统模式审计日志过滤”](audit-log-legacy-filtering.html
    "8.4.5.10 传统模式审计日志过滤")）。使用基于规则的审计日志过滤时，这些变量仍然可见（例如，使用[`SHOW VARIABLES`](show-variables.html
    "15.7.7.41 SHOW VARIABLES语句")），但除非编写包含引用它们的结构的过滤器，否则对它们的更改不会产生任何效果。'
- en: 'The following list describes the permitted predefined variables for `variable`
    items:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表描述了`variable`项的允许的预定义变量：
- en: '`audit_log_connection_policy_value`'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`audit_log_connection_policy_value`'
- en: This variable corresponds to the value of the [`audit_log_connection_policy`](audit-log-reference.html#sysvar_audit_log_connection_policy)
    system variable. The value is an unsigned integer. [Table 8.40, “audit_log_connection_policy_value
    Values”](audit-log-filter-definitions.html#audit-log-connection-policy-value-values
    "Table 8.40 audit_log_connection_policy_value Values") shows the permitted values
    and the corresponding [`audit_log_connection_policy`](audit-log-reference.html#sysvar_audit_log_connection_policy)
    values.
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此变量对应于[`audit_log_connection_policy`](audit-log-reference.html#sysvar_audit_log_connection_policy)系统变量的值。该值是一个无符号整数。[表 8.40，“audit_log_connection_policy_value
    Values”](audit-log-filter-definitions.html#audit-log-connection-policy-value-values
    "表 8.40 audit_log_connection_policy_value Values")显示了允许的值以及相应的[`audit_log_connection_policy`](audit-log-reference.html#sysvar_audit_log_connection_policy)值。
- en: '**Table 8.40 audit_log_connection_policy_value Values**'
  id: totrans-192
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**表 8.40 audit_log_connection_policy_value Values**'
- en: '| Value | Corresponding audit_log_connection_policy Value |'
  id: totrans-193
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| 值 | 对应的audit_log_connection_policy值 |'
- en: '| `0` or `"::none"` | `NONE` |'
  id: totrans-194
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `0` 或 `"::none"` | `NONE` |'
- en: '| `1` or `"::errors"` | `ERRORS` |'
  id: totrans-195
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `1` 或 `"::errors"` | `ERRORS` |'
- en: '| `2` or `"::all"` | `ALL` |'
  id: totrans-196
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `2` 或 `"::all"` | `ALL` |'
- en: The `"::*`xxx`*"` values are symbolic pseudo-constants that may be given instead
    of the literal numeric values. They must be quoted as strings and are case-sensitive.
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`"::*`xxx`*"`值是象征性伪常量，可以代替文字数字值。它们必须被引用为字符串，并且区分大小写。'
- en: '`audit_log_policy_value`'
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`audit_log_policy_value`'
- en: This variable corresponds to the value of the [`audit_log_policy`](audit-log-reference.html#sysvar_audit_log_policy)
    system variable. The value is an unsigned integer. [Table 8.41, “audit_log_policy_value
    Values”](audit-log-filter-definitions.html#audit-log-policy-value-values "Table 8.41 audit_log_policy_value
    Values") shows the permitted values and the corresponding [`audit_log_policy`](audit-log-reference.html#sysvar_audit_log_policy)
    values.
  id: totrans-199
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此变量对应于[`audit_log_policy`](audit-log-reference.html#sysvar_audit_log_policy)系统变量的值。该值是一个无符号整数。[表 8.41，“audit_log_policy_value
    Values”](audit-log-filter-definitions.html#audit-log-policy-value-values "表 8.41 audit_log_policy_value
    Values")显示了允许的值以及相应的[`audit_log_policy`](audit-log-reference.html#sysvar_audit_log_policy)值。
- en: '**Table 8.41 audit_log_policy_value Values**'
  id: totrans-200
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**表 8.41 audit_log_policy_value Values**'
- en: '| Value | Corresponding audit_log_policy Value |'
  id: totrans-201
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| 值 | 对应的audit_log_policy值 |'
- en: '| `0` or `"::none"` | `NONE` |'
  id: totrans-202
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `0` 或 `"::none"` | `NONE` |'
- en: '| `1` or `"::logins"` | `LOGINS` |'
  id: totrans-203
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `1` 或 `"::logins"` | `LOGINS` |'
- en: '| `2` or `"::all"` | `ALL` |'
  id: totrans-204
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `2` 或 `"::all"` | `ALL` |'
- en: '| `3` or `"::queries"` | `QUERIES` |'
  id: totrans-205
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `3` 或 `"::queries"` | `QUERIES` |'
- en: The `"::*`xxx`*"` values are symbolic pseudo-constants that may be given instead
    of the literal numeric values. They must be quoted as strings and are case-sensitive.
  id: totrans-206
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`"::*`xxx`*"`值是象征性伪常量，可以代替文字数字值。它们必须被引用为字符串，并且区分大小写。'
- en: '`audit_log_statement_policy_value`'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`audit_log_statement_policy_value`'
- en: This variable corresponds to the value of the [`audit_log_statement_policy`](audit-log-reference.html#sysvar_audit_log_statement_policy)
    system variable. The value is an unsigned integer. [Table 8.42, “audit_log_statement_policy_value
    Values”](audit-log-filter-definitions.html#audit-log-statement-policy-value-values
    "Table 8.42 audit_log_statement_policy_value Values") shows the permitted values
    and the corresponding [`audit_log_statement_policy`](audit-log-reference.html#sysvar_audit_log_statement_policy)
    values.
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此变量对应于[`audit_log_statement_policy`](audit-log-reference.html#sysvar_audit_log_statement_policy)系统变量的值。该值是一个无符号整数。[表 8.42，“audit_log_statement_policy_value
    Values”](audit-log-filter-definitions.html#audit-log-statement-policy-value-values
    "表 8.42 audit_log_statement_policy_value Values")显示了允许的值以及相应的[`audit_log_statement_policy`](audit-log-reference.html#sysvar_audit_log_statement_policy)值。
- en: '**Table 8.42 audit_log_statement_policy_value Values**'
  id: totrans-209
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**表 8.42 audit_log_statement_policy_value Values**'
- en: '| Value | Corresponding audit_log_statement_policy Value |'
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| 值 | 对应的audit_log_statement_policy值 |'
- en: '| `0` or `"::none"` | `NONE` |'
  id: totrans-211
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `0` 或 `"::none"` | `NONE` |'
- en: '| `1` or `"::errors"` | `ERRORS` |'
  id: totrans-212
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `1` 或 `"::errors"` | `ERRORS` |'
- en: '| `2` or `"::all"` | `ALL` |'
  id: totrans-213
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `2` 或 `"::all"` | `ALL` |'
- en: The `"::*`xxx`*"` values are symbolic pseudo-constants that may be given instead
    of the literal numeric values. They must be quoted as strings and are case-sensitive.
  id: totrans-214
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`"::*`xxx`*"`值是象征性伪常量，可以代替文字数字值。它们必须被引用为字符串，并且区分大小写。'
- en: Referencing Predefined Functions
  id: totrans-215
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 引用预定义函数
- en: 'To refer to a predefined function in a `log` condition, use a `function` item,
    which takes `name` and `args` items to specify the function name and its arguments,
    respectively:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 `log` 条件中引用预定义函数，请使用 `function` 项，该项接受 `name` 和 `args` 项分别指定函数名称及其参数：
- en: '[PRE21]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: The `name` item should specify the function name only, without parentheses or
    the argument list.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: '`name` 项应仅指定函数名称，不包括括号或参数列表。'
- en: 'The `args` item must satisfy these conditions:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: '`args` 项必须满足以下条件：'
- en: If the function takes no arguments, no `args` item should be given.
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果函数不需要参数，则不应提供 `args` 项。
- en: If the function does take arguments, an `args` item is needed, and the arguments
    must be given in the order listed in the function description. Arguments can refer
    to predefined variables, event fields, or string or numeric constants.
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果函数需要参数，则需要一个 `args` 项，并且参数必须按照函数描述中列出的顺序给出。参数可以是预定义变量、事件字段或字符串或数字常量。
- en: If the number of arguments is incorrect or the arguments are not of the correct
    data types required by the function an error occurs.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 如果参数数量不正确或参数类型与函数所需的正确数据类型不符，将会出现错误。
- en: 'Example:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 示例：
- en: '[PRE22]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: The preceding filter determines whether to log `general` class `status` events
    depending on whether the current user is found in the [`audit_log_include_accounts`](audit-log-reference.html#sysvar_audit_log_include_accounts)
    system variable. That user is constructed using fields in the event.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的过滤器根据当前用户是否在 [`audit_log_include_accounts`](audit-log-reference.html#sysvar_audit_log_include_accounts)
    系统变量中找到来确定是否记录 `general` 类 `status` 事件。该用户是使用事件中的字段构建的。
- en: 'The following list describes the permitted predefined functions for `function`
    items:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 以下列表描述了 `function` 项的允许预定义函数：
- en: '`audit_log_exclude_accounts_is_null()`'
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`audit_log_exclude_accounts_is_null()`'
- en: Checks whether the [`audit_log_exclude_accounts`](audit-log-reference.html#sysvar_audit_log_exclude_accounts)
    system variable is `NULL`. This function can be helpful when defining filters
    that correspond to the legacy audit log implementation.
  id: totrans-228
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 检查 [`audit_log_exclude_accounts`](audit-log-reference.html#sysvar_audit_log_exclude_accounts)
    系统变量是否为 `NULL`。在定义与传统审计日志实现对应的过滤器时，此函数可能会有所帮助。
- en: 'Arguments:'
  id: totrans-229
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 参数：
- en: None.
  id: totrans-230
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 无。
- en: '`audit_log_include_accounts_is_null()`'
  id: totrans-231
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`audit_log_include_accounts_is_null()`'
- en: Checks whether the [`audit_log_include_accounts`](audit-log-reference.html#sysvar_audit_log_include_accounts)
    system variable is `NULL`. This function can be helpful when defining filters
    that correspond to the legacy audit log implementation.
  id: totrans-232
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 检查 [`audit_log_include_accounts`](audit-log-reference.html#sysvar_audit_log_include_accounts)
    系统变量是否为 `NULL`。在定义与传统审计日志实现对应的过滤器时，此函数可能会有所帮助。
- en: 'Arguments:'
  id: totrans-233
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 参数：
- en: None.
  id: totrans-234
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 无。
- en: '`debug_sleep(millisec)`'
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`debug_sleep(millisec)`'
- en: Sleeps for the given number of milliseconds. This function is used during performance
    measurement.
  id: totrans-236
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 休眠指定的毫秒数。此函数用于性能测量。
- en: '`debug_sleep()` is available for debug builds only.'
  id: totrans-237
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`debug_sleep()` 仅适用于调试版本。'
- en: 'Arguments:'
  id: totrans-238
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 参数：
- en: '*`millisec`*: An unsigned integer that specifies the number of milliseconds
    to sleep.'
  id: totrans-239
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*`millisec`*：指定要休眠的毫秒数的无符号整数。'
- en: '`find_in_exclude_list(account)`'
  id: totrans-240
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`find_in_exclude_list(account)`'
- en: Checks whether an account string exists in the audit log exclude list (the value
    of the [`audit_log_exclude_accounts`](audit-log-reference.html#sysvar_audit_log_exclude_accounts)
    system variable).
  id: totrans-241
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 检查账户字符串是否存在于审计日志排除列表中（[`audit_log_exclude_accounts`](audit-log-reference.html#sysvar_audit_log_exclude_accounts)
    系统变量的值）。
- en: 'Arguments:'
  id: totrans-242
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 参数：
- en: '*`account`*: A string that specifies the user account name.'
  id: totrans-243
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*`account`*：指定用户账户名称的字符串。'
- en: '`find_in_include_list(account)`'
  id: totrans-244
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`find_in_include_list(account)`'
- en: Checks whether an account string exists in the audit log include list (the value
    of the [`audit_log_include_accounts`](audit-log-reference.html#sysvar_audit_log_include_accounts)
    system variable).
  id: totrans-245
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 检查账户字符串是否存在于审计日志包含列表中（[`audit_log_include_accounts`](audit-log-reference.html#sysvar_audit_log_include_accounts)
    系统变量的值）。
- en: 'Arguments:'
  id: totrans-246
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 参数：
- en: '*`account`*: A string that specifies the user account name.'
  id: totrans-247
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*`account`*：指定用户账户名称的字符串。'
- en: '`query_digest([str])`'
  id: totrans-248
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`query_digest([str])`'
- en: 'This function has differing behavior depending on whether an argument is given:'
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此函数具有不同的行为，具体取决于是否给出参数：
- en: With no argument, `query_digest` returns the statement digest value corresponding
    to the statement literal text in the current event.
  id: totrans-250
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 没有参数时，`query_digest` 返回与当前事件中语句文本对应的语句摘要值。
- en: With an argument, `query_digest` returns a Boolean indicating whether the argument
    is equal to the current statement digest.
  id: totrans-251
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有参数时，`query_digest` 返回一个布尔值，指示参数是否等于当前语句摘要。
- en: 'Arguments:'
  id: totrans-252
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 参数：
- en: '*`str`*: This argument is optional. If given, it specifies a statement digest
    to be compared against the digest for the statement in the current event.'
  id: totrans-253
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*`str`*：此参数是可选的。如果提供，则指定要与当前事件中语句的摘要进行比较的语句摘要。'
- en: 'Examples:'
  id: totrans-254
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 例子：
- en: 'This `function` item includes no argument, so `query_digest` returns the current
    statement digest as a string:'
  id: totrans-255
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此`function`项不包含参数，因此`query_digest`将当前语句摘要作为字符串返回：
- en: '[PRE23]'
  id: totrans-256
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'This `function` item includes an argument, so `query_digest` returns a Boolean
    indicating whether the argument equals the current statement digest:'
  id: totrans-257
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此`function`项包含一个参数，因此`query_digest`返回一个布尔值，指示参数是否等于当前语句摘要：
- en: '[PRE24]'
  id: totrans-258
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: This function was added in MySQL 8.0.26.
  id: totrans-259
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此函数是在MySQL 8.0.26中添加的。
- en: '`string_find(text, substr)`'
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`string_find(text, substr)`'
- en: Checks whether the `substr` value is contained in the `text` value. This search
    is case-sensitive.
  id: totrans-261
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 检查`substr`值是否包含在`text`值中。此搜索区分大小写。
- en: 'Arguments:'
  id: totrans-262
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 参数：
- en: '*`text`*: The text string to search.'
  id: totrans-263
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*`text`*：要搜索的文本字符串。'
- en: '*`substr`*: The substring to search for in *`text`*.'
  id: totrans-264
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*`substr`*：要在*`text`*中搜索的子字符串。'
- en: Replacement of Event Field Values
  id: totrans-265
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 事件字段值的替换
- en: As of MySQL 8.0.26, audit filter definitions support replacement of certain
    audit event fields, so that logged events contain the replacement value rather
    than the original value. This capability enables logged audit records to include
    statement digests rather than literal statements, which can be useful for MySQL
    deployments for which statements may expose sensitive values.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 截至MySQL 8.0.26，审计过滤器定义支持替换某些审计事件字段，以便记录的事件包含替换值而不是原始值。此功能使记录的审计记录可以包含语句摘要而不是文字语句，这对于可能暴露敏感值的MySQL部署非常有用。
- en: 'Field replacement in audit events works like this:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 审计事件中的字段替换工作原理如下：
- en: Field replacements are specified in audit filter definitions, so audit log filtering
    must be enabled as described in [Section 8.4.5.7, “Audit Log Filtering”](audit-log-filtering.html
    "8.4.5.7 Audit Log Filtering").
  id: totrans-268
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 字段替换在审计过滤器定义中指定，因此必须按照[第8.4.5.7节，“审计日志过滤”](audit-log-filtering.html "8.4.5.7 审计日志过滤")中描述的方式启用审计日志过滤。
- en: Not all fields can be replaced. [Table 8.43, “Event Fields Subject to Replacement”](audit-log-filter-definitions.html#audit-log-replaceable-event-fields
    "Table 8.43 Event Fields Subject to Replacement") shows which fields are replaceable
    in which event classes.
  id: totrans-269
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 并非所有字段都可以被替换。[表8.43，“可替换事件字段”](audit-log-filter-definitions.html#audit-log-replaceable-event-fields
    "表8.43 可替换事件字段")显示了哪些字段可以在哪些事件类中被替换。
- en: '**Table 8.43 Event Fields Subject to Replacement**'
  id: totrans-270
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**表8.43 可替换事件字段**'
- en: '| Event Class | Field Name |'
  id: totrans-271
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| 事件类 | 字段名称 |'
- en: '| `general` | `general_query.str` |'
  id: totrans-272
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `general` | `general_query.str` |'
- en: '| `table_access` | `query.str` |'
  id: totrans-273
  prefs:
  - PREF_IND
  type: TYPE_TB
  zh: '| `table_access` | `query.str` |'
- en: Replacement is conditional. Each replacement specification in a filter definition
    includes a condition, enabling a replaceable field to be changed, or left unchanged,
    depending on the condition result.
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 替换是有条件的。过滤器定义中的每个替换规范都包括一个条件，使得可根据条件结果更改或保持替换字段不变。
- en: If replacement occurs, the replacement specification indicates the replacement
    value using a function that is permitted for that purpose.
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果发生替换，替换规范将使用允许用于此目的的函数指示替换值。
- en: As [Table 8.43, “Event Fields Subject to Replacement”](audit-log-filter-definitions.html#audit-log-replaceable-event-fields
    "Table 8.43 Event Fields Subject to Replacement") shows, currently the only replaceable
    fields are those that contain statement text (which occurs in events of the `general`
    and `table_access` classes). In addition, the only function permitted for specifying
    the replacement value is `query_digest`. This means that the only permitted replacement
    operation is to replace statement literal text by its corresponding digest.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 如[表8.43，“可替换事件字段”](audit-log-filter-definitions.html#audit-log-replaceable-event-fields
    "表8.43 可替换事件字段")所示，目前唯一可替换的字段是包含语句文本的字段（出现在`general`和`table_access`类事件中）。此外，唯一允许用于指定替换值的函数是`query_digest`。这意味着唯一允许的替换操作是将语句文字文本替换为其对应的摘要。
- en: Because field replacement occurs at an early auditing stage (during filtering),
    the choice of whether to write statement literal text or digest values applies
    regardless of log format written later (that is, whether the audit log plugin
    produces XML or JSON output).
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 因为字段替换发生在早期的审计阶段（在过滤期间），所以无论稍后写入的日志格式是XML还是JSON输出（即，审计日志插件生成的日志格式），都需要选择是写入语句文字文本还是摘要值。
- en: 'Field replacement can take place at differing levels of event granularity:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 字段替换可以在不同级别的事件粒度上进行：
- en: To perform field replacement for all events in a class, filter events at the
    class level.
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要为类中的所有事件执行字段替换，请在类级别过滤事件。
- en: To perform replacement on a more fine-grained basis, include additional event-selection
    items. For example, you can perform field replacement only for specific subclasses
    of a given event class, or only in events for which fields have certain characteristics.
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要更细粒度地执行替换，可以包括额外的事件选择项。例如，您可以仅针对给定事件类的特定子类执行字段替换，或仅在具有特定特征的字段的事件中执行。
- en: 'Within a filter definition, specify field replacement by including a `print`
    item, which has this syntax:'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 在过滤器定义中，通过包含`print`项来指定字段替换，其语法如下：
- en: '[PRE25]'
  id: totrans-282
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Within the `print` item, its `field` item takes these three items to indicate
    how whether and how replacement occurs:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 在`print`项中，其`field`项使用这三个项目来指示替换是如何发生的：
- en: '`name`: The field for which replacement (potentially) occurs. *`field_name`*
    must be one of those shown in [Table 8.43, “Event Fields Subject to Replacement”](audit-log-filter-definitions.html#audit-log-replaceable-event-fields
    "Table 8.43 Event Fields Subject to Replacement").'
  id: totrans-284
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`name`：替换（可能）发生的字段。*`field_name`*必须是[Table 8.43，“可替换事件字段”](audit-log-filter-definitions.html#audit-log-replaceable-event-fields
    "Table 8.43 Event Fields Subject to Replacement")中显示的字段之一。'
- en: '`print`: The condition that determines whether to retain the original field
    value or replace it:'
  id: totrans-285
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`print`：确定是保留原始字段值还是替换它的条件：'
- en: If *`condition`* evaluates to `true`, the field remains unchanged.
  id: totrans-286
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果*`condition`*评估为`true`，则该字段保持不变。
- en: If *`condition`* evaluates to `false`, replacement occurs, using the value of
    the `replace` item.
  id: totrans-287
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果*`condition`*评估为`false`，则发生替换，使用`replace`项的值。
- en: 'To unconditionally replace a field, specify the condition like this:'
  id: totrans-288
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要无条件替换字段，请指定条件如下：
- en: '[PRE26]'
  id: totrans-289
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '`replace`: The replacement value to use when the `print` condition evaluates
    to `false`. Specify *`replacement_value`* using a `function` item.'
  id: totrans-290
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`replace`：当`print`条件评估为`false`时要使用的替换值。使用`function`项指定*`replacement_value`*。'
- en: 'For example, this filter definition applies to all events in the `general`
    class, replacing the statement literal text with its digest:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，此过滤器定义适用于`general`类中的所有事件，将语句文字替换为其摘要：
- en: '[PRE27]'
  id: totrans-292
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'The preceding filter uses this `print` item to unconditionally replace the
    statement literal text contained in `general_query.str` by its digest value:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的过滤器使用这个`print`项来无条件地通过其摘要值替换`general_query.str`中包含的语句文字：
- en: '[PRE28]'
  id: totrans-294
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '`print` items can be written different ways to implement different replacement
    strategies. The `replace` item just shown specifies the replacement text using
    this `function` construct to return a string representing the current statement
    digest:'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: '`print`项可以以不同的方式编写以实现不同的替换策略。刚刚显示的`replace`项使用这个`function`结构指定替换文本，以返回表示当前语句摘要的字符串：'
- en: '[PRE29]'
  id: totrans-296
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'The `query_digest` function can also be used in another way, as a comparator
    that returns a Boolean, which enables its use in the `print` condition. To do
    this, provide an argument that specifies a comparison statement digest:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: '`query_digest`函数也可以以另一种方式使用，作为返回布尔值的比较器，从而使其在`print`条件中可用。为此，提供一个参数，指定一个比较语句摘要：'
- en: '[PRE30]'
  id: totrans-298
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'In this case, `query_digest` returns `true` or `false` depending on whether
    the current statement digest is the same as the comparison digest. Using `query_digest`
    this way enables filter definitions to detect statements that match particular
    digests. The condition in the following construct is true only for statements
    that have a digest equal to `SELECT ?`, thus effecting replacement only for statements
    that do not match the digest:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，`query_digest`根据当前语句摘要是否与比较摘要相同返回`true`或`false`。以这种方式使用`query_digest`使得过滤器定义能够检测与特定摘要匹配的语句。以下结构中的条件仅对具有等于`SELECT
    ?`的摘要的语句为真，因此仅对不匹配摘要的语句进行替换：
- en: '[PRE31]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'To perform replacement only for statements that do match the digest, use `not`
    to invert the condition:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 仅为匹配摘要的语句执行替换，使用`not`来反转条件：
- en: '[PRE32]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Suppose that you want the audit log to contain only statement digests and not
    literal statements. To achieve this, you must perform replacement on all events
    that contain statement text; that is, events in the `general` and `table_access`
    classes. An earlier filter definition showed how to unconditionally replace statement
    text for `general` events. To do the same for `table_access` events, use a filter
    that is similar but changes the class from `general` to `table_access` and the
    field name from `general_query.str` to `query.str`:'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 假设您希望审计日志仅包含语句摘要而不是文字语句。为实现此目的，您必须对包含语句文本的所有事件执行替换；即`general`和`table_access`类别中的事件。较早的过滤器定义显示了如何无条件地替换`general`事件的语句文本。要对`table_access`事件执行相同操作，请使用类似但将类别从`general`更改为`table_access`，字段名称从`general_query.str`更改为`query.str`的过滤器：
- en: '[PRE33]'
  id: totrans-304
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Combining the `general` and `table_access` filters results in a single filter
    that performs replacement for all statement text-containing events:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 结合`general`和`table_access`过滤器会产生一个执行所有包含语句文本事件替换的单一过滤器：
- en: '[PRE34]'
  id: totrans-306
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'To perform replacement on only some events within a class, add items to the
    filter that indicate more specifically when replacement occurs. The following
    filter applies to events in the `table_access` class, but performs replacement
    only for `insert` and `update` events (leaving `read` and `delete` events unchanged):'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 仅对类别中的某些事件执行替换，向过滤器添加指示更具体替换发生时间的项目。以下过滤器适用于`table_access`类中的事件，但仅对`insert`和`update`事件执行替换（保持`read`和`delete`事件不变）：
- en: '[PRE35]'
  id: totrans-308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'This filter performs replacement for `general` class events corresponding to
    the listed account-management statements (the effect being to hide credential
    and data values in the statements):'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 该过滤器对应于列出的账户管理语句的`general`类事件执行替换（效果是隐藏语句中的凭据和数据值）：
- en: '[PRE36]'
  id: totrans-310
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: For information about the possible `general_sql_command.str` values, see [Testing
    Event Field Values](audit-log-filter-definitions.html#audit-log-filtering-event-fields
    "Testing Event Field Values").
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 有关可能的`general_sql_command.str`值的信息，请参阅[测试事件字段值](audit-log-filter-definitions.html#audit-log-filtering-event-fields
    "Testing Event Field Values")。
- en: Replacing a User Filter
  id: totrans-312
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 替换用户过滤器
- en: 'In some cases, the filter definition can be changed dynamically. To do this,
    define a `filter` configuration within an existing `filter`. For example:'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，过滤器定义可以动态更改。为此，在现有的`filter`中定义一个`filter`配置。例如：
- en: '[PRE37]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: A new filter is activated when the `activate` item within a subfilter evaluates
    to `true`. Using `activate` in a top-level `filter` is not permitted.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 当子过滤器中的`activate`项评估为`true`时，将激活新的过滤器。在顶层`filter`中使用`activate`是不允许的。
- en: A new filter can be replaced with the original one by using a `ref` item inside
    the subfilter to refer to the original filter `id`.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在子过滤器中使用`ref`项引用原始过滤器`id`，可以将新过滤器替换为原始过滤器。
- en: 'The filter shown operates like this:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 所示的过滤器的操作方式如下：
- en: The `main` filter waits for `table_access` events, either `update` or `delete`.
  id: totrans-318
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`main`过滤器等待`table_access`事件，无论是`update`还是`delete`。'
- en: If the `update` or `delete` `table_access` event occurs on the `temp_1` or `temp_2`
    table, the filter is replaced with the internal one (without an `id`, since there
    is no need to refer to it explicitly).
  id: totrans-319
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果在`temp_1`或`temp_2`表上发生`update`或`delete` `table_access`事件，则将过滤器替换为内部过滤器（没有`id`，因为没有必要显式引用它）。
- en: If the end of the command is signalled (`general` / `status` event), an entry
    is written to the audit log file and the filter is replaced with the `main` filter.
  id: totrans-320
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果命令结束被标记（`general` / `status`事件），则会向审计日志文件写入条目，并将过滤器替换为`main`过滤器。
- en: 'The filter is useful to log statements that update or delete anything from
    the `temp_1` or `temp_2` tables, such as this one:'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 该过滤器用于记录更新或删除`temp_1`或`temp_2`表中任何内容的语句，例如：
- en: '[PRE38]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: The statement generates multiple `table_access` events, but the audit log file
    contains only `general` / `status` entries.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 该语句生成多个`table_access`事件，但审计日志文件仅包含`general` / `status`条目。
- en: Note
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Any `id` values used in the definition are evaluated with respect only to that
    definition. They have nothing to do with the value of the [`audit_log_filter_id`](audit-log-reference.html#sysvar_audit_log_filter_id)
    system variable.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 在定义中使用的任何`id`值仅与该定义相关。它们与[`audit_log_filter_id`](audit-log-reference.html#sysvar_audit_log_filter_id)系统变量的值无关。

- en: 8.3.2 Encrypted Connection TLS Protocols and Ciphers
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 8.3.2 加密连接TLS协议和密码
- en: 原文：[https://dev.mysql.com/doc/refman/8.0/en/encrypted-connection-protocols-ciphers.html](https://dev.mysql.com/doc/refman/8.0/en/encrypted-connection-protocols-ciphers.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://dev.mysql.com/doc/refman/8.0/en/encrypted-connection-protocols-ciphers.html](https://dev.mysql.com/doc/refman/8.0/en/encrypted-connection-protocols-ciphers.html)
- en: MySQL supports multiple TLS protocols and ciphers, and enables configuring which
    protocols and ciphers to permit for encrypted connections. It is also possible
    to determine which protocol and cipher the current session uses.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL支持多个TLS协议和密码，并允许配置哪些协议和密码用于加密连接。还可以确定当前会话使用的协议和密码。
- en: '[Supported TLS Protocols](encrypted-connection-protocols-ciphers.html#encrypted-connection-supported-protocols
    "Supported TLS Protocols")'
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[支持的TLS协议](encrypted-connection-protocols-ciphers.html#encrypted-connection-supported-protocols
    "支持的TLS协议")'
- en: '[Removal of Support for the TLSv1 and TLSv1.1 Protocols](encrypted-connection-protocols-ciphers.html#encrypted-connection-deprecated-protocols
    "Removal of Support for the TLSv1 and TLSv1.1 Protocols")'
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[移除对TLSv1和TLSv1.1协议的支持](encrypted-connection-protocols-ciphers.html#encrypted-connection-deprecated-protocols
    "移除对TLSv1和TLSv1.1协议的支持")'
- en: '[Connection TLS Protocol Configuration](encrypted-connection-protocols-ciphers.html#encrypted-connection-protocol-configuration
    "Connection TLS Protocol Configuration")'
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[连接TLS协议配置](encrypted-connection-protocols-ciphers.html#encrypted-connection-protocol-configuration
    "连接TLS协议配置")'
- en: '[Connection Cipher Configuration](encrypted-connection-protocols-ciphers.html#encrypted-connection-cipher-configuration
    "Connection Cipher Configuration")'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[连接密码配置](encrypted-connection-protocols-ciphers.html#encrypted-connection-cipher-configuration
    "连接密码配置")'
- en: '[Connection TLS Protocol Negotiation](encrypted-connection-protocols-ciphers.html#encrypted-connection-protocol-negotiation
    "Connection TLS Protocol Negotiation")'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[连接TLS协议协商](encrypted-connection-protocols-ciphers.html#encrypted-connection-protocol-negotiation
    "连接TLS协议协商")'
- en: '[Monitoring Current Client Session TLS Protocol and Cipher](encrypted-connection-protocols-ciphers.html#encrypted-connection-protocol-monitoring
    "Monitoring Current Client Session TLS Protocol and Cipher")'
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[监视当前客户端会话的TLS协议和密码](encrypted-connection-protocols-ciphers.html#encrypted-connection-protocol-monitoring
    "监视当前客户端会话的TLS协议和密码")'
- en: Supported TLS Protocols
  id: totrans-9
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 支持的TLS协议
- en: 'The set of protocols permitted for connections to a given MySQL server instance
    is subject to multiple factors as follows:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 允许连接到给定MySQL服务器实例的协议集受多个因素影响，如下所示：
- en: MySQL Server release
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL服务器版本
- en: Up to and including MySQL 8.0.15, MySQL supports the TLSv1, TLSv1.1, and TLSv1.2
    protocols.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 直到MySQL 8.0.15，MySQL支持TLSv1、TLSv1.1和TLSv1.2协议。
- en: As of MySQL 8.0.16, MySQL also supports the TLSv1.3 protocol. To use TLSv1.3,
    both the MySQL server and the client application must be compiled using OpenSSL
    1.1.1 or higher. The Group Replication component supports TLSv1.3 from MySQL 8.0.18
    (for details, see [Section 20.6.2, “Securing Group Communication Connections with
    Secure Socket Layer (SSL)”](group-replication-secure-socket-layer-support-ssl.html
    "20.6.2 Securing Group Communication Connections with Secure Socket Layer (SSL)")).
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从MySQL 8.0.16开始，MySQL还支持TLSv1.3协议。要使用TLSv1.3，MySQL服务器和客户端应用程序必须使用OpenSSL 1.1.1或更高版本进行编译。从MySQL
    8.0.18开始，Group Replication组件支持TLSv1.3（有关详细信息，请参见[第20.6.2节，“使用安全套接字层（SSL）保护组通信连接”](group-replication-secure-socket-layer-support-ssl.html
    "20.6.2 使用安全套接字层（SSL）保护组通信连接")）。
- en: As of MySQL 8.0.26, the TLSv1 and TLSv1.1 protocols are deprecated. These protocol
    versions are old, released in 1996 and 2006, respectively, and the algorithms
    used are weak and outdated. For background, refer to the IETF memo [Deprecating
    TLSv1.0 and TLSv1.1](https://tools.ietf.org/id/draft-ietf-tls-oldversions-deprecate-02.html).
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 截至MySQL 8.0.26版本，TLSv1和TLSv1.1协议已被弃用。这些协议版本较旧，分别于1996年和2006年发布，使用的算法较弱且过时。有关背景，请参考IETF备忘录[Deprecating
    TLSv1.0 and TLSv1.1](https://tools.ietf.org/id/draft-ietf-tls-oldversions-deprecate-02.html)。
- en: As of MySQL 8.0.28, MySQL no longer supports the TLSv1 and TLSv1.1 protocols.
    From this release, clients cannot make a TLS/SSL connection with the protocol
    set to TLSv1 or TLSv1.1\. For more details, see [Removal of Support for the TLSv1
    and TLSv1.1 Protocols](encrypted-connection-protocols-ciphers.html#encrypted-connection-deprecated-protocols
    "Removal of Support for the TLSv1 and TLSv1.1 Protocols").
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 截至MySQL 8.0.28版本，MySQL不再支持TLSv1和TLSv1.1协议。从此版本开始，客户端不能使用协议设置为TLSv1或TLSv1.1进行TLS/SSL连接。有关更多详细信息，请参见[移除对TLSv1和TLSv1.1协议的支持](encrypted-connection-protocols-ciphers.html#encrypted-connection-deprecated-protocols
    "移除对TLSv1和TLSv1.1协议的支持")。
- en: '**Table 8.13 MySQL Server TLS Protocol Support**'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '**表 8.13 MySQL 服务器 TLS 协议支持**'
- en: '| MySQL Server Release | TLS Protocols Supported |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| MySQL 服务器版本 | 支持的 TLS 协议 |'
- en: '| MySQL 8.0.15 and below | TLSv1, TLSv1.1, TLSv1.2 |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| MySQL 8.0.15 及以下版本 | TLSv1、TLSv1.1、TLSv1.2 |'
- en: '| MySQL 8.0.16 and MySQL 8.0.17 | TLSv1, TLSv1.1, TLSv1.2, TLSv1.3 (except
    Group Replication) |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| MySQL 8.0.16 和 MySQL 8.0.17 | TLSv1、TLSv1.1、TLSv1.2、TLSv1.3（不包括 Group Replication）
    |'
- en: '| MySQL 8.0.18 through MySQL 8.0.25 | TLSv1, TLSv1.1, TLSv1.2, TLSv1.3 (including
    Group Replication) |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| MySQL 8.0.18 到 MySQL 8.0.25 | TLSv1、TLSv1.1、TLSv1.2、TLSv1.3（包括 Group Replication）
    |'
- en: '| MySQL 8.0.26 and MySQL 8.0.27 | TLSv1 (deprecated), TLSv1.1 (deprecated),
    TLSv1.2, TLSv1.3 |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| MySQL 8.0.26 和 MySQL 8.0.27 | TLSv1（已弃用）、TLSv1.1（已弃用）、TLSv1.2、TLSv1.3 |'
- en: '| MySQL 8.0.28 and above | TLSv1.2, TLSv1.3 |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
  zh: '| MySQL 8.0.28 及更高版本 | TLSv1.2、TLSv1.3 |'
- en: SSL library
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: SSL 库
- en: If the SSL library does not support a particular protocol, neither does MySQL,
    and any parts of the following discussion that specify that protocol do not apply.
    In particular, note that to use TLSv1.3, both the MySQL server and the client
    application must be compiled using OpenSSL 1.1.1 or higher. MySQL Server checks
    the version of OpenSSL at startup, and if it is lower than 1.1.1, TLSv1.3 is removed
    from the default value for the server system variables relating to TLS versions
    ([`tls_version`](server-system-variables.html#sysvar_tls_version), [`admin_tls_version`](server-system-variables.html#sysvar_admin_tls_version),
    and [`group_replication_recovery_tls_version`](group-replication-system-variables.html#sysvar_group_replication_recovery_tls_version)).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 SSL 库不支持特定协议，MySQL 也不支持，以下讨论中指定该协议的任何部分都不适用。特别要注意的是，要使用 TLSv1.3，MySQL 服务器和客户端应用程序都必须使用
    OpenSSL 1.1.1 或更高版本进行编译。MySQL 服务器在启动时检查 OpenSSL 的版本，如果低于 1.1.1，则会从与 TLS 版本相关的服务器系统变量的默认值中删除
    TLSv1.3（[`tls_version`](server-system-variables.html#sysvar_tls_version)、[`admin_tls_version`](server-system-variables.html#sysvar_admin_tls_version)
    和 [`group_replication_recovery_tls_version`](group-replication-system-variables.html#sysvar_group_replication_recovery_tls_version)）。
- en: MySQL instance configuration
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL 实例配置
- en: Permitted TLS protocols can be configured on both the server side and client
    side to include only a subset of the supported TLS protocols. The configuration
    on both sides must include at least one protocol in common or connection attempts
    cannot negotiate a protocol to use. For details, see [Connection TLS Protocol
    Negotiation](encrypted-connection-protocols-ciphers.html#encrypted-connection-protocol-negotiation
    "Connection TLS Protocol Negotiation").
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 可以在服务器端和客户端上配置允许的 TLS 协议，只包括受支持的 TLS 协议的子集。双方的配置必须至少包括一个共同的协议，否则连接尝试无法协商要使用的协议。有关详细信息，请参阅
    [连接 TLS 协议协商](encrypted-connection-protocols-ciphers.html#encrypted-connection-protocol-negotiation
    "连接 TLS 协议协商")。
- en: System-wide host configuration
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 系统范围的主机配置
- en: 'The host system may permit only certain TLS protocols, which means that MySQL
    connections cannot use nonpermitted protocols even if MySQL itself permits them:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 主机系统可能只允许某些 TLS 协议，这意味着即使 MySQL 本身允许它们，MySQL 连接也不能使用非允许的协议：
- en: Suppose that MySQL configuration permits TLSv1, TLSv1.1, and TLSv1.2, but your
    host system configuration permits only connections that use TLSv1.2 or higher.
    In this case, you cannot establish MySQL connections that use TLSv1 or TLSv1.1,
    even though MySQL is configured to permit them, because the host system does not
    permit them.
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 假设 MySQL 配置允许 TLSv1、TLSv1.1 和 TLSv1.2，但您的主机系统配置只允许使用 TLSv1.2 或更高版本的连接。在这种情况下，即使
    MySQL 配置允许它们，您也无法建立使用 TLSv1 或 TLSv1.1 的 MySQL 连接，因为主机系统不允许���们。
- en: If MySQL configuration permits TLSv1, TLSv1.1, and TLSv1.2, but your host system
    configuration permits only connections that use TLSv1.3 or higher, you cannot
    establish MySQL connections at all, because no protocol permitted by MySQL is
    permitted by the host system.
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果 MySQL 配置允许 TLSv1、TLSv1.1 和 TLSv1.2，但您的主机系统配置只允许使用 TLSv1.3 或更高版本的连接，则根本无法建立
    MySQL 连接，因为 MySQL 允许的任何协议都不被主机系统允许。
- en: 'Workarounds for this issue include:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 解决此问题的方法包括：
- en: 'Change the system-wide host configuration to permit additional TLS protocols.
    Consult your operating system documentation for instructions. For example, your
    system may have an `/etc/ssl/openssl.cnf` file that contains these lines to restrict
    TLS protocols to TLSv1.2 or higher:'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更改系统范围的主机配置以允许额外的 TLS 协议。请查阅操作系统文档以获取说明。例如，您的系统可能有一个包含以下行的 `/etc/ssl/openssl.cnf`
    文件，以将 TLS 协议限制为 TLSv1.2 或更高版本：
- en: '[PRE0]'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Changing the value to a lower protocol version or `None` makes the system more
    permissive. This workaround has the disadvantage that permitting lower (less secure)
    protocols may have adverse security consequences.
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 将值更改为较低的协议版本或`None`会使系统更加宽松。这种解决方法的缺点是允许较低（不太安全）的协议可能会产生不利的安全后果。
- en: If you cannot or prefer not to change the host system TLS configuration, change
    MySQL applications to use higher (more secure) TLS protocols that are permitted
    by the host system. This may not be possible for older versions of MySQL that
    support only lower protocol versions. For example, TLSv1 is the only supported
    protocol prior to MySQL 5.6.46, so attempts to connect to a pre-5.6.46 server
    fail even if the client is from a newer MySQL version that supports higher protocol
    versions. In such cases, an upgrade to a version of MySQL that supports additional
    TLS versions may be required.
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果您无法或不愿更改主机系统的TLS配置，请将MySQL应用程序更改为使用主机系统允许的更高（更安全）的TLS协议。对于仅支持较低协议版本的旧版本MySQL可能无法实现此目标。例如，在MySQL
    5.6.46之前，只支持TLSv1协议，因此即使客户端来自支持更高协议版本的新MySQL版本，尝试连接到早于5.6.46的服务器也会失败。在这种情况下，可能需要升级到支持额外TLS版本的MySQL版本。
- en: Removal of Support for the TLSv1 and TLSv1.1 Protocols
  id: totrans-36
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 不再支持TLSv1和TLSv1.1协议。
- en: Support for the TLSv1 and TLSv1.1 connection protocols is removed as of MySQL
    8.0.28\. The protocols were deprecated from MySQL 8.0.26\. For background, refer
    to the IETF memo [Deprecating TLSv1.0 and TLSv1.1](https://tools.ietf.org/id/draft-ietf-tls-oldversions-deprecate-02.html).
    It is recommended that connections be made using the more-secure TLSv1.2 and TLSv1.3
    protocols. TLSv1.3 requires that both the MySQL server and the client application
    are compiled with OpenSSL 1.1.1.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 从MySQL 8.0.28开始，不再支持TLSv1和TLSv1.1连接协议。这些协议从MySQL 8.0.26开始被弃用。有关背景，请参考IETF备忘录[Deprecating
    TLSv1.0 and TLSv1.1](https://tools.ietf.org/id/draft-ietf-tls-oldversions-deprecate-02.html)。建议使用更安全的TLSv1.2和TLSv1.3协议进行连接。TLSv1.3要求MySQL服务器和客户端应用程序都使用OpenSSL
    1.1.1进行编译。
- en: Support for TLSv1 and TLSv1.1 is removed because those protocol versions are
    old, released in 1996 and 2006, respectively. The algorithms used are weak and
    outdated. Unless you are using very old versions of MySQL Server or connectors,
    you are unlikely to have connections using TLSv1.0 or TLSv1.1\. MySQL connectors
    and clients select the highest TLS version available by default.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 不再支持TLSv1和TLSv1.1是因为这些协议版本过时，分别于1996年和2006年发布。使用的算法过于薄弱和过时。除非您使用非常旧的MySQL Server或连接器版本，否则不太可能使用TLSv1.0或TLSv1.1进行连接。MySQL连接器和客户端默认选择可用的最高TLS版本。
- en: In the releases where the TLSv1 and TLSv1.1 connection protocols are unsupported
    (from MySQL 8.0.28 onwards), clients, including MySQL Shell, that support a [`--tls-version`](connection-options.html#option_general_tls-version)
    option for specifying TLS protocols for connections to the MySQL server cannot
    make a TLS/SSL connection with the protocol set to TLSv1 or TLSv1.1\. If a client
    attempts to connect using these protocols, for TCP connections, the connection
    fails, and an error is returned to the client. For socket connections, if [`--ssl-mode`](connection-options.html#option_general_ssl-mode)
    is set to `REQUIRED`, the connection fails, otherwise the connection is made but
    with TLS/SSL disabled.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在不支持TLSv1和TLSv1.1连接协议的版本中（从MySQL 8.0.28开始），包括MySQL Shell在内支持用于指定连接到MySQL服务器的TLS协议的[`--tls-version`](connection-options.html#option_general_tls-version)选项的客户端无法使用设置为TLSv1或TLSv1.1的协议进行TLS/SSL连接。如果客户端尝试使用这些协议进行连接，则对于TCP连接，连接将失败，并向客户端返回错误。对于套接字连接，如果[`--ssl-mode`](connection-options.html#option_general_ssl-mode)设置为`REQUIRED`，则连接将失败，否则将进行连接，但禁用TLS/SSL。
- en: 'On the server side, the following settings are changed from MySQL 8.0.28:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 从MySQL 8.0.28开始，服务器端的以下设置已更改：
- en: The default values of the server’s [`tls_version`](server-system-variables.html#sysvar_tls_version)
    and [`admin_tls_version`](server-system-variables.html#sysvar_admin_tls_version)
    system variables no longer include TLSv1 and TLSv1.1.
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器的[`tls_version`](server-system-variables.html#sysvar_tls_version)和[`admin_tls_version`](server-system-variables.html#sysvar_admin_tls_version)系统变量的默认值不再包括TLSv1和TLSv1.1。
- en: The default value of the Group Replication system variable [`group_replication_recovery_tls_version`](group-replication-system-variables.html#sysvar_group_replication_recovery_tls_version)
    no longer includes TLSv1 and TLSv1.1.
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Group Replication系统变量[`group_replication_recovery_tls_version`](group-replication-system-variables.html#sysvar_group_replication_recovery_tls_version)的默认值不再包括TLSv1和TLSv1.1。
- en: For asynchronous replication, replicas cannot set the protocol for connections
    to the source server to TLSv1 or TLSv1.1 (the `SOURCE_TLS_VERSION` option of the
    [`CHANGE REPLICATION SOURCE TO`](change-replication-source-to.html "15.4.2.3 CHANGE
    REPLICATION SOURCE TO Statement") statement).
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于异步复制，副本不能将与源服务器的连接协议设置为 TLSv1 或 TLSv1.1（[`CHANGE REPLICATION SOURCE TO`](change-replication-source-to.html
    "15.4.2.3 CHANGE REPLICATION SOURCE TO Statement") 语句的 `SOURCE_TLS_VERSION` 选项）。
- en: In the releases where the TLSv1 and TLSv1.1 connection protocols are deprecated
    (MySQL 8.0.26 and MySQL 8.0.27), the server writes a warning to the error log
    if they are included in the values of the [`tls_version`](server-system-variables.html#sysvar_tls_version)
    or [`admin_tls_version`](server-system-variables.html#sysvar_admin_tls_version)
    system variable, and if a client successfully connects using them. A warning is
    also returned if you set the deprecated protocols at runtime and implement them
    using the `ALTER INSTANCE RELOAD TLS` statement. Clients, including replicas that
    specify TLS protocols for connections to the source server and Group Replication
    group members that specify TLS protocols for distributed recovery connections,
    do not issue warnings if they are configured to permit a deprecated TLS protocol.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在 TLSv1 和 TLSv1.1 连接协议被弃用的版本中（MySQL 8.0.26 和 MySQL 8.0.27），如果它们包含在 [`tls_version`](server-system-variables.html#sysvar_tls_version)
    或 [`admin_tls_version`](server-system-variables.html#sysvar_admin_tls_version)
    系统变量的值中，并且客户端成功使用它们连接，则服务器会在错误日志中写入警告。如果在运行时设置弃用的协议并使用 `ALTER INSTANCE RELOAD
    TLS` 语句实现它们，也会返回警告。如果配置允许弃用的 TLS 协议，包括为与源服务器的连接指定 TLS 协议的副本和为分布式恢复连接指定 TLS 协议的
    Group Replication 组成员，那么客户端不会发出警告。
- en: For more information, see [Does MySQL 8.0 support TLS 1.0 and 1.1?](faqs-security.html#faq-mysql-tls-versions
    "A.9.7.")
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 更多信息，请参见[MySQL 8.0 是否支持 TLS 1.0 和 1.1？](faqs-security.html#faq-mysql-tls-versions
    "A.9.7.")
- en: Connection TLS Protocol Configuration
  id: totrans-46
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 连接 TLS 协议配置
- en: On the server side, the value of the [`tls_version`](server-system-variables.html#sysvar_tls_version)
    system variable determines which TLS protocols a MySQL server permits for encrypted
    connections. The [`tls_version`](server-system-variables.html#sysvar_tls_version)
    value applies to connections from clients, regular source/replica replication
    connections where this server instance is the source, Group Replication group
    communication connections, and Group Replication distributed recovery connections
    where this server instance is the donor. The administrative connection interface
    is configured similarly, but uses the [`admin_tls_version`](server-system-variables.html#sysvar_admin_tls_version)
    system variable (see [Section 7.1.12.2, “Administrative Connection Management”](administrative-connection-interface.html
    "7.1.12.2 Administrative Connection Management")). This discussion applies to
    [`admin_tls_version`](server-system-variables.html#sysvar_admin_tls_version) as
    well.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在服务器端，[`tls_version`](server-system-variables.html#sysvar_tls_version) 系统变量的值确定
    MySQL 服务器允许加密连接使用的 TLS 协议。[`tls_version`](server-system-variables.html#sysvar_tls_version)
    值适用于来自客户端的连接、常规源/副本复制连接（其中此服务器实例是源）、Group Replication 组通信连接以及 Group Replication
    分布式恢复连接（其中此服务器实例是捐赠者）。管理连接接口配置类似，但使用 [`admin_tls_version`](server-system-variables.html#sysvar_admin_tls_version)
    系统变量（参见[第 7.1.12.2 节，“管理连接管理”](administrative-connection-interface.html "7.1.12.2 Administrative
    Connection Management")）。此讨论也适用于 [`admin_tls_version`](server-system-variables.html#sysvar_admin_tls_version)。
- en: The [`tls_version`](server-system-variables.html#sysvar_tls_version) value is
    a list of one or more comma-separated TLS protocol versions, which is not case-sensitive.
    By default, this variable lists all protocols that are supported by the SSL library
    used to compile MySQL and by the MySQL Server release. The default settings are
    therefore as shown in [Table 8.14, “MySQL Server TLS Protocol Default Settings”](encrypted-connection-protocols-ciphers.html#tls-support-defaults
    "Table 8.14 MySQL Server TLS Protocol Default Settings").
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '[`tls_version`](server-system-variables.html#sysvar_tls_version) 值是一个或多个逗号分隔的
    TLS 协议版本列表，不区分大小写。默认情况下，此变量列出了编译 MySQL 和 MySQL 服务器发布所使用的 SSL 库支持的所有协议。因此，默认设置如[表 8.14，“MySQL
    服务器 TLS 协议默认设置”](encrypted-connection-protocols-ciphers.html#tls-support-defaults
    "Table 8.14 MySQL Server TLS Protocol Default Settings")所示。'
- en: '**Table 8.14 MySQL Server TLS Protocol Default Settings**'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '**表 8.14 MySQL 服务器 TLS 协议默认设置**'
- en: '| MySQL Server Release | `tls_version` Default Setting |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '| MySQL 服务器发布版本 | `tls_version` 默认设置 |'
- en: '| MySQL 8.0.15 and below | `TLSv1,TLSv1.1,TLSv1.2` |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '| MySQL 8.0.15 及以下版本 | `TLSv1,TLSv1.1,TLSv1.2` |'
- en: '| MySQL 8.0.16 and MySQL 8.0.17 | `TLSv1,TLSv1.1,TLSv1.2,TLSv1.3 (with OpenSSL
    1.1.1)``TLSv1,TLSv1.1,TLSv1.2 (otherwise)`Group Replication does not support TLSv1.3
    |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '| MySQL 8.0.16 和 MySQL 8.0.17 | `TLSv1,TLSv1.1,TLSv1.2,TLSv1.3 (使用 OpenSSL
    1.1.1)` `TLSv1,TLSv1.1,TLSv1.2 (其他情况)` Group Replication 不支持 TLSv1.3 |'
- en: '| MySQL 8.0.18 through MySQL 8.0.25 | `TLSv1,TLSv1.1,TLSv1.2,TLSv1.3 (with
    OpenSSL 1.1.1)``TLSv1,TLSv1.1,TLSv1.2 (otherwise)`Group Replication supports TLSv1.3
    |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
  zh: '| MySQL 8.0.18 到 MySQL 8.0.25 | `TLSv1,TLSv1.1,TLSv1.2,TLSv1.3 (使用 OpenSSL
    1.1.1)` `TLSv1,TLSv1.1,TLSv1.2 (其他情况)` Group Replication 支持 TLSv1.3 |'
- en: '| MySQL 8.0.26 and MySQL 8.0.27 | `TLSv1,TLSv1.1,TLSv1.2,TLSv1.3 (with OpenSSL
    1.1.1)``TLSv1,TLSv1.1,TLSv1.2 (otherwise)`TLSv1 and TLSv1.1 are deprecated |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
  zh: '| MySQL 8.0.26 和 MySQL 8.0.27 | `TLSv1,TLSv1.1,TLSv1.2,TLSv1.3 (使用 OpenSSL
    1.1.1)` `TLSv1,TLSv1.1,TLSv1.2 (其他情况)` `TLSv1 和 TLSv1.1 已被弃用` |'
- en: '| MySQL 8.0.28 and above | `TLSv1.2,TLSv1.3` |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '| MySQL 8.0.28 及以上版本 | `TLSv1.2,TLSv1.3` |'
- en: 'To determine the value of [`tls_version`](server-system-variables.html#sysvar_tls_version)
    at runtime, use this statement:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 要在运行时确定 [`tls_version`](server-system-variables.html#sysvar_tls_version) 的值，请使用以下语句：
- en: '[PRE1]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'To change the value of [`tls_version`](server-system-variables.html#sysvar_tls_version),
    set it at server startup. For example, to permit connections that use the TLSv1.2
    or TLSv1.3 protocol, but prohibit connections that use the less-secure TLSv1 and
    TLSv1.1 protocols, use these lines in the server `my.cnf` file:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 要更改 [`tls_version`](server-system-variables.html#sysvar_tls_version) 的值，请在服务器启动时设置。例如，要允许使用
    TLSv1.2 或 TLSv1.3 协议的连接，但禁止使用较不安全的 TLSv1 和 TLSv1.1 协议的连接，请在服务器的 `my.cnf` 文件中使用以下行：
- en: '[PRE2]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'To be even more restrictive and permit only TLSv1.3 connections, set [`tls_version`](server-system-variables.html#sysvar_tls_version)
    like this:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 要更加严格并仅允许 TLSv1.3 连接，设置 [`tls_version`](server-system-variables.html#sysvar_tls_version)
    如下：
- en: '[PRE3]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: As of MySQL 8.0.16, `tls_version` can be changed at runtime. See [Server-Side
    Runtime Configuration and Monitoring for Encrypted Connections](using-encrypted-connections.html#using-encrypted-connections-server-side-runtime-configuration
    "Server-Side Runtime Configuration and Monitoring for Encrypted Connections").
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 从 MySQL 8.0.16 开始，`tls_version` 可以在运行时更改。请参阅 [Server-Side Runtime Configuration
    and Monitoring for Encrypted Connections](using-encrypted-connections.html#using-encrypted-connections-server-side-runtime-configuration
    "Server-Side Runtime Configuration and Monitoring for Encrypted Connections")。
- en: On the client side, the [`--tls-version`](connection-options.html#option_general_tls-version)
    option specifies which TLS protocols a client program permits for connections
    to the server. The format of the option value is the same as for the [`tls_version`](server-system-variables.html#sysvar_tls_version)
    system variable described previously (a list of one or more comma-separated protocol
    versions).
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在客户端，[`--tls-version`](connection-options.html#option_general_tls-version) 选项指定客户端程序允许连接到服务器的
    TLS 协议版本。选项值的格式与之前描述的 [`tls_version`](server-system-variables.html#sysvar_tls_version)
    系统变量相同（一个或多个逗号分隔的协议版本列表）。
- en: For source/replica replication connections where this server instance is the
    replica, the `SOURCE_TLS_VERSION` | `MASTER_TLS_VERSION` option for the [`CHANGE
    REPLICATION SOURCE TO`](change-replication-source-to.html "15.4.2.3 CHANGE REPLICATION
    SOURCE TO Statement") statement (from MySQL 8.0.23) or [`CHANGE MASTER TO`](change-master-to.html
    "15.4.2.1 CHANGE MASTER TO Statement") statement (before MySQL 8.0.23) specifies
    which TLS protocols the replica permits for connections to the source. The format
    of the option value is the same as for the [`tls_version`](server-system-variables.html#sysvar_tls_version)
    system variable described previously. See [Section 19.3.1, “Setting Up Replication
    to Use Encrypted Connections”](replication-encrypted-connections.html "19.3.1 Setting
    Up Replication to Use Encrypted Connections").
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 对于源/复制复制连接，其中此服务器实例是复制品，[`CHANGE REPLICATION SOURCE TO`](change-replication-source-to.html
    "15.4.2.3 CHANGE REPLICATION SOURCE TO Statement") 语句（从 MySQL 8.0.23 开始）或 [`CHANGE
    MASTER TO`](change-master-to.html "15.4.2.1 CHANGE MASTER TO Statement") 语句（MySQL
    8.0.23 之前）的 `SOURCE_TLS_VERSION` | `MASTER_TLS_VERSION` 选项指定复制品允许连接到源的 TLS 协议版本。选项值的格式与之前描述的
    [`tls_version`](server-system-variables.html#sysvar_tls_version) 系统变量相同。参见 [Section 19.3.1,
    “Setting Up Replication to Use Encrypted Connections”](replication-encrypted-connections.html
    "19.3.1 Setting Up Replication to Use Encrypted Connections")。
- en: The protocols that can be specified for `SOURCE_TLS_VERSION` | `MASTER_TLS_VERSION`
    depend on the SSL library. This option is independent of and not affected by the
    server [`tls_version`](server-system-variables.html#sysvar_tls_version) value.
    For example, a server that acts as a replica can be configured with [`tls_version`](server-system-variables.html#sysvar_tls_version)
    set to TLSv1.3 to permit only incoming connections that use TLSv1.3, but also
    configured with `SOURCE_TLS_VERSION` | `MASTER_TLS_VERSION` set to TLSv1.2 to
    permit only TLSv1.2 for outgoing replica connections to the source.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 可以为`SOURCE_TLS_VERSION` | `MASTER_TLS_VERSION`指定的协议取决于SSL库。此选项独立于服务器[`tls_version`](server-system-variables.html#sysvar_tls_version)值，并不受其影响。例如，作为副本的服务器可以配置[`tls_version`](server-system-variables.html#sysvar_tls_version)设置为TLSv1.3，以仅允许使用TLSv1.3的传入连接，但也可以配置`SOURCE_TLS_VERSION`
    | `MASTER_TLS_VERSION`设置为TLSv1.2，以仅允许对源的传出副本连接使用TLSv1.2。
- en: For Group Replication distributed recovery connections where this server instance
    is the joining member that initiates distributed recovery (that is, the client),
    the [`group_replication_recovery_tls_version`](group-replication-system-variables.html#sysvar_group_replication_recovery_tls_version)
    system variable specifies which protocols are permitted by the client. Again,
    this option is independent of and not affected by the server [`tls_version`](server-system-variables.html#sysvar_tls_version)
    value, which applies when this server instance is the donor. A Group Replication
    server generally participates in distributed recovery both as a donor and as a
    joining member over the course of its group membership, so both these system variables
    should be set. See [Section 20.6.2, “Securing Group Communication Connections
    with Secure Socket Layer (SSL)”](group-replication-secure-socket-layer-support-ssl.html
    "20.6.2 Securing Group Communication Connections with Secure Socket Layer (SSL)").
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Group Replication分布式恢复连接，其中此服务器实例是发起分布式恢复的加入成员（即客户端），[`group_replication_recovery_tls_version`](group-replication-system-variables.html#sysvar_group_replication_recovery_tls_version)系统变量指定客户端允许的协议。同样，此选项独立于服务器[`tls_version`](server-system-variables.html#sysvar_tls_version)值，并不受其影响，当此服务器实例是捐赠者时应用。Group
    Replication服务器通常在其组成员身份的过程中既作为捐赠者又作为加入成员参与分布式恢复，因此应设置这两个系统变量。参见[第20.6.2节，“使用安全套接字层（SSL）保护组通信连接”](group-replication-secure-socket-layer-support-ssl.html
    "20.6.2 使用安全套接字层（SSL）保护组通信连接")。
- en: TLS protocol configuration affects which protocol a given connection uses, as
    described in [Connection TLS Protocol Negotiation](encrypted-connection-protocols-ciphers.html#encrypted-connection-protocol-negotiation
    "Connection TLS Protocol Negotiation").
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: TLS协议配置影响给定连接使用的协议，如[连接TLS协议协商](encrypted-connection-protocols-ciphers.html#encrypted-connection-protocol-negotiation
    "连接TLS协议协商")中所述。
- en: 'Permitted protocols should be chosen such as not to leave “holes” in the list.
    For example, these server configuration values do not have holes:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 允许的协议应该被选择，以免在列表中留下“漏洞”。例如，这些服务器配置数值没有漏洞：
- en: '[PRE4]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'These values do have holes and should not be used:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 这些数值有漏洞，不应使用：
- en: '[PRE5]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The prohibition on holes also applies in other configuration contexts, such
    as for clients or replicas.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 对于其他配置上下文，如客户端或副本，也适用于禁止漏洞。
- en: 'Unless you intend to disable encrypted connections, the list of permitted protocols
    should not be empty. If you set a TLS version parameter to the empty string, encrypted
    connections cannot be established:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 除非你打算禁用加密连接，否则允许的协议列表不应为空。如果将TLS版本参数设置为空字符串，加密连接将无法建立：
- en: '[`tls_version`](server-system-variables.html#sysvar_tls_version): The server
    does not permit encrypted incoming connections.'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`tls_version`](server-system-variables.html#sysvar_tls_version)：服务器不允许加密传入连接。'
- en: '[`--tls-version`](connection-options.html#option_general_tls-version): The
    client does not permit encrypted outgoing connections to the server.'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`--tls-version`](connection-options.html#option_general_tls-version)：客户端不允许向服务器建立加密传出连接。'
- en: '`SOURCE_TLS_VERSION` | `MASTER_TLS_VERSION`: The replica does not permit encrypted
    outgoing connections to the source.'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`SOURCE_TLS_VERSION` | `MASTER_TLS_VERSION`：副本不允许向源建立加密传出连接。'
- en: '[`group_replication_recovery_tls_version`](group-replication-system-variables.html#sysvar_group_replication_recovery_tls_version):
    The joining member does not permit encrypted connections to the distributed recovery
    connection.'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`group_replication_recovery_tls_version`](group-replication-system-variables.html#sysvar_group_replication_recovery_tls_version)：加入成员不允许与分布式恢复连接建立加密连接。'
- en: Connection Cipher Configuration
  id: totrans-78
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 连接密码配置
- en: A default set of ciphers applies to encrypted connections, which can be overridden
    by explicitly configuring the permitted ciphers. During connection establishment,
    both sides of a connection must permit some cipher in common or the connection
    fails. Of the permitted ciphers common to both sides, the SSL library chooses
    the one supported by the provided certificate that has the highest priority.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 一组默认的密码适用于加密连接，可以通过显式配置允许的密码来覆盖。在连接建立过程中，连接的双方必须允许一些共同的密码，否则连接将失败。在双��都允许的密码中，SSL库选择由提供的具有最高优先级的证书支持的密码。
- en: 'To specify a cipher or ciphers applicable for encrypted connections that use
    TLS protocols up through TLSv1.2:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 要指定适用于使用TLS协议直至TLSv1.2的加密连接的密码或密码：
- en: Set the [`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher) system
    variable on the server side, and use the [`--ssl-cipher`](connection-options.html#option_general_ssl-cipher)
    option for client programs.
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在服务器端设置[`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher)系统变量，并为客户端程序使用[`--ssl-cipher`](connection-options.html#option_general_ssl-cipher)选项。
- en: For regular source/replica replication connections, where this server instance
    is the source, set the [`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher)
    system variable. Where this server instance is the replica, use the `SOURCE_SSL_CIPHER`
    | `MASTER_SSL_CIPHER` option for the [`CHANGE REPLICATION SOURCE TO`](change-replication-source-to.html
    "15.4.2.3 CHANGE REPLICATION SOURCE TO Statement") statement (from MySQL 8.0.23)
    or [`CHANGE MASTER TO`](change-master-to.html "15.4.2.1 CHANGE MASTER TO Statement")
    statement (before MySQL 8.0.23). See [Section 19.3.1, “Setting Up Replication
    to Use Encrypted Connections”](replication-encrypted-connections.html "19.3.1 Setting
    Up Replication to Use Encrypted Connections").
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于常规的源/副本复制连接，在这个服务器实例作为源时，设置[`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher)系统变量。当这个服务器实例作为副本时，使用[`CHANGE
    REPLICATION SOURCE TO`](change-replication-source-to.html "15.4.2.3 CHANGE REPLICATION
    SOURCE TO Statement")语句（从MySQL 8.0.23开始）或[`CHANGE MASTER TO`](change-master-to.html
    "15.4.2.1 CHANGE MASTER TO Statement")语句（MySQL 8.0.23之前）的`SOURCE_SSL_CIPHER` |
    `MASTER_SSL_CIPHER`选项。参见[Section 19.3.1, “Setting Up Replication to Use Encrypted
    Connections”](replication-encrypted-connections.html "19.3.1 Setting Up Replication
    to Use Encrypted Connections")。
- en: For a Group Replication group member, for Group Replication group communication
    connections and also for Group Replication distributed recovery connections where
    this server instance is the donor, set the [`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher)
    system variable. For Group Replication distributed recovery connections where
    this server instance is the joining member, use the [`group_replication_recovery_ssl_cipher`](group-replication-system-variables.html#sysvar_group_replication_recovery_ssl_cipher)
    system variable. See [Section 20.6.2, “Securing Group Communication Connections
    with Secure Socket Layer (SSL)”](group-replication-secure-socket-layer-support-ssl.html
    "20.6.2 Securing Group Communication Connections with Secure Socket Layer (SSL)").
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于Group Replication组成员，对于Group Replication组通信连接以及Group Replication分布式恢复连接（其中这个服务器实例是捐赠者），设置[`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher)系统变量。对于Group
    Replication分布式恢复连接（其中这个服务器实例是加入成员），使用[`group_replication_recovery_ssl_cipher`](group-replication-system-variables.html#sysvar_group_replication_recovery_ssl_cipher)系统变量。参见[Section 20.6.2,
    “Securing Group Communication Connections with Secure Socket Layer (SSL)”](group-replication-secure-socket-layer-support-ssl.html
    "20.6.2 Securing Group Communication Connections with Secure Socket Layer (SSL)")。
- en: 'For encrypted connections that use TLSv1.3, OpenSSL 1.1.1 and higher supports
    the following ciphersuites, the first three of which are enabled by default:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 对于使用TLSv1.3的加密连接，OpenSSL 1.1.1及更高版本支持以下密码套件，默认情况下启用前三个：
- en: '[PRE6]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Note
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Prior to MySQL 8.0.35, `TLS_AES_128_CCM_8_SHA256` was supported for use with
    server system variables [`--tls-ciphersuites`](server-system-variables.html#sysvar_tls_ciphersuites)
    or [`--admin-tls-ciphersuites`](server-system-variables.html#sysvar_admin_tls_ciphersuites).
    `TLS_AES_128_CCM_8_SHA256` generates a deprecation warning if configured for MySQL
    8.0.35 and higher.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在MySQL 8.0.35之前，`TLS_AES_128_CCM_8_SHA256`支持与服务器系统变量[`--tls-ciphersuites`](server-system-variables.html#sysvar_tls_ciphersuites)或[`--admin-tls-ciphersuites`](server-system-variables.html#sysvar_admin_tls_ciphersuites)一起使用。如果为MySQL
    8.0.35及更高版本配置`TLS_AES_128_CCM_8_SHA256`，将生成一个弃用警告。
- en: To configure the permitted TLSv1.3 ciphersuites explicitly, set the following
    parameters. In each case, the configuration value is a list of zero or more colon-separated
    ciphersuite names.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 要显式配置允许的TLSv1.3密码套件，请设置以下参数。在每种情况下，配置值是一个零个或多个以冒号分隔的密码套件名称列表。
- en: On the server side, use the [`tls_ciphersuites`](server-system-variables.html#sysvar_tls_ciphersuites)
    system variable. If this variable is not set, its default value is `NULL`, which
    means that the server permits the default set of ciphersuites. If the variable
    is set to the empty string, no ciphersuites are enabled and encrypted connections
    cannot be established.
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在服务器端，使用[`tls_ciphersuites`](server-system-variables.html#sysvar_tls_ciphersuites)系统变量。如果未设置此变量，则其默认值为`NULL`，这意味着服务器允许默认一组密码套件。如果将变量设置为空字符串，则不启用任何密码套件，无法建立加密连接。
- en: On the client side, use the [`--tls-ciphersuites`](connection-options.html#option_general_tls-ciphersuites)
    option. If this option is not set, the client permits the default set of ciphersuites.
    If the option is set to the empty string, no ciphersuites are enabled and encrypted
    connections cannot be established.
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在客户端端，使用[`--tls-ciphersuites`](connection-options.html#option_general_tls-ciphersuites)选项。如果未设置此选项，则客户端允许默认一组密码套件。如果将选项设置为空字符串，则不启用任何密码套件，无法建立加密连接。
- en: For regular source/replica replication connections, where this server instance
    is the source, use the [`tls_ciphersuites`](server-system-variables.html#sysvar_tls_ciphersuites)
    system variable. Where this server instance is the replica, use the `SOURCE_TLS_CIPHERSUITES`
    | `MASTER_TLS_CIPHERSUITES` option for the [`CHANGE REPLICATION SOURCE TO`](change-replication-source-to.html
    "15.4.2.3 CHANGE REPLICATION SOURCE TO Statement") statement (from MySQL 8.0.23)
    or [`CHANGE MASTER TO`](change-master-to.html "15.4.2.1 CHANGE MASTER TO Statement")
    statement (before MySQL 8.0.23). See [Section 19.3.1, “Setting Up Replication
    to Use Encrypted Connections”](replication-encrypted-connections.html "19.3.1 Setting
    Up Replication to Use Encrypted Connections").
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于常规的源/副本复制连接，在此服务器实例作为源时，请使用[`tls_ciphersuites`](server-system-variables.html#sysvar_tls_ciphersuites)系统变量。在此服务器实例作为副本时，请使用`SOURCE_TLS_CIPHERSUITES`
    | `MASTER_TLS_CIPHERSUITES`选项，用于[`CHANGE REPLICATION SOURCE TO`](change-replication-source-to.html
    "15.4.2.3 CHANGE REPLICATION SOURCE TO Statement")语句（从MySQL 8.0.23开始）或[`CHANGE
    MASTER TO`](change-master-to.html "15.4.2.1 CHANGE MASTER TO Statement")语句（在MySQL
    8.0.23之前）。参见[Section 19.3.1, “Setting Up Replication to Use Encrypted Connections”](replication-encrypted-connections.html
    "19.3.1 Setting Up Replication to Use Encrypted Connections")。
- en: For a Group Replication group member, for Group Replication group communication
    connections and also for Group Replication distributed recovery connections where
    this server instance is the donor, use the [`tls_ciphersuites`](server-system-variables.html#sysvar_tls_ciphersuites)
    system variable. For Group Replication distributed recovery connections where
    this server instance is the joining member, use the [`group_replication_recovery_tls_ciphersuites`](group-replication-system-variables.html#sysvar_group_replication_recovery_tls_ciphersuites)
    system variable. See [Section 20.6.2, “Securing Group Communication Connections
    with Secure Socket Layer (SSL)”](group-replication-secure-socket-layer-support-ssl.html
    "20.6.2 Securing Group Communication Connections with Secure Socket Layer (SSL)").
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于Group Replication组成员，在Group Replication组通信连接以及在此服务器实例作为捐赠者时的Group Replication分布式恢复连接中，请使用[`tls_ciphersuites`](server-system-variables.html#sysvar_tls_ciphersuites)系统变量。对于此服务器实例作为加入成员时的Group
    Replication分布式恢复连接，请使用[`group_replication_recovery_tls_ciphersuites`](group-replication-system-variables.html#sysvar_group_replication_recovery_tls_ciphersuites)系统变量。参见[Section 20.6.2,
    “Securing Group Communication Connections with Secure Socket Layer (SSL)”](group-replication-secure-socket-layer-support-ssl.html
    "20.6.2 Securing Group Communication Connections with Secure Socket Layer (SSL)")。
- en: Note
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Ciphersuite support is available as of MySQL 8.0.16, but requires that both
    the MySQL server and the client application be compiled using OpenSSL 1.1.1 or
    higher.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL 8.0.16版本开始支持密码套件，但要求MySQL服务器和客户端应用程序都使用OpenSSL 1.1.1或更高版本进行编译。
- en: In MySQL 8.0.16 through 8.0.18, the [`group_replication_recovery_tls_ciphersuites`](group-replication-system-variables.html#sysvar_group_replication_recovery_tls_ciphersuites)
    system variable and the `SOURCE_TLS_CIPHERSUITES` | `MASTER_TLS_CIPHERSUITES`
    option for the [`CHANGE REPLICATION SOURCE TO`](change-replication-source-to.html
    "15.4.2.3 CHANGE REPLICATION SOURCE TO Statement") statement (from MySQL 8.0.23)
    or [`CHANGE MASTER TO`](change-master-to.html "15.4.2.1 CHANGE MASTER TO Statement")
    statement (before MySQL 8.0.23) are not available. In these releases, if TLSv1.3
    is used for source/replica replication connections, or in Group Replication for
    distributed recovery (supported from MySQL 8.0.18), the replication source or
    Group Replication donor servers must permit the use of at least one TLSv1.3 ciphersuite
    that is enabled by default. From MySQL 8.0.19, you can use the options to configure
    client support for any selection of ciphersuites, including only non-default ciphersuites
    if you want.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在MySQL 8.0.16至8.0.18中，[`group_replication_recovery_tls_ciphersuites`](group-replication-system-variables.html#sysvar_group_replication_recovery_tls_ciphersuites)系统变量和[`CHANGE
    REPLICATION SOURCE TO`](change-replication-source-to.html "15.4.2.3 CHANGE REPLICATION
    SOURCE TO Statement")语句（从MySQL 8.0.23开始）或[`CHANGE MASTER TO`](change-master-to.html
    "15.4.2.1 CHANGE MASTER TO Statement")语句（在MySQL 8.0.23之前）中的`SOURCE_TLS_CIPHERSUITES`
    | `MASTER_TLS_CIPHERSUITES`选项不可用。在这些版本中，如果用于源/副本复制连接的TLSv1.3，或在分布式恢复的Group Replication中使用TLSv1.3（从MySQL
    8.0.18开始支持），则复制源或Group Replication捐赠服务器必须允许至少启用默认情况下启用的一个TLSv1.3密码套件。从MySQL 8.0.19开始，您可以使用选项配置客户端支持任何选择的密码套件，包括仅使用非默认密码套件（如果需要）。
- en: A given cipher may work only with particular TLS protocols, which affects the
    TLS protocol negotiation process. See [Connection TLS Protocol Negotiation](encrypted-connection-protocols-ciphers.html#encrypted-connection-protocol-negotiation
    "Connection TLS Protocol Negotiation").
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 给定密码可能仅适用于特定的TLS协议，这会影响TLS协议协商过程。请参阅[连接TLS协议协商](encrypted-connection-protocols-ciphers.html#encrypted-connection-protocol-negotiation
    "Connection TLS Protocol Negotiation")。
- en: 'To determine which ciphers a given server supports, check the session value
    of the [`Ssl_cipher_list`](server-status-variables.html#statvar_Ssl_cipher_list)
    status variable:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 要确定给定服务器支持哪些密码，检查[`Ssl_cipher_list`](server-status-variables.html#statvar_Ssl_cipher_list)状态变量的会话值：
- en: '[PRE7]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The [`Ssl_cipher_list`](server-status-variables.html#statvar_Ssl_cipher_list)
    status variable lists the possible SSL ciphers (empty for non-SSL connections).
    If MySQL supports TLSv1.3, the value includes the possible TLSv1.3 ciphersuites.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '[`Ssl_cipher_list`](server-status-variables.html#statvar_Ssl_cipher_list)状态变量列出了可能的SSL密码（非SSL连接为空）。如果MySQL支持TLSv1.3，则该值包括可能的TLSv1.3密码套件。'
- en: Note
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: ECDSA ciphers only work in combination with an SSL certificate that uses ECDSA
    for the digital signature, and they do not work with certificates that use RSA.
    MySQL Server’s automatic generation process for SSL certificates does not generate
    ECDSA signed certificates, it generates only RSA signed certificates. Do not select
    ECDSA ciphers unless you have an ECDSA certificate available to you.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: ECDSA密码只能与使用ECDSA进行数字签名的SSL证书结合使用，并且不能与使用RSA的证书一起使用。MySQL服务器的SSL证书自动生成过程不生成ECDSA签名证书，它只生成RSA签名证书。除非您有可用的ECDSA证书，请勿选择ECDSA密码。
- en: For encrypted connections that use TLS.v1.3, MySQL uses the SSL library default
    ciphersuite list.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 对于使用TLS.v1.3的加密连接，MySQL使用SSL库的默认密码套件列表。
- en: For encrypted connections that use TLS protocols up through TLSv1.2, MySQL passes
    the following default cipher list to the SSL library.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 对于使用TLS协议直至TLSv1.2的加密连接，MySQL将以下默认密码列表传递给SSL库。
- en: '[PRE8]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'These cipher restrictions are in place:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 这些密码限制已经生效：
- en: 'As of MySQL 8.0.35, the following ciphers are deprecated and produce a warning
    when used with the server system variables [`--ssl-cipher`](server-system-variables.html#sysvar_ssl_cipher)
    and [`--admin-ssl-cipher`](server-system-variables.html#sysvar_admin_ssl_cipher):'
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从MySQL 8.0.35开始，以下密码已被弃用，并在与服务器系统变量[`--ssl-cipher`](server-system-variables.html#sysvar_ssl_cipher)和[`--admin-ssl-cipher`](server-system-variables.html#sysvar_admin_ssl_cipher)一起使用时产生警告：
- en: '[PRE9]'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The following ciphers are permanently restricted:'
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以下密码已被永久限制：
- en: '[PRE10]'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The following categories of ciphers are permanently restricted:'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以下密码类别已被永久限制：
- en: '[PRE11]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: If the server is started with the [`ssl_cert`](server-system-variables.html#sysvar_ssl_cert)
    system variable set to a certificate that uses any of the preceding restricted
    ciphers or cipher categories, the server starts with support for encrypted connections
    disabled.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 如果服务器启动时使用[`ssl_cert`](server-system-variables.html#sysvar_ssl_cert)系统变量设置为使用任何前述受限密码或密码类别的证书，则服务器将以禁用加密连接的支持启动。
- en: Connection TLS Protocol Negotiation
  id: totrans-113
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 连接TLS协议协商
- en: 'Connection attempts in MySQL negotiate use of the highest TLS protocol version
    available on both sides for which a protocol-compatible encryption cipher is available
    on both sides. The negotiation process depends on factors such as the SSL library
    used to compile the server and client, the TLS protocol and encryption cipher
    configuration, and which key size is used:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在MySQL中，连接尝试会协商双方都支持的最高TLS协议版本，该版本在双方都支持的协议兼容加密密码上可用。协商过程取决于诸如用于编译服务器和客户端的SSL库、TLS协议和加密密码配置以及使用的密钥大小等因素：
- en: For a connection attempt to succeed, the server and client TLS protocol configuration
    must permit some protocol in common.
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要使连接尝试成功，服务器和客户端TLS协议配置必须允许一些共同的协议。
- en: Similarly, the server and client encryption cipher configuration must permit
    some cipher in common. A given cipher may work only with particular TLS protocols,
    so a protocol available to the negotiation process is not chosen unless there
    is also a compatible cipher.
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 类似地，服务器和客户端加密密码配置必须允许一些共同的密码。给定的密码可能仅适用于特定的TLS协议，因此除非还有兼容的密码，否则在协商过程中不会选择协议。
- en: If TLSv1.3 is available, it is used if possible. (This means that server and
    client configuration both must permit TLSv1.3, and both must also permit some
    TLSv1.3-compatible encryption cipher.) Otherwise, MySQL continues through the
    list of available protocols, using TLSv1.2 if possible, and so forth. Negotiation
    proceeds from more secure protocols to less secure. Negotiation order is independent
    of the order in which protocols are configured. For example, negotiation order
    is the same regardless of whether [`tls_version`](server-system-variables.html#sysvar_tls_version)
    has a value of `TLSv1,TLSv1.1,TLSv1.2,TLSv1.3` or `TLSv1.3,TLSv1.2,TLSv1.1,TLSv1`.
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果TLSv1.3可用，则尽可能使用。 （这意味着服务器和客户端配置都必须允许TLSv1.3，并且两者还必须允许一些TLSv1.3兼容的加密密码。）否则，MySQL将继续使用可用协议列表，如果可能的话使用TLSv1.2，依此类推。协商从更安全的协议到不太安全的协议进行。协商顺序与配置协议的顺序无关。例如，无论[`tls_version`](server-system-variables.html#sysvar_tls_version)的值是`TLSv1,TLSv1.1,TLSv1.2,TLSv1.3`还是`TLSv1.3,TLSv1.2,TLSv1.1,TLSv1`，协商顺序都是相同的。
- en: 'TLSv1.2 does not work with all ciphers that have a key size of 512 bits or
    less. To use this protocol with such a key, set the [`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher)
    system variable on the server side or use the [`--ssl-cipher`](connection-options.html#option_general_ssl-cipher)
    client option to specify the cipher name explicitly:'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: TLSv1.2与所有密钥大小为512位或更小的密码不兼容。要使用此协议与此类密钥，请在服务器端设置[`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher)系统变量，或使用[`--ssl-cipher`](connection-options.html#option_general_ssl-cipher)客户端选项显式指定密码名称：
- en: '[PRE12]'
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: For better security, use a certificate with an RSA key size of at least 2048
    bits.
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为了更好的安全性，请使用至少2048位的RSA密钥大小的证书。
- en: 'If the server and client do not have a permitted protocol in common, and a
    protocol-compatible cipher in common, the server terminates the connection request.
    Examples:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 如果服务器和客户端没有共同的允许协议，以及共同的协议兼容密码，服务器将终止连接请求。例如：
- en: 'If the server is configured with [`tls_version=TLSv1.1,TLSv1.2`](server-system-variables.html#sysvar_tls_version):'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果服务器配置为[`tls_version=TLSv1.1,TLSv1.2`](server-system-variables.html#sysvar_tls_version)：
- en: Connection attempts fail for clients invoked with [`--tls-version=TLSv1`](connection-options.html#option_general_tls-version),
    and for older clients that support only TLSv1.
  id: totrans-123
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于使用[`--tls-version=TLSv1`](connection-options.html#option_general_tls-version)调用的客户端以及仅支持TLSv1的旧客户端，连接尝试将失败。
- en: Similarly, connection attempts fail for replicas configured with `MASTER_TLS_VERSION
    = 'TLSv1'`, and for older replicas that support only TLSv1.
  id: totrans-124
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 类似地，为配置为`MASTER_TLS_VERSION = 'TLSv1'`的复制品以及仅支持TLSv1的旧复制品，连接尝试将失败。
- en: 'If the server is configured with [`tls_version=TLSv1`](server-system-variables.html#sysvar_tls_version)
    or is an older server that supports only TLSv1:'
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果服务器配置为[`tls_version=TLSv1`](server-system-variables.html#sysvar_tls_version)或是仅支持TLSv1的旧服务器：
- en: Connection attempts fail for clients invoked with [`--tls-version=TLSv1.1,TLSv1.2`](connection-options.html#option_general_tls-version).
  id: totrans-126
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于使用[`--tls-version=TLSv1.1,TLSv1.2`](connection-options.html#option_general_tls-version)调用的客户端，连接尝试将失败。
- en: Similarly, connection attempts fail for replicas configured with `MASTER_TLS_VERSION
    = 'TLSv1.1,TLSv1.2'`.
  id: totrans-127
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 同样，对于配置为`MASTER_TLS_VERSION = 'TLSv1.1,TLSv1.2'`的副本，连接尝试将失败。
- en: MySQL permits specifying a list of protocols to support. This list is passed
    directly down to the underlying SSL library and is ultimately up to that library
    what protocols it actually enables from the supplied list. Please refer to the
    MySQL source code and the OpenSSL [`SSL_CTX_new()`](https://www.openssl.org/docs/man1.1.0/ssl/SSL_CTX_new.html)
    documentation for information about how the SSL library handles this.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL允许指定要支持的协议列表。此列表直接传递给底层 SSL 库，最终由该库决定实际启用来自提供的列表的哪些协议。有关 SSL 库处理此操作的信息，请参考
    MySQL 源代码和 OpenSSL [`SSL_CTX_new()`](https://www.openssl.org/docs/man1.1.0/ssl/SSL_CTX_new.html)
    文档。
- en: Monitoring Current Client Session TLS Protocol and Cipher
  id: totrans-129
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 监控当前客户端会话的 TLS 协议和密码
- en: 'To determine which encryption TLS protocol and cipher the current client session
    uses, check the session values of the [`Ssl_version`](server-status-variables.html#statvar_Ssl_version)
    and [`Ssl_cipher`](server-status-variables.html#statvar_Ssl_cipher) status variables:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 要确定当前客户端会话使用的加密 TLS 协议和密码，检查[`Ssl_version`](server-status-variables.html#statvar_Ssl_version)和[`Ssl_cipher`](server-status-variables.html#statvar_Ssl_cipher)状态变量的会话值：
- en: '[PRE13]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: If the connection is not encrypted, both variables have an empty value.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 如果连接未加密，则两个变量的值为空。

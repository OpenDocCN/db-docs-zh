- en: 12.4 Connection Character Sets and Collations
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 12.4 连接字符集和排序规则
- en: 原文：[https://dev.mysql.com/doc/refman/8.0/en/charset-connection.html](https://dev.mysql.com/doc/refman/8.0/en/charset-connection.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://dev.mysql.com/doc/refman/8.0/en/charset-connection.html](https://dev.mysql.com/doc/refman/8.0/en/charset-connection.html)
- en: A “connection” is what a client program makes when it connects to the server,
    to begin a session within which it interacts with the server. The client sends
    SQL statements, such as queries, over the session connection. The server sends
    responses, such as result sets or error messages, over the connection back to
    the client.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: “连接”是客户端程序连接到服务器时建立的会话，通过该会话与服务器进行交互。客户端通过会话连接发送SQL语句，如查询。服务器通过连接向客户端发送响应，如结果集或错误消息。
- en: '[Connection Character Set and Collation System Variables](charset-connection.html#charset-connection-system-variables
    "Connection Character Set and Collation System Variables")'
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[连接字符集和排序规则系统变量](charset-connection.html#charset-connection-system-variables
    "连接字符集和排序规则系统变量")'
- en: '[Impermissible Client Character Sets](charset-connection.html#charset-connection-impermissible-client-charset
    "Impermissible Client Character Sets")'
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[不允许的客户端字符集](charset-connection.html#charset-connection-impermissible-client-charset
    "不允许的客户端字符集")'
- en: '[Client Program Connection Character Set Configuration](charset-connection.html#charset-connection-client-configuration
    "Client Program Connection Character Set Configuration")'
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[客户端程序连接字符集配置](charset-connection.html#charset-connection-client-configuration
    "客户端程序连接字符集配置")'
- en: '[SQL Statements for Connection Character Set Configuration](charset-connection.html#charset-connection-sql-statements
    "SQL Statements for Connection Character Set Configuration")'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[连接字符集配置的SQL语句](charset-connection.html#charset-connection-sql-statements "连接字符集配置的SQL语句")'
- en: '[Connection Character Set Error Handling](charset-connection.html#charset-connection-error-handling
    "Connection Character Set Error Handling")'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[连接字符集错误处理](charset-connection.html#charset-connection-error-handling "连接字符集错误处理")'
- en: Connection Character Set and Collation System Variables
  id: totrans-8
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 连接字符集和排序规则系统变量
- en: 'Several character set and collation system variables relate to a client''s
    interaction with the server. Some of these have been mentioned in earlier sections:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 几个字符集和排序规则系统变量与客户端与服务器的交互相关。其中一些在前面的章节中已经提到：
- en: The [`character_set_server`](server-system-variables.html#sysvar_character_set_server)
    and [`collation_server`](server-system-variables.html#sysvar_collation_server)
    system variables indicate the server character set and collation. See [Section 12.3.2,
    “Server Character Set and Collation”](charset-server.html "12.3.2 Server Character
    Set and Collation").
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`character_set_server`](server-system-variables.html#sysvar_character_set_server)
    和 [`collation_server`](server-system-variables.html#sysvar_collation_server) 系统变量指示服务器的字符集和排序规则。参见
    [第12.3.2节，“服务器字符集和排序规则”](charset-server.html "12.3.2 服务器字符集和排序规则")。'
- en: The [`character_set_database`](server-system-variables.html#sysvar_character_set_database)
    and [`collation_database`](server-system-variables.html#sysvar_collation_database)
    system variables indicate the character set and collation of the default database.
    See [Section 12.3.3, “Database Character Set and Collation”](charset-database.html
    "12.3.3 Database Character Set and Collation").
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`character_set_database`](server-system-variables.html#sysvar_character_set_database)
    和 [`collation_database`](server-system-variables.html#sysvar_collation_database)
    系统变量指示默认数据库的字符集和排序规则。参见 [第12.3.3节，“数据库字符集和排序规则”](charset-database.html "12.3.3
    数据库字符集和排序规则")。'
- en: Additional character set and collation system variables are involved in handling
    traffic for the connection between a client and the server. Every client has session-specific
    connection-related character set and collation system variables. These session
    system variable values are initialized at connect time, but can be changed within
    the session.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 处理客户端与服务器之间连接流量涉及到其他字符集和排序规则系统变量。每个客户端都有特定于会话的连接相关字符集和排序规则系统变量。这些会话系统变量值在连接时初始化，但可以在会话中更改。
- en: 'Several questions about character set and collation handling for client connections
    can be answered in terms of system variables:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 关于客户端连接的字符集和排序规则处理的几个问题可以通过系统变量来回答：
- en: What character set are statements in when they leave the client?
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当语句离开客户端时，它们处于什么字符集？
- en: The server takes the [`character_set_client`](server-system-variables.html#sysvar_character_set_client)
    system variable to be the character set in which statements are sent by the client.
  id: totrans-15
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 服务器将[`character_set_client`](server-system-variables.html#sysvar_character_set_client)系统变量视为客户端发送的语句的字符集。
- en: Note
  id: totrans-16
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 注意
- en: Some character sets cannot be used as the client character set. See [Impermissible
    Client Character Sets](charset-connection.html#charset-connection-impermissible-client-charset
    "Impermissible Client Character Sets").
  id: totrans-17
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 一些字符集不能用作客户端字符集。请参阅[不允许的客户端字符集](charset-connection.html#charset-connection-impermissible-client-charset
    "不允许的客户端字符集")。
- en: What character set should the server translate statements to after receiving
    them?
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器在接收语句后应将其转换为哪种字符集？
- en: 'To determine this, the server uses the [`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)
    and [`collation_connection`](server-system-variables.html#sysvar_collation_connection)
    system variables:'
  id: totrans-19
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 为了确定这一点，服务器使用[`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)和[`collation_connection`](server-system-variables.html#sysvar_collation_connection)系统变量：
- en: 'The server converts statements sent by the client from [`character_set_client`](server-system-variables.html#sysvar_character_set_client)
    to [`character_set_connection`](server-system-variables.html#sysvar_character_set_connection).
    Exception: For string literals that have an introducer such as `_utf8mb4` or `_latin2`,
    the introducer determines the character set. See [Section 12.3.8, “Character Set
    Introducers”](charset-introducer.html "12.3.8 Character Set Introducers").'
  id: totrans-20
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器将客户端发送的语句从[`character_set_client`](server-system-variables.html#sysvar_character_set_client)转换为[`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)。例外：对于具有诸如`_utf8mb4`或`_latin2`之类的引导符的字符串文字，引导符确定字符集。请参阅[第12.3.8节，“字符集引导符”](charset-introducer.html
    "12.3.8 字符集引导符")。
- en: '[`collation_connection`](server-system-variables.html#sysvar_collation_connection)
    is important for comparisons of literal strings. For comparisons of strings with
    column values, [`collation_connection`](server-system-variables.html#sysvar_collation_connection)
    does not matter because columns have their own collation, which has a higher collation
    precedence (see [Section 12.8.4, “Collation Coercibility in Expressions”](charset-collation-coercibility.html
    "12.8.4 Collation Coercibility in Expressions")).'
  id: totrans-21
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`collation_connection`](server-system-variables.html#sysvar_collation_connection)对于文字字符串的比较很重要。对于与列值进行比较的字符串，[`collation_connection`](server-system-variables.html#sysvar_collation_connection)并不重要，因为列有自己的排序规则，其具有更高的排序规则优先级（参见[第12.8.4节，“表达式中的排序规则可强制性”](charset-collation-coercibility.html
    "12.8.4 表达式中的排序规则可强制性")）。'
- en: What character set should the server translate query results to before shipping
    them back to the client?
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器在将查询结果返回给客户端之前应将其转换为哪种字符集？
- en: The [`character_set_results`](server-system-variables.html#sysvar_character_set_results)
    system variable indicates the character set in which the server returns query
    results to the client. This includes result data such as column values, result
    metadata such as column names, and error messages.
  id: totrans-23
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[`character_set_results`](server-system-variables.html#sysvar_character_set_results)系统变量指示服务器将查询结果返回给客户端的字符集。这包括结果数据，如列值，结果元数据，如列名，以及错误消息。'
- en: 'To tell the server to perform no conversion of result sets or error messages,
    set [`character_set_results`](server-system-variables.html#sysvar_character_set_results)
    to `NULL` or `binary`:'
  id: totrans-24
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 要告诉服务器不要对结果集或错误消息进行任何转换，请将[`character_set_results`](server-system-variables.html#sysvar_character_set_results)设置为`NULL`或`binary`：
- en: '[PRE0]'
  id: totrans-25
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: For more information about character sets and error messages, see [Section 12.6,
    “Error Message Character Set”](charset-errors.html "12.6 Error Message Character
    Set").
  id: totrans-26
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 有关字符集和错误消息的更多信息，请参阅[第12.6节，“错误消息字符集”](charset-errors.html "12.6 错误消息字符集")。
- en: 'To see the values of the character set and collation system variables that
    apply to the current session, use this statement:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看适用于当前会话的字符集和排序规则系统变量的值，请使用此语句：
- en: '[PRE1]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The following simpler statements also display the connection variables, but
    include other related variables as well. They can be useful to see *all* character
    set and collation system variables:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 以下更简单的语句也显示连接变量，但同时包括其他相关变量。它们可以用于查看*所有*字符集和排序规则系统变量：
- en: '[PRE2]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Clients can fine-tune the settings for these variables, or depend on the defaults
    (in which case, you can skip the rest of this section). If you do not use the
    defaults, you must change the character settings *for each connection to the server*.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端可以微调这些变量的设置，或依赖默认值（在这种情况下，您可以跳过本节的其余部分）。 如果不使用默认值，则必须为*每个连接到服务器的连接*更改字符设置。
- en: Impermissible Client Character Sets
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 不允许的客户端字符集
- en: 'The [`character_set_client`](server-system-variables.html#sysvar_character_set_client)
    system variable cannot be set to certain character sets:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '[`character_set_client`](server-system-variables.html#sysvar_character_set_client)
    系统变量不能设置为某些字符集：'
- en: '[PRE3]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Attempting to use any of those character sets as the client character set produces
    an error:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试将任何这些字符集用作客户端字符集会产生错误：
- en: '[PRE4]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The same error occurs if any of those character sets are used in the following
    contexts, all of which result in an attempt to set [`character_set_client`](server-system-variables.html#sysvar_character_set_client)
    to the named character set:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在以下情况下使用任何这些字符集，都会发生相同的错误，所有这些情况都会尝试将[`character_set_client`](server-system-variables.html#sysvar_character_set_client)设置为指定的字符集：
- en: The [`--default-character-set=*`charset_name`*`](mysql-command-options.html#option_mysql_default-character-set)
    command option used by MySQL client programs such as [**mysql**](mysql.html "6.5.1 mysql
    — The MySQL Command-Line Client") and [**mysqladmin**](mysqladmin.html "6.5.2 mysqladmin
    — A MySQL Server Administration Program").
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MySQL客户端程序（如[**mysql**](mysql.html "6.5.1 mysql — The MySQL Command-Line Client")和[**mysqladmin**](mysqladmin.html
    "6.5.2 mysqladmin — A MySQL Server Administration Program")）使用的[`--default-character-set=*`charset_name`*`](mysql-command-options.html#option_mysql_default-character-set)
    命令选项。
- en: The [`SET NAMES '*`charset_name`*'`](set-names.html "15.7.6.3 SET NAMES Statement")
    statement.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`SET NAMES ''*`charset_name`*''`](set-names.html "15.7.6.3 SET NAMES Statement")
    语句。'
- en: The [`SET CHARACTER SET '*`charset_name`*'`](set-character-set.html "15.7.6.2 SET
    CHARACTER SET Statement") statement.
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`SET CHARACTER SET ''*`charset_name`*''`](set-character-set.html "15.7.6.2 SET
    CHARACTER SET Statement") 语句。'
- en: Client Program Connection Character Set Configuration
  id: totrans-41
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 客户端程序连接字符集配置
- en: When a client connects to the server, it indicates which character set it wants
    to use for communication with the server. (Actually, the client indicates the
    default collation for that character set, from which the server can determine
    the character set.) The server uses this information to set the [`character_set_client`](server-system-variables.html#sysvar_character_set_client),
    [`character_set_results`](server-system-variables.html#sysvar_character_set_results),
    [`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)
    system variables to the character set, and [`collation_connection`](server-system-variables.html#sysvar_collation_connection)
    to the character set default collation. In effect, the server performs the equivalent
    of a [`SET NAMES`](set-names.html "15.7.6.3 SET NAMES Statement") operation.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 当客户端连接到服务器时，它指示要用于与服务器通信的字符集。 （实际上，客户端指示该字符集的默认排序规则，从中服务器可以确定字符集。）服务器使用此信息将[`character_set_client`](server-system-variables.html#sysvar_character_set_client)、[`character_set_results`](server-system-variables.html#sysvar_character_set_results)、[`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)
    系统变量设置为字符集，并将[`collation_connection`](server-system-variables.html#sysvar_collation_connection)
    设置为字符集的默认排序规则。 实际上，服务器执行了一个等效的[`SET NAMES`](set-names.html "15.7.6.3 SET NAMES
    Statement") 操作。
- en: If the server does not support the requested character set or collation, it
    falls back to using the server character set and collation to configure the connection.
    For additional detail about this fallback behavior, see [Connection Character
    Set Error Handling](charset-connection.html#charset-connection-error-handling
    "Connection Character Set Error Handling").
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 如果服务器不支持请求的字符集或排序规则，它将回退到使用服务器字符集和排序规则来配置连接。有关此回退行为的更多详细信息，请参阅[连接字符集错误处理](charset-connection.html#charset-connection-error-handling
    "Connection Character Set Error Handling")。
- en: 'The [**mysql**](mysql.html "6.5.1 mysql — The MySQL Command-Line Client"),
    [**mysqladmin**](mysqladmin.html "6.5.2 mysqladmin — A MySQL Server Administration
    Program"), [**mysqlcheck**](mysqlcheck.html "6.5.3 mysqlcheck — A Table Maintenance
    Program"), [**mysqlimport**](mysqlimport.html "6.5.5 mysqlimport — A Data Import
    Program"), and [**mysqlshow**](mysqlshow.html "6.5.7 mysqlshow — Display Database,
    Table, and Column Information") client programs determine the default character
    set to use as follows:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '[**mysql**](mysql.html "6.5.1 mysql — MySQL 命令行客户端"), [**mysqladmin**](mysqladmin.html
    "6.5.2 mysqladmin — MySQL 服务器管理程序"), [**mysqlcheck**](mysqlcheck.html "6.5.3 mysqlcheck
    — 表维护程序"), [**mysqlimport**](mysqlimport.html "6.5.5 mysqlimport — 数据导入程序"), 和
    [**mysqlshow**](mysqlshow.html "6.5.7 mysqlshow — 显示数据库、表和列信息") 客户端程序确定要使用的默认字符集如下：'
- en: In the absence of other information, each client uses the compiled-in default
    character set, usually `utf8mb4`.
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在没有其他信息的情况下，每个客户端使用编译时的默认字符集，通常为`utf8mb4`。
- en: Each client can autodetect which character set to use based on the operating
    system setting, such as the value of the `LANG` or `LC_ALL` locale environment
    variable on Unix systems or the code page setting on Windows systems. For systems
    on which the locale is available from the OS, the client uses it to set the default
    character set rather than using the compiled-in default. For example, setting
    `LANG` to `ru_RU.KOI8-R` causes the `koi8r` character set to be used. Thus, users
    can configure the locale in their environment for use by MySQL clients.
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个客户端可以根据操作系统设置自动检测要使用的字符集，例如在 Unix 系统上的`LANG`或`LC_ALL`区域设置环境变量的值，或 Windows
    系统上的代码页设置。对于从操作系统获取区域设置的系统，客户端使用它来设置默认字符集，而不是使用编译时的默认值。例如，将`LANG`设置为`ru_RU.KOI8-R`会导致使用`koi8r`字符集。因此，用户可以配置其环境中的区域设置供
    MySQL 客户端使用。
- en: The OS character set is mapped to the closest MySQL character set if there is
    no exact match. If the client does not support the matching character set, it
    uses the compiled-in default. For example, `utf8` and `utf-8` map to `utf8mb4`,
    and `ucs2` is not supported as a connection character set, so it maps to the compiled-in
    default.
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果没有完全匹配，操作系统字符集将映射到最接近的 MySQL 字符集。如果客户端不支持匹配的字符集，则使用编译时的默认值。例如，`utf8`和`utf-8`映射到`utf8mb4`，而`ucs2`不支持作为连接字符集，因此映射到编译时的默认值。
- en: 'C applications can use character set autodetection based on the OS setting
    by invoking [`mysql_options()`](/doc/c-api/8.0/en/mysql-options.html) as follows
    before connecting to the server:'
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: C 应用程序可以根据操作系统设置使用字符集自动检测，方法是在连接到服务器之前调用[`mysql_options()`](/doc/c-api/8.0/en/mysql-options.html)如下：
- en: '[PRE5]'
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Each client supports a [`--default-character-set`](mysql-command-options.html#option_mysql_default-character-set)
    option, which enables users to specify the character set explicitly to override
    whatever default the client otherwise determines.
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个客户端支持[`--default-character-set`](mysql-command-options.html#option_mysql_default-character-set)选项，允许用户显式指定字符集以覆盖客户端否则确定的默认值。
- en: Note
  id: totrans-51
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 注意
- en: Some character sets cannot be used as the client character set. Attempting to
    use them with [`--default-character-set`](mysql-command-options.html#option_mysql_default-character-set)
    produces an error. See [Impermissible Client Character Sets](charset-connection.html#charset-connection-impermissible-client-charset
    "Impermissible Client Character Sets").
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 有些字符集不能用作客户端字符集。尝试使用它们与[`--default-character-set`](mysql-command-options.html#option_mysql_default-character-set)会产生错误。参见[不允许的客户端字符集](charset-connection.html#charset-connection-impermissible-client-charset
    "不允许的客户端字符集")。
- en: 'With the [**mysql**](mysql.html "6.5.1 mysql — The MySQL Command-Line Client")
    client, to use a character set different from the default, you could explicitly
    execute a [`SET NAMES`](set-names.html "15.7.6.3 SET NAMES Statement") statement
    every time you connect to the server (see [Client Program Connection Character
    Set Configuration](charset-connection.html#charset-connection-client-configuration
    "Client Program Connection Character Set Configuration")). To accomplish the same
    result more easily, specify the character set in your option file. For example,
    the following option file setting changes the three connection-related character
    set system variables set to `koi8r` each time you invoke [**mysql**](mysql.html
    "6.5.1 mysql — The MySQL Command-Line Client"):'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 使用[**mysql**](mysql.html "6.5.1 mysql — The MySQL Command-Line Client")客户端，如果要使用与默认字符集不同的字符集，您可以在每次连接到服务器时显式执行一个[`SET
    NAMES`](set-names.html "15.7.6.3 SET NAMES Statement")语句（参见[客户端程序连接字符集配置](charset-connection.html#charset-connection-client-configuration
    "客户端程序连接字符集配置")）。为了更轻松地实现相同的结果，可以在选项文件中指定字符集。例如，以下选项文件设置在每次调用[**mysql**](mysql.html
    "6.5.1 mysql — The MySQL Command-Line Client")时将三个与连接相关的字符集系统变量设置为`koi8r`：
- en: '[PRE6]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'If you are using the [**mysql**](mysql.html "6.5.1 mysql — The MySQL Command-Line
    Client") client with auto-reconnect enabled (which is not recommended), it is
    preferable to use the `charset` command rather than [`SET NAMES`](set-names.html
    "15.7.6.3 SET NAMES Statement"). For example:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您正在使用启用了自动重新连接的[**mysql**](mysql.html "6.5.1 mysql — The MySQL Command-Line
    Client")客户端（不建议），最好使用`charset`命令而不是[`SET NAMES`](set-names.html "15.7.6.3 SET
    NAMES Statement")。例如：
- en: '[PRE7]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The `charset` command issues a [`SET NAMES`](set-names.html "15.7.6.3 SET NAMES
    Statement") statement, and also changes the default character set that [**mysql**](mysql.html
    "6.5.1 mysql — The MySQL Command-Line Client") uses when it reconnects after the
    connection has dropped.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '`charset`命令发出一个[`SET NAMES`](set-names.html "15.7.6.3 SET NAMES Statement")语句，并在连接断开后重新连接时更改[**mysql**](mysql.html
    "6.5.1 mysql — The MySQL Command-Line Client")使用的默认字符集。'
- en: When configuration client programs, you must also consider the environment within
    which they execute. See [Section 12.5, “Configuring Application Character Set
    and Collation”](charset-applications.html "12.5 Configuring Application Character
    Set and Collation").
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置客户端程序时，还必须考虑它们执行的环境。参见[第12.5节，“配置应用程序字符集和排序规则”](charset-applications.html
    "12.5 配置应用程序字符集和排序规则")。
- en: SQL Statements for Connection Character Set Configuration
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 用于连接字符集配置的SQL语句
- en: 'After a connection has been established, clients can change the character set
    and collation system variables for the current session. These variables can be
    changed individually using [`SET`](set-statement.html "15.7.6 SET Statements")
    statements, but two more convenient statements affect the connection-related character
    set system variables as a group:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 建立连接后，客户端可以为当前会话更改字符集和排序规则系统变量。这些变量可以使用[`SET`](set-statement.html "15.7.6 SET
    Statements")语句单独更改，但另外两个更方便的语句会作为一组影响与连接相关的字符集系统变量：
- en: '`SET NAMES ''*`charset_name`*'' [COLLATE ''*`collation_name`*'']`'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`SET NAMES ''*`charset_name`*'' [COLLATE ''*`collation_name`*'']`'
- en: '[`SET NAMES`](set-names.html "15.7.6.3 SET NAMES Statement") indicates what
    character set the client uses to send SQL statements to the server. Thus, [`SET
    NAMES ''cp1251''`](set-names.html "15.7.6.3 SET NAMES Statement") tells the server,
    “future incoming messages from this client are in character set `cp1251`.” It
    also specifies the character set that the server should use for sending results
    back to the client. (For example, it indicates what character set to use for column
    values if you use a [`SELECT`](select.html "15.2.13 SELECT Statement") statement
    that produces a result set.)'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[`SET NAMES`](set-names.html "15.7.6.3 SET NAMES Statement")指示客户端用于向服务器发送SQL语句的字符集。因此，[`SET
    NAMES ''cp1251''`](set-names.html "15.7.6.3 SET NAMES Statement")告诉服务器，“来自此客户端的未来传入消息使用字符集`cp1251`。”它还指定服务器在将结果发送回客户端时应使用的字符集。（例如，如果使用产生结果集的[`SELECT`](select.html
    "15.2.13 SELECT Statement")语句，则指定用于列值的字符集。）'
- en: 'A [`SET NAMES ''*`charset_name`*''`](set-names.html "15.7.6.3 SET NAMES Statement")
    statement is equivalent to these three statements:'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 一个[`SET NAMES '*`charset_name`*'`](set-names.html "15.7.6.3 SET NAMES Statement")语句等同于这三个语句：
- en: '[PRE8]'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Setting [`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)
    to *`charset_name`* also implicitly sets [`collation_connection`](server-system-variables.html#sysvar_collation_connection)
    to the default collation for *`charset_name`*. It is unnecessary to set that collation
    explicitly. To specify a particular collation to use for [`collation_connection`](server-system-variables.html#sysvar_collation_connection),
    add a `COLLATE` clause:'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 将[`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)设置为*`charset_name`*也会隐式地将[`collation_connection`](server-system-variables.html#sysvar_collation_connection)设置为*`charset_name`*的默认排序规则。不需要显式设置该排序规则。要指定用于[`collation_connection`](server-system-variables.html#sysvar_collation_connection)的特定排序规则，请添加`COLLATE`子句：
- en: '[PRE9]'
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '`SET CHARACTER SET ''*`charset_name`*`'''
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`SET CHARACTER SET ''*`charset_name`*''`'
- en: '[`SET CHARACTER SET`](set-character-set.html "15.7.6.2 SET CHARACTER SET Statement")
    is similar to [`SET NAMES`](set-names.html "15.7.6.3 SET NAMES Statement") but
    sets [`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)
    and [`collation_connection`](server-system-variables.html#sysvar_collation_connection)
    to [`character_set_database`](server-system-variables.html#sysvar_character_set_database)
    and [`collation_database`](server-system-variables.html#sysvar_collation_database)
    (which, as mentioned previously, indicate the character set and collation of the
    default database).'
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[`SET CHARACTER SET`](set-character-set.html "15.7.6.2 SET CHARACTER SET Statement")类似于[`SET
    NAMES`](set-names.html "15.7.6.3 SET NAMES Statement")，但将[`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)和[`collation_connection`](server-system-variables.html#sysvar_collation_connection)设置为[`character_set_database`](server-system-variables.html#sysvar_character_set_database)和[`collation_database`](server-system-variables.html#sysvar_collation_database)（如前所述，指示默认数据库的字符集和排序规则）。'
- en: 'A [`SET CHARACTER SET *`charset_name`*`](set-character-set.html "15.7.6.2 SET
    CHARACTER SET Statement") statement is equivalent to these three statements:'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[`SET CHARACTER SET *`charset_name`*`](set-character-set.html "15.7.6.2 SET
    CHARACTER SET Statement")语句等同于这三个语句：'
- en: '[PRE10]'
  id: totrans-70
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Setting [`collation_connection`](server-system-variables.html#sysvar_collation_connection)
    also implicitly sets [`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)
    to the character set associated with the collation (equivalent to executing `SET
    character_set_connection = @@character_set_database`). It is unnecessary to set
    [`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)
    explicitly.
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 设置[`collation_connection`](server-system-variables.html#sysvar_collation_connection)也会隐式地将[`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)设置为与排序规则相关联的字符集（等同于执行`SET
    character_set_connection = @@character_set_database`）。不需要显式设置[`character_set_connection`](server-system-variables.html#sysvar_character_set_connection)。
- en: Note
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Some character sets cannot be used as the client character set. Attempting to
    use them with [`SET NAMES`](set-names.html "15.7.6.3 SET NAMES Statement") or
    [`SET CHARACTER SET`](set-character-set.html "15.7.6.2 SET CHARACTER SET Statement")
    produces an error. See [Impermissible Client Character Sets](charset-connection.html#charset-connection-impermissible-client-charset
    "Impermissible Client Character Sets").
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 有些字符集不能作为客户端字符集使用。尝试在[`SET NAMES`](set-names.html "15.7.6.3 SET NAMES Statement")或[`SET
    CHARACTER SET`](set-character-set.html "15.7.6.2 SET CHARACTER SET Statement")中使用它们会产生错误。请参阅[不允许的客户端字符集](charset-connection.html#charset-connection-impermissible-client-charset
    "不允许的客户端字符集")。
- en: 'Example: Suppose that `column1` is defined as `CHAR(5) CHARACTER SET latin2`.
    If you do not say [`SET NAMES`](set-names.html "15.7.6.3 SET NAMES Statement")
    or [`SET CHARACTER SET`](set-character-set.html "15.7.6.2 SET CHARACTER SET Statement"),
    then for `SELECT column1 FROM t`, the server sends back all the values for `column1`
    using the character set that the client specified when it connected. On the other
    hand, if you say `SET NAMES ''latin1''` or `SET CHARACTER SET ''latin1''` before
    issuing the [`SELECT`](select.html "15.2.13 SELECT Statement") statement, the
    server converts the `latin2` values to `latin1` just before sending results back.
    Conversion may be lossy for characters that are not in both character sets.'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：假设`column1`定义为`CHAR(5) CHARACTER SET latin2`。如果不在发出`SELECT column1 FROM t`之前说[`SET
    NAMES`](set-names.html "15.7.6.3 SET NAMES Statement")或[`SET CHARACTER SET`](set-character-set.html
    "15.7.6.2 SET CHARACTER SET Statement")，那么服务器会使用客户端连接时指定的字符集发送`column1`的所有值。另一方面，如果在发出[`SELECT`](select.html
    "15.2.13 SELECT Statement")语句之前说`SET NAMES 'latin1'`或`SET CHARACTER SET 'latin1'`，服务器会在发送结果之前将`latin2`值转换为`latin1`。对于不在两个字符集中的字符，转换可能会有损失。
- en: Connection Character Set Error Handling
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 连接字符集错误处理
- en: Attempts to use an inappropriate connection character set or collation can produce
    an error, or cause the server to fall back to its default character set and collation
    for a given connection. This section describes problems that can occur when configuring
    the connection character set. These problems can occur when establishing a connection
    or when changing the character set within an established connection.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试使用不合适的连接字符集或排序规则可能会产生错误，或导致服务器回退到给定连接的默认字符集和排序规则。本节描述了在配置连接字符集时可能出现的问题。这些问题可能在建立连接时或在已建立连接中更改字符集时发生。
- en: '[Connect-Time Error Handling](charset-connection.html#charset-connection-error-handling-connect-time
    "Connect-Time Error Handling")'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[连接时错误处理](charset-connection.html#charset-connection-error-handling-connect-time
    "连接时错误处理")'
- en: '[Runtime Error Handling](charset-connection.html#charset-connection-error-handling-runtime
    "Runtime Error Handling")'
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[运行时错误处理](charset-connection.html#charset-connection-error-handling-runtime
    "运行时错误处理")'
- en: Connect-Time Error Handling
  id: totrans-79
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 连接时错误处理
- en: 'Some character sets cannot be used as the client character set; see [Impermissible
    Client Character Sets](charset-connection.html#charset-connection-impermissible-client-charset
    "Impermissible Client Character Sets"). If you specify a character set that is
    valid but not permitted as a client character set, the server returns an error:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 一些字符集不能用作客户端字符集；参见[不允许的客户端字符集](charset-connection.html#charset-connection-impermissible-client-charset
    "不允许的客户端字符集")。如果指定了一个有效但不允许作为客户端字符集的字符集，服务器会返回一个错误：
- en: '[PRE11]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'If you specify a character set that the client does not recognize, it produces
    an error:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 如果指定了客户端不认识的字符集，会产生错误：
- en: '[PRE12]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'If you specify a character set that the client recognizes but the server does
    not, the server falls back to its default character set and collation. Suppose
    that the server is configured to use `latin1` and `latin1_swedish_ci` as its defaults,
    and that it does not recognize `gb18030` as a valid character set. A client that
    specifies [`--default-character-set=gb18030`](mysql-command-options.html#option_mysql_default-character-set)
    is able to connect to the server, but the resulting character set is not what
    the client wants:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 如果指定了客户端识别但服务器不识别的字符集，服务器会回退到其默认字符集和排序规则。假设服务器配置为使用`latin1`和`latin1_swedish_ci`作为默认值，并且不认识`gb18030`作为有效字符集。指定[`--default-character-set=gb18030`](mysql-command-options.html#option_mysql_default-character-set)的客户端可以连接到服务器，但结果的字符集不是客户端想要的：
- en: '[PRE13]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: You can see that the connection system variables have been set to reflect a
    character set and collation of `latin1` and `latin1_swedish_ci`. This occurs because
    the server cannot satisfy the client character set request and falls back to its
    defaults.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以看到连接系统变量已设置为反映`latin1`和`latin1_swedish_ci`的字符集和排序规则。这是因为服务器无法满足客户端字符集请求并回退到其默认值。
- en: In this case, the client cannot use the character set that it wants because
    the server does not support it. The client must either be willing to use a different
    character set, or connect to a different server that supports the desired character
    set.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，客户端无法使用它想要的字符集，因为服务器不支持。客户端必须要么愿意使用不同的字符集，要么连接到支持所需字符集的不同服务器。
- en: 'The same problem occurs in a more subtle context: When the client tells the
    server to use a character set that the server recognizes, but the default collation
    for that character set on the client side is not known on the server side. This
    occurs, for example, when a MySQL 8.0 client wants to connect to a MySQL 5.7 server
    using `utf8mb4` as the client character set. A client that specifies [`--default-character-set=utf8mb4`](mysql-command-options.html#option_mysql_default-character-set)
    is able to connect to the server. However, as in the previous example, the server
    falls back to its default character set and collation, not what the client requested:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 在更微妙的情况下也会出现相同的问题：当客户端告诉服务器使用服务器识别的字符集，但客户端端默认排序规则在服务器端是未知的。例如，当一个 MySQL 8.0
    客户端想要使用`utf8mb4`作为客户端字符集连接到 MySQL 5.7 服务器时，就会出现这种情况。指定[`--default-character-set=utf8mb4`](mysql-command-options.html#option_mysql_default-character-set)的客户端可以连接到服务器。然而，与前面的例子一样，服务器会回退到其默认字符集和排序规则，而不是客户端请求的内容：
- en: '[PRE14]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Why does this occur? After all, `utf8mb4` is known to the 8.0 client and the
    5.7 server, so both of them recognize it. To understand this behavior, it is necessary
    to understand that when the client tells the server which character set it wants
    to use, it really tells the server the default collation for that character set.
    Therefore, the aforementioned behavior occurs due to a combination of factors:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么会发生这种情况？毕竟，`utf8mb4` 是 8.0 客户端和 5.7 服务器都知道的，所以它们都识别它。要理解这种行为，有必要了解当客户端告诉服务器它想要使用哪种字符集时，实际上是告诉服务器该字符集的默认排序规则。因此，上述行为是由多种因素的组合造成的：
- en: The default collation for `utf8mb4` differs between MySQL 5.7 and 8.0 (`utf8mb4_general_ci`
    for 5.7, `utf8mb4_0900_ai_ci` for 8.0).
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`utf8mb4` 的默认排序规则在 MySQL 5.7 和 8.0 之间不同（5.7 为 `utf8mb4_general_ci`，8.0 为 `utf8mb4_0900_ai_ci`）。'
- en: When the 8.0 client requests a character set of `utf8mb4`, what it sends to
    the server is the default 8.0 `utf8mb4` collation; that is, the `utf8mb4_0900_ai_ci`.
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当 8.0 客户端请求一个字符集为 `utf8mb4` 时，发送给服务器的是默认的 8.0 `utf8mb4` 排序规则；即 `utf8mb4_0900_ai_ci`。
- en: '`utf8mb4_0900_ai_ci` is implemented only as of MySQL 8.0, so the 5.7 server
    does not recognize it.'
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`utf8mb4_0900_ai_ci` 仅在 MySQL 8.0 中实现，因此 5.7 服务器不识别它。'
- en: Because the 5.7 server does not recognize `utf8mb4_0900_ai_ci`, it cannot satisfy
    the client character set request, and falls back to its default character set
    and collation (`latin1` and `latin1_swedish_ci`).
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于 5.7 服务器不识别 `utf8mb4_0900_ai_ci`，无法满足客户端字符集请求，因此回退到其默认字符集和排序规则（`latin1` 和
    `latin1_swedish_ci`）。
- en: In this case, the client can still use `utf8mb4` by issuing a `SET NAMES 'utf8mb4'`
    statement after connecting. The resulting collation is the 5.7 default `utf8mb4`
    collation; that is, `utf8mb4_general_ci`. If the client additionally wants a collation
    of `utf8mb4_0900_ai_ci`, it cannot achieve that because the server does not recognize
    that collation. The client must either be willing to use a different `utf8mb4`
    collation, or connect to a server from MySQL 8.0 or higher.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，客户端仍然可以在连接后发出 `SET NAMES 'utf8mb4'` 语句来使用 `utf8mb4`。结果的排序规则是 5.7 默认的
    `utf8mb4` 排序规则；即 `utf8mb4_general_ci`。如果客户端还想要 `utf8mb4_0900_ai_ci` 的排序规则，由于服务器不识别该排序规则，无法实现。客户端必须要么愿意使用不同的
    `utf8mb4` 排序规则，要么连接到 MySQL 8.0 或更高版本的服务器。
- en: Runtime Error Handling
  id: totrans-96
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 运行时错误处理
- en: Within an established connection, the client can request a change of connection
    character set and collation with [`SET NAMES`](set-names.html "15.7.6.3 SET NAMES
    Statement") or [`SET CHARACTER SET`](set-character-set.html "15.7.6.2 SET CHARACTER
    SET Statement").
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在已建立的连接中，客户端可以通过 [`SET NAMES`](set-names.html "15.7.6.3 SET NAMES 语句") 或 [`SET
    CHARACTER SET`](set-character-set.html "15.7.6.2 SET CHARACTER SET 语句") 请求更改连接字符集和排序规则。
- en: 'Some character sets cannot be used as the client character set; see [Impermissible
    Client Character Sets](charset-connection.html#charset-connection-impermissible-client-charset
    "Impermissible Client Character Sets"). If you specify a character set that is
    valid but not permitted as a client character set, the server returns an error:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 一些字符集不能用作客户端字符集；请参阅[不允许的客户端字符集](charset-connection.html#charset-connection-impermissible-client-charset
    "不允许的客户端字符集")。如果指定了一个有效但不允许作为客户端字符集的字符集，服务器会返回一个错误：
- en: '[PRE15]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'If the server does not recognize the character set (or the collation), it produces
    an error:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 如果服务器不识别字符集（或排序规则），则会产生错误：
- en: '[PRE16]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Tip
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 提示
- en: 'A client that wants to verify whether its requested character set was honored
    by the server can execute the following statement after connecting and checking
    that the result is the expected character set:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 一个想要验证服务器是否接受其请求的字符集的客户端可以在连接后执行以下语句，并检查结果是否是预期的字符集：
- en: '[PRE17]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'

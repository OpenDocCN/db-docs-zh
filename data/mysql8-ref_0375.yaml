- en: 8.2.15 Password Management
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 8.2.15 密码管理
- en: 原文：[https://dev.mysql.com/doc/refman/8.0/en/password-management.html](https://dev.mysql.com/doc/refman/8.0/en/password-management.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://dev.mysql.com/doc/refman/8.0/en/password-management.html](https://dev.mysql.com/doc/refman/8.0/en/password-management.html)
- en: 'MySQL supports these password-management capabilities:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL支持这些密码管理功能：
- en: Password expiration, to require passwords to be changed periodically.
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密码过期，要求定期更改密码。
- en: Password reuse restrictions, to prevent old passwords from being chosen again.
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密码重用限制，防止选择旧密码。
- en: Password verification, to require that password changes also specify the current
    password to be replaced.
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密码验证，要求密码更改时也需指定要替换的当前密码。
- en: Dual passwords, to enable clients to connect using either a primary or secondary
    password.
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 双密码，使客户端能够使用主密码或辅助密码连接。
- en: Password strength assessment, to require strong passwords.
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密码强度评估，要求使用强密码。
- en: Random password generation, as an alternative to requiring explicit administrator-specified
    literal passwords.
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 随机密码生成，作为要求明确管理员指定文字密码的替代方案。
- en: Password failure tracking, to enable temporary account locking after too many
    consecutive incorrect-password login failures.
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 密码失败跟踪，以在连续太多次密码错误登录失败后启用临时帐户锁定。
- en: The following sections describe these capabilities, except password strength
    assessment, which is implemented using the `validate_password` component and is
    described in [Section 8.4.3, “The Password Validation Component”](validate-password.html
    "8.4.3 The Password Validation Component").
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 以下各节描述了这些功能，除了密码强度评估，该功能使用`validate_password`组件实现，并在[第8.4.3节，“密码验证组件”](validate-password.html
    "8.4.3 The Password Validation Component")中进行了描述。
- en: '[Internal Versus External Credentials Storage](password-management.html#internal-versus-external-credentials
    "Internal Versus External Credentials Storage")'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[内部与外部凭据存储](password-management.html#internal-versus-external-credentials "内部与外部凭据存储")'
- en: '[Password Expiration Policy](password-management.html#password-expiration-policy
    "Password Expiration Policy")'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[密码过期策略](password-management.html#password-expiration-policy "密码过期策略")'
- en: '[Password Reuse Policy](password-management.html#password-reuse-policy "Password
    Reuse Policy")'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[密码重用策略](password-management.html#password-reuse-policy "密码重用策略")'
- en: '[Password Verification-Required Policy](password-management.html#password-reverification-policy
    "Password Verification-Required Policy")'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[密码验证要求策略](password-management.html#password-reverification-policy "密码验证要求策略")'
- en: '[Dual Password Support](password-management.html#dual-passwords "Dual Password
    Support")'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[双密码支持](password-management.html#dual-passwords "双密码支持")'
- en: '[Random Password Generation](password-management.html#random-password-generation
    "Random Password Generation")'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[随机密码生成](password-management.html#random-password-generation "随机密码生成")'
- en: '[Failed-Login Tracking and Temporary Account Locking](password-management.html#failed-login-tracking
    "Failed-Login Tracking and Temporary Account Locking")'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[登录失败跟踪和临时帐户锁定](password-management.html#failed-login-tracking "登录失败跟踪和临时帐户锁定")'
- en: Important
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 重要
- en: 'MySQL implements password-management capabilities using tables in the `mysql`
    system database. If you upgrade MySQL from an earlier version, your system tables
    might not be up to date. In that case, the server writes messages similar to these
    to the error log during the startup process (the exact numbers may vary):'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL使用`mysql`系统数据库中的表来实现密码管理功能。如果您从早期版本升级MySQL，则您的系统表可能不是最新的。在这种情况下，服务器在启动过程中写入类似以下的错误日志消息（确切的数字可能有所不同）：
- en: '[PRE0]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: To correct the issue, perform the MySQL upgrade procedure. See [Chapter 3, *Upgrading
    MySQL*](upgrading.html "Chapter 3 Upgrading MySQL"). Until this is done, *password
    changes are not possible.*
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 要纠正此问题，请执行MySQL升级过程。请参阅[第3章，*升级MySQL*](upgrading.html "第3章 升级MySQL")。在此之前，*无法更改密码*。
- en: Internal Versus External Credentials Storage
  id: totrans-22
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 内部与外部凭据存储
- en: 'Some authentication plugins store account credentials internally to MySQL,
    in the `mysql.user` system table:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 一些认证插件将帐户凭据存储在MySQL内部，存储在`mysql.user`系统表中：
- en: '`mysql_native_password`'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mysql_native_password`'
- en: '`caching_sha2_password`'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`caching_sha2_password`'
- en: '`sha256_password`'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sha256_password`'
- en: Most discussion in this section applies to such authentication plugins because
    most password-management capabilities described here are based on internal credentials
    storage handled by MySQL itself. Other authentication plugins store account credentials
    externally to MySQL. For accounts that use plugins that perform authentication
    against an external credentials system, password management must be handled externally
    against that system as well.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 本节中的大部分讨论适用于这些认证插件，因为这里描述的大多数密码管理功能都是基于MySQL本身处理的内部凭据存储。其他认证插件将账户凭据存储在MySQL之外。对于使用针对外部凭据系统执行认证的插件的账户，密码管理也必须在该系统外部处理。
- en: The exception is that the options for failed-login tracking and temporary account
    locking apply to all accounts, not just accounts that use internal credentials
    storage, because MySQL is able to assess the status of login attempts for any
    account no matter whether it uses internal or external credentials storage.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 例外情况是，对于所有账户，而不仅仅是使用内部凭据存储的账户，失败登录跟踪和临时账户锁定选项都适用，因为MySQL能够评估任何账户的登录尝试状态，无论它使用内部还是外部凭据存储。
- en: For information about individual authentication plugins, see [Section 8.4.1,
    “Authentication Plugins”](authentication-plugins.html "8.4.1 Authentication Plugins").
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 有关各个认证插件的信息，请参见[第8.4.1节，“认证插件”](authentication-plugins.html "8.4.1 认证插件")。
- en: Password Expiration Policy
  id: totrans-30
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 密码过期策略
- en: MySQL enables database administrators to expire account passwords manually,
    and to establish a policy for automatic password expiration. Expiration policy
    can be established globally, and individual accounts can be set to either defer
    to the global policy or override the global policy with specific per-account behavior.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL使数据库管理员能够手动使账户密码过期，并建立自动密码过期策略。过期策略可以在全局范围内建立，并且可以设置个别账户要么遵循全局策略，要么使用特定的每个账户行为覆盖全局策略。
- en: 'To expire an account password manually, use the [`ALTER USER`](alter-user.html
    "15.7.1.1 ALTER USER Statement") statement:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 要手动使账户密码过期，请使用[`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER语句")语句：
- en: '[PRE1]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: This operation marks the password expired in the corresponding row in the `mysql.user`
    system table.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 此操作会在`mysql.user`系统表中的相应行中标记密码过期。
- en: Password expiration according to policy is automatic and is based on password
    age, which for a given account is assessed from the date and time of its most
    recent password change. The `mysql.user` system table indicates for each account
    when its password was last changed, and the server automatically treats the password
    as expired at client connection time if its age is greater than its permitted
    lifetime. This works with no explicit manual password expiration.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 根据策略，密码过期是自动的，并且基于密码的年龄，对于给定账户，从其最近更改密码的日期和时间进行评估。`mysql.user`系统表指示每个账户的密码上次更改的时间，并且如果其年龄大于其允许的寿命，则服务器会在客户端连接时自动将密码视为过期。这可以在没有明确手动密码过期的情况下工作。
- en: To establish automatic password-expiration policy globally, use the [`default_password_lifetime`](server-system-variables.html#sysvar_default_password_lifetime)
    system variable. Its default value is 0, which disables automatic password expiration.
    If the value of [`default_password_lifetime`](server-system-variables.html#sysvar_default_password_lifetime)
    is a positive integer *`N`*, it indicates the permitted password lifetime, such
    that passwords must be changed every *`N`* days.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 要在全局范围内建立自动密码过期策略，请使用[`default_password_lifetime`](server-system-variables.html#sysvar_default_password_lifetime)系统变量。其默认值为0，这将禁用自动密码过期。如果[`default_password_lifetime`](server-system-variables.html#sysvar_default_password_lifetime)的值是正整数*`N`*，则表示允许的密码寿命，即密码必须每*`N`*天更改一次。
- en: 'Examples:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 示例：
- en: 'To establish a global policy that passwords have a lifetime of approximately
    six months, start the server with these lines in a server `my.cnf` file:'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要建立一个全局策略，使密码的寿命约为六个月，请在服务器的`my.cnf`文件中添加以下行：
- en: '[PRE2]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'To establish a global policy such that passwords never expire, set [`default_password_lifetime`](server-system-variables.html#sysvar_default_password_lifetime)
    to 0:'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要建立一个全局策略，使密码永不过期，请将[`default_password_lifetime`](server-system-variables.html#sysvar_default_password_lifetime)设置为0：
- en: '[PRE3]'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '[`default_password_lifetime`](server-system-variables.html#sysvar_default_password_lifetime)
    can also be set and persisted at runtime:'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`default_password_lifetime`](server-system-variables.html#sysvar_default_password_lifetime)也可以在运行时设置和持久化：'
- en: '[PRE4]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '[`SET PERSIST`](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment")
    sets a value for the running MySQL instance. It also saves the value to carry
    over to subsequent server restarts; see [Section 15.7.6.1, “SET Syntax for Variable
    Assignment”](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment").
    To change the value for the running MySQL instance without having it carry over
    to subsequent restarts, use the `GLOBAL` keyword rather than `PERSIST`.'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[`SET PERSIST`](set-variable.html "15.7.6.1 变量赋值的 SET 语法") 为正在运行的 MySQL 实例设置一个值。它还保存该值以便在后续服务器重启时继续使用；参见
    [Section 15.7.6.1, “变量赋值的 SET 语法”](set-variable.html "15.7.6.1 变量赋值的 SET 语法")。要更改正在运行的
    MySQL 实例的值，而不希望其在后续重启时继续使用，使用 `GLOBAL` 关键字而不是 `PERSIST`。'
- en: The global password-expiration policy applies to all accounts that have not
    been set to override it. To establish policy for individual accounts, use the
    `PASSWORD EXPIRE` option of the [`CREATE USER`](create-user.html "15.7.1.3 CREATE
    USER Statement") and [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement")
    statements. See [Section 15.7.1.3, “CREATE USER Statement”](create-user.html "15.7.1.3 CREATE
    USER Statement"), and [Section 15.7.1.1, “ALTER USER Statement”](alter-user.html
    "15.7.1.1 ALTER USER Statement").
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 全局密码过期策略适用于未设置为覆盖它的所有帐户。要为单个帐户建立策略，请使用 [`CREATE USER`](create-user.html "15.7.1.3 CREATE
    USER 语句") 和 [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER 语句") 语句的 `PASSWORD
    EXPIRE` 选项。参见 [Section 15.7.1.3, “CREATE USER 语句”](create-user.html "15.7.1.3 CREATE
    USER 语句")，以及 [Section 15.7.1.1, “ALTER USER 语句”](alter-user.html "15.7.1.1 ALTER
    USER 语句")。
- en: 'Example account-specific statements:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 示例特定帐户语句：
- en: 'Require the password to be changed every 90 days:'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要求每 90 天更改一次密码：
- en: '[PRE5]'
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: This expiration option overrides the global policy for all accounts named by
    the statement.
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此过期选项会覆盖语句指定的所有帐户的全局策略。
- en: 'Disable password expiration:'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 禁用密码过期：
- en: '[PRE6]'
  id: totrans-51
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: This expiration option overrides the global policy for all accounts named by
    the statement.
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此过期选项会覆盖语句指定的所有帐户的全局策略。
- en: 'Defer to the global expiration policy for all accounts named by the statement:'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 延迟到语句指定的所有帐户的全局过期策略：
- en: '[PRE7]'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'When a client successfully connects, the server determines whether the account
    password has expired:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 当客户端成功连接时，服务器会确定帐户密码是否已过期：
- en: The server checks whether the password has been manually expired.
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器会检查密码是否已手动过期。
- en: Otherwise, the server checks whether the password age is greater than its permitted
    lifetime according to the automatic password expiration policy. If so, the server
    considers the password expired.
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 否则，服务器会检查密码的年龄是否超过根据自动密码过期策略允许的寿命。如果是，则服务器会将密码视为过期。
- en: 'If the password is expired (whether manually or automatically), the server
    either disconnects the client or restricts the operations permitted to it (see
    [Section 8.2.16, “Server Handling of Expired Passwords”](expired-password-handling.html
    "8.2.16 Server Handling of Expired Passwords")). Operations performed by a restricted
    client result in an error until the user establishes a new account password:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 如果密码已过期（无论是手动还是自动），服务器要么断开客户端连接，要么限制其允许的操作（参见 [Section 8.2.16, “过期密码的服务器处理”](expired-password-handling.html
    "8.2.16 过期密码的服务器处理")）。受限客户端执行的操作会导致错误，直到用户建立新的帐户密码：
- en: '[PRE8]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: After the client resets the password, the server restores normal access for
    the session, as well as for subsequent connections that use the account. It is
    also possible for an administrative user to reset the account password, but any
    existing restricted sessions for that account remain restricted. A client using
    the account must disconnect and reconnect before statements can be executed successfully.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端重置密码后，服务器将为该会话以及使用该帐户的后续连接恢复正常访问。管理员用户也可以重置帐户密码，但该帐户的任何现有受限会话仍然受限。在执行语句成功之前，使用该帐户的客户端必须断开连接并重新连接。
- en: Note
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Although it is possible to “reset” an expired password by setting it to its
    current value, it is preferable, as a matter of good policy, to choose a different
    password. DBAs can enforce non-reuse by establishing an appropriate password-reuse
    policy. See [Password Reuse Policy](password-management.html#password-reuse-policy
    "Password Reuse Policy").
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管可以通过将过期密码设置为当前值来“重置”过期密码，但作为良好策略，最好选择不同的密码。DBA 可以通过建立适当的密码重用策略来强制不重用。参见 [密码重用策略](password-management.html#password-reuse-policy
    "密码重用策略")。
- en: Password Reuse Policy
  id: totrans-63
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 密码重用策略
- en: MySQL enables restrictions to be placed on reuse of previous passwords. Reuse
    restrictions can be established based on number of password changes, time elapsed,
    or both. Reuse policy can be established globally, and individual accounts can
    be set to either defer to the global policy or override the global policy with
    specific per-account behavior.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL允许对先前密码的重用施加限制。重用限制可以基于密码更改次数、经过的时间或两者来建立。重用策略可以在全局范围内建立，并且可以设置个别帐户要么遵循全局策略，要么用特定的每个帐户行为覆盖全局策略。
- en: 'The password history for an account consists of passwords it has been assigned
    in the past. MySQL can restrict new passwords from being chosen from this history:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 帐户的密码历史包括其过去分配的密码。MySQL可以限制新密码从此历史中选择：
- en: If an account is restricted on the basis of number of password changes, a new
    password cannot be chosen from a specified number of the most recent passwords.
    For example, if the minimum number of password changes is set to 3, a new password
    cannot be the same as any of the most recent 3 passwords.
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果一个帐户受到密码更改次数的限制，新密码不能选择最近一定数量的最近密码之一。例如，如果最小密码更改次数设置为3，新密码不能与最近的任何3个密码相同。
- en: If an account is restricted based on time elapsed, a new password cannot be
    chosen from passwords in the history that are newer than a specified number of
    days. For example, if the password reuse interval is set to 60, a new password
    must not be among those previously chosen within the last 60 days.
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果一个帐户受到经过时间限制，新密码不能从历史中选择的密码中选择。例如，如果密码重用间隔设置为60，新密码必须不是在过去60天内先前选择的密码之一。
- en: Note
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: The empty password does not count in the password history and is subject to
    reuse at any time.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 空密码不计入密码历史，并可随时重新使用。
- en: To establish password-reuse policy globally, use the [`password_history`](server-system-variables.html#sysvar_password_history)
    and [`password_reuse_interval`](server-system-variables.html#sysvar_password_reuse_interval)
    system variables.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 要在全局范围内建立密码重用策略，请使用[`password_history`](server-system-variables.html#sysvar_password_history)和[`password_reuse_interval`](server-system-variables.html#sysvar_password_reuse_interval)系统变量。
- en: 'Examples:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 例子：
- en: 'To prohibit reusing any of the last 6 passwords or passwords newer than 365
    days, put these lines in the server `my.cnf` file:'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要禁止重用最后6个密码或新于365天的密码，请将以下行放入服务器`my.cnf`文件中：
- en: '[PRE9]'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'To set and persist the variables at runtime, use statements like this:'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要在运行时设置和持久化变量，请使用以下语句：
- en: '[PRE10]'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '[`SET PERSIST`](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment")
    sets a value for the running MySQL instance. It also saves the value to carry
    over to subsequent server restarts; see [Section 15.7.6.1, “SET Syntax for Variable
    Assignment”](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment").
    To change the value for the running MySQL instance without having it carry over
    to subsequent restarts, use the `GLOBAL` keyword rather than `PERSIST`.'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[`SET PERSIST`](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment")为运行中的MySQL实例设置一个值。它还保存该值以在后续服务器重新启动时传递；参见[Section 15.7.6.1,
    “SET Syntax for Variable Assignment”](set-variable.html "15.7.6.1 SET Syntax for
    Variable Assignment")。要更改运行中的MySQL实例的值，而不使其在后续重新启动时传递，请使用`GLOBAL`关键字而不是`PERSIST`。'
- en: The global password-reuse policy applies to all accounts that have not been
    set to override it. To establish policy for individual accounts, use the `PASSWORD
    HISTORY` and `PASSWORD REUSE INTERVAL` options of the [`CREATE USER`](create-user.html
    "15.7.1.3 CREATE USER Statement") and [`ALTER USER`](alter-user.html "15.7.1.1 ALTER
    USER Statement") statements. See [Section 15.7.1.3, “CREATE USER Statement”](create-user.html
    "15.7.1.3 CREATE USER Statement"), and [Section 15.7.1.1, “ALTER USER Statement”](alter-user.html
    "15.7.1.1 ALTER USER Statement").
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 全局密码重用策略适用于未被设置为覆盖它的所有帐户。要为个别帐户建立策略，请使用[`CREATE USER`](create-user.html "15.7.1.3 CREATE
    USER Statement")和[`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement")语句的`PASSWORD
    HISTORY`和`PASSWORD REUSE INTERVAL`选项。参见[Section 15.7.1.3, “CREATE USER Statement”](create-user.html
    "15.7.1.3 CREATE USER Statement")和[Section 15.7.1.1, “ALTER USER Statement”](alter-user.html
    "15.7.1.1 ALTER USER Statement")。
- en: 'Example account-specific statements:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 个别帐户语句示例：
- en: 'Require a minimum of 5 password changes before permitting reuse:'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要求至少更改5次密码才允许重用：
- en: '[PRE11]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: This history-length option overrides the global policy for all accounts named
    by the statement.
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此历史长度选项将覆盖语句命名的所有帐户的全局策略。
- en: 'Require a minimum of 365 days elapsed before permitting reuse:'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要求至少365天经过才允许重用：
- en: '[PRE12]'
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: This time-elapsed option overrides the global policy for all accounts named
    by the statement.
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此经过时间的选项覆盖了语句命名的所有账户的全局策略。
- en: 'To combine both types of reuse restrictions, use `PASSWORD HISTORY` and `PASSWORD
    REUSE INTERVAL` together:'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要结合两种类型的重用限制，一起使用`PASSWORD HISTORY`和`PASSWORD REUSE INTERVAL`：
- en: '[PRE13]'
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: These options override both global policy reuse restrictions for all accounts
    named by the statement.
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这些选项覆盖了语句命名的所有账户的全局策略重用限制。
- en: 'Defer to the global policy for both types of reuse restrictions:'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于两种类型的重用限制，应遵循全局策略：
- en: '[PRE14]'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Password Verification-Required Policy
  id: totrans-90
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 需要密码验证的策略
- en: 'As of MySQL 8.0.13, it is possible to require that attempts to change an account
    password be verified by specifying the current password to be replaced. This enables
    DBAs to prevent users from changing a password without proving that they know
    the current password. Such changes could otherwise occur, for example, if one
    user walks away from a terminal session temporarily without logging out, and a
    malicious user uses the session to change the original user''s MySQL password.
    This can have unfortunate consequences:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 从MySQL 8.0.13开始，可以要求验证更改账户密码的尝试，方法是指定要替换的当前密码。这使得DBA可以防止用户在未证明知道当前密码的情况下更改密码。否则，例如，如果一个用户暂时离开终端会话而没有注销，那么恶意用户可以使用该会话更改原始用户的MySQL密码。这可能会产生不幸的后果：
- en: The original user becomes unable to access MySQL until the account password
    is reset by an administrator.
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 原始用户在管理员重置账户密码之前无法访问MySQL。
- en: Until the password reset occurs, the malicious user can access MySQL with the
    benign user's changed credentials.
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 直到密码重置发生，恶意用户可以使用良性用户更改的凭据访问MySQL。
- en: Password-verification policy can be established globally, and individual accounts
    can be set to either defer to the global policy or override the global policy
    with specific per-account behavior.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 可以在全局范围内建立密码验证策略，并且可以设置单独的账户以延迟全局策略或使用特定的每个账户行为覆盖全局策略。
- en: 'For each account, its `mysql.user` row indicates whether there is an account-specific
    setting requiring verification of the current password for password change attempts.
    The setting is established by the `PASSWORD REQUIRE` option of the [`CREATE USER`](create-user.html
    "15.7.1.3 CREATE USER Statement") and [`ALTER USER`](alter-user.html "15.7.1.1 ALTER
    USER Statement") statements:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个账户，其`mysql.user`行指示是否有一个账户特定设置，要求在尝试更改密码时验证当前密码。该设置由[`CREATE USER`](create-user.html
    "15.7.1.3 CREATE USER Statement")和[`ALTER USER`](alter-user.html "15.7.1.1 ALTER
    USER Statement")语句的`PASSWORD REQUIRE`选项建立：
- en: If the account setting is `PASSWORD REQUIRE CURRENT`, password changes must
    specify the current password.
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果账户设置为`PASSWORD REQUIRE CURRENT`，密码更改必须指定当前密码。
- en: If the account setting is `PASSWORD REQUIRE CURRENT OPTIONAL`, password changes
    may but need not specify the current password.
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果账户设置为`PASSWORD REQUIRE CURRENT OPTIONAL`，密码更改可能需要但不一定需要指定当前密码。
- en: 'If the account setting is `PASSWORD REQUIRE CURRENT DEFAULT`, the [`password_require_current`](server-system-variables.html#sysvar_password_require_current)
    system variable determines the verification-required policy for the account:'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果账户设置为`PASSWORD REQUIRE CURRENT DEFAULT`，[`password_require_current`](server-system-variables.html#sysvar_password_require_current)系统变量确定账户的验证要求策略：
- en: If [`password_require_current`](server-system-variables.html#sysvar_password_require_current)
    is enabled, password changes must specify the current password.
  id: totrans-99
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果[`password_require_current`](server-system-variables.html#sysvar_password_require_current)被启用，密码更改必须指定当前密码。
- en: If [`password_require_current`](server-system-variables.html#sysvar_password_require_current)
    is disabled, password changes may but need not specify the current password.
  id: totrans-100
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果[`password_require_current`](server-system-variables.html#sysvar_password_require_current)被禁用，密码更改可能需要但不一定需要指定当前密码。
- en: In other words, if the account setting is not `PASSWORD REQUIRE CURRENT DEFAULT`,
    the account setting takes precedence over the global policy established by the
    [`password_require_current`](server-system-variables.html#sysvar_password_require_current)
    system variable. Otherwise, the account defers to the [`password_require_current`](server-system-variables.html#sysvar_password_require_current)
    setting.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 换句话说，如果账户设置不是`PASSWORD REQUIRE CURRENT DEFAULT`，则账户设置优先于由[`password_require_current`](server-system-variables.html#sysvar_password_require_current)系统变量建立的全局策略。否则，账户将遵循[`password_require_current`](server-system-variables.html#sysvar_password_require_current)设置。
- en: 'By default, password verification is optional: [`password_require_current`](server-system-variables.html#sysvar_password_require_current)
    is disabled and accounts created with no `PASSWORD REQUIRE` option default to
    `PASSWORD REQUIRE CURRENT DEFAULT`.'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，密码验证是可选的：[`password_require_current`](server-system-variables.html#sysvar_password_require_current)已禁用，并且使用无`PASSWORD
    REQUIRE`选项创建的帐户默认为`PASSWORD REQUIRE CURRENT DEFAULT`。
- en: The following table shows how per-account settings interact with [`password_require_current`](server-system-variables.html#sysvar_password_require_current)
    system variable values to determine account password verification-required policy.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格显示了每个帐户设置如何与[`password_require_current`](server-system-variables.html#sysvar_password_require_current)系统变量值交互，以确定帐户密码验证所需策略。
- en: '**Table 8.10 Password-Verification Policy**'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '**表 8.10 密码验证策略**'
- en: '| Per-Account Setting | password_require_current System Variable | Password
    Changes Require Current Password? |'
  id: totrans-105
  prefs: []
  type: TYPE_TB
  zh: '| 每个帐户设置 | password_require_current系统变量 | 密码更改是否需要当前密码？ |'
- en: '| `PASSWORD REQUIRE CURRENT` | `OFF` | Yes |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
  zh: '| `PASSWORD REQUIRE CURRENT` | `OFF` | 是 |'
- en: '| `PASSWORD REQUIRE CURRENT` | `ON` | Yes |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
  zh: '| `PASSWORD REQUIRE CURRENT` | `ON` | 是 |'
- en: '| `PASSWORD REQUIRE CURRENT OPTIONAL` | `OFF` | No |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
  zh: '| `PASSWORD REQUIRE CURRENT OPTIONAL` | `OFF` | 否 |'
- en: '| `PASSWORD REQUIRE CURRENT OPTIONAL` | `ON` | No |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '| `PASSWORD REQUIRE CURRENT OPTIONAL` | `ON` | 否 |'
- en: '| `PASSWORD REQUIRE CURRENT DEFAULT` | `OFF` | No |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '| `PASSWORD REQUIRE CURRENT DEFAULT` | `OFF` | 否 |'
- en: '| `PASSWORD REQUIRE CURRENT DEFAULT` | `ON` | Yes |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| `PASSWORD REQUIRE CURRENT DEFAULT` | `ON` | 是 |'
- en: Note
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Privileged users can change any account password without specifying the current
    password, regardless of the verification-required policy. A privileged user is
    one who has the global [`CREATE USER`](privileges-provided.html#priv_create-user)
    privilege or the [`UPDATE`](privileges-provided.html#priv_update) privilege for
    the `mysql` system database.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 特权用户可以在不指定当前密码的情况下更改任何帐户密码，而不受需要验证的策略限制。特权用户是具有全局[`CREATE USER`](privileges-provided.html#priv_create-user)权限或`mysql`系统数据库的[`UPDATE`](privileges-provided.html#priv_update)权限的用户。
- en: To establish password-verification policy globally, use the [`password_require_current`](server-system-variables.html#sysvar_password_require_current)
    system variable. Its default value is `OFF`, so it is not required that account
    password changes specify the current password.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 要在全局范围内建立密码验证策略，请使用[`password_require_current`](server-system-variables.html#sysvar_password_require_current)系统变量。其默认值为`OFF`，因此不需要指定当前密码来更改帐户密码。
- en: 'Examples:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 示例：
- en: 'To establish a global policy that password changes must specify the current
    password, start the server with these lines in a server `my.cnf` file:'
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要建立一个全局策略，要求密码更改必须指定当前密码，请在服务器`my.cnf`文件中使用以下行启动服务器：
- en: '[PRE15]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'To set and persist [`password_require_current`](server-system-variables.html#sysvar_password_require_current)
    at runtime, use a statement such as one of these:'
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要在运行时设置并持久化[`password_require_current`](server-system-variables.html#sysvar_password_require_current)，可以使用以下语句之一：
- en: '[PRE16]'
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '[`SET PERSIST`](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment")
    sets a value for the running MySQL instance. It also saves the value to carry
    over to subsequent server restarts; see [Section 15.7.6.1, “SET Syntax for Variable
    Assignment”](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment").
    To change the value for the running MySQL instance without having it carry over
    to subsequent restarts, use the `GLOBAL` keyword rather than `PERSIST`.'
  id: totrans-120
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[`SET PERSIST`](set-variable.html "15.7.6.1 变量赋值的SET语法")为正在运行的MySQL实例设置一个值。它还保存该值以在后续服务器重新启动时继续使用；请参阅[第15.7.6.1节，“变量赋值的SET语法”](set-variable.html
    "15.7.6.1 变量赋值的SET语法")。要更改正在运行的MySQL实例的值，而不使其在后续重新启动时继续使用，使用`GLOBAL`关键字而不是`PERSIST`。'
- en: The global password verification-required policy applies to all accounts that
    have not been set to override it. To establish policy for individual accounts,
    use the `PASSWORD REQUIRE` options of the [`CREATE USER`](create-user.html "15.7.1.3 CREATE
    USER Statement") and [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement")
    statements. See [Section 15.7.1.3, “CREATE USER Statement”](create-user.html "15.7.1.3 CREATE
    USER Statement"), and [Section 15.7.1.1, “ALTER USER Statement”](alter-user.html
    "15.7.1.1 ALTER USER Statement").
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 全局密码验证所需策略适用于未被设置为覆盖它的所有帐户。要为单个帐户建立策略，请使用[`CREATE USER`](create-user.html "15.7.1.3 CREATE
    USER语句")和[`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER语句")语句的`PASSWORD REQUIRE`选项。请参阅[第15.7.1.3节，“CREATE
    USER语句”](create-user.html "15.7.1.3 CREATE USER语句")和[第15.7.1.1节，“ALTER USER语句”](alter-user.html
    "15.7.1.1 ALTER USER语句")。
- en: 'Example account-specific statements:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 示例特定帐户语句：
- en: 'Require that password changes specify the current password:'
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要求更改密码时指定当前密码：
- en: '[PRE17]'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: This verification option overrides the global policy for all accounts named
    by the statement.
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此验证选项覆盖了语句命名的所有帐户的全局策略。
- en: 'Do not require that password changes specify the current password (the current
    password may but need not be given):'
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不要求更改密码时指定当前密码（当前密码可以但不必给出）：
- en: '[PRE18]'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: This verification option overrides the global policy for all accounts named
    by the statement.
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此验证选项覆盖了语句命名的所有帐户的全局策略。
- en: 'Defer to the global password verification-required policy for all accounts
    named by the statement:'
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 延迟到语句命名的所有帐户的全局密码验证要求策略：
- en: '[PRE19]'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Verification of the current password comes into play when a user changes a password
    using the [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement") or [`SET
    PASSWORD`](set-password.html "15.7.1.10 SET PASSWORD Statement") statement. The
    examples use [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement"),
    which is preferred over [`SET PASSWORD`](set-password.html "15.7.1.10 SET PASSWORD
    Statement"), but the principles described here are the same for both statements.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户使用[`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement")或[`SET PASSWORD`](set-password.html
    "15.7.1.10 SET PASSWORD Statement")语句更改密码时，当前密码的验证起作用。示例使用[`ALTER USER`](alter-user.html
    "15.7.1.1 ALTER USER Statement")，这比使用[`SET PASSWORD`](set-password.html "15.7.1.10 SET
    PASSWORD Statement")更可取，但这里描述的原则对两个语句都是相同的。
- en: 'In password-change statements, a `REPLACE` clause specifies the current password
    to be replaced. Examples:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 在更改密码的语句中，`REPLACE`子句指定要替换的当前密码。示例：
- en: 'Change the current user''s password:'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更改当前用户的密码：
- en: '[PRE20]'
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Change a named user''s password:'
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更改命名用户的密码：
- en: '[PRE21]'
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Change a named user''s authentication plugin and password:'
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更改命名用户的身份验证插件和密码：
- en: '[PRE22]'
  id: totrans-138
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The `REPLACE` clause works like this:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '`REPLACE`子句的工作原理如下：'
- en: '`REPLACE` must be given if password changes for the account are required to
    specify the current password, as verification that the user attempting to make
    the change actually knows the current password.'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果需要为帐户更改密码以指定当前密码，则必须提供`REPLACE`，以验证试图进行更改的用户实际上知道当前密码。
- en: '`REPLACE` is optional if password changes for the account may but need not
    specify the current password.'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果需要为帐户更改密码但不需要指定当前密码，则`REPLACE`是可选的。
- en: If `REPLACE` is specified, it must specify the correct current password, or
    an error occurs. This is true even if `REPLACE` is optional.
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果指定了`REPLACE`，则必须指定正确的当前密码，否则将出现错误。即使`REPLACE`是可选的也是如此。
- en: '`REPLACE` can be specified only when changing the account password for the
    current user. (This means that in the examples just shown, the statements that
    explicitly name the account for `jeffrey` fail unless the current user is `jeffrey`.)
    This is true even if the change is attempted for another user by a privileged
    user; however, such a user can change any password without specifying `REPLACE`.'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 只有在更改当前用户的帐户密码时才能指定`REPLACE`。（这意味着在刚刚显示的示例中，明确命名`jeffrey`帐户的语句将失败，除非当前用户是`jeffrey`。）即使特权用户尝试为另一个用户更改密码，也是如此；但是，这样的用户可以更改任何密码而无需指定`REPLACE`。
- en: '`REPLACE` is omitted from the binary log to avoid writing cleartext passwords
    to it.'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为避免将明文密码写入二进制日志，`REPLACE`被省略。
- en: Dual Password Support
  id: totrans-145
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 双密码支持
- en: 'As of MySQL 8.0.14, user accounts are permitted to have dual passwords, designated
    as primary and secondary passwords. Dual-password capability makes it possible
    to seamlessly perform credential changes in scenarios like this:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 截至MySQL 8.0.14，用户帐户被允许具有主密码和辅助密码，称为双密码。双密码功能使得在诸如此类场景中无缝执行凭据更改成为可能：
- en: A system has a large number of MySQL servers, possibly involving replication.
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个系统有大量的MySQL服务器，可能涉及复制。
- en: Multiple applications connect to different MySQL servers.
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多个应用程序连接到不同的MySQL服务器。
- en: Periodic credential changes must be made to the account or accounts used by
    the applications to connect to the servers.
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 必须定期更改用于连接到服务器的应用程序使用的帐户或帐户的凭据。
- en: Consider how a credential change must be performed in the preceding type of
    scenario when an account is permitted only a single password. In this case, there
    must be close cooperation in the timing of when the account password change is
    made and propagated throughout all servers, and when all applications that use
    the account are updated to use the new password. This process may involve downtime
    during which servers or applications are unavailable.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑在前述类型的场景中执行凭据更改时，当一个账户只允许一个密码时。在这种情况下，必须在账户密码更改和在所有服务器上传播时以及所有使用该账户的应用程序更新以使用新密码的时间上进行紧密合作。这个过程可能涉及停机，期间服务器或应用程序不可用。
- en: 'With dual passwords, credential changes can be made more easily, in phases,
    without requiring close cooperation, and without downtime:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 通过双重密码，可以更轻松地分阶段进行凭据更改，无需紧密合作，也无需停机：
- en: For each affected account, establish a new primary password on the servers,
    retaining the current password as the secondary password. This enables servers
    to recognize either the primary or secondary password for each account, while
    applications can continue to connect to the servers using the same password as
    previously (which is now the secondary password).
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于每个受影响的账户，在服务器上建立一个新的主密码，将当前密码保留为次要密码。这使得服务器可以识别每个账户的主密码或次要密码，而应用程序可以继续使用与以前相同的密码连接到服务器（现在是次要密码）。
- en: After the password change has propagated to all servers, modify applications
    that use any affected account to connect using the account primary password.
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在密码更改传播到所有服务器后，修改使用任何受影响账户的应用程序，以使用账户主密码连接。
- en: After all applications have been migrated from the secondary passwords to the
    primary passwords, the secondary passwords are no longer needed and can be discarded.
    After this change has propagated to all servers, only the primary password for
    each account can be used to connect. The credential change is now complete.
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在所有应用程序已从次要密码迁移到主密码后，次要密码不再需要，可以丢弃。此更改传播到所有服务器后，每个账户只能使用主密码连接。凭据更改现在已完成。
- en: 'MySQL implements dual-password capability with syntax that saves and discards
    secondary passwords:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL使用保存和丢弃次要密码的语法实现双重密码功能：
- en: The `RETAIN CURRENT PASSWORD` clause for the [`ALTER USER`](alter-user.html
    "15.7.1.1 ALTER USER Statement") and [`SET PASSWORD`](set-password.html "15.7.1.10 SET
    PASSWORD Statement") statements saves an account current password as its secondary
    password when you assign a new primary password.
  id: totrans-156
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`RETAIN CURRENT PASSWORD`子句用于[`ALTER USER`](alter-user.html "15.7.1.1 ALTER
    USER Statement")和[`SET PASSWORD`](set-password.html "15.7.1.10 SET PASSWORD Statement")语句，当您分配新的主密码时，会将账户当前密码保存为其次要密码。'
- en: The `DISCARD OLD PASSWORD` clause for [`ALTER USER`](alter-user.html "15.7.1.1 ALTER
    USER Statement") discards an account secondary password, leaving only the primary
    password.
  id: totrans-157
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DISCARD OLD PASSWORD`子句用于[`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER
    Statement")，丢弃账户次要密码，仅保留主密码。'
- en: Suppose that, for the previously described credential-change scenario, an account
    named `'appuser1'@'host1.example.com'` is used by applications to connect to servers,
    and that the account password is to be changed from `'*`password_a`*'` to `'*`password_b`*'`.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 假设对于先前描述的凭据更改场景，一个名为`'appuser1'@'host1.example.com'`的账户被应用程序用于连接服务器，并且要将账户密码从`'*`password_a`*'`更改为`'*`password_b`*'`。
- en: 'To perform this change of credentials, use `ALTER USER` as follows:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 要执行凭据更改，请使用以下`ALTER USER`：
- en: 'On each server that is not a replica, establish `''*`password_b`*''` as the
    new `appuser1` primary password, retaining the current password as the secondary
    password:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在每个非副本服务器上，建立`'*`password_b`*'`作为新的`appuser1`主密码，保留当前密码作为次要密码：
- en: '[PRE23]'
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Wait for the password change to replicate throughout the system to all replicas.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 等待密码更改在整个系统中复制到所有副本。
- en: Modify each application that uses the `appuser1` account so that it connects
    to the servers using a password of `'*`password_b`*'` rather than `'*`password_a`*'`.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 修改使用`appuser1`账户的每个应用程序，使其使用密码`'*`password_b`*'`而不是`'*`password_a`*'`连接到服务器。
- en: 'At this point, the secondary password is no longer needed. On each server that
    is not a replica, discard the secondary password:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 此时，次要密码不再需要。在每个非副本服务器上丢弃次要密码：
- en: '[PRE24]'
  id: totrans-165
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: After the discard-password change has replicated to all replicas, the credential
    change is complete.
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在丢弃密码更改已经复制到所有副本之后，凭据更改完成。
- en: 'The `RETAIN CURRENT PASSWORD` and `DISCARD OLD PASSWORD` clauses have the following
    effects:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '`RETAIN CURRENT PASSWORD` 和 `DISCARD OLD PASSWORD` 子句具有以下效果：'
- en: '`RETAIN CURRENT PASSWORD` retains an account current password as its secondary
    password, replacing any existing secondary password. The new password becomes
    the primary password, but clients can use the account to connect to the server
    using either the primary or secondary password. (Exception: If the new password
    specified by the [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement")
    or [`SET PASSWORD`](set-password.html "15.7.1.10 SET PASSWORD Statement") statement
    is empty, the secondary password becomes empty as well, even if `RETAIN CURRENT
    PASSWORD` is given.)'
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`RETAIN CURRENT PASSWORD` 会保留账户当前密码作为其二级密码，替换任何现有的二级密码。新密码成为主密码，但客户端可以使用主密码或二级密码连接到服务器。
    （例外情况：如果由 [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement") 或 [`SET
    PASSWORD`](set-password.html "15.7.1.10 SET PASSWORD Statement") 语句指定的新密码为空，则即使给出
    `RETAIN CURRENT PASSWORD`，二级密码也会变为空。）'
- en: If you specify `RETAIN CURRENT PASSWORD` for an account that has an empty primary
    password, the statement fails.
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果您为具有空主密码的账户指定 `RETAIN CURRENT PASSWORD`，则该语句将失败。
- en: If an account has a secondary password and you change its primary password without
    specifying `RETAIN CURRENT PASSWORD`, the secondary password remains unchanged.
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果一个账户有二级密码，并且您更改其主密码而不指定 `RETAIN CURRENT PASSWORD`，则二级密码保持不变。
- en: For [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement"), if you
    change the authentication plugin assigned to the account, the secondary password
    is discarded. If you change the authentication plugin and also specify `RETAIN
    CURRENT PASSWORD`, the statement fails.
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于 [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement")，如果更改分配给账户的身份验证插件，则二级密码将被丢弃。
    如果更改身份验证插件并且还指定 `RETAIN CURRENT PASSWORD`，则该语句将失败。
- en: For [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement"), `DISCARD
    OLD PASSWORD` discards the secondary password, if one exists. The account retains
    only its primary password, and clients can use the account to connect to the server
    only with the primary password.
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于 [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement")，`DISCARD
    OLD PASSWORD` 会丢弃二级密码（如果存在）。账户仅保留其主密码，客户端只能使用主密码连接到服务器。
- en: 'Statements that modify secondary passwords require these privileges:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 修改二级密码的语句需要以下权限：
- en: The [`APPLICATION_PASSWORD_ADMIN`](privileges-provided.html#priv_application-password-admin)
    privilege is required to use the `RETAIN CURRENT PASSWORD` or `DISCARD OLD PASSWORD`
    clause for [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement") and
    [`SET PASSWORD`](set-password.html "15.7.1.10 SET PASSWORD Statement") statements
    that apply to your own account. The privilege is required to manipulate your own
    secondary password because most users require only one password.
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要使用 `RETAIN CURRENT PASSWORD` 或 `DISCARD OLD PASSWORD` 子句来操作您自己的账户的 [`ALTER
    USER`](alter-user.html "15.7.1.1 ALTER USER Statement") 和 [`SET PASSWORD`](set-password.html
    "15.7.1.10 SET PASSWORD Statement") 语句，需要 [`APPLICATION_PASSWORD_ADMIN`](privileges-provided.html#priv_application-password-admin)
    权限。 大多数用户只需要一个密码，因此需要该权限来操作自己的二级密码。
- en: If an account is to be permitted to manipulate secondary passwords for all accounts,
    it should be granted the [`CREATE USER`](privileges-provided.html#priv_create-user)
    privilege rather than [`APPLICATION_PASSWORD_ADMIN`](privileges-provided.html#priv_application-password-admin).
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果要允许一个账户为所有账户操作二级密码，则应授予 [`CREATE USER`](privileges-provided.html#priv_create-user)
    权限，而不是 [`APPLICATION_PASSWORD_ADMIN`](privileges-provided.html#priv_application-password-admin)。
- en: Random Password Generation
  id: totrans-176
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 随机密码生成
- en: As of MySQL 8.0.18, the [`CREATE USER`](create-user.html "15.7.1.3 CREATE USER
    Statement"), [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement"),
    and [`SET PASSWORD`](set-password.html "15.7.1.10 SET PASSWORD Statement") statements
    have the capability of generating random passwords for user accounts, as an alternative
    to requiring explicit administrator-specified literal passwords. See the description
    of each statement for details about the syntax. This section describes the characteristics
    common to generated random passwords.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 截至 MySQL 8.0.18 版本，[`CREATE USER`](create-user.html "15.7.1.3 CREATE USER Statement")，[`ALTER
    USER`](alter-user.html "15.7.1.1 ALTER USER Statement") 和 [`SET PASSWORD`](set-password.html
    "15.7.1.10 SET PASSWORD Statement") 语句具有生成用户账户随机密码的功能，作为明文密码的替代选择。有关语法的详细信息，请参阅每个语句的描述。本节描述了生成随机密码的共同特征。
- en: By default, generated random passwords have a length of 20 characters. This
    length is controlled by the [`generated_random_password_length`](server-system-variables.html#sysvar_generated_random_password_length)
    system variable, which has a range from 5 to 255.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，生成的随机密码长度为20个字符。这个长度由[`generated_random_password_length`](server-system-variables.html#sysvar_generated_random_password_length)系统变量控制，范围从5到255。
- en: For each account for which a statement generates a random password, the statement
    stores the password in the `mysql.user` system table, hashed appropriately for
    the account authentication plugin. The statement also returns the cleartext password
    in a row of a result set to make it available to the user or application executing
    the statement. The result set columns are named `user`, `host`, `generated password`,
    and `auth_factor` indicating the user name and host name values that identify
    the affected row in the `mysql.user` system table, the cleartext generated password,
    and the authentication factor the displayed password value applies to.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个语句生成随机密码的账户，该语句将密码存储在`mysql.user`系统表中，适当地为账户认证插件进行哈希处理。该语句还会在结果集的一行中返回明文密码，以便用户或应用程序执行该语句。结果集列名为`user`，`host`，`generated
    password`和`auth_factor`，表示标识`mysql.user`系统表中受影响行的用户名和主机名值，明文生成的密码，以及显示密码值适用的认证因素。
- en: '[PRE25]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: A [`CREATE USER`](create-user.html "15.7.1.3 CREATE USER Statement"), [`ALTER
    USER`](alter-user.html "15.7.1.1 ALTER USER Statement"), or [`SET PASSWORD`](set-password.html
    "15.7.1.10 SET PASSWORD Statement") statement that generates a random password
    for an account is written to the binary log as a [`CREATE USER`](create-user.html
    "15.7.1.3 CREATE USER Statement") or [`ALTER USER`](alter-user.html "15.7.1.1 ALTER
    USER Statement") statement with an `IDENTIFIED WITH *`auth_plugin`* AS '*`auth_string`*'`,
    clause, where *`auth_plugin`* is the account authentication plugin and `'*`auth_string`*'`
    is the account hashed password value.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 一个[`CREATE USER`](create-user.html "15.7.1.3 CREATE USER Statement")，[`ALTER
    USER`](alter-user.html "15.7.1.1 ALTER USER Statement")或[`SET PASSWORD`](set-password.html
    "15.7.1.10 SET PASSWORD Statement")语句，为一个账户生成一个随机密码，被写入二进制日志作为一个带有`IDENTIFIED
    WITH *`auth_plugin`* AS '*`auth_string`*`'`子句的[`CREATE USER`](create-user.html
    "15.7.1.3 CREATE USER Statement")或[`ALTER USER`](alter-user.html "15.7.1.1 ALTER
    USER Statement")语句，其中*`auth_plugin`*是账户认证插件，`'*`auth_string`*`'`是账户哈希密码值。
- en: If the `validate_password` component is installed, the policy that it implements
    has no effect on generated passwords. (The purpose of password validation is to
    help humans create better passwords.)
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 如果安装了`validate_password`组件，则其实施的策略对生成的密码没有影响。（密码验证的目的是帮助人类创建更好的密码。）
- en: Failed-Login Tracking and Temporary Account Locking
  id: totrans-183
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 登录失败跟踪和临时账户锁定
- en: As of MySQL 8.0.19, administrators can configure user accounts such that too
    many consecutive login failures cause temporary account locking.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 从MySQL 8.0.19开始，管理员可以配置用户账户，使得连续登录失败次数过多会导致临时账户锁定。
- en: “Login failure” in this context means failure of the client to provide a correct
    password during a connection attempt. It does not include failure to connect for
    reasons such as unknown user or network issues. For accounts that have dual passwords
    (see [Dual Password Support](password-management.html#dual-passwords "Dual Password
    Support")), either account password counts as correct.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，“登录失败”意味着客户端在连接尝试期间未提供正确密码。这不包括由于未知用户或网络问题等原因而无法连接的情况。对于具有双重密码的账户（参见[双重密码支持](password-management.html#dual-passwords
    "双重密码支持")），任一账户密码都算正确。
- en: 'The required number of login failures and the lock time are configurable per
    account, using the `FAILED_LOGIN_ATTEMPTS` and `PASSWORD_LOCK_TIME` options of
    the [`CREATE USER`](create-user.html "15.7.1.3 CREATE USER Statement") and [`ALTER
    USER`](alter-user.html "15.7.1.1 ALTER USER Statement") statements. Examples:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 每个账户的所需登录失败次数和锁定时间可通过[`CREATE USER`](create-user.html "15.7.1.3 CREATE USER
    Statement")和[`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement")语句的`FAILED_LOGIN_ATTEMPTS`和`PASSWORD_LOCK_TIME`选项进行配置。示例：
- en: '[PRE26]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'When too many consecutive login failures occur, the client receives an error
    that looks like this:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 当连续登录失败次数过多时，客户端会收到如下错误消息：
- en: '[PRE27]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Use the options as follows:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 使用选项如下：
- en: '`FAILED_LOGIN_ATTEMPTS *`N`*`'
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`FAILED_LOGIN_ATTEMPTS *`N`*`'
- en: This option indicates whether to track account login attempts that specify an
    incorrect password. The number *`N`* specifies how many consecutive incorrect
    passwords cause temporary account locking.
  id: totrans-192
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此选项指示是否跟踪指定了不正确密码的账户登录尝试。数字*`N`*指定了多少个连续的不正确密码会导致临时账户锁定。
- en: '`PASSWORD_LOCK_TIME {*`N`* | UNBOUNDED}`'
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`PASSWORD_LOCK_TIME {*`N`* | UNBOUNDED}`'
- en: This option indicates how long to lock the account after too many consecutive
    login attempts provide an incorrect password. The value is a number *`N`* to specify
    the number of days the account remains locked, or `UNBOUNDED` to specify that
    when an account enters the temporarily locked state, the duration of that state
    is unbounded and does not end until the account is unlocked. The conditions under
    which unlocking occurs are described later.
  id: totrans-194
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此选项指示在太多连续登录尝试提供错误密码后锁定帐户的时间。该值是一个数字*`N`*，用于指定帐户保持锁定状态的天数，或`UNBOUNDED`以指定当帐户进入临时锁定状态时，该状态的持续时间是无限的，并且直到帐户被解锁为止。解锁发生的条件将在后面描述。
- en: Permitted values of *`N`* for each option are in the range from 0 to 32767\.
    A value of 0 disables the option.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 每个选项的允许值*`N`*的范围为0到32767。值为0会禁用该选项。
- en: 'Failed-login tracking and temporary account locking have these characteristics:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 失败登录跟踪和临时帐户锁定具有以下特征：
- en: For failed-login tracking and temporary locking to occur for an account, its
    `FAILED_LOGIN_ATTEMPTS` and `PASSWORD_LOCK_TIME` options both must be nonzero.
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要对帐户进行失败登录跟踪和临时锁定，其`FAILED_LOGIN_ATTEMPTS`和`PASSWORD_LOCK_TIME`选项都必须为非零。
- en: For [`CREATE USER`](create-user.html "15.7.1.3 CREATE USER Statement"), if `FAILED_LOGIN_ATTEMPTS`
    or `PASSWORD_LOCK_TIME` is not specified, its implicit default value is 0 for
    all accounts named by the statement. This means that failed-login tracking and
    temporary account locking are disabled. (These implicit defaults also apply to
    accounts created prior to the introduction of failed-login tracking.)
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于[`CREATE USER`](create-user.html "15.7.1.3 CREATE USER Statement")，如果未指定`FAILED_LOGIN_ATTEMPTS`或`PASSWORD_LOCK_TIME`，则其隐式默认值对于语句命名的所有帐户均为0。这意味着禁用了失败登录跟踪和临时帐户锁定。（这些隐式默认值也适用于在引入失败登录跟踪之前创建的帐户。）
- en: For [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement"), if `FAILED_LOGIN_ATTEMPTS`
    or `PASSWORD_LOCK_TIME` is not specified, its value remains unchanged for all
    accounts named by the statement.
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于[`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement")，如果未指定`FAILED_LOGIN_ATTEMPTS`或`PASSWORD_LOCK_TIME`，则其值对于语句命名的所有帐户保持不变。
- en: For temporary account locking to occur, password failures must be consecutive.
    Any successful login that occurs prior to reaching the `FAILED_LOGIN_ATTEMPTS`
    value for failed logins causes failure counting to reset. For example, if `FAILED_LOGIN_ATTEMPTS`
    is 4 and three consecutive password failures have occurred, one more failure is
    necessary for locking to begin. But if the next login succeeds, failed-login counting
    for the account is reset so that four consecutive failures are again required
    for locking.
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要发生临时帐户锁定，密码失败必须是连续的。在达到失败登录的`FAILED_LOGIN_ATTEMPTS`值之前发生的任何成功登录都会导致失败计数重置。例如，如果`FAILED_LOGIN_ATTEMPTS`为4，并且已发生三次连续密码失败，则需要再次失败一次才能开始锁定。但是，如果下次登录成功，则帐户的失败登录计数将被重置，因此再次需要四次连续失败才能锁定。
- en: Once temporary locking begins, successful login cannot occur even with the correct
    password until either the lock duration has passed or the account is unlocked
    by one of the account-reset methods listed in the following discussion.
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一旦临时锁定开始，即使使用正确密码也无法进行成功登录，直到锁定持续时间已过或帐户通过以下讨论中列出的帐户重置方法之一被解锁。
- en: When the server reads the grant tables, it initializes state information for
    each account regarding whether failed-login tracking is enabled, whether the account
    is currently temporarily locked and when locking began if so, and the number of
    failures before temporary locking occurs if the account is not locked.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 当服务器读取授权表时，它会初始化每个帐户的状态信息，包括是否启用了失败登录跟踪，帐户当前是否被临时锁定以及如果是的话锁定何时开始，以及如果帐户未被锁定，则在临时锁定发生之前的失败次数。
- en: 'An account''s state information can be reset, which means that failed-login
    counting is reset, and the account is unlocked if currently temporarily locked.
    Account resets can be global for all accounts or per account:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 帐户的状态信息可以被重置，这意味着失败登录计数被重置，并且如果当前被临时锁定，则帐户被解锁。帐户重置可以是全局的，适用于所有帐户，也可以是每个帐户：
- en: 'A global reset of all accounts occurs for any of these conditions:'
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 所有帐户的全局重置发生在以下任何条件下：
- en: A server restart.
  id: totrans-205
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器重新启动。
- en: Execution of [`FLUSH PRIVILEGES`](flush.html#flush-privileges). (Starting the
    server with [`--skip-grant-tables`](server-options.html#option_mysqld_skip-grant-tables)
    causes the grant tables not to be read, which disables failed-login tracking.
    In this case, the first execution of [`FLUSH PRIVILEGES`](flush.html#flush-privileges)
    causes the server to read the grant tables and enable failed-login tracking, in
    addition to resetting all accounts.)
  id: totrans-206
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行[`FLUSH PRIVILEGES`](flush.html#flush-privileges)。（使用[`--skip-grant-tables`](server-options.html#option_mysqld_skip-grant-tables)选项启动服务器会导致授予权限表不被读取，从而禁用了失败登录跟踪。在这种情况下，第一次执行[`FLUSH
    PRIVILEGES`](flush.html#flush-privileges)会导致服务器读取授予权限表并启用失败登录跟踪，同时重置所有账户。）
- en: 'A per-account reset occurs for any of these conditions:'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于任何以下条件，每个账户都会发生重置：
- en: Successful login for the account.
  id: totrans-208
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 账户成功登录。
- en: The lock duration passes. In this case, failed-login counting resets at the
    time of the next login attempt.
  id: totrans-209
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 锁定持续时间过去。在这种情况下，失败登录计数将在下次登录尝试时重置。
- en: Execution of an [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement")
    statement for the account that sets either `FAILED_LOGIN_ATTEMPTS` or `PASSWORD_LOCK_TIME`
    (or both) to any value (including the current option value), or execution of an
    [`ALTER USER ... UNLOCK`](alter-user.html "15.7.1.1 ALTER USER Statement") statement
    for the account.
  id: totrans-210
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于账户执行设置`FAILED_LOGIN_ATTEMPTS`或`PASSWORD_LOCK_TIME`（或两者）任何值（包括当前选项值）的[`ALTER
    USER`](alter-user.html "15.7.1.1 ALTER USER Statement")语句的执行，或对于账户执行[`ALTER USER
    ... UNLOCK`](alter-user.html "15.7.1.1 ALTER USER Statement")语句。
- en: Other [`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement") statements
    for the account have no effect on its current failed-login count or its locking
    state.
  id: totrans-211
  prefs:
  - PREF_IND
  - PREF_IND
  type: TYPE_NORMAL
  zh: 对于账户的其他[`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement")语句对其当前的失败登录计数或锁定状态没有影响。
- en: Failed-login tracking is tied to the login account that is used to check credentials.
    If user proxying is in use, tracking occurs for the proxy user, not the proxied
    user. That is, tracking is tied to the account indicated by [`USER()`](information-functions.html#function_user),
    not the account indicated by [`CURRENT_USER()`](information-functions.html#function_current-user).
    For information about the distinction between proxy and proxied users, see [Section 8.2.19,
    “Proxy Users”](proxy-users.html "8.2.19 Proxy Users").
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 失败登录跟踪与用于检查凭据的登录账户相关联。如果使用用户代理，跟踪将针对代理用户而不是被代理用户进行。也就是说，跟踪与[`USER()`](information-functions.html#function_user)指示的账户相关联，而不是与[`CURRENT_USER()`](information-functions.html#function_current-user)指示的账户相关联。有关代理用户和被代理用户之间区别的信息，请参阅[第
    8.2.19 节，“代理用户”](proxy-users.html "8.2.19 代理用户")。

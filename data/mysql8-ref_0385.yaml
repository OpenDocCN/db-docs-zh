- en: 8.3.1 Configuring MySQL to Use Encrypted Connections
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 8.3.1 配置 MySQL 使用加密连接
- en: 原文：[https://dev.mysql.com/doc/refman/8.0/en/using-encrypted-connections.html](https://dev.mysql.com/doc/refman/8.0/en/using-encrypted-connections.html)
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://dev.mysql.com/doc/refman/8.0/en/using-encrypted-connections.html](https://dev.mysql.com/doc/refman/8.0/en/using-encrypted-connections.html)
- en: 'Several configuration parameters are available to indicate whether to use encrypted
    connections, and to specify the appropriate certificate and key files. This section
    provides general guidance about configuring the server and clients for encrypted
    connections:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 有几个配置参数可用于指示是否使用加密连接，并指定适当的证书和密钥文件。本节提供了有关为加密连接配置服务器和客户端的一般指导：
- en: '[Server-Side Startup Configuration for Encrypted Connections](using-encrypted-connections.html#using-encrypted-connections-server-side-startup-configuration
    "Server-Side Startup Configuration for Encrypted Connections")'
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[用于加密连接的服务器端启动配置](using-encrypted-connections.html#using-encrypted-connections-server-side-startup-configuration
    "用于加密连接的服务器端启动配置")'
- en: '[Server-Side Runtime Configuration and Monitoring for Encrypted Connections](using-encrypted-connections.html#using-encrypted-connections-server-side-runtime-configuration
    "Server-Side Runtime Configuration and Monitoring for Encrypted Connections")'
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[加密连接的服务器端运行时配置和监控](using-encrypted-connections.html#using-encrypted-connections-server-side-runtime-configuration
    "加密连接的服务器端运行时配置和监控")'
- en: '[Client-Side Configuration for Encrypted Connections](using-encrypted-connections.html#using-encrypted-connections-client-side-configuration
    "Client-Side Configuration for Encrypted Connections")'
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[用于加密连接的客户端端配置](using-encrypted-connections.html#using-encrypted-connections-client-side-configuration
    "用于加密连接的客户端端配置")'
- en: '[Configuring Encrypted Connections as Mandatory](using-encrypted-connections.html#mandatory-encrypted-connections
    "Configuring Encrypted Connections as Mandatory")'
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[将加密连接配置为强制性](using-encrypted-connections.html#mandatory-encrypted-connections
    "将加密连接配置为强制性")'
- en: 'Encrypted connections also can be used in other contexts, as discussed in these
    additional sections:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 还可以在其他情境中使用加密连接，如这些附加部分中所讨论的：
- en: Between source and replica replication servers. See [Section 19.3.1, “Setting
    Up Replication to Use Encrypted Connections”](replication-encrypted-connections.html
    "19.3.1 Setting Up Replication to Use Encrypted Connections").
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 源服务器和副本复制服务器之间。参见 [第 19.3.1 节，“设置复制以使用加密连接”](replication-encrypted-connections.html
    "19.3.1 设置复制以使用加密连接")。
- en: Among Group Replication servers. See [Section 20.6.2, “Securing Group Communication
    Connections with Secure Socket Layer (SSL)”](group-replication-secure-socket-layer-support-ssl.html
    "20.6.2 Securing Group Communication Connections with Secure Socket Layer (SSL)").
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在组复制服务器之间。参见 [第 20.6.2 节，“使用安全套接字层（SSL）保护组通信连接”](group-replication-secure-socket-layer-support-ssl.html
    "20.6.2 使用安全套接字层（SSL）保护组通信连接")。
- en: By client programs that are based on the MySQL C API. See [Support for Encrypted
    Connections](/doc/c-api/8.0/en/c-api-encrypted-connections.html).
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于 MySQL C API 的客户端程序。参见 [支持加密连接](/doc/c-api/8.0/en/c-api-encrypted-connections.html)。
- en: Instructions for creating any required certificate and key files are available
    in [Section 8.3.3, “Creating SSL and RSA Certificates and Keys”](creating-ssl-rsa-files.html
    "8.3.3 Creating SSL and RSA Certificates and Keys").
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 有关创建所需证书和密钥文件的说明，请参阅 [第 8.3.3 节，“创建 SSL 和 RSA 证书和密钥”](creating-ssl-rsa-files.html
    "8.3.3 创建 SSL 和 RSA 证书和密钥")。
- en: Server-Side Startup Configuration for Encrypted Connections
  id: totrans-12
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 用于加密连接的服务器端启动配置
- en: On the server side, the [`--ssl`](server-options.html#option_mysqld_ssl) option
    specifies that the server permits but does not require encrypted connections.
    This option is enabled by default, so it need not be specified explicitly.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在服务器端，[`--ssl`](server-options.html#option_mysqld_ssl) 选项指定服务器允许但不要求加密连接。此选项默认启用，因此不需要显式指定。
- en: To require that clients connect using encrypted connections, enable the [`require_secure_transport`](server-system-variables.html#sysvar_require_secure_transport)
    system variable. See [Configuring Encrypted Connections as Mandatory](using-encrypted-connections.html#mandatory-encrypted-connections
    "Configuring Encrypted Connections as Mandatory").
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 要求客户端使用加密连接连接，请启用 [`require_secure_transport`](server-system-variables.html#sysvar_require_secure_transport)
    系统变量。参见 [将加密连接配置为强制性](using-encrypted-connections.html#mandatory-encrypted-connections
    "将加密连接配置为强制性")。
- en: 'These system variables on the server side specify the certificate and key files
    the server uses when permitting clients to establish encrypted connections:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器端的这些系统变量指定了服务器在允许客户端建立加密连接时使用的证书和密钥文件：
- en: '[`ssl_ca`](server-system-variables.html#sysvar_ssl_ca): The path name of the
    Certificate Authority (CA) certificate file. ([`ssl_capath`](server-system-variables.html#sysvar_ssl_capath)
    is similar but specifies the path name of a directory of CA certificate files.)'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`ssl_ca`](server-system-variables.html#sysvar_ssl_ca)：证书颁发机构（CA）证书文件的路径名。([`ssl_capath`](server-system-variables.html#sysvar_ssl_capath)类似，但指定了CA证书文件的目录路径名。)'
- en: '[`ssl_cert`](server-system-variables.html#sysvar_ssl_cert): The path name of
    the server public key certificate file. This certificate can be sent to the client
    and authenticated against the CA certificate that it has.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`ssl_cert`](server-system-variables.html#sysvar_ssl_cert)：服务器公钥证书文件的路径名。此证书可以发送给客户端，并根据其拥有的CA证书进行验证。'
- en: '[`ssl_key`](server-system-variables.html#sysvar_ssl_key): The path name of
    the server private key file.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`ssl_key`](server-system-variables.html#sysvar_ssl_key)：服务器私钥文件的路径名。'
- en: 'For example, to enable the server for encrypted connections, start it with
    these lines in the `my.cnf` file, changing the file names as necessary:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，要启用服务器进行加密连接，请在`my.cnf`文件中使用以下行启动它，根据需要更改文件名：
- en: '[PRE0]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'To specify in addition that clients are required to use encrypted connections,
    enable the [`require_secure_transport`](server-system-variables.html#sysvar_require_secure_transport)
    system variable:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 要额外指定客户端必须使用加密连接，请启用[`require_secure_transport`](server-system-variables.html#sysvar_require_secure_transport)系统变量：
- en: '[PRE1]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Each certificate and key system variable names a file in PEM format. Should
    you need to create the required certificate and key files, see [Section 8.3.3,
    “Creating SSL and RSA Certificates and Keys”](creating-ssl-rsa-files.html "8.3.3 Creating
    SSL and RSA Certificates and Keys"). MySQL servers compiled using OpenSSL can
    generate missing certificate and key files automatically at startup. See [Section 8.3.3.1,
    “Creating SSL and RSA Certificates and Keys using MySQL”](creating-ssl-rsa-files-using-mysql.html
    "8.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL"). Alternatively,
    if you have a MySQL source distribution, you can test your setup using the demonstration
    certificate and key files in its `mysql-test/std_data` directory.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 每个证书和密钥系统变量都指定了一个PEM格式的文件。如果需要创建所需的证书和密钥文件，请参阅[第8.3.3节，“创建SSL和RSA证书和密钥”](creating-ssl-rsa-files.html
    "8.3.3 Creating SSL and RSA Certificates and Keys")。使用OpenSSL编译的MySQL服务器可以在启动时自动生成缺失的证书和密钥文件。请参阅[第8.3.3.1节，“使用MySQL创建SSL和RSA证书和密钥”](creating-ssl-rsa-files-using-mysql.html
    "8.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL")。或者，如果您有MySQL源代码分发版，您可以使用其`mysql-test/std_data`目录中的演示证书和密钥文件测试您的设置。
- en: 'The server performs certificate and key file autodiscovery. If no explicit
    encrypted-connection options are given other than [`--ssl`](server-options.html#option_mysqld_ssl)
    (possibly along with [`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher))
    to configure encrypted connections, the server attempts to enable encrypted-connection
    support automatically at startup:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器执行证书和密钥文件的自动发现。如果除了[`--ssl`](server-options.html#option_mysqld_ssl)（可能还包括[`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher)）之外没有给出明确的加密连接选项来配置加密连接，服务器会尝试在启动时自动启用加密连接支持：
- en: If the server discovers valid certificate and key files named `ca.pem`, `server-cert.pem`,
    and `server-key.pem` in the data directory, it enables support for encrypted connections
    by clients. (The files need not have been generated automatically; what matters
    is that they have those names and are valid.)
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果服务器在数据目录中发现名为`ca.pem`、`server-cert.pem`和`server-key.pem`的有效证书和密钥文件，它会启用客户端的加密连接支持。（文件不一定是自动生成的；重要的是它们具有这些名称并且是有效的。）
- en: If the server does not find valid certificate and key files in the data directory,
    it continues executing but without support for encrypted connections.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果服务器在数据目录中找不到有效的证书和密钥文件，它会继续执行，但不支持加密连接。
- en: If the server automatically enables encrypted connection support, it writes
    a note to the error log. If the server discovers that the CA certificate is self-signed,
    it writes a warning to the error log. (The certificate is self-signed if created
    automatically by the server or manually using [**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html
    "6.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files").)
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 如果服务器自动启用了加密连接支持，它会在错误日志中写下一条说明。如果服务器发现 CA 证书是自签名的，它会在错误日志中写下一个警告。（如果证书是由服务器自动创建或使用
    [**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html "6.4.3 mysql_ssl_rsa_setup
    — Create SSL/RSA Files") 手动创建，则证书是自签名的。）
- en: 'MySQL also provides these system variables for server-side encrypted-connection
    control:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL 还为服务器端提供了这些系统变量来控制加密连接：
- en: '[`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher): The list of
    permissible ciphers for connection encryption.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher)：连接加密的可允许密码列表。'
- en: '[`ssl_crl`](server-system-variables.html#sysvar_ssl_crl): The path name of
    the file containing certificate revocation lists. ([`ssl_crlpath`](server-system-variables.html#sysvar_ssl_crlpath)
    is similar but specifies the path name of a directory of certificate revocation-list
    files.)'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`ssl_crl`](server-system-variables.html#sysvar_ssl_crl)：包含证书吊销列表的文件的路径名。（[`ssl_crlpath`](server-system-variables.html#sysvar_ssl_crlpath)
    类似，但指定了证书吊销列表文件的目录路径名。）'
- en: '[`tls_version`](server-system-variables.html#sysvar_tls_version), [`tls_ciphersuites`](server-system-variables.html#sysvar_tls_ciphersuites):
    Which encryption protocols and ciphersuites the server permits for encrypted connections;
    see [Section 8.3.2, “Encrypted Connection TLS Protocols and Ciphers”](encrypted-connection-protocols-ciphers.html
    "8.3.2 Encrypted Connection TLS Protocols and Ciphers"). For example, you can
    configure [`tls_version`](server-system-variables.html#sysvar_tls_version) to
    prevent clients from using less-secure protocols.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`tls_version`](server-system-variables.html#sysvar_tls_version)、[`tls_ciphersuites`](server-system-variables.html#sysvar_tls_ciphersuites)：服务器允许用于加密连接的加密协议和密码套件；参见
    [Section 8.3.2, “Encrypted Connection TLS Protocols and Ciphers”](encrypted-connection-protocols-ciphers.html
    "8.3.2 Encrypted Connection TLS Protocols and Ciphers")。例如，您可以配置 [`tls_version`](server-system-variables.html#sysvar_tls_version)
    来阻止客户端使用不太安全的协议。'
- en: If the server cannot create a valid TLS context from the system variables for
    server-side encrypted-connection control, the server executes without support
    for encrypted connections.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 如果服务器无法从服务器端加密连接控制的系统变量创建有效的 TLS 上下文，则服务器将在没有加密连接支持的情况下执行。
- en: Server-Side Runtime Configuration and Monitoring for Encrypted Connections
  id: totrans-33
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 用于加密连接的服务器端运行时配置和监控
- en: Prior to MySQL 8.0.16, the `tls_*`xxx`*` and `ssl_*`xxx`*` system variables
    that configure encrypted-connection support can be set only at server startup.
    These system variables therefore determine the TLS context the server uses for
    all new connections.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在 MySQL 8.0.16 之前，配置加密连接支持的 `tls_*`xxx`*` 和 `ssl_*`xxx`*` 系统变量只能在服务器启动时设置。因此，这些系统变量确定服务器为所有新连接使用的
    TLS 上下文。
- en: As of MySQL 8.0.16, the `tls_*`xxx`*` and `ssl_*`xxx`*` system variables are
    dynamic and can be set at runtime, not just at startup. If changed with [`SET
    GLOBAL`](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment"), the
    new values apply only until server restart. If changed with [`SET PERSIST`](set-variable.html
    "15.7.6.1 SET Syntax for Variable Assignment"), the new values also carry over
    to subsequent server restarts. See [Section 15.7.6.1, “SET Syntax for Variable
    Assignment”](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment").
    However, runtime changes to these variables do not immediately affect the TLS
    context for new connections, as explained later in this section.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 从 MySQL 8.0.16 开始，`tls_*`xxx`*` 和 `ssl_*`xxx`*` 系统变量是动态的，可以在运行时设置，而不仅仅是在启动时。如果使用
    [`SET GLOBAL`](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment")
    进行更改，新值仅在服务器重新启动之前有效。如果使用 [`SET PERSIST`](set-variable.html "15.7.6.1 SET Syntax
    for Variable Assignment") 进行更改，新值也会延续到后续的服务器重新启动。参见 [Section 15.7.6.1, “SET Syntax
    for Variable Assignment”](set-variable.html "15.7.6.1 SET Syntax for Variable
    Assignment")。然而，对这些变量的运行时更改不会立即影响新连接的 TLS 上下文，后文将对此进行解释。
- en: Along with the change in MySQL 8.0.16 that enables runtime changes to the TLS
    context-related system variables, the server enables runtime updates to the actual
    TLS context used for new connections. This capability may be useful, for example,
    to avoid restarting a MySQL server that has been running so long that its SSL
    certificate has expired.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 随着 MySQL 8.0.16 中的更改，使得可以在运行时更改与 TLS 上下文相关的系统变量，服务器还启用了对用于新连接的实际 TLS 上下文的运行时更新。例如，这种功能可能很有用，以避免重新启动运行时间过长以至于
    SSL 证书已过期的 MySQL 服务器。
- en: To create the initial TLS context, the server uses the values that the context-related
    system variables have at startup. To expose the context values, the server also
    initializes a set of corresponding status variables. The following table shows
    the system variables that define the TLS context and the corresponding status
    variables that expose the currently active context values.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建初始 TLS 上下文，服务器使用启动时上下文相关系统变量的值。为了公开上下文值，服务器还初始化了一组相应的状态变量。以下表格显示了定义 TLS 上下文的系统变量以及公开当前活动上下文值的相应状态变量。
- en: '**Table 8.12 System and Status Variables for Server Main Connection Interface
    TLS Context**'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '**表 8.12 服务器主连接接口 TLS 上下文的系统和状态变量**'
- en: '| System Variable Name | Corresponding Status Variable Name |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: 系统变量名称 | 对应的状态变量名称 |
- en: '| [`ssl_ca`](server-system-variables.html#sysvar_ssl_ca) | [`Current_tls_ca`](server-status-variables.html#statvar_Current_tls_ca)
    |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| [`ssl_ca`](server-system-variables.html#sysvar_ssl_ca) | [`Current_tls_ca`](server-status-variables.html#statvar_Current_tls_ca)
    |'
- en: '| [`ssl_capath`](server-system-variables.html#sysvar_ssl_capath) | [`Current_tls_capath`](server-status-variables.html#statvar_Current_tls_capath)
    |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| [`ssl_capath`](server-system-variables.html#sysvar_ssl_capath) | [`Current_tls_capath`](server-status-variables.html#statvar_Current_tls_capath)
    |'
- en: '| [`ssl_cert`](server-system-variables.html#sysvar_ssl_cert) | [`Current_tls_cert`](server-status-variables.html#statvar_Current_tls_cert)
    |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| [`ssl_cert`](server-system-variables.html#sysvar_ssl_cert) | [`Current_tls_cert`](server-status-variables.html#statvar_Current_tls_cert)
    |'
- en: '| [`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher) | [`Current_tls_cipher`](server-status-variables.html#statvar_Current_tls_cipher)
    |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| [`ssl_cipher`](server-system-variables.html#sysvar_ssl_cipher) | [`Current_tls_cipher`](server-status-variables.html#statvar_Current_tls_cipher)
    |'
- en: '| [`ssl_crl`](server-system-variables.html#sysvar_ssl_crl) | [`Current_tls_crl`](server-status-variables.html#statvar_Current_tls_crl)
    |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| [`ssl_crl`](server-system-variables.html#sysvar_ssl_crl) | [`Current_tls_crl`](server-status-variables.html#statvar_Current_tls_crl)
    |'
- en: '| [`ssl_crlpath`](server-system-variables.html#sysvar_ssl_crlpath) | [`Current_tls_crlpath`](server-status-variables.html#statvar_Current_tls_crlpath)
    |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| [`ssl_crlpath`](server-system-variables.html#sysvar_ssl_crlpath) | [`Current_tls_crlpath`](server-status-variables.html#statvar_Current_tls_crlpath)
    |'
- en: '| [`ssl_key`](server-system-variables.html#sysvar_ssl_key) | [`Current_tls_key`](server-status-variables.html#statvar_Current_tls_key)
    |'
  id: totrans-46
  prefs: []
  type: TYPE_TB
  zh: '| [`ssl_key`](server-system-variables.html#sysvar_ssl_key) | [`Current_tls_key`](server-status-variables.html#statvar_Current_tls_key)
    |'
- en: '| [`tls_ciphersuites`](server-system-variables.html#sysvar_tls_ciphersuites)
    | [`Current_tls_ciphersuites`](server-status-variables.html#statvar_Current_tls_ciphersuites)
    |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '| [`tls_ciphersuites`](server-system-variables.html#sysvar_tls_ciphersuites)
    | [`Current_tls_ciphersuites`](server-status-variables.html#statvar_Current_tls_ciphersuites)
    |'
- en: '| [`tls_version`](server-system-variables.html#sysvar_tls_version) | [`Current_tls_version`](server-status-variables.html#statvar_Current_tls_version)
    |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| [`tls_version`](server-system-variables.html#sysvar_tls_version) | [`Current_tls_version`](server-status-variables.html#statvar_Current_tls_version)
    |'
- en: As of MySQL 8.0.21, those active TLS context values are also exposed as properties
    in the Performance Schema [`tls_channel_status`](performance-schema-tls-channel-status-table.html
    "29.12.21.9 The tls_channel_status Table") table, along with the properties for
    any other active TLS contexts.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 截至 MySQL 8.0.21，这些活动的 TLS 上下文值也作为性能模式 [`tls_channel_status`](performance-schema-tls-channel-status-table.html
    "29.12.21.9 The tls_channel_status Table") 表中的属性公开，以及任何其他活动 TLS 上下文的属性。
- en: 'To reconfigure the TLS context at runtime, use this procedure:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 要在运行时重新配置 TLS 上下文，请使用以下过程：
- en: Set each TLS context-related system variable that should be changed to its new
    value.
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置每个应更改为新值的与 TLS 上下文相关的系统变量。
- en: Execute [`ALTER INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls).
    This statement reconfigures the active TLS context from the current values of
    the TLS context-related system variables. It also sets the context-related status
    variables to reflect the new active context values. The statement requires the
    [`CONNECTION_ADMIN`](privileges-provided.html#priv_connection-admin) privilege.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 执行[`ALTER INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)。该语句会从TLS上下文相关系统变量的当前值重新配置活动的TLS上下文。它还会设置相关状态变量以反映新的活动上下文值。该语句需要[`CONNECTION_ADMIN`](privileges-provided.html#priv_connection-admin)权限。
- en: New connections established after execution of [`ALTER INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)
    use the new TLS context. Existing connections remain unaffected. If existing connections
    should be terminated, use the [`KILL`](kill.html "15.7.8.4 KILL Statement") statement.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在执行[`ALTER INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)后建立的新连接将使用新的TLS上下文。现有连接不受影响。如果需要终止现有连接，请使用[`KILL`](kill.html
    "15.7.8.4 KILL Statement")语句。
- en: 'The members of each pair of system and status variables may have different
    values temporarily due to the way the reconfiguration procedure works:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 每对系统和状态变量的成员可能由于重新配置过程的方式而暂时具有不同的值：
- en: Changes to the system variables prior to [`ALTER INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)
    do not change the TLS context. At this point, those changes have no effect on
    new connections, and corresponding context-related system and status variables
    may have different values. This enables you to make any changes required to individual
    system variables, then update the active TLS context atomically with [`ALTER INSTANCE
    RELOAD TLS`](alter-instance.html#alter-instance-reload-tls) after all system variable
    changes have been made.
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在[`ALTER INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)之前对系统变量的更改不会改变TLS上下文。在这一点上，这些更改对新连接没有影响，相应的上下文相关系统和状态变量可能具有不同的值。这使您可以对个别系统变量进行任何所需的更改，然后在所有系统变量更改完成后使用[`ALTER
    INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)原子地更新活动的TLS上下文。
- en: After [`ALTER INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls),
    corresponding system and status variables have the same values. This remains true
    until the next change to the system variables.
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在[`ALTER INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)之后，相应的系统和状态变量具有相同的值。这种情况会一直持续，直到对系统变量进行下一次更改。
- en: In some cases, [`ALTER INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)
    by itself may suffice to reconfigure the TLS context, without changing any system
    variables. Suppose that the certificate in the file named by [`ssl_cert`](server-system-variables.html#sysvar_ssl_cert)
    has expired. It is sufficient to replace the existing file contents with a nonexpired
    certificate and execute [`ALTER INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)
    to cause the new file contents to be read and used for new connections.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，仅通过[`ALTER INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)可能足以重新配置TLS上下文，而无需更改任何系统变量。假设由[`ssl_cert`](server-system-variables.html#sysvar_ssl_cert)指定的文件中的证书已过期。只需用非过期证书替换现有文件内容，并执行[`ALTER
    INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)即可使新文件内容被读取并用于新连接。
- en: As of MySQL 8.0.21, the server implements independent connection-encryption
    configuration for the administrative connection interface. See [Administrative
    Interface Support for Encrypted Connections](administrative-connection-interface.html#administrative-interface-encrypted-connections
    "Administrative Interface Support for Encrypted Connections"). In addition, [`ALTER
    INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls) is extended
    with a `FOR CHANNEL` clause that enables specifying the channel (interface) for
    which to reload the TLS context. See [Section 15.1.5, “ALTER INSTANCE Statement”](alter-instance.html
    "15.1.5 ALTER INSTANCE Statement"). There are no status variables to expose the
    administrative interface TLS context, but the Performance Schema [`tls_channel_status`](performance-schema-tls-channel-status-table.html
    "29.12.21.9 The tls_channel_status Table") table exposes TLS properties for both
    the main and administrative interfaces. See [Section 29.12.21.9, “The tls_channel_status
    Table”](performance-schema-tls-channel-status-table.html "29.12.21.9 The tls_channel_status
    Table").
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 截至 MySQL 8.0.21，服务器为管理连接接口实现了独立的连接加密配置。请参阅 [Administrative Interface Support
    for Encrypted Connections](administrative-connection-interface.html#administrative-interface-encrypted-connections
    "Administrative Interface Support for Encrypted Connections")。此外，[`ALTER INSTANCE
    RELOAD TLS`](alter-instance.html#alter-instance-reload-tls) 还通过 `FOR CHANNEL`
    子句扩展，允许指定要重新加载 TLS 上下文的通道（接口）。请参阅 [Section 15.1.5, “ALTER INSTANCE Statement”](alter-instance.html
    "15.1.5 ALTER INSTANCE Statement")。没有状态变量来公开管理接口的 TLS 上下文，但是性能模式 [`tls_channel_status`](performance-schema-tls-channel-status-table.html
    "29.12.21.9 The tls_channel_status Table") 表公开了主接口和管理接口的 TLS 属性。请参阅 [Section 29.12.21.9,
    “The tls_channel_status Table”](performance-schema-tls-channel-status-table.html
    "29.12.21.9 The tls_channel_status Table")。
- en: 'Updating the main interface TLS context has these effects:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 更新主接口的 TLS 上下文会产生以下影响：
- en: The update changes the TLS context used for new connections on the main connection
    interface.
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此更新更改了主连接接口上用于新连接的 TLS 上下文。
- en: The update also changes the TLS context used for new connections on the administrative
    interface unless some nondefault TLS parameter value is configured for that interface.
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此更新还会更改管理接口上用于新连接的 TLS 上下文，除非为该接口配置了某些非默认的 TLS 参数值。
- en: 'The update does not affect the TLS context used by other enabled server plugins
    or components such as Group Replication or X Plugin:'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此更新不会影响其他已启用的服务器插件或组件（如 Group Replication 或 X Plugin）使用的 TLS 上下文：
- en: To apply the main interface reconfiguration to Group Replication's group communication
    connections, which take their settings from the server's TLS context-related system
    variables, you must execute [`STOP GROUP_REPLICATION`](stop-group-replication.html
    "15.4.3.2 STOP GROUP_REPLICATION Statement") followed by [`START GROUP_REPLICATION`](start-group-replication.html
    "15.4.3.1 START GROUP_REPLICATION Statement") to stop and restart Group Replication.
  id: totrans-63
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要将主接口重新配置应用于 Group Replication 的组通信连接，这些连接从服务器的与 TLS 上下文相关的系统变量中获取其设置，必须执行 [`STOP
    GROUP_REPLICATION`](stop-group-replication.html "15.4.3.2 STOP GROUP_REPLICATION
    Statement")，然后执行 [`START GROUP_REPLICATION`](start-group-replication.html "15.4.3.1 START
    GROUP_REPLICATION Statement") 来停止并重新启动 Group Replication。
- en: X Plugin initializes its TLS context at plugin initialization as described at
    [Section 22.5.3, “Using Encrypted Connections with X Plugin”](x-plugin-encrypted-connections.html
    "22.5.3 Using Encrypted Connections with X Plugin"). This context does not change
    thereafter.
  id: totrans-64
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: X Plugin 在插件初始化时初始化其 TLS 上下文，如 [Section 22.5.3, “Using Encrypted Connections
    with X Plugin”](x-plugin-encrypted-connections.html "22.5.3 Using Encrypted Connections
    with X Plugin") 中所述。此上下文之后不会更改。
- en: By default, the `RELOAD TLS` action rolls back with an error and has no effect
    if the configuration values do not permit creation of the new TLS context. The
    previous context values continue to be used for new connections. If the optional
    `NO ROLLBACK ON ERROR` clause is given and the new context cannot be created,
    rollback does not occur. Instead, a warning is generated and encryption is disabled
    for new connections on the interface to which the statement applies.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，如果配置值不允许创建新的 TLS 上下文，则 `RELOAD TLS` 操作将出现错误并且不会生效。先前的上下文值将继续用于新连接。如果给定了可选的
    `NO ROLLBACK ON ERROR` 子句并且无法创建新上下文，则不会发生回滚。相反，会生成警告，并且在适用语句的接口上为新连接禁用加密。
- en: Options that enable or disable encrypted connections on a connection interface
    have an effect only at startup. For example, the [`--ssl`](server-options.html#option_mysqld_ssl)
    and [`--admin-ssl`](server-options.html#option_mysqld_admin-ssl) options affect
    only at startup whether the main and administrative interfaces support encrypted
    connections. Such options are ignored and have no effect on the operation of [`ALTER
    INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls) at runtime.
    For example, you can use [`--ssl=OFF`](server-options.html#option_mysqld_ssl)
    to start the server with encrypted connections disabled on the main interface,
    then reconfigure TLS and execute [`ALTER INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)
    to enable encrypted connections at runtime.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在连接接口上启用或禁用加密连接的选项仅在启动时生效。例如，[`--ssl`](server-options.html#option_mysqld_ssl)和[`--admin-ssl`](server-options.html#option_mysqld_admin-ssl)选项仅在启动时影响主要和管理接口是否支持加密连接。这些选项在运行时被忽略，对[`ALTER
    INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)的操作没有影响。例如，您可以使用[`--ssl=OFF`](server-options.html#option_mysqld_ssl)在主接口上禁用加密连接启动服务器，然后重新配置TLS并执行[`ALTER
    INSTANCE RELOAD TLS`](alter-instance.html#alter-instance-reload-tls)在运行时启用加密连接。
- en: Client-Side Configuration for Encrypted Connections
  id: totrans-67
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 客户端端加密连接的配置
- en: For a complete list of client options related to establishment of encrypted
    connections, see [Command Options for Encrypted Connections](connection-options.html#encrypted-connection-options
    "Command Options for Encrypted Connections").
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 有关与建立加密连接相关的客户端选项的完整列表，请参阅[加密连接的命令选项](connection-options.html#encrypted-connection-options
    "加密连接的命令选项")。
- en: 'By default, MySQL client programs attempt to establish an encrypted connection
    if the server supports encrypted connections, with further control available through
    the [`--ssl-mode`](connection-options.html#option_general_ssl-mode) option:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，如果服务器支持加密连接，MySQL客户端程序会尝试建立加密连接，进一步的控制可以通过[`--ssl-mode`](connection-options.html#option_general_ssl-mode)选项进行设置：
- en: In the absence of an [`--ssl-mode`](connection-options.html#option_general_ssl-mode)
    option, clients attempt to connect using encryption, falling back to an unencrypted
    connection if an encrypted connection cannot be established. This is also the
    behavior with an explicit [`--ssl-mode=PREFERRED`](connection-options.html#option_general_ssl-mode)
    option.
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在没有[`--ssl-mode`](connection-options.html#option_general_ssl-mode)选项的情况下，客户端尝试使用加密连接进行连接，如果无法建立加密连接，则退回到未加密连接。这也是在明确指定[`--ssl-mode=PREFERRED`](connection-options.html#option_general_ssl-mode)选项时的行为。
- en: With [`--ssl-mode=REQUIRED`](connection-options.html#option_general_ssl-mode),
    clients require an encrypted connection and fail if one cannot be established.
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用[`--ssl-mode=REQUIRED`](connection-options.html#option_general_ssl-mode)，客户端需要一个加密连接，如果无法建立加密连接则失败。
- en: With [`--ssl-mode=DISABLED`](connection-options.html#option_general_ssl-mode),
    clients use an unencrypted connection.
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用[`--ssl-mode=DISABLED`](connection-options.html#option_general_ssl-mode)，客户端使用一个未加密的连接。
- en: With [`--ssl-mode=VERIFY_CA`](connection-options.html#option_general_ssl-mode)
    or [`--ssl-mode=VERIFY_IDENTITY`](connection-options.html#option_general_ssl-mode),
    clients require an encrypted connection, and also perform verification against
    the server CA certificate and (with `VERIFY_IDENTITY`) against the server host
    name in its certificate.
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用[`--ssl-mode=VERIFY_CA`](connection-options.html#option_general_ssl-mode)或[`--ssl-mode=VERIFY_IDENTITY`](connection-options.html#option_general_ssl-mode)，客户端需要一个加密连接，并且还会对服务器CA证书进行验证，并且（使用`VERIFY_IDENTITY`）对其证书中的服务器主机名进行验证。
- en: Important
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: The default setting, [`--ssl-mode=PREFERRED`](connection-options.html#option_general_ssl-mode),
    produces an encrypted connection if the other default settings are unchanged.
    However, to help prevent sophisticated man-in-the-middle attacks, it is important
    for the client to verify the server’s identity. The settings [`--ssl-mode=VERIFY_CA`](connection-options.html#option_general_ssl-mode)
    and [`--ssl-mode=VERIFY_IDENTITY`](connection-options.html#option_general_ssl-mode)
    are a better choice than the default setting to help prevent this type of attack.
    `VERIFY_CA` makes the client check that the server’s certificate is valid. `VERIFY_IDENTITY`
    makes the client check that the server’s certificate is valid, and also makes
    the client check that the host name the client is using matches the identity in
    the server’s certificate. To implement one of these settings, you must first ensure
    that the CA certificate for the server is reliably available to all the clients
    that use it in your environment, otherwise availability issues will result. For
    this reason, they are not the default setting.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 默认设置[`--ssl-mode=PREFERRED`](connection-options.html#option_general_ssl-mode)如果其他默认设置未更改，则会产生加密连接。然而，为了防止复杂的中间人攻击，客户端验证服务器的身份非常重要。设置[`--ssl-mode=VERIFY_CA`](connection-options.html#option_general_ssl-mode)和[`--ssl-mode=VERIFY_IDENTITY`](connection-options.html#option_general_ssl-mode)比默认设置更好，以帮助防止这种类型的攻击。`VERIFY_CA`使客户端检查服务器的证书是否有效。`VERIFY_IDENTITY`使客户端检查服务器的证书是否有效，并且使客户端检查客户端使用的主机名是否与服务器证书中的身份匹配。要实施这些设置之一，您必须首先确保服务器的CA证书可靠地对所有在您的环境中使用它的客户端可用，否则将导致可用性问题。因此，它们不是默认设置。
- en: Attempts to establish an unencrypted connection fail if the [`require_secure_transport`](server-system-variables.html#sysvar_require_secure_transport)
    system variable is enabled on the server side to cause the server to require encrypted
    connections. See [Configuring Encrypted Connections as Mandatory](using-encrypted-connections.html#mandatory-encrypted-connections
    "Configuring Encrypted Connections as Mandatory").
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在服务器端启用了[`require_secure_transport`](server-system-variables.html#sysvar_require_secure_transport)系统变量以导致服务器要求加密连接，则尝试建立未加密连接将失败。请参阅[将加密连接配置为强制性](using-encrypted-connections.html#mandatory-encrypted-connections
    "将加密连接配置为强制性")。
- en: 'The following options on the client side identify the certificate and key files
    clients use when establishing encrypted connections to the server. They are similar
    to the [`ssl_ca`](server-system-variables.html#sysvar_ssl_ca), [`ssl_cert`](server-system-variables.html#sysvar_ssl_cert),
    and [`ssl_key`](server-system-variables.html#sysvar_ssl_key) system variables
    used on the server side, but [`--ssl-cert`](connection-options.html#option_general_ssl-cert)
    and [`--ssl-key`](connection-options.html#option_general_ssl-key) identify the
    client public and private key:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端端的以下选项标识客户端在与服务器建立加密连接时使用的证书和密钥文件。它们类似于服务器端使用的[`ssl_ca`](server-system-variables.html#sysvar_ssl_ca)、[`ssl_cert`](server-system-variables.html#sysvar_ssl_cert)和[`ssl_key`](server-system-variables.html#sysvar_ssl_key)系统变量，但[`--ssl-cert`](connection-options.html#option_general_ssl-cert)和[`--ssl-key`](connection-options.html#option_general_ssl-key)标识客户端的公钥和私钥：
- en: '[`--ssl-ca`](connection-options.html#option_general_ssl-ca): The path name
    of the Certificate Authority (CA) certificate file. This option, if used, must
    specify the same certificate used by the server. (`--ssl-capath` is similar but
    specifies the path name of a directory of CA certificate files.)'
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`--ssl-ca`](connection-options.html#option_general_ssl-ca)：证书颁发机构（CA）证书文件的路径名。如果使用此选项，必须指定与服务器使用的相同证书。(`--ssl-capath`类似，但指定CA证书文件目录的路径名。)'
- en: '[`--ssl-cert`](connection-options.html#option_general_ssl-cert): The path name
    of the client public key certificate file.'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`--ssl-cert`](connection-options.html#option_general_ssl-cert)：客户端公钥证书文件的路径名。'
- en: '[`--ssl-key`](connection-options.html#option_general_ssl-key): The path name
    of the client private key file.'
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`--ssl-key`](connection-options.html#option_general_ssl-key)：客户端私钥文件的路径名。'
- en: 'For additional security relative to that provided by the default encryption,
    clients can supply a CA certificate matching the one used by the server and enable
    host name identity verification. In this way, the server and client place their
    trust in the same CA certificate and the client verifies that the host to which
    it connected is the one intended:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 为了相对于默认加密提供额外的安全性，客户端可以提供与服务器使用的CA证书匹配的证书，并启用主机名身份验证。这样，服务器和客户端都信任同一CA证书，并且客户端验证连接的主机是预期的主机：
- en: To specify the CA certificate, use [`--ssl-ca`](connection-options.html#option_general_ssl-ca)
    (or [`--ssl-capath`](connection-options.html#option_general_ssl-capath)), and
    specify [`--ssl-mode=VERIFY_CA`](connection-options.html#option_general_ssl-mode).
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要指定CA证书，请使用[`--ssl-ca`](connection-options.html#option_general_ssl-ca)（或[`--ssl-capath`](connection-options.html#option_general_ssl-capath)），并指定[`--ssl-mode=VERIFY_CA`](connection-options.html#option_general_ssl-mode)。
- en: To enable host name identity verification as well, use [`--ssl-mode=VERIFY_IDENTITY`](connection-options.html#option_general_ssl-mode)
    rather than [`--ssl-mode=VERIFY_CA`](connection-options.html#option_general_ssl-mode).
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 若要启用主机名身份验证，请使用[`--ssl-mode=VERIFY_IDENTITY`](connection-options.html#option_general_ssl-mode)而不是[`--ssl-mode=VERIFY_CA`](connection-options.html#option_general_ssl-mode)。
- en: Note
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: Host name identity verification with `VERIFY_IDENTITY` does not work with self-signed
    certificates that are created automatically by the server or manually using [**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html
    "6.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files") (see [Section 8.3.3.1, “Creating
    SSL and RSA Certificates and Keys using MySQL”](creating-ssl-rsa-files-using-mysql.html
    "8.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL")). Such self-signed
    certificates do not contain the server name as the Common Name value.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`VERIFY_IDENTITY`进行主机名身份验证无法与服务器自动创建的自签名证书或使用[**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html
    "6.4.3 mysql_ssl_rsa_setup — 创建SSL/RSA文件")手动创建的证书一起使用（参见[第8.3.3.1节，“使用MySQL创建SSL和RSA证书和密钥”](creating-ssl-rsa-files-using-mysql.html
    "8.3.3.1 使用MySQL创建SSL和RSA证书和密钥")）。这些自签名证书不包含服务器名称作为通用名称值。
- en: Prior to MySQL 8.0.12, host name identity verification also does not work with
    certificates that specify the Common Name using wildcards because that name is
    compared verbatim to the server name.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在MySQL 8.0.12之前，主机名身份验证也无法与使用通配符指定通用名称的证书一起使用，因为该名称与服务器名称逐字比较。
- en: 'MySQL also provides these options for client-side encrypted-connection control:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL还为客户端提供了这些选项来控制客户端端的加密连接：
- en: '[`--ssl-cipher`](connection-options.html#option_general_ssl-cipher): The list
    of permissible ciphers for connection encryption.'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`--ssl-cipher`](connection-options.html#option_general_ssl-cipher): 连接加密的允许密码列表。'
- en: '[`--ssl-crl`](connection-options.html#option_general_ssl-crl): The path name
    of the file containing certificate revocation lists. (`--ssl-crlpath` is similar
    but specifies the path name of a directory of certificate revocation-list files.)'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`--ssl-crl`](connection-options.html#option_general_ssl-crl): 包含证书吊销列表的文件路径名。（`--ssl-crlpath`类似，但指定证书吊销列表文件目录的路径名。）'
- en: '[`--tls-version`](connection-options.html#option_general_tls-version), [`--tls-ciphersuites`](connection-options.html#option_general_tls-ciphersuites):
    The permitted encryption protocols and ciphersuites; see [Section 8.3.2, “Encrypted
    Connection TLS Protocols and Ciphers”](encrypted-connection-protocols-ciphers.html
    "8.3.2 Encrypted Connection TLS Protocols and Ciphers").'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`--tls-version`](connection-options.html#option_general_tls-version), [`--tls-ciphersuites`](connection-options.html#option_general_tls-ciphersuites):
    允许的加密协议和密码套件；参见[第8.3.2节，“加密连接TLS协议和密码”](encrypted-connection-protocols-ciphers.html
    "8.3.2 加密连接TLS协议和密码")。'
- en: Depending on the encryption requirements of the MySQL account used by a client,
    the client may be required to specify certain options to connect using encryption
    to the MySQL server.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 根据客户端使用的MySQL帐户的加密要求，客户端可能需要指定某些选项以使用加密连接到MySQL服务器。
- en: 'Suppose that you want to connect using an account that has no special encryption
    requirements or that was created using a [`CREATE USER`](create-user.html "15.7.1.3 CREATE
    USER Statement") statement that included the `REQUIRE SSL` clause. Assuming that
    the server supports encrypted connections, a client can connect using encryption
    with no [`--ssl-mode`](connection-options.html#option_general_ssl-mode) option
    or with an explicit [`--ssl-mode=PREFERRED`](connection-options.html#option_general_ssl-mode)
    option:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 假设您想使用没有特殊加密要求的帐户连接，或者使用包含`REQUIRE SSL`子句的[`CREATE USER`](create-user.html "15.7.1.3 CREATE
    USER语句")语句创建的帐户。假设服务器支持加密连接，客户端可以使用没有[`--ssl-mode`](connection-options.html#option_general_ssl-mode)选项或明确的[`--ssl-mode=PREFERRED`](connection-options.html#option_general_ssl-mode)选项连接使用加密：
- en: '[PRE2]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Or:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 或者：
- en: '[PRE3]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'For an account created with a `REQUIRE SSL` clause, the connection attempt
    fails if an encrypted connection cannot be established. For an account with no
    special encryption requirements, the attempt falls back to an unencrypted connection
    if an encrypted connection cannot be established. To prevent fallback and fail
    if an encrypted connection cannot be obtained, connect like this:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 对于使用`REQUIRE SSL`子句创建的帐户，如果无法建立加密连接，则连接尝试将失败。对于没有特殊加密要求的帐户，如果无法建立加密连接，则尝试回退到未加密连接。为了防止回退并在无法获取加密连接时失败，请这样连接：
- en: '[PRE4]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'If the account has more stringent security requirements, other options must
    be specified to establish an encrypted connection:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 如果帐户具有更严格的安全要求，则必须指定其他选项以建立加密连接：
- en: 'For accounts created with a `REQUIRE X509` clause, clients must specify at
    least [`--ssl-cert`](connection-options.html#option_general_ssl-cert) and [`--ssl-key`](connection-options.html#option_general_ssl-key).
    In addition, [`--ssl-ca`](connection-options.html#option_general_ssl-ca) (or [`--ssl-capath`](connection-options.html#option_general_ssl-capath))
    is recommended so that the public certificate provided by the server can be verified.
    For example (enter the command on a single line):'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于使用`REQUIRE X509`子句创建的帐户，客户端必须至少指定[`--ssl-cert`](connection-options.html#option_general_ssl-cert)和[`--ssl-key`](connection-options.html#option_general_ssl-key)。此外，建议使用[`--ssl-ca`](connection-options.html#option_general_ssl-ca)（或[`--ssl-capath`](connection-options.html#option_general_ssl-capath)）以便验证服务器提供的公共证书。例如（在一行上输入命令）：
- en: '[PRE5]'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: For accounts created with a `REQUIRE ISSUER` or `REQUIRE SUBJECT` clause, the
    encryption requirements are the same as for `REQUIRE X509`, but the certificate
    must match the issue or subject, respectively, specified in the account definition.
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于使用`REQUIRE ISSUER`或`REQUIRE SUBJECT`子句创建的帐户，加密要求与`REQUIRE X509`相同，但证书必须分别与帐户定义中指定的发行者或主题匹配。
- en: For additional information about the `REQUIRE` clause, see [Section 15.7.1.3,
    “CREATE USER Statement”](create-user.html "15.7.1.3 CREATE USER Statement").
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 有关`REQUIRE`子句的更多信息，请参见[第 15.7.1.3 节，“CREATE USER Statement”](create-user.html
    "15.7.1.3 CREATE USER Statement")。
- en: MySQL servers can generate client certificate and key files that clients can
    use to connect to MySQL server instances. See [Section 8.3.3, “Creating SSL and
    RSA Certificates and Keys”](creating-ssl-rsa-files.html "8.3.3 Creating SSL and
    RSA Certificates and Keys").
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL 服务器可以生成客户端证书和密钥文件，客户端可以使用这些文件连接到 MySQL 服务器实例。请参见[第 8.3.3 节，“创建 SSL 和 RSA
    证书和密钥”](creating-ssl-rsa-files.html "8.3.3 Creating SSL and RSA Certificates and
    Keys")。
- en: Important
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: If a client connecting to a MySQL server instance uses an SSL certificate with
    the `extendedKeyUsage` extension (an X.509 v3 extension), the extended key usage
    must include client authentication (`clientAuth`). If the SSL certificate is only
    specified for server authentication (`serverAuth`) and other non-client certificate
    purposes, certificate verification fails and the client connection to the MySQL
    server instance fails. There is no `extendedKeyUsage` extension in SSL certificates
    generated by MySQL Server (as described in [Section 8.3.3.1, “Creating SSL and
    RSA Certificates and Keys using MySQL”](creating-ssl-rsa-files-using-mysql.html
    "8.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL")), and SSL certificates
    created using the **openssl** command following the instructions in [Section 8.3.3.2,
    “Creating SSL Certificates and Keys Using openssl”](creating-ssl-files-using-openssl.html
    "8.3.3.2 Creating SSL Certificates and Keys Using openssl"). If you use your own
    client certificate created in another way, ensure any `extendedKeyUsage` extension
    includes client authentication.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 如果连接到 MySQL 服务器实例的客户端使用具有`extendedKeyUsage`扩展（X.509 v3扩展）的 SSL 证书，则扩展密钥用途必须包括客户端身份验证（`clientAuth`）。如果
    SSL 证书仅用于服务器身份验证（`serverAuth`）和其他非客户端证书目的，证书验证将失败，客户端连接到 MySQL 服务器实例将失败。MySQL
    Server 生成的 SSL 证书中没有`extendedKeyUsage`扩展（如[第 8.3.3.1 节，“使用 MySQL 创建 SSL 和 RSA
    证书和密钥”](creating-ssl-rsa-files-using-mysql.html "8.3.3.1 Creating SSL and RSA
    Certificates and Keys using MySQL")中所述），并且使用**openssl**命令创建的 SSL 证书遵循[第 8.3.3.2 节，“使用
    openssl 创建 SSL 证书和密钥”](creating-ssl-files-using-openssl.html "8.3.3.2 Creating
    SSL Certificates and Keys Using openssl")中的说明。如果使用其他方式创建的客户端证书，请确保任何`extendedKeyUsage`扩展包括客户端身份验证。
- en: 'To prevent use of encryption and override other `--ssl-*`xxx`*` options, invoke
    the client program with [`--ssl-mode=DISABLED`](connection-options.html#option_general_ssl-mode):'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止使用加密并覆盖其他`--ssl-*`xxx`*`选项，请使用[`--ssl-mode=DISABLED`](connection-options.html#option_general_ssl-mode)调用客户端程序：
- en: '[PRE6]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'To determine whether the current connection with the server uses encryption,
    check the session value of the [`Ssl_cipher`](server-status-variables.html#statvar_Ssl_cipher)
    status variable. If the value is empty, the connection is not encrypted. Otherwise,
    the connection is encrypted and the value indicates the encryption cipher. For
    example:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 要确定当前与服务器的连接是否使用加密，请检查 [`Ssl_cipher`](server-status-variables.html#statvar_Ssl_cipher)
    状态变量的会话值。如果值为空，则连接未加密。否则，连接已加密，并且该值指示加密密码。例如：
- en: '[PRE7]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'For the [**mysql**](mysql.html "6.5.1 mysql — The MySQL Command-Line Client")
    client, an alternative is to use the `STATUS` or `\s` command and check the `SSL`
    line:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 [**mysql**](mysql.html "6.5.1 mysql — The MySQL Command-Line Client") 客户端，另一种方法是使用
    `STATUS` 或 `\s` 命令并检查 `SSL` 行：
- en: '[PRE8]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Or:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 或者：
- en: '[PRE9]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Configuring Encrypted Connections as Mandatory
  id: totrans-114
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 配置加密连接为强制性
- en: 'For some MySQL deployments it may be not only desirable but mandatory to use
    encrypted connections (for example, to satisfy regulatory requirements). This
    section discusses configuration settings that enable you to do this. These levels
    of control are available:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 对于一些 MySQL 部署，使用加密连接可能不仅仅是可取的，而是强制性的（例如，为了满足监管要求）。本节讨论了使您能够执行此操作的配置设置。这些控制级别可用：
- en: You can configure the server to require that clients connect using encrypted
    connections.
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以配置服务器要求客户端使用加密连接进行连接。
- en: You can invoke individual client programs to require an encrypted connection,
    even if the server permits but does not require encryption.
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以调用单独的客户端程序要求加密连接，即使服务器允许但不要求加密。
- en: You can configure individual MySQL accounts to be usable only over encrypted
    connections.
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以配置单独的 MySQL 帐户仅在加密连接上可用。
- en: 'To require that clients connect using encrypted connections, enable the [`require_secure_transport`](server-system-variables.html#sysvar_require_secure_transport)
    system variable. For example, put these lines in the server `my.cnf` file:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 要求客户端使用加密连接连接，请启用 [`require_secure_transport`](server-system-variables.html#sysvar_require_secure_transport)
    系统变量。例如，在服务器的 `my.cnf` 文件中添加以下行：
- en: '[PRE10]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Alternatively, to set and persist the value at runtime, use this statement:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，要在运行时设置并持久化该值，请使用以下语句：
- en: '[PRE11]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '[`SET PERSIST`](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment")
    sets a value for the running MySQL instance. It also saves the value, causing
    it to be used for subsequent server restarts. See [Section 15.7.6.1, “SET Syntax
    for Variable Assignment”](set-variable.html "15.7.6.1 SET Syntax for Variable
    Assignment").'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '[`SET PERSIST`](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment")
    为运行中的 MySQL 实例设置一个值。它还保存该值，导致其在后续服务器重启时使用。参见 [Section 15.7.6.1, “SET Syntax for
    Variable Assignment”](set-variable.html "15.7.6.1 SET Syntax for Variable Assignment")。'
- en: With [`require_secure_transport`](server-system-variables.html#sysvar_require_secure_transport)
    enabled, client connections to the server are required to use some form of secure
    transport, and the server permits only TCP/IP connections that use SSL, or connections
    that use a socket file (on Unix) or shared memory (on Windows). The server rejects
    nonsecure connection attempts, which fail with an [`ER_SECURE_TRANSPORT_REQUIRED`](/doc/mysql-errors/8.0/en/server-error-reference.html#error_er_secure_transport_required)
    error.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 启用 [`require_secure_transport`](server-system-variables.html#sysvar_require_secure_transport)
    后，客户端连接到服务器需要使用某种形式的安全传输，服务器仅允许使用 SSL 的 TCP/IP 连接，或者使用套接字文件（在 Unix 上）或共享内存（在 Windows
    上）的连接。服务器拒绝非安全连接尝试，这些尝试将因 [`ER_SECURE_TRANSPORT_REQUIRED`](/doc/mysql-errors/8.0/en/server-error-reference.html#error_er_secure_transport_required)
    错误而失败。
- en: 'To invoke a client program such that it requires an encrypted connection whether
    or not the server requires encryption, use an [`--ssl-mode`](connection-options.html#option_general_ssl-mode)
    option value of `REQUIRED`, `VERIFY_CA`, or `VERIFY_IDENTITY`. For example:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 要调用客户端程序，使其要求加密连接，无论服务器是否要求加密，请使用 [`--ssl-mode`](connection-options.html#option_general_ssl-mode)
    选项值 `REQUIRED`、`VERIFY_CA` 或 `VERIFY_IDENTITY`。例如：
- en: '[PRE12]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'To configure a MySQL account to be usable only over encrypted connections,
    include a `REQUIRE` clause in the [`CREATE USER`](create-user.html "15.7.1.3 CREATE
    USER Statement") statement that creates the account, specifying in that clause
    the encryption characteristics you require. For example, to require an encrypted
    connection and the use of a valid X.509 certificate, use `REQUIRE X509`:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置一个 MySQL 帐户仅在加密连接上可用，请在创建帐户的 [`CREATE USER`](create-user.html "15.7.1.3 CREATE
    USER Statement") 语句中包含一个 `REQUIRE` 子句，指定您需要的加密特性。例如，要求加密连接和使用有效的 X.509 证书，使用 `REQUIRE
    X509`：
- en: '[PRE13]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: For additional information about the `REQUIRE` clause, see [Section 15.7.1.3,
    “CREATE USER Statement”](create-user.html "15.7.1.3 CREATE USER Statement").
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 有关`REQUIRE`子句的更多信息，请参见[第15.7.1.3节，“CREATE USER Statement”](create-user.html
    "15.7.1.3 CREATE USER Statement")。
- en: To modify existing accounts that have no encryption requirements, use the [`ALTER
    USER`](alter-user.html "15.7.1.1 ALTER USER Statement") statement.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 要修改没有加密要求的现有帐户，请使用[`ALTER USER`](alter-user.html "15.7.1.1 ALTER USER Statement")语句。

- en: 原文：[https://dev.mysql.com/doc/refman/8.0/en/creating-ssl-rsa-files-using-mysql.html](https://dev.mysql.com/doc/refman/8.0/en/creating-ssl-rsa-files-using-mysql.html)
  id: totrans-0
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://dev.mysql.com/doc/refman/8.0/en/creating-ssl-rsa-files-using-mysql.html](https://dev.mysql.com/doc/refman/8.0/en/creating-ssl-rsa-files-using-mysql.html)
- en: 8.3.3.1 Creating SSL and RSA Certificates and Keys using MySQL
  id: totrans-1
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 8.3.3.1 使用MySQL创建SSL和RSA证书和密钥
- en: 'MySQL provides these ways to create the SSL certificate and key files and RSA
    key-pair files required to support encrypted connections using SSL and secure
    password exchange using RSA over unencrypted connections, if those files are missing:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL提供了以下方法来创建SSL证书和密钥文件以及RSA密钥对文件，以支持使用SSL进行加密连接和在未加密连接上使用RSA进行安全密码交换，如果这些文件丢失：
- en: The server can autogenerate these files at startup, for MySQL distributions.
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器可以在启动时自动生成这些文件，适用于MySQL发行版。
- en: Users can invoke the [**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html "6.4.3 mysql_ssl_rsa_setup
    — Create SSL/RSA Files") utility manually (deprecated as of MySQL 8.0.34).
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户可以手动调用[**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html "6.4.3 mysql_ssl_rsa_setup
    — 创建SSL/RSA文件")实用程序（自MySQL 8.0.34起已弃用）。
- en: For some distribution types, such as RPM and DEB packages, [**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html
    "6.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files") invocation occurs during data
    directory initialization. In this case, the MySQL distribution need not have been
    compiled using OpenSSL as long as the **openssl** command is available.
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于某些发行类型，如RPM和DEB软件包，[**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html "6.4.3 mysql_ssl_rsa_setup
    — 创建SSL/RSA文件")在数据目录初始化期间调用。在这种情况下，只要**openssl**命令可用，MySQL发行版不必使用OpenSSL进行编译。
- en: Important
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 重要
- en: Server autogeneration and [**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html
    "6.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files") help lower the barrier to
    using SSL by making it easier to generate the required files. However, certificates
    generated by these methods are self-signed, which may not be very secure. After
    you gain experience using such files, consider obtaining certificate/key material
    from a registered certificate authority.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器自动生成和[**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html "6.4.3 mysql_ssl_rsa_setup
    — 创建SSL/RSA文件")有助于降低使用SSL的门槛，使生成所需文件变得更容易。然而，通过这些方法生成的证书是自签名的，可能不太安全。在您获得使用这些文件的经验后，考虑从注册的证书颁发机构获取证书/密钥材料。
- en: Important
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 重要
- en: If a client connecting to a MySQL server instance uses an SSL certificate with
    the `extendedKeyUsage` extension (an X.509 v3 extension), the extended key usage
    must include client authentication (`clientAuth`). If the SSL certificate is only
    specified for server authentication (`serverAuth`) and other non-client certificate
    purposes, certificate verification fails and the client connection to the MySQL
    server instance fails. There is no `extendedKeyUsage` extension in SSL certificates
    generated by MySQL Server. If you use your own client certificate created in another
    way, ensure any `extendedKeyUsage` extension includes client authentication.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 如果连接到MySQL服务器实例的客户端使用带有`extendedKeyUsage`扩展（X.509 v3扩展）的SSL证书，则扩展密钥用途必须包括客户端认证（`clientAuth`）。如果SSL证书仅指定用于服务器认证（`serverAuth`）和其他非客户端证书目的，证书验证将失败，客户端连接到MySQL服务器实例将失败。MySQL服务器生成的SSL证书中没有`extendedKeyUsage`扩展。如果您使用另一种方式创建的自己的客户端证书，请确保任何`extendedKeyUsage`扩展包括客户端认证。
- en: '[Automatic SSL and RSA File Generation](creating-ssl-rsa-files-using-mysql.html#creating-ssl-rsa-files-using-mysql-automatic
    "Automatic SSL and RSA File Generation")'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[自动SSL和RSA文件生成](creating-ssl-rsa-files-using-mysql.html#creating-ssl-rsa-files-using-mysql-automatic
    "自动SSL和RSA文件生成")'
- en: '[Manual SSL and RSA File Generation Using mysql_ssl_rsa_setup](creating-ssl-rsa-files-using-mysql.html#creating-ssl-rsa-files-using-mysql-manual-using-mysql-ssl-rsa-setup
    "Manual SSL and RSA File Generation Using mysql_ssl_rsa_setup")'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[使用mysql_ssl_rsa_setup手动生成SSL和RSA文件](creating-ssl-rsa-files-using-mysql.html#creating-ssl-rsa-files-using-mysql-manual-using-mysql-ssl-rsa-setup
    "使用mysql_ssl_rsa_setup手动生成SSL和RSA文件")'
- en: '[SSL and RSA File Characteristics](creating-ssl-rsa-files-using-mysql.html#creating-ssl-rsa-files-using-mysql-ssl-and-rsa-file-characteristics
    "SSL and RSA File Characteristics")'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[SSL和RSA文件特性](creating-ssl-rsa-files-using-mysql.html#creating-ssl-rsa-files-using-mysql-ssl-and-rsa-file-characteristics
    "SSL和RSA文件特性")'
- en: Automatic SSL and RSA File Generation
  id: totrans-13
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 自动SSL和RSA文件生成
- en: For MySQL distributions compiled using OpenSSL, the MySQL server has the capability
    of automatically generating missing SSL and RSA files at startup. The [`auto_generate_certs`](server-system-variables.html#sysvar_auto_generate_certs),
    [`sha256_password_auto_generate_rsa_keys`](server-system-variables.html#sysvar_sha256_password_auto_generate_rsa_keys),
    and [`caching_sha2_password_auto_generate_rsa_keys`](server-system-variables.html#sysvar_caching_sha2_password_auto_generate_rsa_keys)
    system variables control automatic generation of these files. These variables
    are enabled by default. They can be enabled at startup and inspected but not set
    at runtime.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 对于使用OpenSSL编译的MySQL发行版，MySQL服务器具有在启动时自动生成缺失的SSL和RSA文件的能力。[`auto_generate_certs`](server-system-variables.html#sysvar_auto_generate_certs)、[`sha256_password_auto_generate_rsa_keys`](server-system-variables.html#sysvar_sha256_password_auto_generate_rsa_keys)和[`caching_sha2_password_auto_generate_rsa_keys`](server-system-variables.html#sysvar_caching_sha2_password_auto_generate_rsa_keys)系统变量控制这些文件的自动生成。这些变量默认启用。它们可以在启动时启用和检查，但不能在运行时设置。
- en: At startup, the server automatically generates server-side and client-side SSL
    certificate and key files in the data directory if the [`auto_generate_certs`](server-system-variables.html#sysvar_auto_generate_certs)
    system variable is enabled, no SSL options other than [`--ssl`](server-options.html#option_mysqld_ssl)
    are specified, and the server-side SSL files are missing from the data directory.
    These files enable encrypted client connections using SSL; see [Section 8.3.1,
    “Configuring MySQL to Use Encrypted Connections”](using-encrypted-connections.html
    "8.3.1 Configuring MySQL to Use Encrypted Connections").
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在启动时，如果启用了[`auto_generate_certs`](server-system-variables.html#sysvar_auto_generate_certs)系统变量，没有指定除[`--ssl`](server-options.html#option_mysqld_ssl)之外的其他SSL选项，并且数据目录中缺少服务器端SSL文件，则服务器会自动在数据目录中生成服务器端和客户端SSL证书和密钥文件。这些文件使得可以使用SSL加密客户端连接；参见[第8.3.1节，“配置MySQL使用加密连接”](using-encrypted-connections.html
    "8.3.1 配置MySQL使用加密连接")。
- en: 'The server checks the data directory for SSL files with the following names:'
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 服务器检查数据目录中具有以下名称的SSL文件：
- en: '[PRE0]'
  id: totrans-17
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'If any of those files are present, the server creates no SSL files. Otherwise,
    it creates them, plus some additional files:'
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果存在任何这些文件，则服务器不会创建SSL文件。否则，它会创建它们，以及一些额外的文件：
- en: '[PRE1]'
  id: totrans-19
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: If the server autogenerates SSL files, it uses the names of the `ca.pem`, `server-cert.pem`,
    and `server-key.pem` files to set the corresponding system variables ([`ssl_ca`](server-system-variables.html#sysvar_ssl_ca),
    [`ssl_cert`](server-system-variables.html#sysvar_ssl_cert), [`ssl_key`](server-system-variables.html#sysvar_ssl_key)).
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果服务器自动生成SSL文件，则使用`ca.pem`、`server-cert.pem`和`server-key.pem`文件的名称来设置相应的系统变量（[`ssl_ca`](server-system-variables.html#sysvar_ssl_ca)、[`ssl_cert`](server-system-variables.html#sysvar_ssl_cert)、[`ssl_key`](server-system-variables.html#sysvar_ssl_key)）。
- en: 'At startup, the server automatically generates RSA private/public key-pair
    files in the data directory if all of these conditions are true: The [`sha256_password_auto_generate_rsa_keys`](server-system-variables.html#sysvar_sha256_password_auto_generate_rsa_keys)
    or [`caching_sha2_password_auto_generate_rsa_keys`](server-system-variables.html#sysvar_caching_sha2_password_auto_generate_rsa_keys)
    system variable is enabled; no RSA options are specified; the RSA files are missing
    from the data directory. These key-pair files enable secure password exchange
    using RSA over unencrypted connections for accounts authenticated by the `sha256_password`
    or `caching_sha2_password` plugin; see [Section 8.4.1.3, “SHA-256 Pluggable Authentication”](sha256-pluggable-authentication.html
    "8.4.1.3 SHA-256 Pluggable Authentication"), and [Section 8.4.1.2, “Caching SHA-2
    Pluggable Authentication”](caching-sha2-pluggable-authentication.html "8.4.1.2 Caching
    SHA-2 Pluggable Authentication").'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在启动时，如果满足以下所有条件，则服务器会自动在数据目录中生成RSA私钥/公钥对文件：启用了[`sha256_password_auto_generate_rsa_keys`](server-system-variables.html#sysvar_sha256_password_auto_generate_rsa_keys)或[`caching_sha2_password_auto_generate_rsa_keys`](server-system-variables.html#sysvar_caching_sha2_password_auto_generate_rsa_keys)系统变量；未指定RSA选项；数据目录中缺少RSA文件。这些密钥对文件使得可以在通过`sha256_password`或`caching_sha2_password`插件进行身份验证的帐户之间使用RSA在未加密连接上进行安全密码交换；参见[第8.4.1.3节，“SHA-256可插拔认证”](sha256-pluggable-authentication.html
    "8.4.1.3 SHA-256可插拔认证")和[第8.4.1.2节，“缓存SHA-2可插拔认证”](caching-sha2-pluggable-authentication.html
    "8.4.1.2 缓存SHA-2可插拔认证")。
- en: 'The server checks the data directory for RSA files with the following names:'
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 服务器检查数据目录中具有以下名称的RSA文件：
- en: '[PRE2]'
  id: totrans-23
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: If any of these files are present, the server creates no RSA files. Otherwise,
    it creates them.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果存在任何这些文件，则服务器不会创建RSA文件。否则，它会创建它们。
- en: If the server autogenerates the RSA files, it uses their names to set the corresponding
    system variables ([`sha256_password_private_key_path`](server-system-variables.html#sysvar_sha256_password_private_key_path)
    and [`sha256_password_public_key_path`](server-system-variables.html#sysvar_sha256_password_public_key_path);
    [`caching_sha2_password_private_key_path`](server-system-variables.html#sysvar_caching_sha2_password_private_key_path)
    and [`caching_sha2_password_public_key_path`](server-system-variables.html#sysvar_caching_sha2_password_public_key_path)).
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果服务器自动生成RSA文件，则使用它们的名称来设置相应的系统变量([`sha256_password_private_key_path`](server-system-variables.html#sysvar_sha256_password_private_key_path)和[`sha256_password_public_key_path`](server-system-variables.html#sysvar_sha256_password_public_key_path);
    [`caching_sha2_password_private_key_path`](server-system-variables.html#sysvar_caching_sha2_password_private_key_path)和[`caching_sha2_password_public_key_path`](server-system-variables.html#sysvar_caching_sha2_password_public_key_path))。
- en: Manual SSL and RSA File Generation Using mysql_ssl_rsa_setup
  id: totrans-26
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 使用mysql_ssl_rsa_setup手动生成SSL和RSA文件
- en: MySQL distributions include a [**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html
    "6.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files") utility (deprecated as of
    MySQL 8.0.34) that can be invoked manually to generate SSL and RSA files. This
    utility is included with all MySQL distributions, but it does require that the
    **openssl** command be available. For usage instructions, see [Section 6.4.3,
    “mysql_ssl_rsa_setup — Create SSL/RSA Files”](mysql-ssl-rsa-setup.html "6.4.3 mysql_ssl_rsa_setup
    — Create SSL/RSA Files").
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL发行版包含一个[**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html "6.4.3 mysql_ssl_rsa_setup
    — Create SSL/RSA Files")实用程序（自MySQL 8.0.34起已弃用），可以手动调用以生成SSL和RSA文件。该实用程序包含在所有MySQL发行版中，但需要**openssl**命令可用。有关使用说明，请参见[第6.4.3节，“mysql_ssl_rsa_setup
    — Create SSL/RSA Files”](mysql-ssl-rsa-setup.html "6.4.3 mysql_ssl_rsa_setup —
    Create SSL/RSA Files")。
- en: SSL and RSA File Characteristics
  id: totrans-28
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: SSL和RSA文件特征
- en: 'SSL and RSA files created automatically by the server or by invoking [**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html
    "6.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files") have these characteristics:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器自动创建的SSL和RSA文件或通过调用[**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html "6.4.3 mysql_ssl_rsa_setup
    — Create SSL/RSA Files")创建的文件具有以下特征：
- en: SSL and RSA have a size of 2048 bits.
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSL和RSA的位数为2048位。
- en: The SSL CA certificate is self signed.
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSL CA证书是自签名的。
- en: The SSL server and client certificates are signed with the CA certificate and
    key, using the `sha256WithRSAEncryption` signature algorithm.
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSL服务器和客户端证书使用CA证书和密钥签名，使用`sha256WithRSAEncryption`签名算法。
- en: 'SSL certificates use these Common Name (CN) values, with the appropriate certificate
    type (CA, Server, Client):'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSL证书使用这些通用名称（CN）值，具有适当的证书类型（CA、服务器、客户端）：
- en: '[PRE3]'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The *`suffix`* value is based on the MySQL version number. For files generated
    by [**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html "6.4.3 mysql_ssl_rsa_setup
    — Create SSL/RSA Files"), the suffix can be specified explicitly using the [`--suffix`](mysql-ssl-rsa-setup.html#option_mysql_ssl_rsa_setup_suffix)
    option.
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '*`suffix`*值基于MySQL版本号。对于由[**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html
    "6.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files")生成的文件，可以使用[`--suffix`](mysql-ssl-rsa-setup.html#option_mysql_ssl_rsa_setup_suffix)选项显式指定后缀。'
- en: For files generated by the server, if the resulting CN values exceed 64 characters,
    the `_*`suffix`*` portion of the name is omitted.
  id: totrans-36
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 对于服务器生成的文件，如果结果CN值超过64个字符，则名称的`_*`后缀部分将被省略。
- en: SSL files have blank values for Country (C), State or Province (ST), Organization
    (O), Organization Unit Name (OU) and email address.
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSL文件的国家（C）、州或省（ST）、组织（O）、组织单位名称（OU）和电子邮件地址为空值。
- en: SSL files created by the server or by [**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html
    "6.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files") are valid for ten years from
    the time of generation.
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由服务器或[**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html "6.4.3 mysql_ssl_rsa_setup
    — Create SSL/RSA Files")生成的SSL文件从生成时起有效期为十年。
- en: RSA files do not expire.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RSA文件不会过期。
- en: SSL files have different serial numbers for each certificate/key pair (1 for
    CA, 2 for Server, 3 for Client).
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SSL文件对于每个证书/密钥对具有不同的序列号（CA为1，服务器为2，客户端为3）。
- en: Files created automatically by the server are owned by the account that runs
    the server. Files created using [**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html
    "6.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files") are owned by the user who
    invoked that program. This can be changed on systems that support the `chown()`
    system call if the program is invoked by `root` and the [`--uid`](mysql-ssl-rsa-setup.html#option_mysql_ssl_rsa_setup_uid)
    option is given to specify the user who should own the files.
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器自动创建的文件归属于运行服务器的账户。使用 [**mysql_ssl_rsa_setup**](mysql-ssl-rsa-setup.html
    "6.4.3 mysql_ssl_rsa_setup — Create SSL/RSA Files") 创建的文件归属于调用该程序的用户。在支持 `chown()`
    系统调用的系统上，如果程序由 `root` 调用并且提供了 [`--uid`](mysql-ssl-rsa-setup.html#option_mysql_ssl_rsa_setup_uid)
    选项来指定应该拥有这些文件的用户，则可以更改这一点。
- en: On Unix and Unix-like systems, the file access mode is 644 for certificate files
    (that is, world readable) and 600 for key files (that is, accessible only by the
    account that runs the server).
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Unix 和类 Unix 系统上，证书文件的文件访问模式为 644（即，全局可读），密钥文件的文件访问模式为 600（即，只能由运行服务器的账户访问）。
- en: 'To see the contents of an SSL certificate (for example, to check the range
    of dates over which it is valid), invoke **openssl** directly:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看 SSL 证书的内容（例如，检查其有效日期范围），可以直接调用 **openssl**：
- en: '[PRE4]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'It is also possible to check SSL certificate expiration information using this
    SQL statement:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下 SQL 语句也可以检查 SSL 证书的过期信息：
- en: '[PRE5]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'

- en: 原文：[https://dev.mysql.com/doc/refman/8.0/en/xa-statements.html](https://dev.mysql.com/doc/refman/8.0/en/xa-statements.html)
  id: totrans-0
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 原文：[https://dev.mysql.com/doc/refman/8.0/en/xa-statements.html](https://dev.mysql.com/doc/refman/8.0/en/xa-statements.html)
- en: 15.3.8.1 XA Transaction SQL Statements
  id: totrans-1
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 15.3.8.1 XA 事务 SQL 语句
- en: 'To perform XA transactions in MySQL, use the following statements:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 MySQL 中执行 XA 事务，请使用以下语句：
- en: '[PRE0]'
  id: totrans-3
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: For [`XA START`](xa-statements.html "15.3.8.1 XA Transaction SQL Statements"),
    the `JOIN` and `RESUME` clauses are recognized but have no effect.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 [`XA START`](xa-statements.html "15.3.8.1 XA Transaction SQL Statements")，`JOIN`
    和 `RESUME` 子句被识别但没有效果。
- en: For [`XA END`](xa-statements.html "15.3.8.1 XA Transaction SQL Statements")
    the `SUSPEND [FOR MIGRATE]` clause is recognized but has no effect.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 [`XA END`](xa-statements.html "15.3.8.1 XA Transaction SQL Statements")，`SUSPEND
    [FOR MIGRATE]` 子句被识别但没有效果。
- en: 'Each XA statement begins with the `XA` keyword, and most of them require an
    *`xid`* value. An *`xid`* is an XA transaction identifier. It indicates which
    transaction the statement applies to. *`xid`* values are supplied by the client,
    or generated by the MySQL server. An *`xid`* value has from one to three parts:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 每个 XA 语句都以 `XA` 关键字开头，大多数需要一个 *`xid`* 值。*`xid`* 是一个 XA 事务标识符。它指示语句适用于哪个事务。*`xid`*
    值由客户端提供，或由 MySQL 服务器生成。*`xid`* 值有一到三部分：
- en: '[PRE1]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '*`gtrid`* is a global transaction identifier, *`bqual`* is a branch qualifier,
    and *`formatID`* is a number that identifies the format used by the *`gtrid`*
    and *`bqual`* values. As indicated by the syntax, *`bqual`* and *`formatID`* are
    optional. The default *`bqual`* value is `''''` if not given. The default *`formatID`*
    value is 1 if not given.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '*`gtrid`* 是全局事务标识符，*`bqual`* 是分支限定符，*`formatID`* 是标识 *`gtrid`* 和 *`bqual`*
    值使用的格式的数字。如语法所示，*`bqual`* 和 *`formatID`* 是可选的。如果未给出，默认 *`bqual`* 值为 `''''`。如果未给出，默认
    *`formatID`* 值为 1。'
- en: '*`gtrid`* and *`bqual`* must be string literals, each up to 64 bytes (not characters)
    long. *`gtrid`* and *`bqual`* can be specified in several ways. You can use a
    quoted string (`''ab''`), hex string (`X''6162''`, `0x6162`), or bit value (`b''*`nnnn`*''`).'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: '*`gtrid`* 和 *`bqual`* 必须是字符串字面量，每个最多 64 字节（而非字符）长。*`gtrid`* 和 *`bqual`* 可以以几种方式指定。您可以使用带引号的字符串（`''ab''`）、十六进制字符串（`X''6162''`、`0x6162`）或位值（`b''*`nnnn`*''`）。'
- en: '*`formatID`* is an unsigned integer.'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '*`formatID`* 是一个无符号整数。'
- en: The *`gtrid`* and *`bqual`* values are interpreted in bytes by the MySQL server's
    underlying XA support routines. However, while an SQL statement containing an
    XA statement is being parsed, the server works with some specific character set.
    To be safe, write *`gtrid`* and *`bqual`* as hex strings.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '*`gtrid`* 和 *`bqual`* 值由 MySQL 服务器底层的 XA 支持程序解释为字节。然而，在解析包含 XA 语句的 SQL 语句时，服务器使用特定的字符集。为了安全起见，将
    *`gtrid`* 和 *`bqual`* 写成十六进制字符串。'
- en: '*`xid`* values typically are generated by the Transaction Manager. Values generated
    by one TM must be different from values generated by other TMs. A given TM must
    be able to recognize its own *`xid`* values in a list of values returned by the
    [`XA RECOVER`](xa-statements.html "15.3.8.1 XA Transaction SQL Statements") statement.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '*`xid`* 值通常由事务管理器生成。一个事务管理器生成的值必须与其他事务管理器生成的值不同。给定的事务管理器必须能够在 [`XA RECOVER`](xa-statements.html
    "15.3.8.1 XA Transaction SQL Statements") 语句返回的值列表中识别出自己的 *`xid`* 值。'
- en: '[`XA START *`xid`*`](xa-statements.html "15.3.8.1 XA Transaction SQL Statements")
    starts an XA transaction with the given *`xid`* value. Each XA transaction must
    have a unique *`xid`* value, so the value must not currently be used by another
    XA transaction. Uniqueness is assessed using the *`gtrid`* and *`bqual`* values.
    All following XA statements for the XA transaction must be specified using the
    same *`xid`* value as that given in the [`XA START`](xa-statements.html "15.3.8.1 XA
    Transaction SQL Statements") statement. If you use any of those statements but
    specify an *`xid`* value that does not correspond to some existing XA transaction,
    an error occurs.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '[`XA START *`xid`*`](xa-statements.html "15.3.8.1 XA Transaction SQL Statements")
    使用给定的 *`xid`* 值启动一个 XA 事务。每个 XA 事务必须具有唯一的 *`xid`* 值，因此该值不能当前被另一个 XA 事务使用。使用 *`gtrid`*
    和 *`bqual`* 值来评估唯一性。随后的所有 XA 语句必须使用与 [`XA START`](xa-statements.html "15.3.8.1 XA
    Transaction SQL Statements") 语句中给定的 *`xid`* 值相同的 *`xid`* 值指定。如果您使用这些语句之一，但指定的
    *`xid`* 值与某个现有 XA 事务不对应，则会发生错误。'
- en: Beginning with MySQL 8.0.31, `XA START`, `XA BEGIN`, `XA END`, `XA COMMIT`,
    and `XA ROLLBACK` statements are not filtered by the default database when the
    server is running with [`--replicate-do-db`](replication-options-replica.html#option_mysqld_replicate-do-db)
    or [`--replicate-ignore-db`](replication-options-replica.html#option_mysqld_replicate-ignore-db).
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 从 MySQL 8.0.31 开始，当服务器运行时带有 [`--replicate-do-db`](replication-options-replica.html#option_mysqld_replicate-do-db)
    或 [`--replicate-ignore-db`](replication-options-replica.html#option_mysqld_replicate-ignore-db)
    时，`XA START`、`XA BEGIN`、`XA END`、`XA COMMIT` 和 `XA ROLLBACK` 语句不会被默认数据库过滤。
- en: One or more XA transactions can be part of the same global transaction. All
    XA transactions within a given global transaction must use the same *`gtrid`*
    value in the *`xid`* value. For this reason, *`gtrid`* values must be globally
    unique so that there is no ambiguity about which global transaction a given XA
    transaction is part of. The *`bqual`* part of the *`xid`* value must be different
    for each XA transaction within a global transaction. (The requirement that *`bqual`*
    values be different is a limitation of the current MySQL XA implementation. It
    is not part of the XA specification.)
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 一个或多个 XA 事务可以是同一个全局事务的一部分。给定全局事务中的所有 XA 事务必须在 *`xid`* 值中使用相同的 *`gtrid`* 值。因此，*`gtrid`*
    值必须是全局唯一的，以确保对于给定 XA 事务是哪个全局事务的一部分没有歧义。 *`xid`* 值的 *`bqual`* 部分必须对于全局事务中的每个 XA
    事务都不同。 （*`bqual`* 值必须不同的要求是当前 MySQL XA 实现的限制。它不是 XA 规范的一部分。）
- en: The [`XA RECOVER`](xa-statements.html "15.3.8.1 XA Transaction SQL Statements")
    statement returns information for those XA transactions on the MySQL server that
    are in the `PREPARED` state. (See [Section 15.3.8.2, “XA Transaction States”](xa-states.html
    "15.3.8.2 XA Transaction States").) The output includes a row for each such XA
    transaction on the server, regardless of which client started it.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '[`XA RECOVER`](xa-statements.html "15.3.8.1 XA 事务 SQL 语句") 语句返回 MySQL 服务器上处于`PREPARED`状态的
    XA 事务的信息。（参见 [Section 15.3.8.2, “XA 事务状态”](xa-states.html "15.3.8.2 XA 事务状态").）输出包括服务器上每个这样的
    XA 事务的行，无论是哪个客户端启动的。'
- en: '[`XA RECOVER`](xa-statements.html "15.3.8.1 XA Transaction SQL Statements")
    requires the [`XA_RECOVER_ADMIN`](privileges-provided.html#priv_xa-recover-admin)
    privilege. This privilege requirement prevents users from discovering the XID
    values for outstanding prepared XA transactions other than their own. It does
    not affect normal commit or rollback of an XA transaction because the user who
    started it knows its XID.'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '[`XA RECOVER`](xa-statements.html "15.3.8.1 XA 事务 SQL 语句") 需要 [`XA_RECOVER_ADMIN`](privileges-provided.html#priv_xa-recover-admin)
    权限。这个权限要求阻止用户发现除了自己之外的未完成准备好的 XA 事务的 XID 值。它不影响 XA 事务的正常提交或回滚，因为启动它的用户知道它的 XID。'
- en: '[`XA RECOVER`](xa-statements.html "15.3.8.1 XA Transaction SQL Statements")
    output rows look like this (for an example *`xid`* value consisting of the parts
    `''abc''`, `''def''`, and `7`):'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '[`XA RECOVER`](xa-statements.html "15.3.8.1 XA 事务 SQL 语句") 输出行如下（对于由部分 `''abc''`、`''def''`
    和 `7` 组成的 *`xid`* 值的示例）：'
- en: '[PRE2]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The output columns have the following meanings:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 输出列的含义如下：
- en: '`formatID` is the *`formatID`* part of the transaction *`xid`*'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`formatID` 是事务 *`xid`* 的 *`formatID`* 部分'
- en: '`gtrid_length` is the length in bytes of the *`gtrid`* part of the *`xid`*'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`gtrid_length` 是 *`xid`* 的 *`gtrid`* 部分的字节长度'
- en: '`bqual_length` is the length in bytes of the *`bqual`* part of the *`xid`*'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bqual_length` 是 *`xid`* 的 *`bqual`* 部分的字节长度'
- en: '`data` is the concatenation of the *`gtrid`* and *`bqual`* parts of the *`xid`*'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`data` 是 *`xid`* 的 *`gtrid`* 和 *`bqual`* 部分的串联'
- en: XID values may contain nonprintable characters. [`XA RECOVER`](xa-statements.html
    "15.3.8.1 XA Transaction SQL Statements") permits an optional `CONVERT XID` clause
    so that clients can request XID values in hexadecimal.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: XID 值可能包含不可打印字符。[`XA RECOVER`](xa-statements.html "15.3.8.1 XA 事务 SQL 语句") 允许一个可选的
    `CONVERT XID` 子句，以便客户端可以请求十六进制的 XID 值。
